'use strict';(function(){var k={},h=(b,a,d,c)=>{b.prototype.constructor=b;b.__typeName=a;b.__class=!0;d&&(b.__baseType=d,b.__basePrototypePending=!1);0<c.length&&(b.__interfaces=c)};class m{static wa(b){var a=window.g_instantAppSettings;return{userSessionId:a.SessionId,buildVersion:a.BuildVersion,wacCluster:a.WacCluster,url:a.WebServiceBase,ja:a.Canary,accessToken:b?b.AccessToken:a.AccessToken,userType:a.UserType,Ia:a.RootQuerySignature,accessTokenTtl:b?b.AccessTokenTtl:""}}}h(m,"VisioBootOptionsFactory",
null,[]);class n{constructor(b){this.H=b}W(b,a,d){b=this.H.url+b;var c=null;if(d){d=d.substr(1).split("&");c=new FormData;for(let f of d)d=f.split("="),2==d.length&&c.append(d[0],d[1])}return this.xa(b,c,a)}xa(b,a,d){let c=new XMLHttpRequest;const f={};c.onreadystatechange=()=>{if(c&&4===c.readyState&&"undefined"!==typeof c.status)try{d&&d(c)}finally{null!=c&&(c.onreadystatechange=()=>{},c=void 0)}};c.open("Post",b,!0);this.ma(f);for(const l in f)"Content-Type"===l&&a||c.setRequestHeader(l,f[l]);
a?c.send(a):c.send("");return c}ma(b){b["X-xhr"]="1";b["X-LogHostRequests"]="1";this.H.userSessionId&&(b["X-UserSessionId"]=this.H.userSessionId);this.H.buildVersion&&(b["X-OfficeVersion"]=this.H.buildVersion);b["Content-Type"]="application/json; charset=utf-8";this.H.ja&&(b["X-Key"]=this.H.ja);this.H.accessToken&&(b["X-AccessToken"]=this.H.accessToken);this.H.accessTokenTtl&&(b["X-AccessTokenTtl"]=this.H.accessTokenTtl);this.H.userType&&(b["X-UserType"]=this.H.userType);this.H.wacCluster&&(b["X-WacCluster"]=
this.H.wacCluster);b["X-Requested-With"]="XMLHttpRequest"}}h(n,"VisioBootExecutor",null,[]);class e{constructor(b){this.K=this.fa=!1;this.Z=this.ga=0;this.Aa=()=>{this.la();let a=Number(window.g_instantAppSettings.WopiPendingSessionMessageTimeoutInMs);a&&window.setTimeout(()=>this.Ea(),a)};this.la=()=>{this.ka(e.ra);window.setTimeout(()=>this.Ba(),e.ua)};this.Ba=()=>{this.fa||this.K||(this.ga++,this.ga<e.va&&this.la())};this.Ea=()=>{this.K||e.J("WopiPendingSession_Timeout")};this.ka=a=>{var d={};
try{const c={MessageId:a,SendTime:Date.now(),Values:d};let f=this.ea;window.parent.postMessage(JSON.stringify(c),f)}catch(c){e.J("SendPostMessageToParentWindow",c.message+"\r\n"+c.stack)}};this.za=a=>{try{if(a.origin===this.ea){var d=void 0;try{d=JSON.parse(a.data)}catch(c){return}switch(d.MessageId){case e.na:this.fa=!0;break;case e.pa:if(this.K)break;this.K=!0;e.J("WopiPendingSession_Fail");break;case e.oa:this.ka(e.ta);if(this.K)break;this.K=!0;this.U=d.Values.WopiDetails;let c=this.W();this.ha(c);
break;case e.qa:"true"===window.g_instantAppSettings.IsAppShellPrebootSession.toLowerCase()&&"undefined"!==d.Values&&(window.g_createNewTemplateId=d.Values,"undefined"===typeof window.g_createNewTemplateIdAvailableCallback||window.g_createNewTemplateIdAvailableCallbackTriggered||(window.g_createNewTemplateIdAvailableCallbackTriggered=!0,window.g_createNewTemplateIdAvailableCallback()))}}}catch(c){e.J("ReceivePostMessage",c.message+"\r\n"+c.stack)}};this.W=()=>{try{const a=new n(m.wa(this.U));let d=
`WOPISrc=${encodeURIComponent(this.U.WopiSrc)}`;"true"===window.g_instantAppSettings.IsAppShellPrebootSession.toLowerCase()&&"undefined"!==this.U.CreateNewTemplateId&&(window.g_createNewTemplateId=this.U.CreateNewTemplateId,"undefined"===typeof window.g_createNewTemplateIdAvailableCallback||window.g_createNewTemplateIdAvailableCallbackTriggered||(window.g_createNewTemplateIdAvailableCallbackTriggered=!0,window.g_createNewTemplateIdAvailableCallback()),d+=`&wdTpl=${this.U.CreateNewTemplateId}`);window.location.search&&
(d+=`&${window.location.search.substr(1)}`);let c="";window.g_instantAppSettings.hasOwnProperty("VisioEditorStatSessionFormData")&&(c=window.g_instantAppSettings.VisioEditorStatSessionFormData);return a.W(`VisioEditorStartSession.aspx?${d}`,this.ya,c)}catch(a){e.J("MakeStartSessionRequest",a.message+"\r\n"+a.stack)}};this.ya=a=>{try{"true"===window.g_instantAppSettings.WopiStartSessionRetryEnabled.toLowerCase()&&this.Z<e.ia&&200!=a.status||(200!=a.status&&e.J("StartSession_Fail","Status: $(executor.status)"),
window.g_fullAppSettings=JSON.parse(a.responseText),window.g_fullAppSettingsAvailable=!0,window.g_appSettingsDownloaded=!0,"undefined"!==typeof window.g_fullAppSettingsReadyCallback&&window.g_fullAppSettingsReadyCallback())}catch(d){e.J("StartSession_AppSettingsParseError",d.message+"\r\n"+d.stack)}};this.ha=a=>{let d=Number(window.g_instantAppSettings.WopiStartSessionTimeoutInMs);d||(d=1E4);window.setTimeout(()=>this.Ga(a),d)};this.Ga=a=>{window.g_fullAppSettingsAvailable||("true"===window.g_instantAppSettings.WopiStartSessionRetryEnabled.toLowerCase()&&
this.Z<e.ia?(this.Z++,"undefined"!==typeof a&&(a.onreadystatechange=function(){},a.abort()),a=this.W(),this.ha(a)):("true"===window.g_instantAppSettings.WopiStartSessionRetryEnabled.toLowerCase()&&"undefined"!==typeof a&&(a.onreadystatechange=function(){},a.abort()),e.J("WopiStartSession_Timeout")))};window.g_fullAppSettingsAvailable=!1;window.g_createNewTemplateIdAvailableCallbackTriggered=!1;window.g_instantAppSettings=b;window.g_instantAppSettingsAvailable=!0;this.ea=b.VisioBootstrapperPostMessageOrigin;
window.addEventListener("message",a=>{this.za(a)},!1);this.Aa();"undefined"!==typeof window.makeInitialRequest&&window.makeInitialRequest(b)}}e.ra="WacInitialize_Ready";e.na="WacInitialize_Ready_Ack";e.oa="WopiPendingSession_Complete";e.ta="WopiSession_Complete_Ack";e.pa="WopiPendingSession_Fail";e.qa="TemplateInfo_Ready";e.ua=1E3;e.va=3;e.ia=3;e.J=(b,a)=>{window.g_isBootstrapperError=!0;window.g_bootstrapperError={ErrorCode:b,ErrorDetails:a};"undefined"!==typeof window.g_bootstrapperErrorHandler&&
window.g_bootstrapperErrorHandler()};h(e,"VisioEditorInstantApp",null,[]);window.VisioEditorInstantApp=e;h=window;for(var r in k)h[r]=k[r];k.Ha&&Object.defineProperty(h,"__esModule",{value:!0})})();

//# sourceMappingURL=VisioWeb.InstantEditApp1JS.js.map