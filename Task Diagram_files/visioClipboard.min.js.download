function asyncGeneratorStep(e,t,r,a,o,i,n){try{var s=e[i](n),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(a,o)}function _async_to_generator(e){return function(){var t=this,r=arguments;return new Promise((function(a,o){var i=e.apply(t,r);function n(e){asyncGeneratorStep(i,a,o,n,s,"next",e)}function s(e){asyncGeneratorStep(i,a,o,n,s,"throw",e)}n(void 0)}))}}function _define_property(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){_define_property(e,t,r[t])}))}return e}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function _object_spread_props(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}var visioClipboard;!function(){var e={5343:function(e,t){"use strict";function r(e){for(var t="";t.length<e;){var r=16*Math.random();t+=(r|=0).toString(16)}return t}var a=function(){function e(){}return e.generate=function(){var e=[];e.push(r(8)),e.push(r(4));var t="4"+r(3);e.push(t);var a=r(4),o=parseInt(a[0],10);return o&=3,a=(o|=8).toString(16)+a.substr(1),e.push(a),e.push(r(12)),e.join("-")},e.normalizeLower=function(t,r){return t?e._normalizeBrackets(t.toLowerCase(),r):""},e.normalizeUpper=function(t,r){return t?e._normalizeBrackets(t.toUpperCase(),r):""},e._normalizeBrackets=function(e,t){var r=e.match(/^\{(.*)\}$/);return r?t?r[0]:r[1]:t?"{"+e+"}":e},e}();a.Empty="00000000-0000-0000-0000-000000000000",t.A=a},3765:function(e){e.exports=function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,r){return t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(e,r)}function r(e,a,o){return r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,r,a){var o=[null];o.push.apply(o,r);var i=new(Function.bind.apply(e,o));return a&&t(i,a.prototype),i},r.apply(null,arguments)}function a(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var i=Object.hasOwnProperty,n=Object.setPrototypeOf,s=Object.isFrozen,l=Object.getPrototypeOf,c=Object.getOwnPropertyDescriptor,d=Object.freeze,p=Object.seal,u=Object.create,m="undefined"!=typeof Reflect&&Reflect,g=m.apply,h=m.construct;g||(g=function(e,t,r){return e.apply(t,r)}),d||(d=function(e){return e}),p||(p=function(e){return e}),h||(h=function(e,t){return r(e,a(t))});var f,S=A(Array.prototype.forEach),y=A(Array.prototype.pop),C=A(Array.prototype.push),b=A(String.prototype.toLowerCase),E=A(String.prototype.toString),w=A(String.prototype.match),_=A(String.prototype.replace),v=A(String.prototype.indexOf),I=A(String.prototype.trim),P=A(RegExp.prototype.test),T=(f=TypeError,function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return h(f,t)});function A(e){return function(t){for(var r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];return g(e,t,a)}}function L(e,t,r){var a;r=null!==(a=r)&&void 0!==a?a:b,n&&n(e,null);for(var o=t.length;o--;){var i=t[o];if("string"==typeof i){var l=r(i);l!==i&&(s(t)||(t[o]=l),i=l)}e[i]=!0}return e}function D(e){var t,r=u(null);for(t in e)!0===g(i,e,[t])&&(r[t]=e[t]);return r}function M(e,t){for(;null!==e;){var r=c(e,t);if(r){if(r.get)return A(r.get);if("function"==typeof r.value)return A(r.value)}e=l(e)}return function(e){return console.warn("fallback value for",e),null}}var x=d(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),k=d(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),W=d(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),$=d(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),F=d(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),U=d(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),O=d(["#text"]),R=d(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),J=d(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),N=d(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),j=d(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),z=p(/\{\{[\w\W]*|[\w\W]*\}\}/gm),H=p(/<%[\w\W]*|[\w\W]*%>/gm),V=p(/\${[\w\W]*}/gm),G=p(/^data-[\-\w.\u00B7-\uFFFF]/),B=p(/^aria-[\-\w]+$/),K=p(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),q=p(/^(?:\w+script|data):/i),Z=p(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),X=p(/^html$/i),Y=p(/^[a-z][.\w]*(-[.\w]+)+$/i);return function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"undefined"==typeof window?null:window,o=function(e){return t(e)};if(o.version="2.5.7",o.removed=[],!r||!r.document||9!==r.document.nodeType)return o.isSupported=!1,o;var i=r.document,n=r.document,s=r.DocumentFragment,l=r.HTMLTemplateElement,c=r.Node,p=r.Element,u=r.NodeFilter,m=r.NamedNodeMap,g=void 0===m?r.NamedNodeMap||r.MozNamedAttrMap:m,h=r.HTMLFormElement,f=r.DOMParser,A=r.trustedTypes,Q=p.prototype,ee=M(Q,"cloneNode"),te=M(Q,"nextSibling"),re=M(Q,"childNodes"),ae=M(Q,"parentNode");if("function"==typeof l){var oe=n.createElement("template");oe.content&&oe.content.ownerDocument&&(n=oe.content.ownerDocument)}var ie=function(t,r){if("object"!==e(t)||"function"!=typeof t.createPolicy)return null;var a=null,o="data-tt-policy-suffix";r.currentScript&&r.currentScript.hasAttribute(o)&&(a=r.currentScript.getAttribute(o));var i="dompurify"+(a?"#"+a:"");try{return t.createPolicy(i,{createHTML:function(e){return e},createScriptURL:function(e){return e}})}catch(e){return console.warn("TrustedTypes policy "+i+" could not be created."),null}}(A,i),ne=ie?ie.createHTML(""):"",se=n,le=se.implementation,ce=se.createNodeIterator,de=se.createDocumentFragment,pe=se.getElementsByTagName,ue=i.importNode,me={};try{me=D(n).documentMode?n.documentMode:{}}catch(e){}var ge={};o.isSupported="function"==typeof ae&&le&&void 0!==le.createHTMLDocument&&9!==me;var he,fe,Se=z,ye=H,Ce=V,be=G,Ee=B,we=q,_e=Z,ve=Y,Ie=K,Pe=null,Te=L({},[].concat(a(x),a(k),a(W),a(F),a(O))),Ae=null,Le=L({},[].concat(a(R),a(J),a(N),a(j))),De=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Me=null,xe=null,ke=!0,We=!0,$e=!1,Fe=!0,Ue=!1,Oe=!0,Re=!1,Je=!1,Ne=!1,je=!1,ze=!1,He=!1,Ve=!0,Ge=!1,Be=!0,Ke=!1,qe={},Ze=null,Xe=L({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),Ye=null,Qe=L({},["audio","video","img","source","image","track"]),et=null,tt=L({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),rt="http://www.w3.org/1998/Math/MathML",at="http://www.w3.org/2000/svg",ot="http://www.w3.org/1999/xhtml",it=ot,nt=!1,st=null,lt=L({},[rt,at,ot],E),ct=["application/xhtml+xml","text/html"],dt=null,pt=n.createElement("form"),ut=function(e){return e instanceof RegExp||e instanceof Function},mt=function(t){dt&&dt===t||(t&&"object"===e(t)||(t={}),t=D(t),he=he=-1===ct.indexOf(t.PARSER_MEDIA_TYPE)?"text/html":t.PARSER_MEDIA_TYPE,fe="application/xhtml+xml"===he?E:b,Pe="ALLOWED_TAGS"in t?L({},t.ALLOWED_TAGS,fe):Te,Ae="ALLOWED_ATTR"in t?L({},t.ALLOWED_ATTR,fe):Le,st="ALLOWED_NAMESPACES"in t?L({},t.ALLOWED_NAMESPACES,E):lt,et="ADD_URI_SAFE_ATTR"in t?L(D(tt),t.ADD_URI_SAFE_ATTR,fe):tt,Ye="ADD_DATA_URI_TAGS"in t?L(D(Qe),t.ADD_DATA_URI_TAGS,fe):Qe,Ze="FORBID_CONTENTS"in t?L({},t.FORBID_CONTENTS,fe):Xe,Me="FORBID_TAGS"in t?L({},t.FORBID_TAGS,fe):{},xe="FORBID_ATTR"in t?L({},t.FORBID_ATTR,fe):{},qe="USE_PROFILES"in t&&t.USE_PROFILES,ke=!1!==t.ALLOW_ARIA_ATTR,We=!1!==t.ALLOW_DATA_ATTR,$e=t.ALLOW_UNKNOWN_PROTOCOLS||!1,Fe=!1!==t.ALLOW_SELF_CLOSE_IN_ATTR,Ue=t.SAFE_FOR_TEMPLATES||!1,Oe=!1!==t.SAFE_FOR_XML,Re=t.WHOLE_DOCUMENT||!1,je=t.RETURN_DOM||!1,ze=t.RETURN_DOM_FRAGMENT||!1,He=t.RETURN_TRUSTED_TYPE||!1,Ne=t.FORCE_BODY||!1,Ve=!1!==t.SANITIZE_DOM,Ge=t.SANITIZE_NAMED_PROPS||!1,Be=!1!==t.KEEP_CONTENT,Ke=t.IN_PLACE||!1,Ie=t.ALLOWED_URI_REGEXP||Ie,it=t.NAMESPACE||ot,De=t.CUSTOM_ELEMENT_HANDLING||{},t.CUSTOM_ELEMENT_HANDLING&&ut(t.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(De.tagNameCheck=t.CUSTOM_ELEMENT_HANDLING.tagNameCheck),t.CUSTOM_ELEMENT_HANDLING&&ut(t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(De.attributeNameCheck=t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),t.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(De.allowCustomizedBuiltInElements=t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Ue&&(We=!1),ze&&(je=!0),qe&&(Pe=L({},a(O)),Ae=[],!0===qe.html&&(L(Pe,x),L(Ae,R)),!0===qe.svg&&(L(Pe,k),L(Ae,J),L(Ae,j)),!0===qe.svgFilters&&(L(Pe,W),L(Ae,J),L(Ae,j)),!0===qe.mathMl&&(L(Pe,F),L(Ae,N),L(Ae,j))),t.ADD_TAGS&&(Pe===Te&&(Pe=D(Pe)),L(Pe,t.ADD_TAGS,fe)),t.ADD_ATTR&&(Ae===Le&&(Ae=D(Ae)),L(Ae,t.ADD_ATTR,fe)),t.ADD_URI_SAFE_ATTR&&L(et,t.ADD_URI_SAFE_ATTR,fe),t.FORBID_CONTENTS&&(Ze===Xe&&(Ze=D(Ze)),L(Ze,t.FORBID_CONTENTS,fe)),Be&&(Pe["#text"]=!0),Re&&L(Pe,["html","head","body"]),Pe.table&&(L(Pe,["tbody"]),delete Me.tbody),d&&d(t),dt=t)},gt=L({},["mi","mo","mn","ms","mtext"]),ht=L({},["annotation-xml"]),ft=L({},["title","style","font","a","script"]),St=L({},k);L(St,W),L(St,$);var yt=L({},F);L(yt,U);var Ct=function(e){C(o.removed,{element:e});try{e.parentNode.removeChild(e)}catch(t){try{e.outerHTML=ne}catch(t){e.remove()}}},bt=function(e,t){try{C(o.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){C(o.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e&&!Ae[e])if(je||ze)try{Ct(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},Et=function(e){var t,r;if(Ne)e="<remove></remove>"+e;else{var a=w(e,/^[\r\n\t ]+/);r=a&&a[0]}"application/xhtml+xml"===he&&it===ot&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");var o=ie?ie.createHTML(e):e;if(it===ot)try{t=(new f).parseFromString(o,he)}catch(e){}if(!t||!t.documentElement){t=le.createDocument(it,"template",null);try{t.documentElement.innerHTML=nt?ne:o}catch(e){}}var i=t.body||t.documentElement;return e&&r&&i.insertBefore(n.createTextNode(r),i.childNodes[0]||null),it===ot?pe.call(t,Re?"html":"body")[0]:Re?t.documentElement:i},wt=function(e){return ce.call(e.ownerDocument||e,e,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null,!1)},_t=function(e){return e instanceof h&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof g)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},vt=function(t){return"object"===e(c)?t instanceof c:t&&"object"===e(t)&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName},It=function(e,t,r){ge[e]&&S(ge[e],(function(e){e.call(o,t,r,dt)}))},Pt=function(e){var t;if(It("beforeSanitizeElements",e,null),_t(e))return Ct(e),!0;if(P(/[\u0080-\uFFFF]/,e.nodeName))return Ct(e),!0;var r=fe(e.nodeName);if(It("uponSanitizeElement",e,{tagName:r,allowedTags:Pe}),e.hasChildNodes()&&!vt(e.firstElementChild)&&(!vt(e.content)||!vt(e.content.firstElementChild))&&P(/<[/\w]/g,e.innerHTML)&&P(/<[/\w]/g,e.textContent))return Ct(e),!0;if("select"===r&&P(/<template/i,e.innerHTML))return Ct(e),!0;if(7===e.nodeType)return Ct(e),!0;if(Oe&&8===e.nodeType&&P(/<[/\w]/g,e.data))return Ct(e),!0;if(!Pe[r]||Me[r]){if(!Me[r]&&At(r)){if(De.tagNameCheck instanceof RegExp&&P(De.tagNameCheck,r))return!1;if(De.tagNameCheck instanceof Function&&De.tagNameCheck(r))return!1}if(Be&&!Ze[r]){var a=ae(e)||e.parentNode,i=re(e)||e.childNodes;if(i&&a)for(var n=i.length-1;n>=0;--n){var s=ee(i[n],!0);s.__removalCount=(e.__removalCount||0)+1,a.insertBefore(s,te(e))}}return Ct(e),!0}return e instanceof p&&!function(e){var t=ae(e);t&&t.tagName||(t={namespaceURI:it,tagName:"template"});var r=b(e.tagName),a=b(t.tagName);return!!st[e.namespaceURI]&&(e.namespaceURI===at?t.namespaceURI===ot?"svg"===r:t.namespaceURI===rt?"svg"===r&&("annotation-xml"===a||gt[a]):Boolean(St[r]):e.namespaceURI===rt?t.namespaceURI===ot?"math"===r:t.namespaceURI===at?"math"===r&&ht[a]:Boolean(yt[r]):e.namespaceURI===ot?!(t.namespaceURI===at&&!ht[a])&&!(t.namespaceURI===rt&&!gt[a])&&!yt[r]&&(ft[r]||!St[r]):!("application/xhtml+xml"!==he||!st[e.namespaceURI]))}(e)?(Ct(e),!0):"noscript"!==r&&"noembed"!==r&&"noframes"!==r||!P(/<\/no(script|embed|frames)/i,e.innerHTML)?(Ue&&3===e.nodeType&&(t=e.textContent,t=_(t,Se," "),t=_(t,ye," "),t=_(t,Ce," "),e.textContent!==t&&(C(o.removed,{element:e.cloneNode()}),e.textContent=t)),It("afterSanitizeElements",e,null),!1):(Ct(e),!0)},Tt=function(e,t,r){if(Ve&&("id"===t||"name"===t)&&(r in n||r in pt))return!1;if(We&&!xe[t]&&P(be,t));else if(ke&&P(Ee,t));else if(!Ae[t]||xe[t]){if(!(At(e)&&(De.tagNameCheck instanceof RegExp&&P(De.tagNameCheck,e)||De.tagNameCheck instanceof Function&&De.tagNameCheck(e))&&(De.attributeNameCheck instanceof RegExp&&P(De.attributeNameCheck,t)||De.attributeNameCheck instanceof Function&&De.attributeNameCheck(t))||"is"===t&&De.allowCustomizedBuiltInElements&&(De.tagNameCheck instanceof RegExp&&P(De.tagNameCheck,r)||De.tagNameCheck instanceof Function&&De.tagNameCheck(r))))return!1}else if(et[t]);else if(P(Ie,_(r,_e,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==v(r,"data:")||!Ye[e])if($e&&!P(we,_(r,_e,"")));else if(r)return!1;return!0},At=function(e){return"annotation-xml"!==e&&w(e,ve)},Lt=function(t){var r,a,i,n;It("beforeSanitizeAttributes",t,null);var s=t.attributes;if(s){var l={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Ae};for(n=s.length;n--;){var c=r=s[n],d=c.name,p=c.namespaceURI;if(a="value"===d?r.value:I(r.value),i=fe(d),l.attrName=i,l.attrValue=a,l.keepAttr=!0,l.forceKeepAttr=void 0,It("uponSanitizeAttribute",t,l),a=l.attrValue,!l.forceKeepAttr&&(bt(d,t),l.keepAttr))if(Fe||!P(/\/>/i,a)){Ue&&(a=_(a,Se," "),a=_(a,ye," "),a=_(a,Ce," "));var u=fe(t.nodeName);if(Tt(u,i,a))if(!Ge||"id"!==i&&"name"!==i||(bt(d,t),a="user-content-"+a),Oe&&P(/((--!?|])>)|<\/(style|title)/i,a))bt(d,t);else{if(ie&&"object"===e(A)&&"function"==typeof A.getAttributeType)if(p);else switch(A.getAttributeType(u,i)){case"TrustedHTML":a=ie.createHTML(a);break;case"TrustedScriptURL":a=ie.createScriptURL(a)}try{p?t.setAttributeNS(p,d,a):t.setAttribute(d,a),_t(t)?Ct(t):y(o.removed)}catch(e){}}}else bt(d,t)}It("afterSanitizeAttributes",t,null)}},Dt=function e(t){var r,a=wt(t);for(It("beforeSanitizeShadowDOM",t,null);r=a.nextNode();)It("uponSanitizeShadowNode",r,null),Pt(r)||(r.content instanceof s&&e(r.content),Lt(r));It("afterSanitizeShadowDOM",t,null)};return o.sanitize=function(t){var a,n,l,d,p,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((nt=!t)&&(t="\x3c!--\x3e"),"string"!=typeof t&&!vt(t)){if("function"!=typeof t.toString)throw T("toString is not a function");if("string"!=typeof(t=t.toString()))throw T("dirty is not a string, aborting")}if(!o.isSupported){if("object"===e(r.toStaticHTML)||"function"==typeof r.toStaticHTML){if("string"==typeof t)return r.toStaticHTML(t);if(vt(t))return r.toStaticHTML(t.outerHTML)}return t}if(Je||mt(u),o.removed=[],"string"==typeof t&&(Ke=!1),Ke){if(t.nodeName){var m=fe(t.nodeName);if(!Pe[m]||Me[m])throw T("root node is forbidden and cannot be sanitized in-place")}}else if(t instanceof c)1===(n=(a=Et("\x3c!----\x3e")).ownerDocument.importNode(t,!0)).nodeType&&"BODY"===n.nodeName||"HTML"===n.nodeName?a=n:a.appendChild(n);else{if(!je&&!Ue&&!Re&&-1===t.indexOf("<"))return ie&&He?ie.createHTML(t):t;if(!(a=Et(t)))return je?null:He?ne:""}a&&Ne&&Ct(a.firstChild);for(var g=wt(Ke?t:a);l=g.nextNode();)3===l.nodeType&&l===d||Pt(l)||(l.content instanceof s&&Dt(l.content),Lt(l),d=l);if(d=null,Ke)return t;if(je){if(ze)for(p=de.call(a.ownerDocument);a.firstChild;)p.appendChild(a.firstChild);else p=a;return(Ae.shadowroot||Ae.shadowrootmod)&&(p=ue.call(i,p,!0)),p}var h=Re?a.outerHTML:a.innerHTML;return Re&&Pe["!doctype"]&&a.ownerDocument&&a.ownerDocument.doctype&&a.ownerDocument.doctype.name&&P(X,a.ownerDocument.doctype.name)&&(h="<!DOCTYPE "+a.ownerDocument.doctype.name+">\n"+h),Ue&&(h=_(h,Se," "),h=_(h,ye," "),h=_(h,Ce," ")),ie&&He?ie.createHTML(h):h},o.setConfig=function(e){mt(e),Je=!0},o.clearConfig=function(){dt=null,Je=!1},o.isValidAttribute=function(e,t,r){dt||mt({});var a=fe(e),o=fe(t);return Tt(a,o,r)},o.addHook=function(e,t){"function"==typeof t&&(ge[e]=ge[e]||[],C(ge[e],t))},o.removeHook=function(e){if(ge[e])return y(ge[e])},o.removeHooks=function(e){ge[e]&&(ge[e]=[])},o.removeAllHooks=function(){ge={}},o}()}()},2440:function(e,t,r){"use strict";r.r(t),r.d(t,{__assign:function(){return i},__asyncDelegator:function(){return I},__asyncGenerator:function(){return v},__asyncValues:function(){return P},__await:function(){return _},__awaiter:function(){return g},__classPrivateFieldGet:function(){return M},__classPrivateFieldIn:function(){return k},__classPrivateFieldSet:function(){return x},__createBinding:function(){return f},__decorate:function(){return s},__esDecorate:function(){return c},__exportStar:function(){return S},__extends:function(){return o},__generator:function(){return h},__importDefault:function(){return D},__importStar:function(){return L},__makeTemplateObject:function(){return T},__metadata:function(){return m},__param:function(){return l},__propKey:function(){return p},__read:function(){return C},__rest:function(){return n},__runInitializers:function(){return d},__setFunctionName:function(){return u},__spread:function(){return b},__spreadArray:function(){return w},__spreadArrays:function(){return E},__values:function(){return y}});var a=function(e,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},a(e,t)};function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var i=function(){return i=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},i.apply(this,arguments)};function n(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(r[a[o]]=e[a[o]])}return r}function s(e,t,r,a){var o,i=arguments.length,n=i<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,a);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(n=(i<3?o(n):i>3?o(t,r,n):o(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n}function l(e,t){return function(r,a){t(r,a,e)}}function c(e,t,r,a,o,i){function n(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var s,l=a.kind,c="getter"===l?"get":"setter"===l?"set":"value",d=!t&&e?a.static?e:e.prototype:null,p=t||(d?Object.getOwnPropertyDescriptor(d,a.name):{}),u=!1,m=r.length-1;m>=0;m--){var g={};for(var h in a)g[h]="access"===h?{}:a[h];for(var h in a.access)g.access[h]=a.access[h];g.addInitializer=function(e){if(u)throw new TypeError("Cannot add initializers after decoration has completed");i.push(n(e||null))};var f=(0,r[m])("accessor"===l?{get:p.get,set:p.set}:p[c],g);if("accessor"===l){if(void 0===f)continue;if(null===f||"object"!=typeof f)throw new TypeError("Object expected");(s=n(f.get))&&(p.get=s),(s=n(f.set))&&(p.set=s),(s=n(f.init))&&o.push(s)}else(s=n(f))&&("field"===l?o.push(s):p[c]=s)}d&&Object.defineProperty(d,a.name,p),u=!0}function d(e,t,r){for(var a=arguments.length>2,o=0;o<t.length;o++)r=a?t[o].call(e,r):t[o].call(e);return a?r:void 0}function p(e){return"symbol"==typeof e?e:"".concat(e)}function u(e,t,r){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function m(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function g(e,t,r,a){return new(r||(r=Promise))((function(o,i){function n(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}l((a=a.apply(e,t||[])).next())}))}function h(e,t){var r,a,o,i,n={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(l){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(n=0)),n;)try{if(r=1,a&&(o=2&s[0]?a.return:s[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,s[1])).done)return o;switch(a=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return n.label++,{value:s[1],done:!1};case 5:n.label++,a=s[1],s=[0];continue;case 7:s=n.ops.pop(),n.trys.pop();continue;default:if(!((o=(o=n.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){n=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(6===s[0]&&n.label<o[1]){n.label=o[1],o=s;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(s);break}o[2]&&n.ops.pop(),n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e],a=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}var f=Object.create?function(e,t,r,a){void 0===a&&(a=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,o)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]};function S(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||f(t,e,r)}function y(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],a=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function C(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var a,o,i=r.call(e),n=[];try{for(;(void 0===t||t-- >0)&&!(a=i.next()).done;)n.push(a.value)}catch(e){o={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return n}function b(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(C(arguments[t]));return e}function E(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var a=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],n=0,s=i.length;n<s;n++,o++)a[o]=i[n];return a}function w(e,t,r){if(r||2===arguments.length)for(var a,o=0,i=t.length;o<i;o++)!a&&o in t||(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))}function _(e){return this instanceof _?(this.v=e,this):new _(e)}function v(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a,o=r.apply(e,t||[]),i=[];return a={},n("next"),n("throw"),n("return"),a[Symbol.asyncIterator]=function(){return this},a;function n(e){o[e]&&(a[e]=function(t){return new Promise((function(r,a){i.push([e,t,r,a])>1||s(e,t)}))})}function s(e,t){try{(r=o[e](t)).value instanceof _?Promise.resolve(r.value.v).then(l,c):d(i[0][2],r)}catch(e){d(i[0][3],e)}var r}function l(e){s("next",e)}function c(e){s("throw",e)}function d(e,t){e(t),i.shift(),i.length&&s(i[0][0],i[0][1])}}function I(e){var t,r;return t={},a("next"),a("throw",(function(e){throw e})),a("return"),t[Symbol.iterator]=function(){return this},t;function a(a,o){t[a]=e[a]?function(t){return(r=!r)?{value:_(e[a](t)),done:!1}:o?o(t):t}:o}}function P(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=y(e),t={},a("next"),a("throw"),a("return"),t[Symbol.asyncIterator]=function(){return this},t);function a(r){t[r]=e[r]&&function(t){return new Promise((function(a,o){!function(e,t,r,a){Promise.resolve(a).then((function(t){e({value:t,done:r})}),t)}(a,o,(t=e[r](t)).done,t.value)}))}}}function T(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var A=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function L(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&f(t,e,r);return A(t,e),t}function D(e){return e&&e.__esModule?e:{default:e}}function M(e,t,r,a){if("a"===r&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)}function x(e,t,r,a,o){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?o.call(e,r):o?o.value=r:t.set(e,r),r}function k(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}},4107:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promises=void 0;const r={},a="promises";t.promises=function(){return void 0===r[a]&&(r[a]="undefined"!=typeof Promise&&"function"==typeof Promise.resolve&&"function"==typeof Promise.resolve(0).then),r[a]}},7265:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNewGuid=void 0,t.getNewGuid=function(){const e=new Uint8Array(31),t=function(e){const t={crypto:!1,perfNow:!1,exceptions:[]},r="undefined"!=typeof crypto?crypto:"undefined"!=typeof msCrypto?msCrypto:void 0;if(r){t.crypto=!0;try{return r.getRandomValues(e),t}catch(e){t.exceptions.push(`crypto: ${JSON.stringify(e)}`)}}let a=!1;const o="undefined"!=typeof performance?performance:void 0;try{o&&o.now&&o.now()!==1/0&&(a=!0)}catch(e){t.exceptions.push(`perfNow: ${JSON.stringify(e)}`)}for(let r=0;r<e.length;r+=1){try{if(a){t.perfNow=!0;let e=Math.floor(100*o.now())%10;(e<0||e>9)&&(e=0);for(let t=0;t<e;t+=1)Math.random()}}catch(e){t.exceptions.push(`Math.random: ${JSON.stringify(e)}`)}e[r]=Math.floor(16*Math.random())}return t}(e);let r=0;return["xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const a=15&e[r];return r+=1,("x"===t?a:3&a|8).toString(16)})),t]}},8747:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isReplaceChildrenSupported=t.replaceChildren=void 0,t.replaceChildren=e=>{if(e)if((0,t.isReplaceChildrenSupported)(e))e.replaceChildren();else for(;e.lastChild;)e.removeChild(e.lastChild)},t.isReplaceChildrenSupported=e=>!!e.replaceChildren},1450:function(e,t,r){"use strict";t.TZ=t.nh=t.kp=t.Hv=t.Wp=t.kA=void 0;const a=r(1691);t.Wp=a;const o=r(896);Object.defineProperty(t,"Hv",{enumerable:!0,get:function(){return o.ULS}}),Object.defineProperty(t,"kp",{enumerable:!0,get:function(){return o.TraceLevel}}),Object.defineProperty(t,"nh",{enumerable:!0,get:function(){return o.LogCategory}}),r(4107);const i=r(9084);t.TZ=i;r(1837),r(8054);var n=r(7265);Object.defineProperty(t,"kA",{enumerable:!0,get:function(){return n.getNewGuid}});r(5168),r(8747)},896:function(e,t){"use strict";var r,a;Object.defineProperty(t,"__esModule",{value:!0}),t.NulLogger=t.ConsoleLogger=t.ULS=t.LogCategory=t.TraceLevel=void 0,function(e){e[e.Error=10]="Error",e[e.Warning=15]="Warning",e[e.Info=50]="Info",e[e.Verbose=100]="Verbose",e[e.Spam=200]="Spam"}(r||(t.TraceLevel=r={})),function(e){e[e.msoulscat_ES_EWAJS=0]="msoulscat_ES_EWAJS"}(a||(t.LogCategory=a={})),t.ULS={getFromExternalLogger:function(e){const t=e;return{ULS:{trace:(e,r,a)=>t.traceTag(0,e,r,a),traceTag:(e,r,a,o)=>t.traceTag(e,r,a,o),debugTrace:(e,r,a)=>t.debugTraceTag(0,e,r,a),debugTraceTag:(e,r,a,o)=>t.debugTraceTag(e,r,a,o),assert:(e,r,a)=>t.assertTag(0,e,r,a),assertTag:(e,r,a,o)=>t.assertTag(e,r,a,o),shipAssert:(e,r,a)=>t.shipAssertTag(0,e,r,a),shipAssertTag:(e,r,a,o)=>t.shipAssertTag(e,r,a,o),dnmTrace:(e,r,a)=>t.dnmTraceTag(0,e,r,a),dnmTraceTag:(e,r,a,o)=>t.dnmTraceTag(e,r,a,o)}}}},t.ConsoleLogger=class{shipAssertTag(e,t,r,a){console.assert(r,"shipAssertTag:",e,t,a)}assertTag(e,t,r,a){console.assert(r,"assertTag",e,t,a)}traceTag(e,t,r,a){console.log("traceTag",e,a,t,r)}dnmTraceTag(e,t,r,a){console.log("dnmTraceTag",e,a,t,r)}debugTraceTag(e,t,r,a){console.log("debugTraceTag",e,a,t,r)}},t.NulLogger=class{shipAssertTag(){}assertTag(){}traceTag(){}debugTraceTag(){}dnmTraceTag(){}}},9084:function(e,t){"use strict";function r(){const e="undefined"!=typeof self?self:window;return e.performance&&e.performance.now?e.performance.now():Date.now()}function a(e,t,a){e[t]=r()-a}Object.defineProperty(t,"__esModule",{value:!0}),t.timeStamp=t.failure=t.success=t.end=t.mark=t.start=void 0,t.start=function(e){const t=r(),o=e,i=t,n={},s=(e,t,r)=>function(e,t,r,o,i,n){a(e,"end",r);const s={sessionName:t,result:o?"success":"failure",message:n,marks:e};i(JSON.stringify(s))}(n,o,i,e,t,r);return n.start=0,{mark:e=>(e=>a(n,e,i))(e),end:e=>s(!0,e),success:(e,t)=>s(!0,e,t),failure:(e,t)=>s(!1,e,t)}},t.mark=function(e,t){void 0!==e&&e.mark(t)},t.end=function(e,t){void 0!==e&&e.end(t)},t.success=function(e,t,r){void 0!==e&&e.success(t,r)},t.failure=function(e,t,r){void 0!==e&&e.failure(t,r)},t.timeStamp=r},5168:function(e,t){"use strict";var r,a;Object.defineProperty(t,"__esModule",{value:!0}),t.TextAreaInputMode=t.TextAreaVirtualKeyboardPolicy=void 0,function(e){e.Auto="auto",e.Manual="manual"}(r||(t.TextAreaVirtualKeyboardPolicy=r={})),function(e){e.None="none",e.Text="text",e.Tel="tel",e.Url="url",e.Email="email",e.Numeric="numeric",e.Decimal="decimal",e.Search="search"}(a||(t.TextAreaInputMode=a={}))},1837:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initStopwatchFactory=void 0;let r=()=>Date.now();t.initStopwatchFactory=function(e,t=1){return"undefined"!=typeof self&&self.performance&&self.performance.now&&(r=()=>self.performance.now()),function(a){let o=r(),i=a;return{reset(e){null!=e&&(i=e),o=r()},stop(a){const n=r()-o,s=JSON.stringify({Target:i,Duration:n.toFixed(t),StopInfo:a});e(s)}}}}},8054:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TelemetryCollector=void 0,t.TelemetryCollector=class{getJsonForLogging(){return'{"Events":'+this.getEventsLoggableString()+',"Counters":'+this.getCountersLoggableString()+',"Timers":'+this.getTimersLoggableString()+"}"}addEvent(e,t){null!=e&&null!=t&&(this.events[e]=t)}clearEvents(){this.events={}}getEventsLoggableString(){return JSON.stringify(this.events)}incrementCounter(e){null!=e&&(this.counters.hasOwnProperty(e)?this.counters[e]+=1:this.counters[e]=1)}getCountersLoggableString(){return JSON.stringify(this.counters)}clearCounters(){this.counters={}}startTimer(e){null!=e&&(this.timers[e]={name:e,startTime:Date.now(),endTime:void 0,isRunning:!0,duration:void 0})}endTimer(e){null!=e&&this.timers.hasOwnProperty(e)&&(this.timers[e].endTime=Date.now(),this.timers[e].isRunning=!1,this.timers[e].duration=this.timers[e].endTime-this.timers[e].startTime)}getTimerDuration(e){return null==e?"-1":this.timers.hasOwnProperty(e)&&void 0!==this.timers[e].duration?this.timers[e].duration:"-1"}getTimersLoggableString(){return JSON.stringify(this.timers)}constructor(){this.counters={},this.timers={},this.events={}}}},1691:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.calcHashCode=t.decodeHtml=t.getQueryParameterByName=t.chainFallbackPromises=t.retry=t.getPerfWatchMarkName=t.getStringifiedError=t.defaultToJSONResultWhenStringifyFails=t.forEachPromise=void 0,t.forEachPromise=function(e,t,r){return e.reduce(((e,a)=>e.then((()=>r&&r.stop?Promise.resolve(void 0):t(a,r)))),Promise.resolve(void 0))},t.defaultToJSONResultWhenStringifyFails="...",t.getStringifiedError=function(e){if(0===e)return"0";if(!e)return"";try{return JSON.stringify(a(e))}catch(e){return t.defaultToJSONResultWhenStringifyFails}};const r=5;function a(e,t=0){if(t<0||t>r)return e;if(null==e||"object"!=typeof e)return e;const o={};Object.getOwnPropertyNames(e).forEach((t=>{"stack"!==t&&t.toUpperCase()!==t&&(o[t]=e[t])}));const i=Object.getPrototypeOf(e);i&&"object"==typeof i&&Object.keys(i).forEach((t=>{"stack"!==t&&t.toUpperCase()!==t&&(o[t]=e[t])}));const n={};return Object.keys(o).forEach((e=>{n[e]=a(o[e],t+1)})),n}const o=new RegExp("\\W+","g");t.getPerfWatchMarkName=function(e){if(!e)return"";let t=e.trim().substring(0,200).trim().replace(o,"_").substring(0,80);return t&&t.length>0&&"_"===t.substr(t.length-1,1)&&(t=t.substr(0,t.length-1)),t&&t.length>0&&"_"===t.substr(0,1)&&(t=t.substr(1)),t},t.retry=function(e,t){if(!e)return Promise.reject(new Error("utils.retry: action can't be null or undefined"));if(t<1)return Promise.reject(new Error(`utils.retry: attempts expected to be greater than 0 but got ${t}`));let r=Promise.reject();for(let a=1;a<=t;a+=1)r=r.catch((t=>e(a,t)));return r},t.chainFallbackPromises=function(e,t){if(!e||0===e.length)return Promise.reject();let r=t(e[0]);for(let a=1;a<e.length;a+=1){const o=e[a];r=r.catch((()=>t(o)))}return r},t.getQueryParameterByName=function(e,t){const r=new RegExp(`[?&]${t}(=([^&#]*)|&|#|$)`).exec(e);if(r)return r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):""},t.decodeHtml=function(e){return"string"==typeof e?(new DOMParser).parseFromString(e,"text/html").documentElement.textContent:e},t.calcHashCode=function(e){if(!e)return 0;let t=5381,r=t;const a=e.length;for(let o=0;o<a&&(t=4294967295&((t<<5)+t^e.charCodeAt(o)),o!==a-1);o+=2)r=4294967295&((r<<5)+r^e.charCodeAt(o+1));let o=t+35685*r+(23896*r<<16)&4294967295;return o<0&&(o+=4294967296),o}},9773:function(e,t){"use strict";function r(){return void 0===globalThis.__get_change_gate_dictionary_variable?{}:globalThis.__get_change_gate_dictionary_variable()}Object.defineProperty(t,"__esModule",{value:!0}),t.setChangeGateDictionaryGetter=t.isChangeGateEnabled=t.getChangeGateDictionary=void 0,t.getChangeGateDictionary=r,t.isChangeGateEnabled=function(e){var t;return null===(t=r()[e])||void 0===t||t},t.setChangeGateDictionaryGetter=function(e){const t=globalThis.__get_change_gate_dictionary_variable;return globalThis.__get_change_gate_dictionary_variable=e,t}},9574:function(e,t){"use strict";function r(e){return e.split("")}Object.defineProperty(t,"__esModule",{value:!0}),t.editDistance=void 0,t.editDistance=function(e,t){const a=r(e),o=r(t);let i=[];for(let e=0;e<=o.length;++e)i[e]=e;for(let e=1;e<=a.length;++e){const t=[e];for(let r=1;r<=o.length;++r)t[r]=a[e-1]===o[r-1]?i[r-1]:1+Math.min(i[r],i[r-1],t[r-1]);i=t}return i[o.length]}},1491:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setFeatureGateDictionaryGetter=t.getIntFeatureGate=t.getNumberFeatureGate=t.getBooleanFeatureGate=t.getStringFeatureGate=t.getFeatureGateDictionary=t.enableVerboseMode=t.disableVerboseMode=void 0;const a=r(9574);t.disableVerboseMode=function(){globalThis.__office_online_feature_gates_verbose_log_callback=void 0},t.enableVerboseMode=function(e){globalThis.__office_online_feature_gates_verbose_log_callback=e};const o={};function i(){return void 0===globalThis.__get_feature_gate_dictionary_variable?o:globalThis.__get_feature_gate_dictionary_variable()}function n(e,t){var r;if(void 0===globalThis.__office_online_feature_gates_verbose_log_callback)return null!==(r=i()[e])&&void 0!==r?r:t;const o=i();var n;if(Object.hasOwn(o,e))return null!==(n=o[e])&&void 0!==n?n:t;const s=globalThis.__office_online_feature_gates_verbose_log_callback;s(`Failed lookup for FeatureGate ${e}...`);const l=[],c=e.toLowerCase();for(const e of Object.keys(o))(0,a.editDistance)(e.toLowerCase(),c)<=4&&l.push(e);return l.length>0&&s(`Potential candidates found (edit distance <= 4, case-insensitive): [${l.join(", ")}]`),s(`FeatureGate override not found, returning default: ${t}`),t}t.getFeatureGateDictionary=i,t.getStringFeatureGate=n,t.getBooleanFeatureGate=function(e,t){var r;const a=null===(r=n(e))||void 0===r?void 0:r.trim().toLowerCase();return"true"===a||"false"!==a&&t},t.getNumberFeatureGate=function(e,t){var r;const a=null===(r=n(e))||void 0===r?void 0:r.trim().toLowerCase();if(void 0===a)return t;if("infinity"===a||"+infinity"===a)return 1/0;if("-infinity"===a)return-1/0;const o=parseFloat(a);return isNaN(o)?t:o},t.getIntFeatureGate=function(e,t){var r;const a=null===(r=n(e))||void 0===r?void 0:r.trim();if(void 0===a)return t;const o=parseInt(a,10);return isNaN(o)?t:o},t.setFeatureGateDictionaryGetter=function(e){const t=globalThis.__get_feature_gate_dictionary_variable;return globalThis.__get_feature_gate_dictionary_variable=e,t}},8181:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=r(2440);a.__exportStar(r(1491),t),a.__exportStar(r(6422),t),a.__exportStar(r(9773),t),a.__exportStar(r(2571),t),a.__exportStar(r(7861),t),a.__exportStar(r(8571),t)},6422:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeGetTypedFeatureGate=void 0;const a=r(1491);t.makeGetTypedFeatureGate=function(e){return function(t){const r=e[t];switch(typeof r){case"boolean":return(0,a.getBooleanFeatureGate)(t,r);case"number":return(0,a.getNumberFeatureGate)(t,r);case"string":return(0,a.getStringFeatureGate)(t,r);default:throw new Error("Wrong defaultValue type")}}}},2571:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeTypedIsChangeGateEnabled=void 0;const a=r(9773);t.makeTypedIsChangeGateEnabled=function(e){return e=>(0,a.isChangeGateEnabled)(e)}},7861:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.overrideTypedChangeGates=t.overrideChangeGates=void 0;const a=r(9773);function o(e){const t=(0,a.setChangeGateDictionaryGetter)(void 0);return(0,a.setChangeGateDictionaryGetter)((()=>_object_spread({},void 0!==t?t():{},e))),t}t.overrideChangeGates=o,t.overrideTypedChangeGates=function(e,t){return o(t)}},8571:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.overrideTypedFeatureGates=t.overrideFeatureGates=void 0;const a=r(1491);function o(e){const t={};for(const a of Object.keys(e)){var r;t[a]=null===(r=e[a])||void 0===r?void 0:r.toString()}var o;const i=null!==(o=(0,a.setFeatureGateDictionaryGetter)(void 0))&&void 0!==o?o:()=>({});return(0,a.setFeatureGateDictionaryGetter)((()=>_object_spread({},i(),t))),i}t.overrideFeatureGates=o,t.overrideTypedFeatureGates=function(e,t){return o(t)}}},t={};function r(a){var o=t[a];if(void 0!==o)return o.exports;var i=t[a]={exports:{}};return e[a].call(i.exports,i,i.exports,r),i.exports}r.d=function(e,t){for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};!function(){"use strict";let e,t;function o(t,r){return e&&e[t]?e[t]:r}r.r(a),r.d(a,{Base64Image:function(){return So},ClipboardData:function(){return ho},ClipboardManager:function(){return Io},ImageDimension:function(){return yo},PackageCopyError:function(){return no},PackagePasteError:function(){return io},PasteSessionInfo:function(){return so},SvgData:function(){return fo},testCopy:function(){return xo},testPaste:function(){return ko}});const i=(e,t=!1)=>t;var n=r(1450);let s;function l(){return s}function c(e){if(!e)throw new Error("The 'logger' argument is missing");s=n.Hv.getFromExternalLogger(e)}const d="",p=".",u="1";var m,g,h,f,S,y;function C(e,t){return b(e,[t])}function b(e,t){if(!function(e){if(!e||"object"!=typeof e||!("reason"in e))return!1;return!!function(e){if(!e&&0!==e)return!1;const t=Number(e);return!isNaN(t)&&t.toString()===e.toString()}(e.reason)}(e))return!1;if(!t||!Array.isArray(t)||t.length<1)return!1;const r=e.reason;return t.indexOf(r)>=0}function E(e){if(e&&"object"==typeof e){if(w(e.reason))return!0;if(e.innerError&&"string"==typeof e.innerError)try{if(w(JSON.parse(e.innerError).reason))return!0}catch(e){}}if("string"==typeof e)try{if(w(JSON.parse(e).reason))return!0}catch(e){}return!1}function w(e){return e===h.LocalStorageInitilizationInaccessible}(g=m||(m={}))[g.SystemClipboard=0]="SystemClipboard",g[g.FullAccessClipboardAndInMemory=3]="FullAccessClipboardAndInMemory",g[g.InMemory=4]="InMemory",g[g.LocalStorage=5]="LocalStorage",g[g.SystemClipboardAndLocalStorage=6]="SystemClipboardAndLocalStorage",g[g.SystemClipboardAndInMemory=7]="SystemClipboardAndInMemory",g[g.AsyncSystemClipboard=8]="AsyncSystemClipboard",g[g.AsyncSystemClipboardAndLocalStorage=9]="AsyncSystemClipboardAndLocalStorage",g[g.AsyncSystemClipboardAndInMemory=10]="AsyncSystemClipboardAndInMemory",function(e){e[e.UnsupportedClipboardStrategyType=0]="UnsupportedClipboardStrategyType",e[e.UnsupportedClipboardStorageType=1]="UnsupportedClipboardStorageType",e[e.ClipboardIsInaccessible=2]="ClipboardIsInaccessible",e[e.SetClipboardItems=3]="SetClipboardItems",e[e.GetClipboardItems=5]="GetClipboardItems",e[e.NoGetOperationResultMessage=7]="NoGetOperationResultMessage",e[e.NoSetOperationResultMessage=8]="NoSetOperationResultMessage",e[e.ClearClipboardItems=9]="ClearClipboardItems",e[e.MissingBrowserExtensionCapability=10]="MissingBrowserExtensionCapability",e[e.NoBrowserExtensionsInConfiguration=11]="NoBrowserExtensionsInConfiguration",e[e.NoAvailableBrowserExtensions=12]="NoAvailableBrowserExtensions",e[e.UnavailableBrowserExtension=13]="UnavailableBrowserExtension",e[e.NoBrowserExtensionWithGetClipboardDataCommand=14]="NoBrowserExtensionWithGetClipboardDataCommand",e[e.SelectClipboardStrategy=15]="SelectClipboardStrategy",e[e.IframeInitialization=16]="IframeInitialization",e[e.UnsupportedOperationCode=26]="UnsupportedOperationCode",e[e.RejectingPendingPastePromiseDueToNewPasteOperation=27]="RejectingPendingPastePromiseDueToNewPasteOperation",e[e.RejectingPendingCutCopyPromiseDueToNewCutCopyOperation=28]="RejectingPendingCutCopyPromiseDueToNewCutCopyOperation",e[e.RejectingBlockedSyncCutCopyPromise=29]="RejectingBlockedSyncCutCopyPromise",e[e.IframeInitializationTimeout=30]="IframeInitializationTimeout",e[e.ClipboardStrategyNotInitialized=33]="ClipboardStrategyNotInitialized",e[e.UnexpectedClipboardTextHtmlContentLength=34]="UnexpectedClipboardTextHtmlContentLength",e[e.InvalidClipboardStrategyType=35]="InvalidClipboardStrategyType",e[e.CreateWindowRPCServer=36]="CreateWindowRPCServer",e[e.RefreshMetadata=37]="RefreshMetadata",e[e.DeserializedMetadata=38]="DeserializedMetadata",e[e.SerializedMetadata=39]="SerializedMetadata",e[e.LocalStorageInitilizationInaccessible=40]="LocalStorageInitilizationInaccessible",e[e.LocalStorageInitilizationNoKey=41]="LocalStorageInitilizationNoKey",e[e.IframeProxyGeneralError=42]="IframeProxyGeneralError",e[e.IframeProxyEmptyResultMessage=43]="IframeProxyEmptyResultMessage"}(h||(h={})),function(e){e[e.MissingArgumentError=0]="MissingArgumentError",e[e.CopyFlowHandlerNotFound=1]="CopyFlowHandlerNotFound",e[e.FetchCopyFlowHandlerFailed=2]="FetchCopyFlowHandlerFailed",e[e.FetchSourceItemFailed=3]="FetchSourceItemFailed",e[e.BeforeSerializeFailed=4]="BeforeSerializeFailed",e[e.SerializeFailed=5]="SerializeFailed",e[e.SerializeResultNotValid=6]="SerializeResultNotValid",e[e.AsyncSerializeFailed=7]="AsyncSerializeFailed",e[e.SaveToTheClipboardFailed=8]="SaveToTheClipboardFailed",e[e.InspectClipboardFailed=9]="InspectClipboardFailed",e[e.ClipboardIsInaccessible=10]="ClipboardIsInaccessible",e[e.SuccessiveCutCopyOverridingPendingCutCopy=11]="SuccessiveCutCopyOverridingPendingCutCopy",e[e.BlockedSynchronousCutCopy=12]="BlockedSynchronousCutCopy",e[e.CopyOperationCancelled=13]="CopyOperationCancelled",e[e.UnknownCopyErrorType=14]="UnknownCopyErrorType"}(f||(f={})),function(e){e[e.MissingArgumentError=0]="MissingArgumentError",e[e.PasteFlowHandlerNotFound=1]="PasteFlowHandlerNotFound",e[e.FetchPasteFlowHandlerFailed=2]="FetchPasteFlowHandlerFailed",e[e.FailedToReadFromClipboard=3]="FailedToReadFromClipboard",e[e.InspectClipboardFailed=4]="InspectClipboardFailed",e[e.ReadFromClipboardReturnNullOrUndefined=5]="ReadFromClipboardReturnNullOrUndefined",e[e.ClipboardIsEmpty=6]="ClipboardIsEmpty",e[e.DeserializeOperationFailed=7]="DeserializeOperationFailed",e[e.ClipboardIsInaccessible=8]="ClipboardIsInaccessible",e[e.SuccessivePasteOverridingPendingPaste=9]="SuccessivePasteOverridingPendingPaste",e[e.FileReaderResultIsEmpty=10]="FileReaderResultIsEmpty",e[e.FileReaderFailed=11]="FileReaderFailed",e[e.UnknownPasteError=12]="UnknownPasteError",e[e.DeferredPasteRejectedBecauseOtherCopyCompleted=13]="DeferredPasteRejectedBecauseOtherCopyCompleted",e[e.DeferredPasteRejectedBecauseOtherCopyStarted=14]="DeferredPasteRejectedBecauseOtherCopyStarted",e[e.DeferredPasteRejectedBecauseMetadataUpdateWithoutCopyContext=15]="DeferredPasteRejectedBecauseMetadataUpdateWithoutCopyContext"}(S||(S={})),function(e){e[e.FailedToClearClipboard=0]="FailedToClearClipboard"}(y||(y={}));class _ extends Error{static augmentParameterValue(e){return e&&"string"==typeof e?e.trim():d}constructor(e,t,r){const a=_.augmentParameterValue(e);if(super(a),this.name=_.augmentParameterValue(t),this.errorName=this.name,this.name?l().ULS.traceTag(596456211,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`Error '${this.name}': ${a}`):l().ULS.traceTag(596456212,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`Error message: ${a}`),r){this.innerError=r;let e=this.innerError.message;e||(e=this.innerError.name);const t=_.augmentParameterValue(e);t.length>0&&l().ULS.traceTag(596456213,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`Inner error message: ${t}`)}this.stack||(this.stack=(new Error).stack)}}class v extends _{constructor(e,t){super(e,"NoValidKeyError",t)}}class I extends _{static getDefaultMessage(e){let t="Missing argument";return e.length>0&&(t=`Missing argument: '${e}'`),t}constructor(e,t,r){const a=_.augmentParameterValue(t),o=I.getDefaultMessage(a);let i=_.augmentParameterValue(e);0===i.length&&(i=o),super(i,"MissingArgumentError",r),this.name=a}}class P extends _{static getDefaultMessage(e,t){return e.length>0?`Invalid '${e}' argument: '${t}'`:"Invalid argument"}constructor(e,t,r,a){const o=_.augmentParameterValue(t);let i=r;i||(i=d);const n=P.getDefaultMessage(o,i);let s=_.augmentParameterValue(e);0===e.length&&(s=n),super(s,"InvalidArgumentError",a),this.name=o,this.value=i}}class T extends _{constructor(e,t){super(e,"InvalidOperationError",t)}}class A extends _{constructor(e,t,r,a,o){super(`${e}. Data version: ${t}, Infra version: ${r}, blockMismatchDataVersion: ${a}`,"MismatchVersionError",o)}}class L extends _{constructor(e,t,r,a){super(`${e}. Duration in clipboard (ms) : ${t}, TTL (ms): ${r}`,"TTLClipboardDataError",a)}}class D extends _{constructor(e,t,r,a){super(`${e}. Data User Hash : ${t}, infra User Hash: ${r}`,"UserHashMismatchError",a)}}class M extends _{constructor(e,t){super(e,"UnexpectedError",t)}}function x(e,t){return function(e,t){return void 0!==e&&"number"==typeof e&&e>=0&&e<Object.keys(t).length/2}(e,t)?t[e]:d}class k extends _{constructor(e,t,r,a,o){super(t||`reason=${e}`,r,a),this.reason=e,o&&(this.errorName=o)}}class W extends k{constructor(e,t,r){super(e,t,"CopyError",r,x(e,f))}}class $ extends k{constructor(e,t,r){super(e,t,"PasteError",r,x(e,S))}}class F extends k{constructor(e,t,r){super(e,t,"CancelError",r,x(e,y))}}class U extends k{constructor(e,t,r){super(e,t,"ClipboardPlatformError",r,x(e,h))}}function O(e){if(!e||!Array.isArray(e)||0===e.length)return void l().ULS.traceTag(596456214,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,"rethrowAfterAllActions: no actions to execute");let t,r=0;if(e.forEach((e=>{if(r+=1,e)try{e()}catch(e){l().ULS.traceTag(596456216,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`rethrowAfterAllActions: callback action #${r} threw an exception: ${e.message}`),t||(t=new T(e.message,e))}else l().ULS.traceTag(596456215,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`rethrowAfterAllActions: callback action #${r} is empty`)})),t)throw t}function R(){return J}const J={userAgent:()=>window&&window.navigator?window.navigator.userAgent:d,appVersion:()=>window&&window.navigator?window.navigator.appVersion:d};let N={};const j=new RegExp("(\\bTrident/| MSIE )"),z=16.16299,H=17.17123,V=new RegExp("\\bEdge/(\\d+\\.\\d+)\\b");function G(){if(void 0===N.isIEProperty){N.isIEProperty=!1;const e=R();if(e&&e.userAgent&&"function"==typeof e.userAgent){const t=e.userAgent();if(t){const e=t.match(j);e&&2===e.length&&(N.isIEProperty=!0)}}}return N.isIEProperty}function B(){if(void 0===N.isEdgeProperty){N.isEdgeProperty=!1,N.isEdgeWithTextHtmlClipboardSupportProperty=!1,N.isEdgeVersionWithTextHtmlWrapperSupportProperty=!1;const e=R();if(e&&e.appVersion&&"function"==typeof e.appVersion){const t=e.appVersion();if(t){const e=t.match(V);if(e&&2===e.length){N.isEdgeProperty=!0;const t=Number(e[1]);isNaN(t)||(t>=z&&(N.isEdgeWithTextHtmlClipboardSupportProperty=!0),t>=H&&(N.isEdgeVersionWithTextHtmlWrapperSupportProperty=!0))}}}}return N.isEdgeProperty}const K=(e,t,r,a)=>{e.postMessage(t,r,a)},q="copy",Z="cut",X="paste",Y="copy",Q="paste",ee=(e,t,r,a=!1)=>(e.addEventListener(t,r,a),()=>{e.removeEventListener(t,r,a)}),te="text/plain",re="Text",ae="text/html",oe="image/png",ie="metadata/is-last-copy-was-external",ne="metadata/ccp-infra-version",se="copyId",le="metadata/copy-context",ce=function(){const e={items:{}};return{getData:()=>e,getItem:e=>{},setItem:(e,t)=>{throw new T(`Cannot set an item with clipboard data format '${e}' in an immutable empty clipboard (content is ${t&&t.length>0?"not ":d}empty)`)},setDeferredItem:(e,t)=>{throw new T(`Cannot set a deferred item with clipboard data format '${e}' in an immutable empty clipboard`)},hasDeferredItem:e=>!1,getDeferredItem:e=>{},get:()=>Ce(void 0)}}();function de(){return ce}function pe(e){return e&&e.items?Object.keys(e.items).length:0}function ue(e){return pe(e&&e.getData())}function me(e=void 0){let t=e;t||(t={items:{}});const r={getItem:e=>ge(t,e),setItem:(e,r)=>{he(t,e,r)},setDeferredItem:(e,r)=>{he(t,e,r)},hasDeferredItem:e=>{if(!t||!t.items)return!1;const r=t.items[e];return!!r&&r instanceof Promise},getDeferredItem:e=>function(e,t){if(!e)throw new I(d,"clipboardItemsData");if(!e.items)throw new P(d,"clipboardItemsData.items");const r=e.items[t];return!r||r instanceof Promise?r:Promise.resolve(new Blob([r],{type:te}))}(t,e),getData:()=>t,get:()=>Ce(t)};return r}function ge(e,t){if(!e)throw new I(d,"clipboardItemsData");if(!e.items)throw new P(d,"clipboardItemsData.items");const r=e.items[t];if(!(r&&r instanceof Promise))return r}function he(e,t,r){if(!e)throw new I(d,"clipboardItemsData");if(!e.items)throw new P(d,"clipboardItemsData.items");e.items[t]=r}function fe(e,t){if(!e||0===e.length||!t||!t.trim())return d;let r;return e.forEach((e=>{e.clipboardDataFormat!==t||e.deferred||(r=e.data)})),r||d}function Se(e){return fe(e,te)}function ye(e){let t=[];return e&&(t=e.get()),0===t.length&&t.push({clipboardDataFormat:te,data:d}),t}function Ce(e){const t=[];if(0===pe(e))return t;for(const r in e.items){let a=e.items[r];a||(a=d);const o={clipboardDataFormat:r,data:a,deferred:a instanceof Promise};t.push(o)}return t}var be,Ee,we,_e;(Ee=be||(be={}))[Ee.SystemClipboard=0]="SystemClipboard",Ee[Ee.InMemory=2]="InMemory",Ee[Ee.LocalStorage=3]="LocalStorage",Ee[Ee.AsyncSystemClipboard=4]="AsyncSystemClipboard",function(e){e[e.None=0]="None",e[e.Cut=1]="Cut",e[e.Copy=2]="Copy",e[e.Paste=4]="Paste",e[e.Values=16]="Values",e[e.Formatting=32]="Formatting",e[e.Formulas=64]="Formulas",e[e.DragDropCells=128]="DragDropCells",e[e.DragDropNoErrMsg=256]="DragDropNoErrMsg",e[e.Transpose=512]="Transpose",e[e.Link=1024]="Link",e[e.PictureInCell=2048]="PictureInCell",e[e.ColumnWidths=4096]="ColumnWidths",e[e.PasteValues=20]="PasteValues",e[e.PasteFormatting=36]="PasteFormatting",e[e.PasteFormulas=68]="PasteFormulas",e[e.PasteTranspose=516]="PasteTranspose",e[e.PasteLink=1028]="PasteLink",e[e.PastePictureInCell=2052]="PastePictureInCell",e[e.PasteWithColumnWidths=4100]="PasteWithColumnWidths"}(we||(we={})),function(e){e[e.NoError=0]="NoError",e[e.LocalStorageInaccessible=1]="LocalStorageInaccessible"}(_e||(_e={}));const ve="BulsEndpointUrl",Ie="usid",Pe="-",Te=1,Ae=3600,Le=2;let De=ke(),Me=!1;function xe(){if(!Me)throw new T("First initialize the settings via initializeSharedClipboardSettingsFromWindow() or initializeSharedClipboardSettings()");return De}function ke(){return{whitelistOriginComponents:!1,sharedClipboardHostingApp:d,sharedClipboardHostingApps:[],sharedClipboardHostingEnvironments:[],sharedClipboardSchemaVersion:Te,sharedClipboardExpirationInMinutes:Ae,clipboardPromiseTimeoutInMinutes:Le,remoteLoggerPath:d}}function We(){let e=d;return window&&window.location&&window.location.origin?(e=window.location.origin,e||(e=d)):(l().ULS.traceTag(595932950,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`windowLocation.getWindowLocation: is window exist: ${!!window}. is window.location exist: ${window&&!!window.location}. is window.location.origin exist ${window&&window.location&&!!window.location.origin}. is window.location.protocol exist ${window&&window.location&&!!window.location.protocol}. is window.location.hostname exist ${window&&window.location&&!!window.location.hostname}. is window.location.port exist ${window&&window.location&&!!window.location.port}`),window&&window.location&&window.location.protocol&&window.location.hostname&&(e=window.location.protocol+"//"+window.location.hostname,window.location.origin=e)),{origin:e}}const $e="://",Fe="http",Ue="https",Oe=".",Re="/",Je=":",Ne=new RegExp("^\\d+$");let je,ze,He=!1;function Ve(e){if(!e)throw new I(d,"origin");const t=e.trim().toLowerCase();let r=d,a=t.split($e,3);if(!a||0===a.length||!a[0]||a[0]!==Fe&&a[0]!==Ue)throw new P("Missing protocol","origin",e);if(1===a.length)throw new P("Missing domain","origin",e);if(a.length>2)throw new P(`'${$e}' should appear once`,"origin",e);let o=a[1];if(!o)throw new P("Missing domain","origin",e);if(r=a[0]+$e,o=o.trim(),a=o.trim().split(Re,3),!a||0===a.length||!a[0]||!a[0].trim())throw new P("Missing domain","origin",e);if(a.length>2)throw new P("The last part of the origin should be the domain","origin",e);if(2===a.length&&a[1])throw new P("The last part of the origin should be the domain","origin",e);if(a=o.split(Je,3),!a||0===a.length||!a[0]||!a[0].trim())throw new P("Missing domain","origin",e);if(a.length>2||2===a.length&&(!a[1]||!a[1].trim()))throw new P("The last part of the origin should be the domain and an optional port number","origin",e);if(o=a[0].trim(),r+=o,2===a.length){const t=a[1].trim(),o=Ne.exec(t);if(!o||1!==o.length)throw new P("Invalid port number","origin",e);const i=Number(t);if(isNaN(i))throw new P("Invalid port number","origin",e);r+=Je+t}return l().ULS.traceTag(596452423,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`getValidatedOrigin: origin = '${e}'; validated origin = '${r}'`),r}function Ge(e){qe();const t=e.split($e,2),r=t[0],a=Be(t[1]),o={protocol:r};if(o.environment=Ke(e,a,ze),a.length<=o.environment.length+1)throw new P("Missing app component","origin",e);if(a.charAt(o.environment.length)!==Oe)throw new P("Missing a domain separator after the environment component","origin",e);const i=a.substr(o.environment.length+Oe.length);if(o.app=Ke(e,i,je),o.app.length<i.length&&i.charAt(o.app.length)!==Pe)throw new P(`When the Office Online app name is not the domain prefix, '${Pe}' should precede it`,"origin",e);return o}function Be(e){if(!e)throw new I(d,"stringToReverse");const t=e.length;let r=d;for(let a=t-1;a>=0;a-=1)r+=e.charAt(a);return r}function Ke(e,t,r){if(!t)throw new I(d,"reversedValidatedHostname");if(!r)throw new I(d,"reversedStringsToLengthMap");const a=t.length,o=Object.keys(r).filter((e=>{const o=r[e];return o<=a&&t.substr(0,o)===e}));if(o&&o.length>0)return Be(o[0]);throw new P("Invalid origin","validatedOrigin",e)}function qe(){if(He)return;const e=xe();e.whitelistOriginComponents&&(je=Ze(e.sharedClipboardHostingApps),ze=Ze(e.sharedClipboardHostingEnvironments),He=!0)}function Ze(e){const t={};return e&&Array.isArray(e)&&0!==e.length?(e.forEach((e=>{t[Be(e)]=e.length})),t):t}function Xe(){return Qe()}function Ye(e){if(!e)throw new I(d,"id");const t=e.trim().toLowerCase();if(0===t.length)throw new P(d,"id");return t}function Qe(){return(Math.random()+1).toString(36).substring(7)}function et(e,t,r,a,o){const i={id:e,operationCode:t,destination:r,userHash:a,clipboardItemsData:o};return rt(i),i}class tt{}tt.localStorageData="localStorage/data",tt.localStorageMetadata="localStorage/metadata",tt.initIframe="initIframe";const rt=function(e){if(!e)throw new I(d,"clipboardOperationMessage");if(!e.id||0===e.id.trim().length)throw new I(d,"id");if(!e.operationCode)throw new I(d,"operationCode");if(!e.destination)throw new I(d,"destination");if("get"!==(t=e.operationCode)&&"set"!==t&&"init"!==t)throw new P(d,"operationCode",e.operationCode);var t;if("set"!==e.operationCode&&e.clipboardItemsData)throw new P(`'${e.operationCode}' expects no clipboard items`,"clipboardItemsData")};function at(e,t,r,a,o){const i={id:e,operationCode:t,failed:r,error:a,clipboardItemsData:o};return ot(i),i}const ot=function(e){if(!e)throw new I(d,"clipboardOperationResultMessage");const t=["failed","error","clipboardItemsData","operationCode","id","userHash"];let r=!1;for(const a of t)if(e.hasOwnProperty(a)){r=!0;break}if(!r)throw new v("clipboardOperationResultMessage has no valid key");if(!e.id||0===e.id.trim().length)throw l().ULS.traceTag(553747865,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`Missing argument 'id'. keys: ${JSON.stringify(Object.keys(e))}, isConstructorObject: ${e.constructor===Object}, operationCode: ${e.operationCode}, id: ${e.id}, failed: ${e.failed}, error: ${e.error}.`),new I(d,"id");if(!e.operationCode)throw new I(d,"operationCode");if("getresult"!==e.operationCode&&"setresult"!==e.operationCode&&"initresult"!==e.operationCode&&"unknownresult"!==e.operationCode&&"getMetadata_longPollingresult"!==e.operationCode)throw new P(d,"operationCode",e.operationCode);if(e.failed){if(!e.error)throw new P(`A failed '${e.operationCode}' operation expects a non-empty error argument`,"error");if(e.clipboardItemsData)throw new P(`A failed '${e.operationCode}' operation does not expect a clipboardItemsData argument`,"clipboardItemsData")}else{if(e.error)throw new P(`'${e.operationCode}' expects an empty error argument`,"error");if("unknownresult"===e.operationCode)throw new P(`'${e.operationCode}' can only be used with a failure message`,"operationCode")}if("getresult"===e.operationCode||"getMetadata_longPollingresult"===e.operationCode){if(!e.failed&&!e.clipboardItemsData)throw new P(`'${e.operationCode}' expects a clipboardItems argument`,"clipboardItemsData")}else if(e.clipboardItemsData)throw new P(`'${e.operationCode}' expects no clipboardItemsData argument`,"clipboardItemsData")};function it(e){if(!e||0===e.trim().length)throw new P(d,"className",e);return(()=>{let t=!1;function r(t){return`${e}:${t}: already disposed`}return{dispose:function(){t=!0},logIfDisposed:function(e){return t&&l().ULS.traceTag(596456217,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,r(e)),t},throwIfDisposed:function(e){if(t)throw new T(r(e))}}})()}class nt{initialize(e){return e.then((e=>(this.clipboardStorage=e,l().ULS.traceTag(596453007,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`Clipboard strategy type '${this.clipboardStrategyType}' was initialized.`),Promise.resolve(this))),(e=>(l().ULS.traceTag(596453008,n.nh.msoulscat_ES_EWAJS,E(e)?n.kp.Info:n.kp.Error,`Failed to initialize clipboard strategy type '${this.clipboardStrategyType}'. Error: ${n.Wp.getStringifiedError(e)}`),Promise.reject(e))))}set(e,t){try{if(this.disposableImplementationExtension.throwIfDisposed("set"),!this.clipboardStorage){const e="ClipboardStrategyBase.set: this.clipboardStorage should be defined";return l().ULS.shipAssertTag(596121485,n.nh.msoulscat_ES_EWAJS,!1,e),Promise.reject(new U(h.ClipboardStrategyNotInitialized))}return this.clipboardDataProcessor&&this.clipboardDataProcessor.preSetProcess(e),this.clipboardStorage.set(e,t)}catch(e){return Promise.reject(new U(h.SetClipboardItems,`Failed in (clipboard ${this.clipboardStrategyType}).set`,e))}}get(e){try{if(this.disposableImplementationExtension.throwIfDisposed("get"),!this.clipboardStorage){const e="ClipboardStrategyBase.get: this.clipboardStorage should be defined";return l().ULS.shipAssertTag(596121486,n.nh.msoulscat_ES_EWAJS,!1,e),Promise.reject(new U(h.ClipboardStrategyNotInitialized))}return this.clipboardStorage.get(e).then((e=>(this.clipboardDataProcessor&&this.clipboardDataProcessor.postGetProcess(e),Promise.resolve(e)))).catch((t=>{throw l().ULS.traceTag(507848131,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`ClipboardStrategyBase.get - Failed to get clipboard items. Command id: ${e.id}, Error: ${n.Wp.getStringifiedError(t)}`),t}))}catch(e){return Promise.reject(new U(h.GetClipboardItems,`Failed in (clipboard ${this.clipboardStrategyType}).get`,e))}}onSystemClipboardChangedExternally(e){try{return this.disposableImplementationExtension.throwIfDisposed("onSystemClipboardChangedExternally"),this.clipboardStorage?this.clipboardCapabilities.systemClipboard?Promise.resolve():this.clipboardStorage.set(de(),e):(l().ULS.shipAssertTag(595882508,n.nh.msoulscat_ES_EWAJS,!1,"ClipboardStrategyBase.onSystemClipboardChangedExternally: this.clipboardStorage should be defined"),Promise.reject(new U(h.ClipboardStrategyNotInitialized)))}catch(e){return Promise.reject(new U(h.ClearClipboardItems,`Failed in (clipboard ${this.clipboardStrategyType}).onSystemClipboardChangedExternally`,e))}}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||(this.clipboardStorage&&this.clipboardStorage.dispose(),this.disposableImplementationExtension.dispose())}constructor(e,t,r){this.clipboardStrategyType=e,this.clipboardCapabilities=t,this.clipboardDataProcessor=r,this.disposableImplementationExtension=it(`${e}`)}}const st=!!window.performance&&!!window.performance.now&&!!window.performance.timing;function lt(e){let t=e;return t&&0!==t.trim().length||(t=Xe()),new ut(t)}function ct(){return st?window.performance.now():Date.now()}function dt(e){return st?new Date(e+window.performance.timing.navigationStart):new Date(e)}function pt(e,t,r){if(!r)throw new I(d,"creationTimestamp");return`${e?"Fulfilled":"Still unfulfilled"} after ${e?t?t-r:"?":ct()-r}ms`}class ut{fulfilled(){return this.isFulfilled}resolve(e){this.markAsFulfilled("resolve"),this.internalResolve?this.internalResolve(e):l().ULS.traceTag(596456257,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`Deferred promise - resolve: the resolve for deferred promise #${this.sequenceId} with id '${this.id}' is not tracked with a callback`)}reject(e){this.markAsFulfilled("reject"),this.internalReject?this.internalReject(e):l().ULS.traceTag(596456260,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`Deferred promise - reject: the reject for deferred promise #${this.sequenceId} with id '${this.id}' is not tracked with a callback`)}markAsFulfilled(e){this.fulfillmentCheck(e)||(this.isFulfilled=!0,this.rejected="resolve"!==e,this.fulfillmentTimestamp=ct(),l().ULS.traceTag(596456261,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`Deferred promise: marking promise #${this.sequenceId} with id '${this.id}' as fulfilled (${this.rejected?"rejected":"resolved"}). ${pt(this.isFulfilled,this.fulfillmentTimestamp,this.creationTimestamp)}`))}fulfillmentCheck(e){return l().ULS.traceTag(596456258,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`Deferred promise: asked to ${e} deferred promise #${this.sequenceId} with id '${this.id}'`),this.isFulfilled&&l().ULS.traceTag(596456259,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`Deferred promise: cannot ${e} deferred promise #${this.sequenceId} with id '${this.id}' since it was ${this.rejected?"rejected":"resolved"} already on ${dt(this.fulfillmentTimestamp)}. ${pt(this.isFulfilled,this.fulfillmentTimestamp,this.creationTimestamp)}`),this.isFulfilled}constructor(e){this.isFulfilled=!1,this.fulfillmentTimestamp=void 0,this.rejected=!1,this.id=Ye(e),ut.sequenceId+=1,this.sequenceId=ut.sequenceId,this.creationTimestamp=ct(),l().ULS.traceTag(596456225,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`Deferred promise: creating deferred promise #${this.sequenceId} with id '${this.id}' on ${dt(this.creationTimestamp)}`),this.promise=new Promise(((e,t)=>{l().ULS.traceTag(596456226,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`Deferred promise: registering callback for promise #${this.sequenceId} with id '${this.id}' on ${dt(ct())}`),this.internalResolve=e,this.internalReject=t}))}}ut.sequenceId=0;class mt{getDeferredPromise(e){const t=Ye(e);return this.deferredResultMessagePromiseCache[t]}getPromise(e){const t=this.getDeferredPromise(e);if(t)return l().ULS.traceTag(596456218,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`Deferred promise cache: found a deferred promise with id '${e}'.`),t.promise;l().ULS.traceTag(596456219,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`Deferred promise cache: there is no deferred promise with id '${e}'.`)}addNewPromise(e){const t=lt(e);if(this.getDeferredPromise(t.id))throw new P("A deferred promise already exists in the cache for the specified id","id",t.id);const r=Ye(t.id);return this.deferredResultMessagePromiseCache[r]=t,l().ULS.traceTag(596456220,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`Deferred promise cache: added a new deferred promise with id '${t.id}'.`),t}getLength(){let e=0;for(const t in this.deferredResultMessagePromiseCache)e+=1;return e}delete(e){if(!this.getDeferredPromise(e))return void l().ULS.traceTag(596456221,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`Deferred promise cache: no need to delete an item with id '${e}' since this id is not associated with an existing deferred promise.`);const t=Ye(e);delete this.deferredResultMessagePromiseCache[t],l().ULS.traceTag(596456222,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`Deferred promise cache: deleted id '${e}'.`)}clear(){if(l().ULS.traceTag(596456223,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`Deferred promise cache: clearing ${this.getLength()} items from the cache`),this.deferredResultMessagePromiseCache)for(const e in this.deferredResultMessagePromiseCache){const t=this.deferredResultMessagePromiseCache[e];if(t)try{t.reject()}catch(t){l().ULS.traceTag(596456224,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`Deferred promise cache: clear failed to reject promise id '${e}' with this exception: ${t.message}. Ignoring.`)}}this.deferredResultMessagePromiseCache={}}constructor(){this.deferredResultMessagePromiseCache={}}}const gt="initmessageid",ht="CreatorOrigin";function ft(e){if(!e)throw new I(d,"remoteWindow");if(!("window"in e)||!e.window)throw new I(d,"remoteWindow.window");if(!("windowOrigin"in e)||!e.windowOrigin)throw new I(d,"remoteWindow.windowOrigin");const t=function(e){qe();const t=Ve(e),r=Ve(We().origin);if(t===r)return t;if(!xe().whitelistOriginComponents)throw new T(`validateOriginForReceivedMessage: Caller origin '${e}' doesn't match the current window's origin '${r}'`);const a=Ge(t),o=Ge(r);if(a.protocol!==o.protocol)throw new T(`validateRemoteWindowOrigin: Caller origin's protocol '${a.protocol}' doesn't match the current window origin's protocol '${o.protocol}'`);if(a.environment!==o.environment)throw new T(`validateRemoteWindowOrigin: Caller origin's environment '${a.environment}' doesn't match the current window origin's environment '${o.environment}'`);return t}(e.windowOrigin);return{window:e.window,windowOrigin:t}}class St{get disposableImplementationExtension(){return this._disposableImplementationExtension}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||(O([()=>{this.sender&&this.sender.dispose()},()=>{this.receiver&&this.receiver.dispose()}]),this.disposableImplementationExtension.dispose())}postMessage(e){if(this.disposableImplementationExtension.throwIfDisposed("postMessage"),!e)throw new I(d,"outgoingMessage");if(!this.sender){const e="WindowRPCBase::postMessage - this.sender should be defined";throw l().ULS.shipAssertTag(596121484,n.nh.msoulscat_ES_EWAJS,!1,e),new T(e)}this.sender.postMessage(e)}constructor(e,t,r,a){this.serializer=e,this.deserializer=t,this.remoteWindow=r,this.remoteWindow=r,this._disposableImplementationExtension=it(a)}}function yt(){return Ct}const Ct={addEventListener:(e,t)=>window.addEventListener(e,t),removeEventListener:(e,t)=>window.removeEventListener(e,t)},bt="message";class Et{dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||(yt().removeEventListener(bt,this.windowMessageHandler),this.disposableImplementationExtension.dispose())}shouldFilterMessageEvent(e){try{if(!e.origin||!e.source)return l().ULS.traceTag(596452370,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"Window RPC Receiver: ignoring messages from unspecified window sources."),!0;if(e.source===window)return l().ULS.traceTag(596452371,n.nh.msoulscat_ES_EWAJS,n.kp.Verbose,"Window RPC Receiver: ignoring messages from this window to itself."),!0;if(this.remoteWindow.window&&e.source!==this.remoteWindow.window)return l().ULS.traceTag(596452372,n.nh.msoulscat_ES_EWAJS,n.kp.Verbose,"Window RPC Receiver: ignoring messages from windows other than the assigned remote window."),!0;if(e.origin.toLowerCase()!==this.remoteWindow.windowOrigin)return l().ULS.traceTag(596452373,n.nh.msoulscat_ES_EWAJS,n.kp.Verbose,"Window RPC Receiver: ignoring messages from windows with an origin that differs from remote window origin."),!0}catch(e){return!0}return!1}onMessageReceived(e){if(this.shouldFilterMessageEvent(e))return;let t;try{t=this.deserializer.deserialize(e.data)}catch(e){l().ULS.traceTag(596452374,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`Window RPC Receiver: unable to deserialize incoming message. ${n.Wp.getStringifiedError(e)}`);try{this.handler.handleDeserializationError(e)}catch(e){l().ULS.traceTag(596452184,n.nh.msoulscat_ES_EWAJS,n.kp.Error,`Window RPC Receiver: unable to handle deserialization error. ${n.Wp.getStringifiedError(e)}`)}return}if(t)try{this.handler.handleMessage(t).catch((e=>{l().ULS.traceTag(595985880,n.nh.msoulscat_ES_EWAJS,n.kp.Error,`Window RPC Receiver: unable to process incoming message. ${n.Wp.getStringifiedError(e)}`)}))}catch(e){l().ULS.traceTag(596452186,n.nh.msoulscat_ES_EWAJS,n.kp.Error,`Window RPC Receiver: unable to process incoming message. ${n.Wp.getStringifiedError(e)}`)}else l().ULS.traceTag(596452185,n.nh.msoulscat_ES_EWAJS,n.kp.Error,"Window RPC Receiver: the incoming message is empty")}constructor(e,t,r){if(this.deserializer=e,this.handler=t,this.windowMessageHandler=e=>this.onMessageReceived(e),!e)throw new I(d,"deserializer");if(!t)throw new I(d,"handler");if(!r)throw new I(d,"windowRPC");this.disposableImplementationExtension=it("WindowRPCReceiverInternal"),this.remoteWindow=ft(r.remoteWindow),yt().addEventListener(bt,this.windowMessageHandler)}}class wt{postMessage(e){if(!e)throw new I(d,"outgoingMessage");if(!this.remoteWindow.window)throw new T("Configure the remote window");if(!this.remoteWindow.window.postMessage)throw new T("The remote window does not support postMessage");const t=this.serializer.serialize(e);K(this.remoteWindow.window,t,this.remoteWindow.windowOrigin)}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||this.disposableImplementationExtension.dispose()}constructor(e,t,r=!1){if(this.serializer=e,this.delayedQueueEnabled=r,!e)throw new I(d,"serializer");if(!t)throw new I(d,"windowRPC");this.disposableImplementationExtension=it("WindowRPCSenderInternal"),this.remoteWindow=ft(t.remoteWindow)}}const _t="OfficeOnlineCCP_",vt=_t+"Metadata_",It=_t+"Data_",Pt="_LocalStorageChangedFlag";function Tt(e){return vt+e}class At{constructor(){this.copyStatus=Dt.Started,this.isTimestampStoredInSystemClipboard=!1,this.isAsyncSerializeFailed=!1,this.succeededPopulatingSystemClipboardSync=void 0,this.succeededPopulatingSystemClipboardAsync=void 0,this.isFullSheetCopy=!1}}class Lt{profilingMessage(e){const t=n.TZ.timeStamp()-this.startTime;return`onPasteProfiling: ${e}, pasteId: ${this.id}, timeMS: ${t.toFixed()}`}constructor(){this.startTime=n.TZ.timeStamp()}}var Dt;function Mt(e){let t;return e&&e.lastCopy&&(t=_object_spread({},e.lastCopy)),{lastCopy:t}}!function(e){e[e.Started=1]="Started",e[e.SynchronousPhaseCompleted=2]="SynchronousPhaseCompleted",e[e.Completed=3]="Completed"}(Dt||(Dt={}));class xt{get(e){this.disposableImplementationExtension.throwIfDisposed("get"),l().ULS.traceTag(595716238,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`localStorageClipboardStorage.get: commandParameters.id='${e?e.id:d}'`);const t=localStorage.getItem(this.localStorageKey);if(!t)return Promise.resolve(de());try{const e=JSON.parse(t);if(!e||0===pe(e))return Promise.resolve(de());const r=me(e);return Promise.resolve(r)}catch(e){return Promise.resolve(de())}}set(e,t){this.disposableImplementationExtension.throwIfDisposed("set"),l().ULS.traceTag(595716239,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`localStorageClipboardStorage.set: item count=${ue(e)}'; commandParameters.id='${t?t.id:d}'`),0===ue(e)?localStorage.removeItem(this.localStorageKey):localStorage.setItem(this.localStorageKey,JSON.stringify(e.getData()));const r=`${this.localStorageKey+Pt}`,a=Xe();return l().ULS.traceTag(595654546,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`localStorageClipboardStorage.set: set local storage value. eventFalgKey = ${r}. eventFlagValue = ${a}`),localStorage.setItem(r,a),Promise.resolve()}getSupportedDataFormats(){return this.disposableImplementationExtension.throwIfDisposed("getSupportedDataFormats"),[te,ae,"data/shadow-workbook"]}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||this.disposableImplementationExtension.dispose()}constructor(e){this.localStorageKey=e;try{if(!localStorage)throw new Error("LocalStorageClipboardStorage.ctor: localStorage == null")}catch(e){throw new U(h.LocalStorageInitilizationInaccessible,"LocalStorageClipboardStorage.ctor: failed access to localStorage",e)}if(!e)throw new U(h.LocalStorageInitilizationNoKey,"LocalStorageClipboardStorage.ctor: localStorageKey must be defined");this.clipboardStorageType=be.LocalStorage,this.disposableImplementationExtension=it("LocalStorageClipboardStorage")}}class kt extends nt{constructor(e){super(m.LocalStorage,{browserStorage:!0,systemClipboard:!1,inMemory:!1},e)}}class Wt{onStorageChanged(e){l().ULS.shipAssertTag(595716249,n.nh.msoulscat_ES_EWAJS,null!=e,"e should not be null"),l().ULS.traceTag(595716288,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`LocalStorageKeyChangeTracker.onStorageChanged:got storage change event. e.key = ${e.key}. localStorageKeyToWatch = ${this.localStorageKeyToWatch}. lastLocalStorageValue = ${this.lastLocalStorageValue}`),e.key===this.localStorageKeyToWatch&&(this.raiseMetadataChangedEvent(),l().ULS.traceTag(595716289,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`LocalStorageKeyChangeTracker.onStorageChanged: raised metadata change event. lastLocalStorageValue = ${this.lastLocalStorageValue}`),this.isLocalStorageValueChanged()||this.waitForLocalStorageValueToChange(this.maxTimeToWaitInMilliseconds).then((()=>{this.raiseMetadataChangedEvent()}),(()=>{l().ULS.traceTag(595716295,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,"LocalStorageKeyChangeTracker.onStorageChanged: got rejected promise.")})))}raiseMetadataChangedEvent(){return l().ULS.traceTag(595715525,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`LocalStorageKeyChangeTracker.raiseMetadataChangedEvent: starting raiseMetadataChangedEvent. lastLocalStorageValue = ${this.lastLocalStorageValue}`),this.clipboardStrategy.get({userHash:0}).then((e=>{this.listener(e),l().ULS.traceTag(595716232,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`LocalStorageKeyChangeTracker.raiseMetadataChangedEvent: sent message. lastLocalStorageValue = ${this.lastLocalStorageValue}`)}),(e=>{l().ULS.traceTag(595716233,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,"LocalStorageKeyChangeTracker.raiseMetadataChangedEvent: failed to get metadata from clipboardStorage")}))}isLocalStorageValueChanged(){const e=localStorage.getItem(this.localStorageKeyToWatch),t=this.lastLocalStorageValue!==e;return l().ULS.traceTag(595715526,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`LocalStorageKeyChangeTracker.isLocalStorageValueChanged: lastLocalStorageValue = ${this.lastLocalStorageValue}. currentLocalStorageValue = ${e}`),this.lastLocalStorageValue=e,t}waitForLocalStorageValueToChange(e){if(l().ULS.traceTag(595715527,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: start waitForLocalStorageValueToChange. lastLocalStorageValue = ${this.lastLocalStorageValue}`),this.isLocalStorageValueChanged())return l().ULS.traceTag(595715528,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: resolving because value was changed. lastLocalStorageValue = ${this.lastLocalStorageValue}`),Promise.resolve();const t=lt(),r=new Date,a=setInterval((()=>{const o=(new Date).getTime()-r.getTime();l().ULS.traceTag(595715529,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: call by setInterval. startTime = ${r}. elapseTime = ${o}. lastLocalStorageValue = ${this.lastLocalStorageValue}`),this.isLocalStorageValueChanged()?(clearInterval(a),l().ULS.traceTag(595716234,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: resolving. startTime = ${r}. elapseTime = ${o}. lastLocalStorageValue = ${this.lastLocalStorageValue}`),t.resolve()):o>e&&(clearInterval(a),l().ULS.traceTag(595716235,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: rejecting. startTime = ${r}. elapseTime = ${o}. lastLocalStorageValue = ${this.lastLocalStorageValue}`),t.reject())}),200);return t.promise}constructor(e,t,r){this.localStorageKeyToWatch=e,this.clipboardStrategy=t,this.listener=r,this.maxTimeToWaitInMilliseconds=2e3,this.lastLocalStorageValue=null,window.addEventListener("storage",this.onStorageChanged.bind(this)),this.raiseMetadataChangedEvent()}}const $t="\n",Ft="\r",Ut=new RegExp(`(${$t}${Ft})|(${Ft}${$t})|(${Ft})`,"g"),Ot=new RegExp("(\t)","g"),Rt=10240,Jt=new RegExp("<","g"),Nt=new RegExp(">","g"),jt="table",zt="tr",Ht="td",Vt=`Version:0.9${$t}StartHTML:0000000100${$t}EndHTML:{EndHTML0}${$t}StartFragment:0000000134${$t}EndFragment:{EndFragm}${$t}<html>${$t}<body>${$t}\x3c!--StartFragment--\x3e${$t}`,Gt=`\x3c!--EndFragment--\x3e${$t}</body>${$t}</html>`,Bt="0000000000",Kt="data-ccp-timestamp";function qt(e){return e?e.replace(Ut,$t):e}function Zt(e){return e?e.length<=Rt?e:e.substr(0,Rt):d}function Xt(e){var t,r;const a=function(e){return e?e.replace(Ut,`</${Ht}></${zt}><${zt}><${Ht}>`):e}((r=(t=e)?t.replace(Jt,"&lt;").replace(Nt,"&gt;"):d)?r.replace(Ot,`</${Ht}><${Ht}>`):r);return`<${jt}><${zt}><${Ht}>${a}</${Ht}></${zt}></${jt}>`}function Yt(e){const t=[],r=e.getElementsByTagName("td");if(r.length>0){t.push(r[0].innerText);for(let e=1;e<r.length;e+=1)t.push("\t"),t.push(r[e].innerText)}return t.join("")}function Qt(e){if(!B()||B()&&N.isEdgeVersionWithTextHtmlWrapperSupportProperty)return e;const t=10,r=Vt.length+e.length+Gt.length;let a=(r-Gt.length).toString();if(a.length<t&&(a=Bt.substr(0,t-a.length)+a),a.length!==t){const e=`addClipboardWrapperForEdge: the string representation of the opening bracket position of the End Fragment xml comment is ${a.length} but it should be 10`;throw l().ULS.shipAssertTag(596128536,n.nh.msoulscat_ES_EWAJS,!1,e),new U(h.UnexpectedClipboardTextHtmlContentLength,e)}let o=(r-7).toString();if(o.length<t&&(o=Bt.substr(0,t-o.length)+o),o.length!==t){const e=`addClipboardWrapperForEdge: the string representation of the opening bracket position of the End Html tag is ${o.length} but it should be 10`;throw l().ULS.shipAssertTag(596128537,n.nh.msoulscat_ES_EWAJS,!1,e),new U(h.UnexpectedClipboardTextHtmlContentLength,e)}const i=Vt.replace("{EndHTML0}",o).replace("{EndFragm}",a)+e+Gt;return l().ULS.shipAssertTag(596128538,n.nh.msoulscat_ES_EWAJS,i.length===r,`addClipboardWrapperForEdge: The resulting text/html payload length of ${i.length} differs from the expected length of ${r}`),i}class er{get clipboardStrategy(){if(this.clipboardPlatformEnvironment)return this.clipboardPlatformEnvironment.getClipboardStrategy();throw new T("clipboardPlatformEnvironment is missing")}onCopy(e){if(!e)return Promise.reject(new W(f.MissingArgumentError,"Missing commandParameters argument",new I(d,"commandParameters")));let t,r;t=new At;try{t.id=Qe(),l().ULS.traceTag(595937123,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.onCopy: copy ${t.id} started.`),t.sessionId=this.applicationHost.getSessionId(),t.commandParameters=e;const a=this.getCopyFlowHandler(t);t.sourceItem=this.getSourceItem(a,t),this.clearInProgressCopyIfNeeded(t),this.inProgressCopyContext=t,r=this.serialize(a,t),l().ULS.traceTag(595937152,n.nh.msoulscat_ES_EWAJS,n.kp.Verbose,`CopyPasteFlowManager.onCopy: updating metadata for copy id ${t.id} after serialize.`),this.isLocalstorageDepsInAsyncClipboardAPIRemoved&&r&&r.synchronousResult&&r.synchronousResult.setItem(le,this.metadataManager.serializeMetadata({lastCopy:_object_spread_props(_object_spread({},t),{copyStatus:t.isFromCache?Dt.Completed:Dt.SynchronousPhaseCompleted})})),this.metadataManager.updateMetadata({lastCopy:t})}catch(r){return t?l().ULS.traceTag(595734742,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.onCopy: catching error for copy id ${t.id} during serialize.`):l().ULS.traceTag(595734743,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,"CopyPasteFlowManager.onCopy: catching error and no copy context during serialize."),this.copyCompleteCleanup(t,e),Promise.reject(r)}try{return Promise.all([this.setClipboardSync(r.synchronousResult,e,t).then((()=>this.rejectIfCopyCancelled(t))).then((()=>{t.copyStatus=Dt.SynchronousPhaseCompleted,l().ULS.traceTag(595937153,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.onCopy: updating metadata for copy id ${t.id} after status changed to SynchronousPhaseCompleted.`),this.metadataManager.updateMetadata({lastCopy:t})})).catch((e=>{if(t?l().ULS.traceTag(595734744,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.onCopy: catch error for copy id ${t.id}.`):l().ULS.traceTag(595734745,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,"CopyPasteFlowManager.onCopy: no copy context."),e&&e.reason){const t=e.reason;if(t===f.SuccessiveCutCopyOverridingPendingCutCopy||t===f.BlockedSynchronousCutCopy||t===f.CopyOperationCancelled)return l().ULS.traceTag(595734746,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`CopyPasteInfra.copyPasteFlowManager.onCopy: synchronous copy failed to populate the clipboard. Rejecting the promise: ${n.Wp.getStringifiedError(e)}. Call stack: ${e.stack?e.stack:"NA"}`),Promise.reject(e)}return l().ULS.traceTag(596456159,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`CopyPasteInfra.copyPasteFlowManager.onCopy: synchronous copy failed to populate the clipboard. Ignoring this failure since the active selection will allow for the required functionality: ${n.Wp.getStringifiedError(e)}. Call stack: ${e.stack?e.stack:"NA"}`),this.metadataManager.updateMetadata({lastCopy:t}),Promise.resolve()})),this.rejectIfCopyCancelled(t).then((()=>this.setClipboardAsync(r.asynchronousResult,e,t)))]).then((()=>this.rejectIfCopyCancelled(t))).then((()=>(this.copyCompleteCleanup(t,e),t)),(r=>{l().ULS.traceTag(595734747,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.onCopy: got error for copy id ${t.id}.`);let a=r;return this.copyCompleteCleanup(t,e),a||(l().ULS.shipAssertTag(595854806,n.nh.msoulscat_ES_EWAJS,!1,"copyPasteFlowManager.onCopy: promise rejected without error"),a=new W(f.UnknownCopyErrorType,"copyPasteFlowManager.onCopy failed without specified error")),a.copyContext=t,Promise.reject(a)}))}catch(r){return this.copyCompleteCleanup(t,e),l().ULS.traceTag(596456160,n.nh.msoulscat_ES_EWAJS,n.kp.Error,`CopyPasteInfra.copyPasteFlowManager.onCopy: Failed to store content in the clipboard. Exception: ${n.Wp.getStringifiedError(r)}. Call stack: ${r.stack?r.stack:"NA"}`),Promise.reject(new W(f.SaveToTheClipboardFailed,`Failed to store content in the clipboard (with an exception): ${r.message}`,r))}}onPaste(e){const t=new Lt;try{if(!e)return Promise.reject(new $(S.MissingArgumentError,"Missing commandParameters argument",new I(d,"commandParameters")));e.isTimestampStoredInSystemClipboard=!0,t.id=Xe(),t.sessionId=this.applicationHost.getSessionId(),t.commandParameters=e,t.clipboardItems=de(),t.isClipboardInaccessible=!1,l().ULS.traceTag(595685636,n.nh.msoulscat_ES_EWAJS,n.kp.Info,t.profilingMessage("start"));const r=this.metadataManager.getCachedMetadata();t.copyContextSnapshot=r.lastCopy,this.applicationHost.initializePasteContext(t),t.copyContextSnapshot?l().ULS.traceTag(595937154,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.onPaste: paste started for copy id ${t.copyContextSnapshot.id}`):l().ULS.traceTag(595730637,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"CopyPasteFlowManager.onPaste: paste started and copy context is null");let a,o=!1;return e.skipClipboardAccess?(l().ULS.traceTag(595685637,n.nh.msoulscat_ES_EWAJS,n.kp.Info,t.profilingMessage("skipClipboardAccess")),a=Promise.resolve()):a=this.readFromClipboard(t,e).then((r=>{if(l().ULS.traceTag(595685638,n.nh.msoulscat_ES_EWAJS,n.kp.Info,t.profilingMessage("readFromClipboard_then")),e.isAsyncClipboardAPI&&this.isLocalstorageDepsInAsyncClipboardAPIRemoved){let e={lastCopy:void 0};if(!this.isEmptyClipboard(r)){const n=r.getItem(le);var a,o,i,s,c;n&&(e=this.metadataManager.deserializeMetadata(n),(!(null==t?void 0:t.copyContextSnapshot)||t.copyContextSnapshot.id!==(null==e||null===(a=e.lastCopy)||void 0===a?void 0:a.id)||(null==t||null===(o=t.copyContextSnapshot)||void 0===o?void 0:o.id)===(null==e||null===(i=e.lastCopy)||void 0===i?void 0:i.id)&&(null==t||null===(s=t.copyContextSnapshot)||void 0===s?void 0:s.copyStatus)!==Dt.Completed&&(null==e||null===(c=e.lastCopy)||void 0===c?void 0:c.copyStatus)===Dt.Completed)&&(t.copyContextSnapshot=null==e?void 0:e.lastCopy,this.metadataManager.updateMetadata(e)))}(null==e?void 0:e.lastCopy)||(t.copyContextSnapshot=void 0,this.metadataManager.updateMetadata({lastCopy:void 0}),r.setItem(ie,u))}return t.clipboardItems=r,Promise.resolve()}),(e=>e&&e.reason&&e.reason===S.ClipboardIsInaccessible?(t.isClipboardInaccessible=!0,Promise.resolve()):Promise.reject(e))),a.then((()=>e.isAsyncClipboardAPI&&this.isLocalstorageDepsInAsyncClipboardAPIRemoved?t:this.readClipboardItemsAgainIfMetadataNotSync(t,e))).then((()=>(l().ULS.traceTag(595685639,n.nh.msoulscat_ES_EWAJS,n.kp.Info,t.profilingMessage("getPasteFlowHandler")),this.getPasteFlowHandler(t)))).then((e=>(o||e.beforePaste&&e.beforePaste(t),e))).then((r=>{if(l().ULS.traceTag(595685640,n.nh.msoulscat_ES_EWAJS,n.kp.Info,t.profilingMessage("getPasteFlowHandler_then")),(!e.isAsyncClipboardAPI||!this.isLocalstorageDepsInAsyncClipboardAPIRemoved)&&t.copyContextSnapshot&&t.copyContextSnapshot.copyStatus!==Dt.Completed&&r.shouldWaitForCopyToComplete(t)){l().ULS.traceTag(595937155,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.onPaste: pasteFlowHandler ask to waiting for copy (${t.copyContextSnapshot.id}) to complete. current status ${t.copyContextSnapshot.copyStatus}. copy session id is ${t.copyContextSnapshot.sessionId}`),l().ULS.traceTag(595683427,n.nh.msoulscat_ES_EWAJS,n.kp.Info,t.profilingMessage("onDeferredPasteStarted")),r.onDeferredPasteStarted(t);const a=this.continueWhenCopyComplete(e,t).then((e=>(l().ULS.traceTag(595685642,n.nh.msoulscat_ES_EWAJS,n.kp.Info,t.profilingMessage("onDeferredPasteCompleted")),r.onDeferredPasteCompleted(t),t.copyContextSnapshot=this.metadataManager.getCachedMetadata().lastCopy,t.clipboardItems=e,r)),(e=>(r.onDeferredPasteCompleted(t),l().ULS.traceTag(595882504,n.nh.msoulscat_ES_EWAJS,n.kp.Error,`CopyPasteFlowManager.onPaste: got error while wait for deferred paste to complete. error: [${e}]`),Promise.reject(e))));return l().ULS.traceTag(595685643,n.nh.msoulscat_ES_EWAJS,n.kp.Info,t.profilingMessage("continueWhenCopyComplete")),this.testHook("continueWhenCopyComplete"),a}return l().ULS.traceTag(595940941,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.onPaste: not wait for copy(${t.copyContextSnapshot&&t.copyContextSnapshot.id}) to complete. is copyContextSnapshot defined: ${void 0!==t.copyContextSnapshot}. copyStatus: ${t.copyContextSnapshot&&t.copyContextSnapshot.copyStatus}`),r})).then((e=>this.deserialize(e,t))).then((()=>{l().ULS.traceTag(595685644,n.nh.msoulscat_ES_EWAJS,n.kp.Info,t.profilingMessage("deserialize_then")),t.clipboardItems&&t.clipboardItems.getItem(ie)===u&&(l().ULS.traceTag(595685645,n.nh.msoulscat_ES_EWAJS,n.kp.Info,t.profilingMessage("onSystemClipboardChangedExternally")),this.onSystemClipboardChangedExternally())})).then((()=>{const e=t.clipboardItems;if(void 0===e)return;const r=e.getItem(ae);if(void 0!==r){const e=function(e){if(!e||!e.trim())return;const t=(new DOMParser).parseFromString(e,"text/html"),r=function(e){const t=e.getElementsByTagName("meta");for(let e=0;e<t.length;e+=1){const r=t[e];if("ProgId"===r.getAttribute("name")){const e=r.getAttribute("content");if(null!==e){if(e.length>64)return void l().ULS.shipAssertTag(595683460,n.nh.msoulscat_ES_EWAJS,!1,"ProgID longer than 64 characters");if(e.startsWith("Word"))return"Word Desktop";if(e.startsWith("Excel"))return"Excel Desktop";if(e.startsWith("PowerPoint"))return"PowerPoint Desktop";if(e.startsWith("OneNote"))return"OneNote Desktop";l().ULS.traceTag(595683457,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"htmlClipboardItem.getOfficeDesktopOrigin: unrecognized ProgId content")}return}}}(t);if(void 0!==r)return r;const a=function(e){if(null===e||null===e.body||null===e.body.children||0===e.body.children.length)return;const t=e.body.children[0];if(null!=t&&null!=t.classList)for(let e=0;e<t.classList.length;e+=1){const r=t.classList[e];if(r.startsWith("SCXO"))return"OneNote Online";if(r.startsWith("SCXP"))return"PowerPoint Online";if(r.startsWith("SCXW"))return"Word Online"}}(t);return void 0!==a?a:function(e){if(null===e)return!1;const t=e.getElementsByTagName("b");if(0===t.length)return!1;const r=t[0];return!(null==r||null==r.id||null==r.id.startsWith||!r.id.startsWith("docs-internal-guid-"))}(t)?"Google Docs":void 0}(r);void 0!==e&&(t.externalAppSource=e)}})).then((()=>t)).catch((e=>{let r=e;return r||(l().ULS.shipAssertTag(595858762,n.nh.msoulscat_ES_EWAJS,!1,"copyPasteFlowManager.onPaste: promise rejected without error"),r=new $(S.UnknownPasteError,"copyPasteFlowManager.onPaste failed without specified error")),r.pasteContext=t,Promise.reject(r)}))}catch(e){return l().ULS.shipAssertTag(596456161,n.nh.msoulscat_ES_EWAJS,!1,`CopyPasteInfra.copyPasteFlowManager.onPaste: Failed to read data from the clipboard. Exception: ${n.Wp.getStringifiedError(e)}`),Promise.reject(new $(S.FailedToReadFromClipboard,`Failed to read data from the clipboard (with an exception): ${e.message}`,e,t))}}onCancelCopy(e){try{if(this.inProgressCopyContext?(this.inProgressCopyContext.markForCancellation=!0,l().ULS.traceTag(595734748,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.onCancelCopy: canceling copy for copy id ${this.inProgressCopyContext.id}.`)):l().ULS.traceTag(595734749,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"CopyPasteFlowManager.onCancelCopy: no inProgressCopyContext."),!e)return Promise.resolve();this.metadataManager.clear();const t=de(),r={isKeyboardEvent:!1,silentClipboardAccessFailures:!0,commandType:we.Copy};return this.clipboardStrategy.set(t,r).catch((e=>(l().ULS.traceTag(596456162,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`CopyPasteInfra.copyPasteFlowManager.onCancelCopy: Failed to clear the clipboard: ${n.Wp.getStringifiedError(e)}. Call stack: ${e.stack?e.stack:"NA"}`),Promise.reject(new F(y.FailedToClearClipboard,`Failed to clear the clipboard: ${e.message}`,e)))))}catch(e){return l().ULS.traceTag(596456163,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`CopyPasteInfra.copyPasteFlowManager.onCancelCopy: Failed to clear the clipboard. Exception: ${n.Wp.getStringifiedError(e)}`),Promise.reject(new F(y.FailedToClearClipboard,`Failed to clear the clipboard (with an exception): ${e.message}`,e))}}onSystemClipboardChangedExternally(){var e=this;return _async_to_generator((function*(){e.onCancelCopy(!1),e.metadataManager.updateMetadata({lastCopy:void 0});const t={isKeyboardEvent:!1,silentClipboardAccessFailures:!0,commandType:we.Copy};yield e.clipboardStrategy.onSystemClipboardChangedExternally(t)}))()}readClipboardItemsAgainIfMetadataNotSync(e,t){let r=!1;return this.metadataManager.getMetadataSyncPromise().then((t=>{t&&t.lastCopy?(e.copyContextSnapshot&&(r=t.lastCopy.id!==e.copyContextSnapshot.id||t.lastCopy.copyStatus!==e.copyContextSnapshot.copyStatus),e.copyContextSnapshot=t.lastCopy,l().ULS.traceTag(595937158,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`MetadataManager.readClipboardItemsAgainIfMetadataNotSync: metadata is sync. copy id = ${e.copyContextSnapshot.id}. copy status = ${e.copyContextSnapshot.copyStatus}. isMetadataChanged = ${r}`)):l().ULS.traceTag(595937025,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"MetadataManager.readClipboardItemsAgainIfMetadataNotSync: metadata or metadata.lastCopy are not defined. This should be possible only when the last copy was external (i.e. there is no previous copy operation in xlo). do nothing")})).then((()=>r?this.readRichClipboardOnly(e,t,e.clipboardItems):Promise.resolve(e.clipboardItems))).then((t=>(e.clipboardItems=t,e)))}getCopyFlowHandler(e){let t;try{t=this.applicationHost.getCopyFlowHandler(e)}catch(e){throw l().ULS.shipAssertTag(596456192,n.nh.msoulscat_ES_EWAJS,!1,`CopyPasteInfra.copyPasteFlowManager.onCopy: applicationHost.getCopyFlowHandler failed with an exception: ${n.Wp.getStringifiedError(e)}`),new W(f.FetchCopyFlowHandlerFailed,`applicationHost.getCopyFlowHandler failed with an exception: ${e.message}`,e)}if(!t){const e="CopyPasteInfra.copyPasteFlowManager.onCopy: applicationHost.getCopyFlowHandler should return an object. Try again later, when the CCP infra is loaded.";throw l().ULS.shipAssertTag(596456193,n.nh.msoulscat_ES_EWAJS,!1,e),new W(f.CopyFlowHandlerNotFound,e)}return t}getSourceItem(e,t){try{return e.getSourceItem(t)}catch(e){throw l().ULS.shipAssertTag(596456194,n.nh.msoulscat_ES_EWAJS,!1,`CopyPasteInfra.copyPasteFlowManager.onCopy: copyFlowHandler.getSourceItem failed with an exception: ${n.Wp.getStringifiedError(e)}`),new W(f.FetchSourceItemFailed,`applicationHost.getSourceItem failed with an exception: ${e.message}`,e)}}serialize(e,t){try{e.beforeSerialize(t)}catch(e){throw l().ULS.shipAssertTag(596456195,n.nh.msoulscat_ES_EWAJS,!1,`CopyPasteInfra.copyPasteFlowManager.onCopy: copyFlowHandler.beforeSerialize failed with an exception: ${n.Wp.getStringifiedError(e)}`),new W(f.BeforeSerializeFailed,`copyFlowHandler.beforeSerialize failed with an exception: ${e.message}`,e)}let r;try{r=e.serialize(t)}catch(e){throw l().ULS.shipAssertTag(596456196,n.nh.msoulscat_ES_EWAJS,!1,`CopyPasteInfra.copyPasteFlowManager.onCopy: copyFlowHandler.serialize failed with an exception: ${n.Wp.getStringifiedError(e)}`),new W(f.SerializeFailed,`copyFlowHandler.serialize failed with an exception: ${e.message}`,e)}if(!r)throw l().ULS.shipAssertTag(596456197,n.nh.msoulscat_ES_EWAJS,!1,"CopyPasteInfra.copyPasteFlowManager.onCopy: copyFlowHandler.serialize should return a non null result"),new W(f.SerializeResultNotValid,"copyFlowHandler.serialize should return a non null result");return r}setClipboardSync(e,t,r){try{r?l().ULS.traceTag(595734750,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.setClipboardSync: start setClipboardSync for copy id ${r.id}.`):l().ULS.traceTag(595734751,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,"CopyPasteFlowManager.setClipboardSync: no copy context.");let a=e;return a||(a=de()),this.clipboardStrategy.set(a,t).catch((e=>{if(l().ULS.traceTag(596456198,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`CopyPasteInfra.copyPasteFlowManager.onCopy: Failed to synchronously store content in the clipboard. isKeyboardEvent: ${t.isKeyboardEvent}, Error: ${n.Wp.getStringifiedError(e)}. Call stack: ${e.stack?e.stack:"NA"}`),e&&void 0!==e.reason){const t=e;if(t.reason===h.ClipboardIsInaccessible)return Promise.reject(new W(f.ClipboardIsInaccessible,t.message,t));if(t.reason===h.RejectingPendingCutCopyPromiseDueToNewCutCopyOperation)return Promise.reject(new W(f.SuccessiveCutCopyOverridingPendingCutCopy,`A successive Cut/Copy user event occurred before the last Cut/Copy browser event fired: ${t.message}`,t));if(t.reason===h.RejectingBlockedSyncCutCopyPromise)return Promise.reject(new W(f.BlockedSynchronousCutCopy,`In the user Cut/Copy operation, the async part occurred before its predecessor sync Cut/Copy browser event fired: ${t.message}`,t))}return Promise.reject(new W(f.SaveToTheClipboardFailed,`Failed to synchronously store content in the clipboard: ${e.message}`,e))})).then((()=>{r.succeededPopulatingSystemClipboardSync=t.isTimestampStoredInSystemClipboard}))}catch(e){return l().ULS.shipAssertTag(596456199,n.nh.msoulscat_ES_EWAJS,!1,`CopyPasteInfra.copyPasteFlowManager.onCopy: Failed to synchronously store content in the clipboard. Exception: ${n.Wp.getStringifiedError(e)}. Call stack: ${e.stack?e.stack:"NA"}`),Promise.reject(new W(f.SaveToTheClipboardFailed,`Failed to synchronously store content in the clipboard (with an exception): ${e.message}`,e))}}setClipboardAsync(e,t,r){return l().ULS.traceTag(595734752,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.setClipboardAsync: start setClipboardAsync for copy id ${r.id}.`),e?e.then((e=>{try{if(this.isEmptyClipboard(e))return Promise.resolve();this.isLocalstorageDepsInAsyncClipboardAPIRemoved&&e.setItem(le,this.metadataManager.serializeMetadata({lastCopy:_object_spread_props(_object_spread({},r),{copyStatus:Dt.Completed})}));const a=t.stopwatch;t.stopwatch=void 0;const o=_object_spread({},t);return o.isTimestampStoredInSystemClipboard=!1,t.stopwatch=a,t.isKeyboardEvent&&(o.isKeyboardEvent=!1,o.silentClipboardAccessFailures=!0),this.clipboardStrategy.set(e,o).catch((e=>(l().ULS.traceTag(596456200,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`CopyPasteInfra.copyPasteFlowManager.onCopy: Failed to asynchronously store content in the clipboard: ${n.Wp.getStringifiedError(e)}. Call stack: ${e.stack?e.stack:"NA"}`),e&&void 0!==e.reason&&e.reason===h.ClipboardIsInaccessible?Promise.resolve():Promise.reject(new W(f.SaveToTheClipboardFailed,`Failed to asynchronously store content in the clipboard: ${e&&e.message}`,e))))).then((()=>{r.succeededPopulatingSystemClipboardAsync=o.isTimestampStoredInSystemClipboard}))}catch(e){return l().ULS.shipAssertTag(596456201,n.nh.msoulscat_ES_EWAJS,!1,`CopyPasteInfra.copyPasteFlowManager.onCopy: Failed to asynchronously store content in the clipboard. Exception: ${n.Wp.getStringifiedError(e)}. Call stack: ${e.stack?e.stack:"NA"}`),Promise.reject(new W(f.SaveToTheClipboardFailed,`Failed to asynchronously store content in the clipboard (with an exception): ${e.message}`,e))}}),(e=>(r.isAsyncSerializeFailed=!0,l().ULS.traceTag(596456202,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`CopyPasteInfra.copyPasteFlowManager.onCopy: Failed to asynchronously serialize the content - Marking copyContext.isAsyncSerializeFailed as true. Error: ${n.Wp.getStringifiedError(e)}. Call stack: ${e&&e.stack?e.stack:"NA"}`),Promise.reject(new W(f.AsyncSerializeFailed,`Failed to asynchronously serialize the content. Error: ${e?e.message:"..."}`,e))))):(l().ULS.traceTag(595734753,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.setClipboardAsync: no clipboardItemsPromise. resolving promise for copy id ${r.id}.`),Promise.resolve())}isEmptyClipboard(e){return e?0===ue(e)&&(l().ULS.traceTag(596456204,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"CopyPasteInfra.copyPasteFlowManager.onCopy: the async serialization result does not contain items."),!0):(l().ULS.traceTag(596456203,n.nh.msoulscat_ES_EWAJS,n.kp.Error,"CopyPasteInfra.copyPasteFlowManager.onCopy: the async serialization result is undefined."),!0)}readFromClipboard(e,t){l().ULS.traceTag(595685646,n.nh.msoulscat_ES_EWAJS,n.kp.Info,e.profilingMessage("readFromClipboard")),e.copyContextSnapshot&&(t.isTimestampStoredInSystemClipboard=e.copyContextSnapshot.isTimestampStoredInSystemClipboard);const r=this.clipboardStrategy.get(t);return l().ULS.traceTag(595685647,n.nh.msoulscat_ES_EWAJS,n.kp.Info,e.profilingMessage("readFromClipboard_ret")),r?r.then((t=>(l().ULS.traceTag(595685648,n.nh.msoulscat_ES_EWAJS,n.kp.Info,e.profilingMessage("readFromClipboard_then")),t?Promise.resolve(t):(l().ULS.traceTag(596456206,n.nh.msoulscat_ES_EWAJS,n.kp.Error,"CopyPasteInfra.copyPasteFlowManager.onPaste: Failed to read data from the clipboard. Intercepted a missing clipboard item collection"),Promise.reject(new $(S.FailedToReadFromClipboard,"Failed to read data from the clipboard. Intercepted a missing clipboard item collection",new $(S.ClipboardIsEmpty,d)))))),(e=>{if(l().ULS.traceTag(596456207,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`CopyPasteInfra.copyPasteFlowManager.onPaste: Failed to read data from the clipboard: ${n.Wp.getStringifiedError(e)}. Call stack: ${e.stack?e.stack:"NA"}`),t.isPasteCommandFromRecoveryUI&&t.pasteRecoveryCachedClipboardItems)return l().ULS.traceTag(577249542,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"CopyPasteInfra.copyPasteFlowManager.onPaste: Returning 'pasteRecoveryCachedClipboardItems'"),Promise.resolve(t.pasteRecoveryCachedClipboardItems);const r=e;return C(e,h.ClipboardIsInaccessible)?Promise.reject(new $(S.ClipboardIsInaccessible,r.message,r)):C(e,h.RejectingPendingPastePromiseDueToNewPasteOperation)?Promise.reject(new $(S.SuccessivePasteOverridingPendingPaste,`A successive Paste user event occurred before the last Paste browser event fired: ${r.message}`,r)):Promise.reject(new $(S.FailedToReadFromClipboard,`Failed to read data from the clipboard: ${e.message}`,e))})):(l().ULS.shipAssertTag(596456205,n.nh.msoulscat_ES_EWAJS,!1,"CopyPasteInfra.copyPasteFlowManager.onPaste: Failed to read data from the clipboard. clipboardStrategy.get() did not return an object"),Promise.reject(new $(S.FailedToReadFromClipboard,"Failed to read data from the clipboard. clipboardStrategy.get() did not return an object",new $(S.ReadFromClipboardReturnNullOrUndefined,d))))}getPasteFlowHandler(e){let t;try{t=this.applicationHost.getPasteFlowHandler(e)}catch(e){throw l().ULS.shipAssertTag(596456208,n.nh.msoulscat_ES_EWAJS,!1,`CopyPasteInfra.copyPasteFlowManager.onPaste: applicationHost.getPasteFlowHandler failed. Exception: ${n.Wp.getStringifiedError(e)}`),new $(S.FetchPasteFlowHandlerFailed,`applicationHost.getPasteFlowHandler failed with an exception: ${e.message}`,e)}if(!t){const e="CopyPasteInfra.copyPasteFlowManager.onPaste: applicationHost.getPasteFlowHandler should return an object. Try again later, when the CCP infra is loaded.";throw l().ULS.shipAssertTag(596456209,n.nh.msoulscat_ES_EWAJS,!1,e),new $(S.PasteFlowHandlerNotFound,e)}return t}deserialize(e,t){return l().ULS.traceTag(595683456,n.nh.msoulscat_ES_EWAJS,n.kp.Info,t.profilingMessage("deserialize")),e.deserialize(t).catch((e=>{const t=n.Wp.getStringifiedError(e);return l().ULS.traceTag(596456210,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`CopyPasteInfra.copyPasteFlowManager.onPaste: Deserialization failed: ${t}.`),Promise.reject(new $(S.DeserializeOperationFailed,`Deserialization failed: ${t}`,e))}))}copyCompleteCleanup(e,t){e?(l().ULS.traceTag(595734754,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.copyCompleteCleanup: start copy complete for copy id ${e.id}.`),t&&(e.isTimestampStoredInSystemClipboard=t.isTimestampStoredInSystemClipboard),e&&this.inProgressCopyContext&&e.id===this.inProgressCopyContext.id?(this.inProgressCopyContext=void 0,e.copyStatus=Dt.Completed,l().ULS.traceTag(595937159,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.copyCompleteCleanup: updating metadata for copy id ${e.id} after copy completed.`),this.metadataManager.updateMetadata({lastCopy:e})):l().ULS.traceTag(595734755,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.copyCompleteCleanup: not setting copy status to complete state for copy id ${e.id}.`)):l().ULS.traceTag(595734784,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,"CopyPasteFlowManager.copyCompleteCleanup: no copy context.")}readRichClipboardOnly(e,t,r){return t.skipSystemClipboardAccess=!0,this.readFromClipboard(e,t).then((e=>(l().ULS.traceTag(595937160,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"CopyPasteFlowManager.readRichClipboardOnly: get clipboard items."),e)),(e=>(l().ULS.traceTag(595940942,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`CopyPasteFlowManager.readRichClipboardOnly: reading form rich clipboard failed with error: ${n.Wp.getStringifiedError(e)}. use clipboard items from the first read as fallback.`),Promise.resolve(r))))}continueWhenCopyComplete(e,t){if(!t||!t.copyContextSnapshot)return Promise.resolve(void 0);if(t.copyContextSnapshot.copyStatus===Dt.Completed)return Promise.resolve(void 0);if(this.deferredPasteData&&this.deferredPasteData.copyContextId!==t.copyContextSnapshot.id&&(l().ULS.shipAssertTag(595937161,n.nh.msoulscat_ES_EWAJS,!1,`CopyPasteFlowManager.continueWhenCopyComplete: deferred paste for another copy(${this.deferredPasteData.copyContextId} !== ${t.copyContextSnapshot.id}) exist, this is not expected as we should clean deferred paste data when new copy started(both same and cross session)`),this.rejectDeferredPasteData(S.DeferredPasteRejectedBecauseOtherCopyCompleted)),!this.deferredPasteData){const r=this.metadataManager.getCachedMetadata();if(r&&r.lastCopy&&r.lastCopy.copyStatus===Dt.Completed&&r.lastCopy.id===t.copyContextSnapshot.id)return l().ULS.traceTag(595937162,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.continueWhenCopyComplete: copy ${r.lastCopy.id} already completed, not need for waiting any longer, reading the rich clipboard items`),this.readRichClipboardOnly(t,e,t.clipboardItems);const a=lt(),o=a.promise.then((()=>this.readRichClipboardOnly(t,e,t.clipboardItems)));this.deferredPasteData={copyContextId:t.copyContextSnapshot.id,copyCompleteDeferredPromise:a,readClipboardPromise:o,numberOfDeferredPaste:0,createdDate:new Date}}return this.deferredPasteData.numberOfDeferredPaste+=1,l().ULS.traceTag(595937163,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.continueWhenCopyComplete: new deferred paste created for copy id: ${this.deferredPasteData.copyContextId}. number of deferred paste for this copy is: ${this.deferredPasteData.numberOfDeferredPaste}. first deferred paste created time: ${this.deferredPasteData.createdDate.toUTCString()}`),this.deferredPasteData.readClipboardPromise}rejectDeferredPasteData(e){if(this.deferredPasteData){l().ULS.traceTag(595937164,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.rejectDeferredPasteData: reject deferred pastes for copy id: ${this.deferredPasteData.copyContextId}. number of deferred paste for this copy is: ${this.deferredPasteData.numberOfDeferredPaste}. first deferred paste created time: ${this.deferredPasteData.createdDate.toUTCString()}. totalTime = ${(new Date).getTime()-this.deferredPasteData.createdDate.getTime()}ms`);const t=this.deferredPasteData.copyCompleteDeferredPromise;this.deferredPasteData=void 0,t.reject(new $(e,"CopyPasteFlowManager.rejectDeferredPasteData: reject deferred paste"))}}resolveDeferredPasteData(){if(this.deferredPasteData){l().ULS.traceTag(595937165,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.resolveDeferredPasteData: resolve deferred pastes for copy id: ${this.deferredPasteData.copyContextId}. number of deferred paste for this copy is: ${this.deferredPasteData.numberOfDeferredPaste}. first deferred paste created time: ${this.deferredPasteData.createdDate.toUTCString()}. totalTime = ${(new Date).getTime()-this.deferredPasteData.createdDate.getTime()}ms`);const e=this.deferredPasteData.copyCompleteDeferredPromise;this.deferredPasteData=void 0,e.resolve()}}rejectIfCopyCancelled(e){return e?l().ULS.traceTag(595734785,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.rejectIfCopyCancelled: start rejectIfCopyCancelled for copy id ${e.id}.`):l().ULS.traceTag(595734786,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,"CopyPasteFlowManager.rejectIfCopyCancelled: no copy context."),e&&e.markForCancellation?(l().ULS.traceTag(595734787,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.rejectIfCopyCancelled: reject for copy id ${e.id}.`),Promise.reject(new W(f.CopyOperationCancelled,`CopyPasteFlowManager.rejectIfCopyCancelled: Rejecting since copyContext with id ${e.id} is marked for cancellation`))):(e&&l().ULS.traceTag(595734788,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.rejectIfCopyCancelled: resolve for copy id ${e.id}.`),Promise.resolve())}clearInProgressCopyIfNeeded(e){e&&e.markForCancellation||!this.inProgressCopyContext||e&&this.inProgressCopyContext.id===e.id||(l().ULS.traceTag(595937166,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.clearInProgressCopyIfNeeded: cancel previous in-progress copy (id = ${this.inProgressCopyContext.id}) as new copy started (${e.id})`),this.inProgressCopyContext.markForCancellation=!0,this.inProgressCopyContext=void 0)}onMetadataChanged(e){e&&e.lastCopy?(l().ULS.traceTag(595937167,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.onMetadataChanged: the status of copy id ${e.lastCopy.id} from session ${e.lastCopy.sessionId} changed to ${e.lastCopy.copyStatus}`),this.clearInProgressCopyIfNeeded(e.lastCopy),this.deferredPasteData&&e.lastCopy.id!==this.deferredPasteData.copyContextId&&(l().ULS.traceTag(595734789,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.onMetadataChanged: reject deferred paste because copy id ${e.lastCopy.id} is not equal to ${this.deferredPasteData.copyContextId}`),this.rejectDeferredPasteData(S.DeferredPasteRejectedBecauseOtherCopyStarted)),e.lastCopy.copyStatus===Dt.Completed&&this.onCopyCompletedSuccessfully(e.lastCopy)):(l().ULS.traceTag(595734790,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"CopyPasteFlowManager.onMetadataChanged: no metadata or no metadata.lastCopy"),this.deferredPasteData&&(l().ULS.traceTag(595724049,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"CopyPasteFlowManager.onMetadataChanged: reject deferred paste because metadata update without copy context"),this.rejectDeferredPasteData(S.DeferredPasteRejectedBecauseMetadataUpdateWithoutCopyContext)))}onCopyCompletedSuccessfully(e){e?l().ULS.traceTag(595734791,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CopyPasteFlowManager.onCopyCompletedSuccessfully: start onCopyCompletedSuccessfully for copy id ${e.id}.`):l().ULS.traceTag(595734792,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,"CopyPasteFlowManager.onCopyCompletedSuccessfully: no copy context."),this.deferredPasteData&&e&&e.copyStatus===Dt.Completed&&e.id===this.deferredPasteData.copyContextId&&this.resolveDeferredPasteData()}testHook(e){}constructor(e,t,r){if(this.clipboardPlatformEnvironment=e,this.applicationHost=t,this.inProgressCopyContext=void 0,this.deferredPasteData=void 0,this.isLocalstorageDepsInAsyncClipboardAPIRemoved=!1,!r)throw new I(d,"logger");c(r),l().ULS.shipAssertTag(596456157,n.nh.msoulscat_ES_EWAJS,!!e,"CopyPasteInfra.copyPasteFlowManager.ctor: missing 'clipboardPlatformEnvironment' argument"),l().ULS.shipAssertTag(596456158,n.nh.msoulscat_ES_EWAJS,!!t,"CopyPasteInfra.copyPasteFlowManager.ctor: missing 'applicationHost' argument"),this.metadataManager=e.getMetadataManager(),this.metadataManager.addMetadataChangeListener("CopyPasteFlowManagerOnMetadataChangedListener",this.onMetadataChanged.bind(this)),l().ULS.shipAssertTag(596456156,n.nh.msoulscat_ES_EWAJS,!!this.metadataManager,"CopyPasteInfra.copyPasteFlowManager.ctor: metadataManager is not valid"),this.isLocalstorageDepsInAsyncClipboardAPIRemoved=i(0,!1)}}let tr;r(1691);var rr=r(8181);let ar;const or={serializeMetadata:function(e){if(!e)return"{}";try{const t={},r=function(e){if(e)try{if(!e.id)throw new U(h.SerializedMetadata,"MetadataSerializer.serializeCopyContext: copyContext.id is not defined");if(!e.sessionId)throw new U(h.SerializedMetadata,"MetadataSerializer.serializeCopyContext: copyContext.sessionId is not defined");if(void 0===e.copyStatus)throw new U(h.SerializedMetadata,"MetadataSerializer.serializeCopyContext: copyContext.copyStatus is not defined");return{id:e.id,sessionId:e.sessionId,sourceItem:ar.serializeSourceItem(e.sourceItem),commandParameters:ar.serializeCommandParameters(e.commandParameters),copyStatus:e.copyStatus,isTimestampStoredInSystemClipboard:e.isTimestampStoredInSystemClipboard,isAsyncSerializeFailed:e.isAsyncSerializeFailed,asyncClipboardItemsKeys:e.asyncClipboardItemsKeys,syncClipboardItemsKeys:e.syncClipboardItemsKeys,isFullSheetCopy:e.isFullSheetCopy}}catch(e){return void l().ULS.traceTag(595945243,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`MetadataSerializer.serializeCopyContext: failed to serialized copyContext: ${n.Wp.getStringifiedError(e)}`)}}(e.lastCopy);return r&&(t.copyContext=r),JSON.stringify(t)}catch(e){return l().ULS.traceTag(595945242,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`MetadataSerializer.serializeMetadata: failed to serialized metadata: ${n.Wp.getStringifiedError(e)}`),"{}"}},deserializeMetadata:function(e){if(!e)return{};try{const t=JSON.parse(e),r={};return t.copyContext&&(r.lastCopy=function(e){if(e)try{if(!e.id)throw new U(h.DeserializedMetadata,"MetadataSerializer.deserializeCopyContext: copyContextSerializationData.id is not defined");if(!e.sessionId)throw new U(h.DeserializedMetadata,"MetadataSerializer.deserializeCopyContext: copyContextSerializationData.sessionId is not defined");if(!e.copyStatus)throw new U(h.DeserializedMetadata,"MetadataSerializer.deserializeCopyContext: copyContextSerializationData.copyStatus is not defined");if(!e.sourceItem)throw new U(h.DeserializedMetadata,"MetadataSerializer.deserializeCopyContext: copyContextSerializationData.sourceItem is not defined");if(!e.commandParameters)throw new U(h.DeserializedMetadata,"MetadataSerializer.deserializeCopyContext: copyContextSerializationData.commandParameters is not defined");const t=new At;return t.id=e.id,t.sessionId=e.sessionId,t.copyStatus=e.copyStatus,t.isTimestampStoredInSystemClipboard=e.isTimestampStoredInSystemClipboard,t.isAsyncSerializeFailed=e.isAsyncSerializeFailed,t.sourceItem=ar.deserializeSourceItem(e.sourceItem),t.commandParameters=ar.deserializeCommandParameters(e.commandParameters),t.asyncClipboardItemsKeys=e.asyncClipboardItemsKeys,t.syncClipboardItemsKeys=e.syncClipboardItemsKeys,t.isFullSheetCopy=e.isFullSheetCopy,t}catch(e){return void l().ULS.traceTag(595945245,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`MetadataSerializer.deserializeMetadata: failed to deserialized copyContext with error: ${n.Wp.getStringifiedError(e)}.`)}}(t.copyContext)),r}catch(e){l().ULS.traceTag(595945244,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`MetadataSerializer.deserializeMetadata: failed to deserialized metadata with error: ${n.Wp.getStringifiedError(e)}`)}return{}}};let ir,nr,sr,lr={};const cr={};let dr;const pr={getCachedMetadata:function(){return l().ULS.traceTag(595730648,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`MetadataManager.getCachedMetadata: get cached metadata with value: ${fr(lr)}`),Mt(lr)},updateMetadata:function(e){l().ULS.traceTag(595730652,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`MetadataManager.updateMetadata: start update metadata with metadata : ${fr(e)}`);const t=_object_spread({},lr,e),r=me();r.setItem("metadata",nr.serializeMetadata(t)),l().ULS.traceTag(595730653,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`MetadataManager.updateMetadata: schedule metadata with value: ${fr(t)}`),gr(r,t)},clear:function(){l().ULS.traceTag(595730654,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"MetadataManager.clear: start clear metadata");gr(me(),{})},addMetadataChangeListener:function(e,t){e||l().ULS.traceTag(595936158,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,"MetadataManager.addMetadataChangeListener: expected listenerId to be define"),t||l().ULS.traceTag(595936159,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,"MetadataManager.addMetadataChangeListener: expected listener to be define"),cr[e]&&l().ULS.traceTag(595936160,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`MetadataManager.addMetadataChangeListener: listener with same listenerId(${e} already exist.`),cr[e]=t},removeMetadataChangeListener:function(e){e||l().ULS.traceTag(595936161,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,"MetadataManager.addMetadataChangeListener: expected listenerId to be define"),cr[e]?delete cr[e]:l().ULS.traceTag(595936162,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`MetadataManager.removeMetadataChangeListener: can't find listener with listenerId = ${e}.`)},getMetadataSyncPromise:function(){return dr&&(0,rr.isChangeGateEnabled)("OfficeVSO:2594435_ArtCCPWaitForCopyToComplete")?(l().ULS.traceTag(595937174,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"MetadataManager.getMetadataSyncPromise: metadata not sync, return deferred promise."),dr.deferredPromise.promise.then((e=>(l().ULS.traceTag(595937175,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"MetadataManager.getMetadataSyncPromise: sync promise resolved."),e)))):(l().ULS.traceTag(595937173,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"MetadataManager.getMetadataSyncPromise: metadata is sync, return resolved promise."),Promise.resolve(Mt(lr)))},isMetadataSync:function(){return!dr},serializeMetadata:function(e){return nr.serializeMetadata(e)},deserializeMetadata:function(e){return nr.deserializeMetadata(e)}};function ur(e){try{if(e&&0!==ue(e)){const t=e.getItem("metadata");lr=nr.deserializeMetadata(t),l().ULS.traceTag(595730650,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`MetadataManager.onMetadataChanged: set cached metadata with value ${fr(lr)}`)}else l().ULS.traceTag(595730649,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"MetadataManager.onMetadataChanged: set empty cached metadata because clipboardItems were not found"),lr={}}catch(e){l().ULS.traceTag(595945248,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`MetadataManager.onMetadataChanged: failed to parse metadata string with error: ${n.Wp.getStringifiedError(e)}`),lr={}}mr(Mt(lr))}function mr(e){l().ULS.traceTag(595730651,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`MetadataManager.updateListenerForMetadataChanged: update listeners with metadata : ${fr(e)}`);for(const t in cr){const r=cr[t];r&&r(e)}}function gr(e,t){const r=Xe();dr?dr.metadataSyncMessageId=r:(dr={metadataSyncMessageId:r,deferredPromise:lt()},l().ULS.traceTag(595937176,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`MetadataManager.scheduleMetadataUpdate: _syncMetadata created. ${dr.metadataSyncMessageId}`)),l().ULS.traceTag(595937177,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`MetadataManager.scheduleMetadataUpdate: set metadata request was sent with message id ${r}.`),setTimeout((()=>{ir.set(e,{}).then((()=>{lr=t,l().ULS.traceTag(595937178,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`MetadataManager.scheduleMetadataUpdate: set metadata successfully. messageId=${r}. _syncMetadata.metadataSyncMessageId = ${dr&&dr.metadataSyncMessageId}. newMetadata = ${fr(t)}`),hr(r)}),(e=>{l().ULS.traceTag(595945250,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`MetadataManager.updateMetadata: failed to update metadata store with error: ${n.Wp.getStringifiedError(e)}`),hr(r)}))}),0)}function hr(e){if(l().ULS.traceTag(595730655,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`MetadataManager.notifyMetadataSyncIfNeeded: start notifyMetadataSyncIfNeeded with messageId: ${e}`),dr&&dr.metadataSyncMessageId===e){const e=dr;dr=void 0;const t=Mt(lr);l().ULS.traceTag(595730656,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`MetadataManager.notifyMetadataSyncIfNeeded: resolve with metadata: ${fr(t)}`),mr(t),e.deferredPromise.resolve(t)}}function fr(e){return e?e.lastCopy?`copyContext.id=${e.lastCopy.id}`:"copy context is null":"metadata is null"}const Sr="ccp_infra_version=['|\"](\\d+)['|\"]";class yr{wrapTextWithDataSignature(e,t,r,a="null",o){const i={ccp_infra_version:3,ccp_infra_timestamp:r,ccp_infra_user_hash:this.userHash,ccp_infra_copy_id:a};let n;return n=null!==o&&0!==Object.keys(o).length?_object_spread({},i,o):i,n[Kt]=r,function(e,t,r){let a="";return r&&(a=Object.keys(r).reduce(((e,t)=>t?`${e} ${t}='${r[t]}'`:e),"")),`<${t}${a}>${e}</${t}>`}(e,t,n)}ensureDataSignatureInHtmlItem(e){if(0===ue(e))return;const t=ye(e),r=fe(t,se),a=fe(t,"metadata/additional-signature-data-attributes");let o=null;if(a!==d&&(o=JSON.parse(a)),(0,rr.isChangeGateEnabled)("OfficeVSO:9292465_AsyncClipboardWritePromiseEnabled")&&e.hasDeferredItem(ae)){const t=e.getDeferredItem(ae);if(t){const a=t.then((e=>e.text())).then((e=>void 0!==this.getRegExIntValue(e,Sr)?new Blob([e],{type:ae}):new Blob([this.wrapTextWithDataSignature(e,"div",Date.now(),r,o)],{type:ae})));return void e.setDeferredItem(ae,a)}}else{const a=fe(t,ae);if(a){if(void 0!==this.getRegExIntValue(a,Sr))return;return void e.setItem(ae,this.wrapTextWithDataSignature(a,"div",Date.now(),r,o))}}if((0,rr.isChangeGateEnabled)("OfficeVSO:9292465_AsyncClipboardWritePromiseEnabled")&&e.hasDeferredItem(te)){const t=e.getDeferredItem(te);if(t){const a=t.then((e=>e.text())).then((e=>{const t=Xt(e),a=this.wrapTextWithDataSignature(t,"pre",Date.now(),r,o);return new Blob([Qt(a)],{type:ae})}));e.setDeferredItem(ae,a)}}else{const a=Xt(Se(t)),i=this.wrapTextWithDataSignature(a,"pre",Date.now(),r,o);e.setItem(ae,Qt(i))}}extractSignatureData(e){if(pe(e)>0){const t=ge(e,ae),r=this.getRegExIntValue(t,Sr);if(void 0===r)return this.parsePreSignatureData(t);if(this.blockMismatchDataVersion&&3!==r)throw l().ULS.traceTag(595902983,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`clipboardDataManager.extractSignatureData: block mismatch version. dataVer = ${r}, CCPInfraVersion = 3`),new A("ClipboardDataManagerImpl.extractSignatureData",r,3,this.blockMismatchDataVersion);return r<3?(l().ULS.traceTag(595902986,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`clipboardDataManager.extractSignatureData: got data with older version then app version: dataVer = ${r}, CCPInfraVersion = 3. Converting to the data`),this.parseOldSignatureData(t)):(r>3&&l().ULS.traceTag(595900176,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`clipboardDataManager.extractSignatureData: got data with newer version then app version: dataVer = ${r}, CCPInfraVersion = 3. ( It's OK - Should be forward compatibility)`),this.parseCurrentVersionSignatureData(t))}}parseCurrentVersionSignatureData(e){const t=this.getRegExIntValue(e,"\\s+ccp_infra_timestamp=['|\"](\\d+)['|\"]"),r=this.getRegExIntValue(e,"\\s+ccp_infra_user_hash=['|\"](\\d+)['|\"]");if(void 0!==t&&void 0!==r){const a=this.getRegExStringValue(e,"\\s+ccp_infra_copy_id=['|\"]([\\w-]+)['|\"]");return a&&l().ULS.traceTag(595183181,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`clipboardDataManager.parseCurrentVersionSignatureData: copy ID of legacy paste cross session : ${a}`),{ccp_infra_version:3,ccp_infra_timestamp:t,ccp_infra_user_hash:r,ccp_infra_copy_id:a||""}}l().ULS.traceTag(595902985,n.nh.msoulscat_ES_EWAJS,n.kp.Error,`clipboardDataManager.extractSignatureData: Failed to extract SignatureData. textHtmlItem: ${e}`)}parseOldSignatureData(e){return this.parseCurrentVersionSignatureData(e)}parsePreSignatureData(e){const t=function(e){const t=function(e,t){if(!e||!e.trim())return;if(!t||!t.trim())throw new I(d,"attributeName");const r=new RegExp(`${t}=['"](\\d+)['"]`,"i").exec(e);return!r||r.length<2?void 0:r[1]}(e,Kt);if(!t||!t.trim())return;const r=Number(t);return!r&&0!==r||isNaN(r)?void 0:r}(e);if(l().ULS.traceTag(595723668,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`clipboardDataManager.parsePreSignatureData: dataTimeStamp=${t}`),t){if(this.blockMismatchDataVersion)throw l().ULS.traceTag(595899270,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,"clipboardDataManager.parsePreSignatureData: block mismatch version. block pre signature data"),new A("ClipboardDataManagerImpl.extractSignatureData",NaN,3,this.blockMismatchDataVersion);const e={ccp_infra_version:3,ccp_infra_timestamp:t,ccp_infra_user_hash:0};return l().ULS.traceTag(595723669,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"clipboardDataManager.parsePreSignatureData"),e}}validateTTL(e){if(e&&this.ttlInMs){const t=Date.now()-e.ccp_infra_timestamp;if(t>this.ttlInMs)throw l().ULS.traceTag(595899858,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`Time elapsed (${t} ms) from setting Clipboard (${e.ccp_infra_timestamp}) is greater then TTL (${this.ttlInMs} ms) - return error`),new L("clipboardDataManager.validateTTL validation failed",t,this.ttlInMs)}}validateUserHash(e){if(e&&e.ccp_infra_user_hash!==this.userHash)throw l().ULS.traceTag(595723670,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,"clipboardDataManager.validateUserHash: user hash mismatch detected. throw error"),new D("clipboardDataManager.validateUserHash validation failed",e?e.ccp_infra_user_hash:0,this.userHash)}setMetaDataVersionItem(e){if(0===ue(e))return;e.setItem(ne,JSON.stringify({ccp_infra_version:3}))}validateMetaDataVersionItem(e){if(e&&ue(e)>0){const t=ge(e.getData(),ne);let r;try{r=JSON.parse(t)}catch(e){if(!this.blockMismatchDataVersion)return;throw l().ULS.traceTag(595899272,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`clipboardDataManager.validateMetaDataVersionItem: failed parse SignatureMetaData. error = ${e}`),new M(`ClipboardDataManagerImpl.validateMetaDataVersionItem: failed parse SignatureMetaData. SignatureMetaData text = ${t}`)}if(this.blockMismatchDataVersion&&3!==r.ccp_infra_version)throw l().ULS.traceTag(595899203,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`clipboardDataManager.validateMetaDataVersionItem: block mismatch version. dataVer = ${r.ccp_infra_version}, CCPInfraVersion = 3`),new A("ClipboardDataManagerImpl.validateMetaDataVersionItem",r.ccp_infra_version,3,this.blockMismatchDataVersion)}}createClipboardDataProcessor(e){return l().ULS.traceTag(595723671,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`clipboardDataManager.createClipboardDataProcessor: get called. validateUserHash=${e}`),{preSetProcess:this.ensureDataSignatureInHtmlItem.bind(this),postGetProcess:(t=>{if(l().ULS.traceTag(595723672,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`clipboardDataManager.createClipboardDataProcessor.postGet: get called. validateUserHash=${e}`),t){const r=this.extractSignatureData(t.getData());l().ULS.traceTag(595723673,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`clipboardDataManager.createClipboardDataProcessor.postGet: clipboardItems not empty. validateUserHash=${e}`),r&&t.setItem(se,r.ccp_infra_copy_id),this.validateTTL(r),e&&(l().ULS.traceTag(595723674,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`clipboardDataManager.createClipboardDataProcessor.postGet: going to validate user hash. validateUserHash=${e}`),this.validateUserHash(r))}}).bind(this)}}createDualClipboardDataProcessor(e){return l().ULS.traceTag(595723675,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"clipboardDataManager.createDualClipboardDataProcessor: get called."),{preSetProcess:this.ensureDataSignatureInHtmlItem.bind(this),postGetProcess:(e=>{l().ULS.traceTag(595723676,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"clipboardDataManager.createDualClipboardDataProcessor.postGet: get called."),e&&e.clipboardItemsData&&(e.signatureData=this.extractSignatureData(e.clipboardItemsData),e.signatureData&&(e.clipboardItemsData.items[se]=e.signatureData.ccp_infra_copy_id),this.validateTTL(e.signatureData))}).bind(this),validateUserHash:e?this.validateUserHash.bind(this):()=>{}}}createClipboardMetaDataProcessor(){return{preSetProcess:this.setMetaDataVersionItem.bind(this),postGetProcess:this.validateMetaDataVersionItem.bind(this)}}getRegExStringValue(e,t){const r=new RegExp(t,"g").exec(e);if(r&&r.length&&r.length>1)return r[1]}getRegExIntValue(e,t){const r=this.getRegExStringValue(e,t);if(r){const e=Number(r);return isNaN(e)?void 0:e}}constructor(e,t,r){this.ttlInMs=t,this.blockMismatchDataVersion=r,e?this.userHash=n.Wp.calcHashCode(e):(this.userHash=1565411791,l().ULS.traceTag(595903939,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,"userId not exist!. Use default ID"))}}class Cr extends St{init(e){var t,r;return this.deferredResultMessagePromiseCache=new mt,this.sender=(t=this.serializer,new wt(t,this)),this.receiver=(r=this.deserializer,new Et(r,this,this)),this.postInitMessage(e).catch((e=>(l().ULS.traceTag(596129250,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`Init failure or timeout. Error: ${n.Wp.getStringifiedError(e)}`),C(e,h.IframeInitializationTimeout)?Promise.reject(e):Promise.reject(new U(h.IframeInitialization,"failed to init the Shared Clipboard",e)))))}registerPushMessageListener(e,t){this.pushMessageListeners[e]=t}postInitMessage(e){const t=et(gt,"init",tt.initIframe);if(!this.deferredResultMessagePromiseCache){const e="RPC Client - postInitMessage: this.deferredResultMessagePromiseCache should be defined";return l().ULS.shipAssertTag(596121487,n.nh.msoulscat_ES_EWAJS,!1,e),Promise.reject(new T(e))}const r=this.postMessage(t),a=this.deferredResultMessagePromiseCache.getDeferredPromise(t.id),o=Date.now();return setTimeout((()=>{if(a&&!a.fulfilled()){const e=Date.now(),t=`initialization started on ${new Date(o)} and timed out on ${new Date(e)} after ${e-o} ms`;l().ULS.traceTag(596129251,n.nh.msoulscat_ES_EWAJS,n.kp.Error,t),a.reject(new U(h.IframeInitializationTimeout,t))}}),e),r}postMessage(e){try{if(!e)throw new I(d,"outgoingMessage");if(l().ULS.shipAssertTag(596452175,n.nh.msoulscat_ES_EWAJS,!!e.id,"postMessage: outgoingMessage.id must be defined"),super.postMessage(e),!this.deferredResultMessagePromiseCache){const e="RPC Client - postMessage: this.deferredResultMessagePromiseCache should be defined";throw l().ULS.shipAssertTag(596121488,n.nh.msoulscat_ES_EWAJS,!1,e),new T(e)}return this.deferredResultMessagePromiseCache.addNewPromise(e.id).promise}catch(t){return Promise.reject(new T(`Unable to post message for operation '${e?e.operationCode:void 0}'`,t))}}handleMessage(e){l().ULS.traceTag(596452376,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`RPC Client - handleMessage: incomingMessage.id='${e&&e.id}'; incomingMessage.operationCode='${e&&e.operationCode}'; incomingMessage.failed='${e&&e.failed}'; incomingMessage.error='${e&&e.error}'; incomingMessage.clipboardItems.length=${pe(e&&e.clipboardItemsData)}`);const t=this.pushMessageListeners[e.operationCode];if(t)return t(e.clipboardItemsData),Promise.resolve();if(!this.deferredResultMessagePromiseCache){const e="RPC Client - handleMessage: this.deferredResultMessagePromiseCache should be defined";return l().ULS.shipAssertTag(596121489,n.nh.msoulscat_ES_EWAJS,!1,e),Promise.reject(new T(e))}const r="initresult"===e.operationCode?gt:e.id,a=this.deferredResultMessagePromiseCache.getDeferredPromise(r);return a?(this.deferredResultMessagePromiseCache.delete(r),e.failed?a.reject(e.error):a.resolve(e),Promise.resolve()):(l().ULS.traceTag(596452377,n.nh.msoulscat_ES_EWAJS,n.kp.Info,r===e.id?`RPC Client - handleMessage: no deferred promise with id '${e.id}'; dropping this result.`:`RPC Client - handleMessage: no deferred promise with id '${r}' for message id '${e.id}'; dropping this result.`),Promise.resolve())}handleDeserializationError(e){return!e||"NoValidKeyError"!==e.errorName||this.deferredResultMessagePromiseCache&&0!==this.deferredResultMessagePromiseCache.getLength()?(l().ULS.traceTag(596452379,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`RPC Client - handleDeserializationError. There are ${this.deferredResultMessagePromiseCache?this.deferredResultMessagePromiseCache.getLength():0} deferred promise(s) in the cache. Error: ${n.Wp.getStringifiedError(e)}`),Promise.resolve()):(l().ULS.traceTag(542687372,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`RPC Client - handleDeserializationError. Error: ${n.Wp.getStringifiedError(e)}`),Promise.resolve())}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||(O([()=>{this.deferredResultMessagePromiseCache&&this.deferredResultMessagePromiseCache.clear()}]),super.dispose())}constructor(e,t,r){super(e,t,r,"WindowRPCClientInternal"),this.pushMessageListeners={}}}const br=[],Er="load",wr="clipboard",_r="clipboard/shared.aspx",vr="corrid",Ir={initialized:!1,origin:d,src:d,deferredPromise:void 0};let Pr,Tr;function Ar(){return Ir}function Lr(){if(Pr){try{Pr()}catch(e){}Pr=void 0}}function Dr(e){return Tr||(Tr=Ar()),Tr.initialized||(Tr.origin=function(e){qe();const t=Ve(e);let r=t.split($e);if(!r||2!==r.length||!r[0]||!r[1])throw new P("Invalid origin","parentOrigin",e);const a=xe();let o=d;if(a.whitelistOriginComponents){const t=r[0]+$e;if(r=r[1].split(Oe),!r||r.length<2||!r[0])throw new P("Invalid origin","parentOrigin",e);r.splice(0,1,a.sharedClipboardHostingApp),o=t+r.join(Oe)}else o=t;return l().ULS.traceTag(596452424,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`getSharedClipboardValidatedOrigin: app's origin = '${e}'; Shared Clipboard iframe origin = '${o}' components=${JSON.stringify(r)}`),o}(e),Tr.src=function(e){const t=Ar().origin;let r=t;"/"!==t.charAt(t.length-1)&&(r+="/"),r+=_r,e&&(r+=`?${encodeURIComponent(ht)}=${encodeURIComponent(e)}`);const a=[];br.forEach((e=>{(0,rr.isChangeGateEnabled)(e)||a.push({key:e,value:"1"})}));const o=function(){if(!tr)throw new T("ClipboardPlatformSettings is not ready. Call ClipboardPlatformEnvironment.init(...).");return tr}();o&&(o.sessionId&&a.push({key:Ie,value:o.sessionId}),o.bulsEndpointUrl&&a.push({key:ve,value:o.bulsEndpointUrl}));const[i,s]=(0,n.kA)();return l().ULS.traceTag(595722560,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`getValidatedIframeSrc.getValidatedIframeSrc: Generate correlation if for loading the shared clipboard frame. CorrelationId: ${i} newGuidLogging: ${s}`),a.push({key:vr,value:i}),a.push({key:"NoAuth",value:"true"}),a.length>0&&a.forEach((e=>{r+=r.indexOf("?")>=0?"&":"?",r+=`${encodeURIComponent(e.key)}=${encodeURIComponent(e.value)}`})),r}(e),Tr.initialized=!0),Tr.origin}function Mr(){if(!Tr)return Promise.reject("state in undefined, please make sure to call initialize first");let e=function(){if(!Ar().initialized)throw new T("getIframe: the initialize function should be called beforehand");const e=document.getElementsByTagName("iframe");if(e&&0!==e.length){l().ULS.traceTag(595952723,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`getIframe: found ${e.length} iframes`);for(let t=0;t<e.length;t+=1){const r=e[t];if(r&&r.id&&r.id===wr)return r}l().ULS.traceTag(595952724,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"getIframe: the CCP iframe does not exist")}else l().ULS.traceTag(595952722,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"getIframe: found no iframes")}();e&&(l().ULS.traceTag(596448770,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`ensureIframeWindow: The CCP iframe exists. Removing the iframe and re-adding it. iframe.src ${void 0!==e.src&&void 0!==Tr.src&&e.src.toLowerCase()===Tr.src.toLowerCase()?"===":"!=="} src; deferredPromise ${void 0===Tr.deferredPromise?"does not exist":"exists"}; The iframe's content window ${void 0===e.contentWindow?"does not exist":"exists"}.`),function(e){if(!e)throw new I(d,"iframe");l().ULS.traceTag(595952725,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,"removeIframe: removing the CCP iframe"),Lr(),e.parentNode&&e.parentNode.removeChild(e)}(e),e=void 0);let t=Tr.deferredPromise,r=t?t.id:d;if(t){Lr(),Tr.deferredPromise=void 0;const e=`ensureIframeWindow: the CCP iframe does not exist and the deferred promise of its content window should not exist as well. Rejecting deferred promise id '${r}' and creating a new one`;l().ULS.shipAssertTag(596453587,n.nh.msoulscat_ES_EWAJS,!1,e),t.reject(new T(e)),t=void 0}Tr.deferredPromise=lt(Xe()),t=Tr.deferredPromise,r=t.id;try{e=function(){const e=document.createElement("iframe");return e.style.display="none",e.id=wr,l().ULS.shipAssertTag(595952726,n.nh.msoulscat_ES_EWAJS,!Pr,"createIframe: the last shared clipboard iframe's onload event listener should have been removed. Removing it and registering a new event listener."),Lr(),Pr=ee(e,Er,(e=>function(e){l().ULS.traceTag(595952727,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"CCP iframe onload event: Entering"),Lr();const t=Ar().deferredPromise;if(!t)return void l().ULS.shipAssertTag(595952728,n.nh.msoulscat_ES_EWAJS,!1,"CCP iframe onload event: the CCP iframe does not have a matching deferred promise to notify subscribers when the iframe loaded");const r=t.id;try{Ar().deferredPromise=void 0;const a=e.target;if(!a){const e=`CCP iframe onload event: the CCP iframe should exist when its onload event is called. Rejecting deferred promise id '${r}'`;return l().ULS.shipAssertTag(595952729,n.nh.msoulscat_ES_EWAJS,!1,e),void t.reject(new T(e))}if(!a.contentWindow){const e=`CCP iframe onload event: the contentWindow of the CCP iframe does not exist. Rejecting deferred promise id '${r}'`;return l().ULS.shipAssertTag(595952730,n.nh.msoulscat_ES_EWAJS,!1,e),void t.reject(new T(e))}l().ULS.traceTag(595952732,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CCP iframe onload event: resolving deferred promise id '${r}' with the iframe`),t.resolve(a)}catch(e){const a=`iframeOnLoad: an error has occurred: [${n.Wp.getStringifiedError(e)}]. Rejecting deferred promise id '${r}'`;l().ULS.traceTag(595952733,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,a),t.reject(new T(a,e))}}(e))),e.src=Ar().src,e}(),document.getElementsByTagName("body")[0].appendChild(e)}catch(e){const t=`ensureIframeWindow: unable to create and/or add a CCP iframe. Dropping tentative deferred promise id '${r}'`;return l().ULS.traceTag(596453588,n.nh.msoulscat_ES_EWAJS,n.kp.Error,t),Tr.deferredPromise=void 0,Lr(),Promise.reject(new T(t,e))}return t&&!t.fulfilled()?t.promise:(Lr(),e.contentWindow?(Tr.deferredPromise=void 0,Promise.resolve(e)):(l().ULS.shipAssertTag(596453589,n.nh.msoulscat_ES_EWAJS,!1,`ensureIframeWindow: the iframe's content window should exist. Deferred promise id = '${r}'`),Promise.reject(new T(`ensureIframeWindow: the iframe's content window should exist. Deferred promise id = '${r}'`))))}let xr,kr;function Wr(){if(kr)return kr.promise;kr=lt(Xe());try{const e=Dr(We().origin);xr=function(e,t){return new Cr(function(e){if(!e)throw new I(d,"validator");return{serialize:t=>function(e,t){if(!e)throw new I(d,"outgoingMessage");if(!t)throw new I(d,"validator");return t(e),function(e){let t;try{t=JSON.stringify(e)}catch(t){throw new P("Serialization failed","outgoingMessage",`${Object.keys(e).length} properties`,t)}return l().ULS.traceTag(596452375,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`The length of the serialized message is ${t.length}`),t}(e)}(t,e)}}(rt),function(e){if(!e)throw new I(d,"validator");return{deserialize:t=>function(e,t){if(!e)throw new I(d,"incomingMessage");if(!t)throw new I(d,"validator");if(0===e.length)throw new P("An empty message is invalid","incomingMessage");const r=e.trim();if(0===r.length)throw new P("A message cannot contain only spaces","incomingMessage");let a;try{a=JSON.parse(r)}catch(t){throw new P("Deserialization failed","incomingMessage",`Contains ${e.length.toString()} characters`,t)}if(!a)throw new P("Deserialization returned nothing","incomingMessage");return t(a),a}(t,e)}}(ot),{window:void 0,windowOrigin:e})}(e),n.Wp.retry(((e,t)=>function(e,t){if(!xr){const e="clipboardIframeLoader::initializeIframe - windowRPCClient should be defined";return l().ULS.shipAssertTag(595947544,n.nh.msoulscat_ES_EWAJS,!1,e),Promise.reject(new T(e))}const r=n.TZ.start(`Iframe_initialize_${e}`);n.TZ.mark(r,"start"),xr.remoteWindow.window=void 0;const a=a=>{const o=C(a,h.IframeInitializationTimeout)?` due to a timeout of approx. ${t} ms`:d;n.TZ.mark(r,"finish_error"),n.TZ.failure(r,(e=>l().ULS.traceTag(596452419,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,e)),`Attempt #${e} failed to initialize an iframe ${o}. ${e<3?"Retrying...":"No more retries!"}. Error: ${n.Wp.getStringifiedError(a)}`)},o=lt();return Mr().then((o=>{if(n.TZ.mark(r,"iframe_loaded"),n.TZ.mark(r,"iframe_waiting_for_idb_init"),!xr){const e="clipboardIframeLoader::initializeIframe - windowRPCClient should be defined";l().ULS.shipAssertTag(595947545,n.nh.msoulscat_ES_EWAJS,!1,e);const t=new T(e);return a(t),Promise.reject(t)}if(!o.contentWindow){const e="clipboardIframeLoader::initializeIframe - remoteWindow.contentWindow should be defined";l().ULS.shipAssertTag(595903557,n.nh.msoulscat_ES_EWAJS,!1,e);const t=new T(e);return a(t),Promise.reject(t)}return xr.remoteWindow.window=o.contentWindow,xr.init(t).then((()=>(n.TZ.mark(r,"iframe_idb_init_complete"),n.TZ.mark(r,"finish"),n.TZ.success(r,(e=>l().ULS.traceTag(596452418,n.nh.msoulscat_ES_EWAJS,n.kp.Info,e)),`Attempt #${e} initialized iframe`),Promise.resolve())))})).then((()=>{o.resolve()}),(e=>{a(e),o.reject(e)})),o.promise}(e,2e4+(C(t,h.IframeInitializationTimeout)?5e3:0)*(e-1))),3).then((()=>{kr.resolve(xr)}),(e=>{kr.reject(e)}))}catch(e){kr.reject(e)}return kr.promise}class $r{innerInitialize(){return Wr().then((e=>(this.initialized=!0,this.windowRPCClient=e,this)))}registerPushMessageListener(e,t){this.windowRPCClient&&this.windowRPCClient.registerPushMessageListener(e,t)}postMessage(e,t){if(!this.initialized)return Promise.reject(new U(h.IframeInitialization));const r=n.TZ.start(`BaseIframeProxy_${t}`);n.TZ.mark(r,"start");const a=e=>(n.TZ.mark(r,"finish_error"),n.TZ.failure(r,(e=>l().ULS.traceTag(596452188,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,e)),`Failed in BaseIframeProxy.postMessage. Error: ${n.Wp.getStringifiedError(e)}`),Promise.reject(new U(h.IframeProxyGeneralError,"Failed in BaseIframeProxy.postMessage",e)));if(!this.windowRPCClient){const e="BaseIframeProxy.postMessage - this.windowRPCClient should be defined";return l().ULS.shipAssertTag(595944461,n.nh.msoulscat_ES_EWAJS,!1,e),a(new T(e))}return this.windowRPCClient.postMessage(e).then((e=>(l().ULS.shipAssertTag(595944462,n.nh.msoulscat_ES_EWAJS,!!e,"BaseIframeProxy.postMessage: postMessage must have returned a result message"),e?e.failed?Promise.reject(new U(h.IframeProxyGeneralError,`BaseIframeProxy.postMessage: the operation failed. Error: ${e.error}`)):(n.TZ.mark(r,"finish"),n.TZ.success(r,(e=>l().ULS.traceTag(596452187,n.nh.msoulscat_ES_EWAJS,n.kp.Info,e))),Promise.resolve(e)):Promise.reject(new U(h.IframeProxyEmptyResultMessage,"BaseIframeProxy.postMessage: postMessage succeeded but returned nothing"))))).catch((e=>a(e)))}constructor(){this.initialized=!1}}class Fr{initialize(e){return new Wt(this.localStorageKey,e,(e=>{this._onMetadataChangedListener&&this._onMetadataChangedListener(e)})),Promise.resolve()}setOnMetadataChangedListener(e){l().ULS.traceTag(595716297,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"LocalStorageKeyTrackerMetadataWatcher.setOnMetadataChangedListener: start setOnMetadataChangedListener"),l().ULS.shipAssertTag(595716298,n.nh.msoulscat_ES_EWAJS,!!e,"LocalStorageKeyTrackerMetadataWatcher.setOnMetadataChangedListener: expect listener to be defined."),this._onMetadataChangedListener=e}constructor(e){this.localStorageKey=e}}class Ur extends $r{initialize(e){return super.innerInitialize().then((()=>{this.registerPushMessageListener("getMetadata_longPollingresult",(e=>{this._onMetadataChangedListener&&this._onMetadataChangedListener(me(e))}))}))}setOnMetadataChangedListener(e){l().ULS.traceTag(595730647,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"LongPollingMetadataWatcher.setOnMetadataChangedListener: start setOnMetadataChangedListener"),l().ULS.shipAssertTag(595944466,n.nh.msoulscat_ES_EWAJS,!!e,"LongPollingMetadataWatcher.setOnMetadataChangedListener: expect listener to be defined."),this._onMetadataChangedListener=e}}class Or extends nt{constructor(e){super(m.SystemClipboard,{browserStorage:!1,systemClipboard:!0,inMemory:!1},e)}}let Rr=!0;function Jr(){return Rr}function Nr(){Rr=!1}let jr=!0;function zr(){return jr}function Hr(){jr=!1}function Vr(){let e;try{e=window.clipboardData}catch(e){l().ULS.traceTag(595985225,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`ieSystemClipboard.getDataTransfer: An error occurred when attempting to access window.clipboardData. Error: ${n.Wp.getStringifiedError(e)}`)}return e}function Gr(){if(l().ULS.shipAssertTag(596455701,n.nh.msoulscat_ES_EWAJS,G(),"The browser must be IE"),!G())throw new T("The browser must be IE")}function Br(e){return!!e}function Kr(e){if(!e)return void l().ULS.traceTag(596456320,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"A clipboard event parameter is missing");let t;try{t=e.clipboardData}catch(e){throw l().ULS.traceTag(595985224,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`systemClipboard.getDataTransfer: An error occurred when attempting to access rawEvent.clipboardData. Error: ${n.Wp.getStringifiedError(e)}`),e}return t}function qr(e,t,r,a){let o=!1;try{const a=Kr(r);if(!a||!Br(a))return l().ULS.traceTag(596456264,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`setData - programmatic ${q} and ${Z} is broken. There is no valid data transfer object. clipboardDataFormat = '${e}'`),!1;o=a.setData(e,t),!1===o&&l().ULS.traceTag(596456265,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`setData returned false for '${e}'.`)}catch(t){l().ULS.traceTag(596456266,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`setData with '${e}' threw an exception: ${n.Wp.getStringifiedError(t)}`)}return void 0===o&&(o=!0),o}function Zr(e,t,r,a){if(Gr(),!a&&!Jr()&&!zr())return l().ULS.traceTag(596456269,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`setData - programmatic ${q} and ${Z} clipboard access is not supported. rawEvent is empty = ${!!r}`),!1;const o=Vr();if(!o||!Br(o))return l().ULS.traceTag(596456270,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`setData - ${q} and ${Z} is broken. There is no valid global data transfer object. Do not try again to fetch it. clipboardDataFormat = '${e}'`),a||(l().ULS.shipAssertTag(596456271,n.nh.msoulscat_ES_EWAJS,Jr()&&zr(),`setData - programmatic ${q} and ${Z} is broken because the global data transfer object was previously available and now it's not available. isBeforeFirstProgrammaticAccess = '${Jr()}'. isProgrammaticAccessSupported = '${zr()}'. clipboardDataFormat = '${e}'`),Nr(),Hr()),!1;let i,s=e;s===te&&(s=re);try{i=o.setData(s,t),!1===i&&l().ULS.traceTag(596456272,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`setData returned false for '${s}'.`)}catch(e){l().ULS.traceTag(596456273,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`setData with '${s}' threw an exception: ${e.message}`)}return!a&&Jr()&&(Nr(),!1===i&&Hr()),void 0===i&&(i=!0),i}function Xr(){return Jr()&&Zr(te,d,void 0,!1),!!zr()||(l().ULS.traceTag(596456274,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`document.execCommand - programmatic clipboard access is not allowed for '${q}' and '${Z}'.`),!1)}const Yr={execCommandCopy:function(){let e;try{e=document.execCommand(q,!1,null)}catch(e){l().ULS.traceTag(596456262,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`document.execCommand('${q}') threw an exception. This is a browser bug. Ignoring. Exception: ${e.message}`)}return void 0===e&&(e=!0),e},execCommandCut:function(){let e;try{e=document.execCommand(Z,!1,null)}catch(e){l().ULS.traceTag(596456263,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`document.execCommand('${Z}') threw an exception. This is a browser bug. Ignoring. Exception: ${e.message}`)}return void 0===e&&(e=!0),e},setData:qr,defaultClipboardDataFormat:te},Qr={execCommandCopy:function(){if(Gr(),!Xr())return!1;try{document.execCommand(q,!1,null)}catch(e){l().ULS.traceTag(596456267,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`document.execCommand('${q}') threw an exception. This is a browser bug. Ignoring. Exception: ${e.message}`)}return!0},execCommandCut:function(){if(Gr(),!Xr())return!1;try{document.execCommand(Z,!1,null)}catch(e){l().ULS.traceTag(596456268,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`document.execCommand('${Z}') threw an exception. This is a browser bug. Ignoring. Exception: ${e.message}`)}return!0},setData:Zr,defaultClipboardDataFormat:re};let ea;function ta(e,t,r,a){return ra().setData(e,t,r,a)}function ra(){return void 0===ea&&(ea=Yr),ea}G()&&(ea=Qr);const aa="command",oa="getClipboardData",ia="getAvailableCommands";let na;const sa={};function la(){if(void 0===na&&(na=!1,"chrome"in window)){const e=window.chrome;e&&("runtime"in e&&e.runtime?"sendMessage"in e.runtime&&e.runtime.sendMessage?na=!0:l().ULS.traceTag(596455703,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,"chrome.runtime.sendMessage is not available"):l().ULS.traceTag(596455704,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"chrome.runtime is not available"))}return na}function ca(e){if(!e||!e.items)return Promise.reject(new $(S.ClipboardIsInaccessible,`getImageDataUrlFromClipboardData: clipboardData is undefined=${!e} clipboardData.items is undefined=${!e.items}`));for(let t=0;t<e.items.length;t+=1){const r=e.items[t].type&&e.items[t].type.startsWith("image");if(r||l().ULS.traceTag(528859143,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"Non-image type read from System Clipboard. File Type is "+e.items[t].type),"file"===e.items[t].kind&&r)return da(e.items[t].getAsFile())}return Promise.resolve(d)}function da(e){const t=n.TZ.start("ImageFile_Read_From_Clipboard"),r=e?e.size:-1,a=lt(),o=new FileReader;return o.onload=()=>{o.result?(n.TZ.success(t,(e=>l().ULS.traceTag(595911452,n.nh.msoulscat_ES_EWAJS,n.kp.Info,pa(e,r)))),a.resolve(o.result.toString())):(n.TZ.failure(t,(e=>l().ULS.traceTag(595911453,n.nh.msoulscat_ES_EWAJS,n.kp.Info,pa(e,r)))),a.reject(new $(S.FileReaderResultIsEmpty,"getImageDataUrlFromClipboardData: FileReader result is null or undefined")))},o.onerror=()=>{n.TZ.failure(t,(e=>l().ULS.traceTag(595911454,n.nh.msoulscat_ES_EWAJS,n.kp.Info,pa(e,r)))),a.reject(new $(S.FileReaderFailed,"getImageDataUrlFromClipboardData: FileReader failed"))},n.TZ.mark(t,"Starting_readAsDataURL"),o.readAsDataURL(e),a.promise}function pa(e,t){const r=JSON.parse(e);return r.filesize=t,JSON.stringify(r)}function ua(e,t,r){if(Gr(),!r&&!Jr()&&!zr())return l().ULS.traceTag(596456327,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`getData - programmatic ${X} clipboard access is not supported. rawEvent is empty = ${!!t}`),Promise.resolve(d);const a=Vr();if(!a||!Br(a))return l().ULS.traceTag(596456328,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`getData - ${X} is broken. There is no valid global data transfer object. Do not try again to fetch it. clipboardDataFormat = '${e}'`),r||(l().ULS.shipAssertTag(596456329,n.nh.msoulscat_ES_EWAJS,Jr()&&zr(),`getData - programmatic ${X} is broken because the global data transfer object was previously available and now it's not available. isBeforeFirstProgrammaticAccess = '${Jr()}'. isProgrammaticAccessSupported = '${zr()}'. clipboardDataFormat = '${e}'`),Nr(),Hr()),Promise.resolve(d);let o=e;o===te&&(o=re);let i=d;try{i=a.getData(o),i||(i=d),l().ULS.traceTag(596456330,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`getData('${o}') returned ${i.length} characters`)}catch(e){l().ULS.traceTag(596456331,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`getData with '${o}' threw an exception. This is a browser bug. Ignoring. Exception: ${e.message}`)}if(!r&&Jr()&&(Nr(),i===d)){if(qr(e," ",void 0))return ua(e,void 0,!1).then((t=>(t===d?Hr():qr(e,d,void 0),Promise.resolve(i))));Hr()}return Promise.resolve(i)}const ma={init:function(){},execCommandPaste:function(){let e;try{e=document.execCommand(X,!1,null)}catch(e){l().ULS.traceTag(596456322,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`document.execCommand('${X}') threw an exception. This is a browser bug. Ignoring. Exception: ${e.message}`)}return void 0===e&&(e=!0),e},getData:function(e,t,r){let a=d;try{const r=Kr(t);if(!r||!Br(r))return Promise.resolve(a);if(e===oe)return ca(r);a=r.getData(e),a||(a=d),l().ULS.traceTag(596456323,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`getData('${e}') returned ${a.length} characters`)}catch(t){l().ULS.traceTag(596456324,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`getData with '${e}' threw an exception. This is a browser bug. Ignoring. Exception:: ${n.Wp.getStringifiedError(t)}`)}return Promise.resolve(a)},browserExtensionPaste:function(){return Promise.reject(new U(h.NoBrowserExtensionsInConfiguration))}},ga={init:function(){},execCommandPaste:function(){if(Gr(),Jr()&&ua(te,void 0,!1),!zr())return l().ULS.traceTag(596456325,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`document.execCommand - programmatic clipboard '${X}' access is not allowed in this session.`),!1;try{document.execCommand(X,!1,null)}catch(e){l().ULS.traceTag(596456326,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`document.execCommand('${X}') threw an exception. This is a browser bug. Ignoring. Exception: ${e.message}`)}return!0},getData:ua,browserExtensionPaste:function(){return Promise.reject(new U(h.NoBrowserExtensionsInConfiguration))}},ha={init:function(){!function(){const e=Ya().getChromeExtensionIds();if(0===e.length)return;const t={};t[aa]=ia,e.forEach((e=>{window.chrome.runtime.sendMessage(e,t,void 0,(t=>{const r=window.chrome.runtime.lastError;if(t&&Array.isArray(t)&&0!==t.length&&!r)sa[e]=t;else{let t=d;r&&"message"in r&&"string"==typeof r.message&&(t=r.message),l().ULS.traceTag(589947074,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`chromeSystemClipboard - '${ia}': browser extension '${e}' is not available. Error: ${t}`)}}))}))}()},execCommandPaste:function(){let e=!1;try{e=document.execCommand(X,!1,null),void 0===e&&(e=!0)}catch(e){l().ULS.traceTag(596455698,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`Chrome: document.execCommand('${X}') threw an exception. This is a browser bug. Ignoring. Exception: ${e.message}`)}return e},getData:function(e,t,r){let a=d;try{const r=Kr(t);if(!r||!Br(r))return Promise.resolve(a);if(e===oe)return ca(r);a=r.getData(e),a||(a=d),l().ULS.traceTag(596455699,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`Chrome: getData('${e}') returned ${a.length} characters`)}catch(t){l().ULS.traceTag(596455700,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`Chrome: getData with '${e}' threw an exception. This is a browser bug. Ignoring. Exception:: ${n.Wp.getStringifiedError(t)}`)}return Promise.resolve(a)},browserExtensionPaste:function(){return function(){if(!la())return Promise.reject(new U(h.MissingBrowserExtensionCapability));const e=function(){for(const e in sa)if(sa[e].includes(oa))return e;return null}();if(!e)return Promise.reject(new U(h.NoBrowserExtensionWithGetClipboardDataCommand));const t={};return t[aa]="getClipboardData",function(e,t){return new Promise(((r,a)=>{let o=!0;window.chrome.runtime.sendMessage(e,t,void 0,(t=>{const i=window.chrome.runtime.lastError;if(!t||"object"!=typeof t||Array.isArray(t)||i){o=!1;let t=d;i&&"message"in i&&"string"==typeof i.message&&(t=i.message),a(new U(h.UnavailableBrowserExtension,`chromeSystemClipboard - '${oa}': browser extension '${e}' is not available. Error: ${t}`))}else{o=!1;const e=t,a=e.html,i=e.img,n=e.text,s=function(e,t,r){const a=!!e,o=!!t,i=!!r,n=e.includes("<img src=");return o&&!i||o&&a&&n}(a,i,n);r({text:n,html:s?i:a})}})),setTimeout((()=>{o&&(l().ULS.traceTag(589947076,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`chromeSystemClipboard - getPasteWithExtensionPromise reject the promise after timeout. chromeExtenstionsInfo: '${sa}'`),a(new U(h.UnavailableBrowserExtension,`chromeSystemClipboard - '${oa}': browser extension '${e}' is not available. Timeout after : 2000 ms`)))}),2e3)}))}(e,t).then((t=>{if(!t)return Promise.reject(new U(h.NoAvailableBrowserExtensions));l().ULS.traceTag(589947075,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`chromeSystemClipboard - paste by browser extension '${e}'`);const r=me();return r.setItem(te,t.text),r.setItem(ae,t.html),r.setItem("metadata/chrome-extension-id",e),r}))}()}};let fa;function Sa(){return void 0===fa&&(fa=la()?ha:ma),fa}G()&&(fa=ga);var ya=r(3765);const Ca=(e,t)=>{if(Ea(e))e.replaceChildren(t);else{for(;e.firstChild;)e.removeChild(e.firstChild);ba(e,t)}},ba=(e,t)=>{if(wa(e))e.append(t);else if("string"==typeof t){const r=document.createTextNode(t);e.appendChild(r)}else e.appendChild(t)},Ea=e=>!!e.replaceChildren,wa=e=>!!e.append,_a="ccpContentEditable";function va(){const e=document.getSelection();if(e&&e.getRangeAt&&"function"==typeof e.getRangeAt&&!(e.rangeCount<1))return e.getRangeAt(0)}function Ia(e,t,r=void 0){l().ULS.shipAssertTag(596444114,n.nh.msoulscat_ES_EWAJS,!1===t&&!r||!0===t&&(!!r||r===d),`enableClipboardEvents: useTextHtmlContentCandidate = '${t}', textHtmlContentCandidate is ${r||r===d?d:"not "}provided`);let a=document.activeElement&&document.activeElement.id;a||l().ULS.traceTag(595719625,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,"hiddenContentEditableDiv.enableClipboardEvents: activeElementIdToRestore must to be define");const o=function(e,t){let r=Aa();if(r&&r.tagName&&"div"!==r.tagName.toLowerCase()&&(r.parentElement&&r.parentElement.removeChild(r),r=void 0),r||(r=function(){const e=document.createElement("div");return function(e){e.id=_a,e.contentEditable="true",Ma()&&(e.contentEditable="false"),e.spellcheck=!1,e.setAttribute("autocomplete","off"),e.setAttribute("autocorrect","off"),e.setAttribute("autocapitalize","off"),e.setAttribute("aria-hidden","true"),e.tabIndex=-1,e.style.display="inline-block",e.style.position="absolute",e.style.fontSize="10",e.style.height="0px",e.style.width="0px",e.style.top="0px",e.style.left="0px",e.style.zIndex="-100",e.style.overflow="hidden",e.onmousemove=()=>{e.onmousemove=null,l().ULS.assertTag(595957699,n.nh.msoulscat_ES_EWAJS,!1,`contentEditableElement.onmousemove: Mouse move event is not expected on element '${_a}'. it should be covered by other elements`)}}(e),document.body.appendChild(e),e}()),G()){let a=t;e?a||(a=d):a=Da().outerHTML,r.innerHTML=ya.sanitize(a)}else Ca(r,e?null!=t?t:d:Da());return r}(t,r);a&&a===o.id&&(a=void 0),o.focus();const i=document.getSelection();if(i){i.removeAllRanges();const e=document.createRange();e.selectNodeContents(o),i.addRange(e)}return e&&Pa(!0),a}function Pa(e){if(!Ma())return;const t=Aa();t&&(t.contentEditable=e?"true":"false")}function Ta(){const e=Aa();if(!e)return!1;try{const t=e.clientLeft+e.scrollWidth/2,r=e.clientTop+e.scrollTop/2,a=document.elementFromPoint(t,r);return!!a&&(a.id===e.id||!!a.parentElement&&a.parentElement.id===e.id)}catch(e){return l().ULS.traceTag(595957534,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`isContentEditableElementVisibleToUser: hit test failed with error: ${n.Wp.getStringifiedError(e)}`),!1}}function Aa(){return document.getElementById(_a)}function La(){const e=Aa();e&&(G()?e.innerHTML=ya.sanitize(Da().outerHTML):Ca(e,Da()))}function Da(){const e=document.createElement("span");return e.innerText=p,e}function Ma(){return!G()}class xa{get(e){if(this.disposableImplementationExtension.throwIfDisposed("get"),l().ULS.traceTag(596449096,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`SystemClipboardStorage.get: isKeyboardEvent = '${e.isKeyboardEvent}'`),e.skipSystemClipboardAccess){l().ULS.traceTag(596124883,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"SystemClipboardStorage.get: Skipping system clipboard access");const e=ee(document,Q,(t=>this.skipSystemClipboardPasteHandler(t,e)),!0);return this.removeLastPasteEventListenerCallback=e,Promise.resolve(de())}if(this.lastDeferredPastePromise&&!this.lastDeferredPastePromise.fulfilled()){const e=this.lastDeferredPastePromise,t=`There exists a pending deferred promise with id '${e.id}', representing an active ${X} event. Scheduling a rejection to execute after the current operation.`;l().ULS.traceTag(596455680,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,t),window.setTimeout((()=>{e.reject(new U(h.RejectingPendingPastePromiseDueToNewPasteOperation,t))}),0)}this.clearPasteCallbackConfiguration(this.lastDeferredPastePromise,!0,!1);const t=lt();this.lastDeferredPastePromise=t;const r=t.id,a=ee(document,Q,(r=>this.pasteHandler(r,t,e.isKeyboardEvent,a)),!0);this.removeLastPasteEventListenerCallback=a,this.selectedRangeToRestore=va(),this.activeElementIdToRestore=Ia(!0,!1);try{let a=!1;if(e.isKeyboardEvent||(a=Sa().execCommandPaste()),e.isKeyboardEvent);else if(!a)return this.clearPasteCallbackConfiguration(t,!0,!0),e.isAsyncSystemClipboardEnabled?Promise.reject(new U(h.ClipboardIsInaccessible,`Reject the Promise if not keyboard event in SystemClipboardStorage.get. Deferred promise id = '${r}'`)):Sa().browserExtensionPaste().then((t=>(e.isChromiumExtension=!0,e.clearSystemClipboard&&this.clearSystemClipboard(),t)),(t=>(!e.isAsyncSystemClipboardEnabled&&e.clearSystemClipboard&&this.clearSystemClipboard(),Promise.reject(new U(h.ClipboardIsInaccessible,`document.execCommand(${X}) failed in SystemClipboard.get. Deferred promise id = '${r}'`,t)))))}catch(e){return this.clearPasteCallbackConfiguration(t,!0,!1),Promise.reject(new U(h.GetClipboardItems,`Failed in SystemClipboard.get. Deferred promise id = '${r}'`,e))}return t.promise.then((t=>(e.clearSystemClipboard&&this.clearSystemClipboard(),t)),(t=>(e.clearSystemClipboard&&this.clearSystemClipboard(),C(t,h.RejectingPendingPastePromiseDueToNewPasteOperation)?Promise.reject(t):Promise.reject(new U(h.GetClipboardItems,`Failed in SystemClipboard.get. Deferred promise id = '${r}'`,t)))))}set(e,t){if(this.disposableImplementationExtension.throwIfDisposed("set"),l().ULS.traceTag(596449097,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`SystemClipboardStorage.set: isKeyboardEvent = '${t.isKeyboardEvent}'; cutCopyPasteFlags = '${t.commandType}'`),l().ULS.shipAssertTag(595932513,n.nh.msoulscat_ES_EWAJS,!t.skipSystemClipboardAccess,"SystemClipboardStorage.set: skipSystemClipboardAccess shouldn't be used using set of SystemClipboardStorage as we have to set the timestamp metadata in the html in order to support last copy item scenario. "),G()&&!t.isKeyboardEvent){if(t.silentClipboardAccessFailures&&Jr())return l().ULS.traceTag(596455681,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"Aborting attempt to store content in the clipboard since silentClipboardAccessFailures is on and the user did not select Allow access in IE's clipboard access dialog"),Promise.resolve();if(!Jr()&&!zr())return l().ULS.traceTag(596455682,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"Aborting attempt to store content in the clipboard since the user selected Dont Allow in IE's clipboard access dialog. Use the active selection."),Promise.resolve()}if(this.lastDeferredCutCopyPromise&&!this.lastDeferredCutCopyPromise.fulfilled()){const e=this.lastDeferredCutCopyPromise,r=`There exists a pending deferred promise with id '${e.id}', representing an active ${Z}/${q} event. Scheduling a rejection to execute after the current operation.`;l().ULS.traceTag(596455683,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,r),window.setTimeout((()=>{e.reject(new U(t.isKeyboardEvent?h.RejectingPendingCutCopyPromiseDueToNewCutCopyOperation:h.RejectingBlockedSyncCutCopyPromise,r))}),0)}this.clearCutCopyCallbackConfiguration(this.lastDeferredCutCopyPromise,!0,!1);const r=lt();this.lastDeferredCutCopyPromise=r;const a=r.id;try{const o=ye(e),i=xa.getClipboardCutCopyEventType(t.commandType),s=ee(document,i,(e=>{t.isTimestampStoredInSystemClipboard=!0,this.cutCopyHandler(e,r,o,t.isKeyboardEvent,t.commandType,s)}));this.removeLastCutCopyEventListenerCallback=s;let c=d;G()&&(c=fe(o,ae)),this.selectedRangeToRestore=va(),this.activeElementIdToRestore=Ia(!1,!!c,c);let p=!1;if(G()&&t.isKeyboardEvent||(p=t.commandType===we.Cut?ra().execCommandCut():ra().execCommandCopy()),t.isKeyboardEvent);else if(!p)return this.clearCutCopyCallbackConfiguration(r,!0,!0),!G()||Jr()||zr()||(l().ULS.traceTag(596455684,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`Aborting attempt to store content in the clipboard since the user selected Dont Allow in IE's clipboard access dialog. Use the active selection. Deferred promise id = '${a}'`),r.resolve()),Promise.resolve()}catch(e){return this.clearCutCopyCallbackConfiguration(r,!0,!1),Promise.reject(new U(h.SetClipboardItems,`Failed in SystemClipboard.set. Deferred promise id = '${a}'`,e))}return r.promise.catch((e=>e&&b(e,[h.RejectingPendingCutCopyPromiseDueToNewCutCopyOperation,h.RejectingBlockedSyncCutCopyPromise])?Promise.reject(e):Promise.reject(new U(h.SetClipboardItems,`Failed in SystemClipboard.set. Deferred promise id = '${a}'`,e))))}getSupportedDataFormats(){return this.disposableImplementationExtension.throwIfDisposed("getSupportedDataFormats"),[te,ae,oe]}cutCopyHandler(e,t,r,a,o,i){try{if(l().ULS.traceTag(596449098,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`SystemClipboardStorage.cutCopyHandler: isKeyboardEvent = '${a}'; cutCopyPasteFlags = '${o}'; bubbles = '${e.bubbles}'; eventPhase = '${e.eventPhase}'`),i(),this.removeLastCutCopyEventListenerCallback===i&&(this.removeLastCutCopyEventListenerCallback=void 0),this.disposableImplementationExtension.logIfDisposed("cutCopyHandler"))return;if(l().ULS.shipAssertTag(596455686,n.nh.msoulscat_ES_EWAJS,!!t,`SystemClipboardStorage.cutCopyHandler: the deferred promise parameter is missing. isKeyboardEvent = '${a}'; cutCopyPasteFlags = '${o}'`),!t)return;if(l().ULS.traceTag(596455687,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`SystemClipboardStorage.cutCopyHandler: isKeyboardEvent = '${a}'; cutCopyPasteFlags = '${o}'; deferred promise id = '${t.id}'`),l().ULS.shipAssertTag(596455688,n.nh.msoulscat_ES_EWAJS,!t.fulfilled(),`SystemClipboardStorage.cutCopyHandler: deferred promise '${t.id}' is already fulfilled. isKeyboardEvent = '${a}'; cutCopyPasteFlags = '${o}'`),t.fulfilled())return;const s=()=>{t.resolve(),this.clearCutCopyCallbackConfiguration(t,!1,!1)},c=fe(r,ae);if(c&&G())window.setTimeout(s,0);else{c&&ta(ae,c,e,a);const t=Se(r);ta(ra().defaultClipboardDataFormat,t,e,a),e.preventDefault(),s()}}catch(e){this.clearCutCopyCallbackConfiguration(t,!1,!1),l().ULS.traceTag(596455689,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`SystemClipboardStorage.cutCopyHandler callback with deferred promise id '${t?t.id:d}' (fulfilled = '${t?t.fulfilled():d}') failed with this exception: ${e&&e.message?e.message:"NA"}. Call stack: ${e.stack?e.stack:"NA"}`),t&&t.reject(new U(h.SetClipboardItems,`Failed in SystemClipboard.set > cutCopyHandler callback. Deferred promise id = '${t.id}'. Error: ${e&&e.message?e.message:"NA"}`,e))}}pasteHandler(e,t,r,a){let o=!0;try{if(l().ULS.traceTag(596449099,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`SystemClipboardStorage.pasteHandler: isKeyboardEvent = '${r}'; eventPhase='${e.eventPhase}'`),e.preventDefault(),a(),this.removeLastPasteEventListenerCallback===a&&(this.removeLastPasteEventListenerCallback=void 0),this.disposableImplementationExtension.logIfDisposed("pasteHandler"))return;if(l().ULS.shipAssertTag(596455690,n.nh.msoulscat_ES_EWAJS,!!t,`SystemClipboardStorage.pasteHandler: the deferred promise parameter is missing. isKeyboardEvent = '${r}'`),!t)return;if(l().ULS.traceTag(596455691,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`SystemClipboardStorage.pasteHandler: isKeyboardEvent = '${r}'; deferred promise id = '${t.id}'`),l().ULS.shipAssertTag(596455692,n.nh.msoulscat_ES_EWAJS,!t.fulfilled(),`SystemClipboardStorage.pasteHandler: deferred promise '${t.id}' is already fulfilled. isKeyboardEvent = '${r}'`),t.fulfilled())return;const i=me(),s=this.getSupportedDataFormats(),c=this.readDataFormats(s,e,r,i);Promise.all(c).then((()=>{e.stopPropagation(),o=!1,G()?window.setTimeout((()=>{const e=document.getElementById(_a);if(e&&e.firstChild&&"IMG"===e.firstChild.nodeName){const t=e.firstChild;t&&t.src&&t.src.indexOf("base64")>-1?i.setItem(oe,t.src):l().ULS.traceTag(595907107,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"SystemClipboardStorage.pasteHandler: IE has provided the IMG HTML rather than the image blob, which is unsupported.")}else i.setItem(ae,function(){const e=Aa();return l().ULS.shipAssertTag(596444113,n.nh.msoulscat_ES_EWAJS,!!e,"getTextHtmlContent: the content editable element does not exist"),e?ya.sanitize(e.innerHTML):d}()),(r=e)&&r.firstChild&&r.firstElementChild&&r.firstElementChild.getAttribute(Kt)&&i.setItem(te,function(e){const t=[],r=e.getElementsByTagName("tr");if(r.length>0){const e=Yt(r[0]);t.push(e);for(let e=1;e<r.length;e+=1){t.push(Ft),t.push($t);const a=Yt(r[e]);t.push(a)}}return t.join("")}(e));var r;La(),t.resolve(i),this.clearPasteCallbackConfiguration(t,!1,!1)}),0):(La(),t.resolve(i),this.clearPasteCallbackConfiguration(t,!1,!1))}))}catch(r){La();try{o&&e.stopPropagation()}catch(e){l().ULS.traceTag(595985030,n.nh.msoulscat_ES_EWAJS,n.kp.Error,`SystemClipboardStorage.pasteHandler: failed when performing stopPropagation/preventDefault on the raw event. Failed with an exception: ${n.Wp.getStringifiedError(e)}`)}this.clearPasteCallbackConfiguration(t,!1,!1),l().ULS.traceTag(596455693,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`SystemClipboardStorage.pasteHandler callback with deferred promise id '${t?t.id:d}' (fulfilled = '${t?t.fulfilled():d}') failed with an exception: ${r&&r.message?r.message:"NA"}. Call stack: ${r.stack?r.stack:"NA"}`),t&&t.reject(new U(h.GetClipboardItems,`Failed in SystemClipboard.get > pasteHandler callback. Deferred promise id = '${t.id}'. Error: ${r&&r.message?r.message:"NA"}`,r))}}isFileFormat(e){return e===oe}isPlainTextEmpty(e){const t=e.getItem("text/plain");return!t||0===t.length}readDataFormats(e,t,r,a){if(!this.skipFilesIfPlainTextExists||!r&&function(){const e=R();let t=!1;if(e&&e.userAgent){const r=e.userAgent();r&&r.indexOf("Edg/")>=0&&(t=!0)}return t}())return this.readDataFormatsInternal(e,t,r,a);const o=e.filter((e=>this.isFileFormat(e)));if(0===o.length)return this.readDataFormatsInternal(e,t,r,a);const i=e.filter((e=>!this.isFileFormat(e))),s=this.readDataFormatsInternal(i,t,r,a);return[Promise.all(s).then((()=>{if(!this.isPlainTextEmpty(a))return l().ULS.traceTag(595653317,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"SystemClipboardStorage.readDataFormats: skip files loading because clipboard contains plain text"),Promise.resolve();const e=this.readDataFormatsInternal(o,t,r,a);return Promise.all(e)}))]}readDataFormatsInternal(e,t,r,a){const o=[];return e.forEach((e=>{o.push(function(e,t,r){return Sa().getData(e,t,r)}(e,t,r).then((t=>{l().ULS.traceTag(541646989,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"SystemClipboardStorage.readDataFormatsInternal: Read "+e+" from clipboard"),a.setItem(e,t)})).catch((t=>{l().ULS.traceTag(595653318,n.nh.msoulscat_ES_EWAJS,n.kp.Error,`SystemClipboardStorage.readDataFormatsInternal: Failed to get data of type [${e}]. Error [${n.Wp.getStringifiedError(t)}]`)})))})),o}skipSystemClipboardPasteHandler(e,t){try{t(),e.stopPropagation(),e.preventDefault()}catch(e){l().ULS.traceTag(595993058,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`SystemClipboardStorage.skipSystemClipboardPasteHandler: failed with an exception: ${e&&e.message?e.message:"NA"}. Call stack: ${e.stack?e.stack:"NA"}`)}this.removeLastPasteEventListenerCallback===t&&(this.removeLastPasteEventListenerCallback=void 0)}hasPlainText(e){return!!e&&Object.keys(e.getData().items).indexOf(te)>-1}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||(O([()=>{this.lastDeferredCutCopyPromise&&!this.lastDeferredCutCopyPromise.fulfilled()&&(this.lastDeferredCutCopyPromise.reject(),this.lastDeferredCutCopyPromise=void 0,this.removeLastCutCopyEventListenerCallback&&(this.removeLastCutCopyEventListenerCallback(),this.removeLastCutCopyEventListenerCallback=void 0))},()=>{this.lastDeferredPastePromise&&!this.lastDeferredPastePromise.fulfilled()&&(this.lastDeferredPastePromise.reject(),this.lastDeferredPastePromise=void 0,this.removeLastPasteEventListenerCallback&&(this.removeLastPasteEventListenerCallback(),this.removeLastPasteEventListenerCallback=void 0))}]),this.disposableImplementationExtension.dispose())}static getClipboardCutCopyEventType(e){if(!e)return Y;if(e===we.Copy)return Y;if(e===we.Cut)return"cut";throw new P(d,"cutCopyPasteFlags",e.toString())}restoreFocusToPreviouslyActiveElement(){if(!this.activeElementIdToRestore)return;const e=document.getElementById(this.activeElementIdToRestore);e&&e.focus(),this.activeElementIdToRestore=void 0}restoreSelection(){this.selectedRangeToRestore&&(function(e){if(!e)return;const t=document.getSelection();t&&t.removeAllRanges&&"function"==typeof t.removeAllRanges&&t.addRange&&"function"==typeof t.addRange&&(t.removeAllRanges(),t.addRange(e))}(this.selectedRangeToRestore),this.selectedRangeToRestore=void 0)}clearCutCopyCallbackConfiguration(e,t,r){this.restoreFocusToPreviouslyActiveElement(),this.restoreSelection(),l().ULS.shipAssertTag(595957697,n.nh.msoulscat_ES_EWAJS,!Ta(),"SystemClipboardStorage.set: ccpContentEditable is visible to the user during a copy/cut operation, but it should not be visible."),(e===this.lastDeferredCutCopyPromise||e&&this.lastDeferredCutCopyPromise&&e.id===this.lastDeferredCutCopyPromise.id)&&(this.lastDeferredCutCopyPromise=void 0),t&&this.removeLastCutCopyEventListenerCallback&&(r||l().ULS.traceTag(596449290,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`SystemClipboardStorage.set: the ${Z}/${q} event listener was not called. Calling removeLastCutCopyEventListenerCallback()`),this.removeLastCutCopyEventListenerCallback(),this.removeLastCutCopyEventListenerCallback=void 0)}clearPasteCallbackConfiguration(e,t,r){this.restoreFocusToPreviouslyActiveElement(),this.restoreSelection(),Pa(!1),l().ULS.shipAssertTag(595957698,n.nh.msoulscat_ES_EWAJS,!Ta(),"SystemClipboardStorage.clearPasteCallbackConfiguration: ccpContentEditable is visible to the user during a paste operation, but it should not be visible"),(e===this.lastDeferredPastePromise||e&&this.lastDeferredPastePromise&&e.id===this.lastDeferredPastePromise.id)&&(this.lastDeferredPastePromise=void 0),t&&this.removeLastPasteEventListenerCallback&&(r||l().ULS.traceTag(596449291,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`SystemClipboardStorage.get: the ${X} event listener was not called. Calling removeLastPasteEventListenerCallback()`),this.removeLastPasteEventListenerCallback(),this.removeLastPasteEventListenerCallback=void 0)}clearSystemClipboard(){const e=de(),t={isKeyboardEvent:!1,commandType:we.Copy};this.set(e,t).then((()=>{l().ULS.traceTag(595935906,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"SystemClipboardStorage.clearSystemClipboard: clear system clipboard succeed")}),(()=>{l().ULS.traceTag(595935907,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"SystemClipboardStorage.clearSystemClipboard: clear system clipboard failed")}))}constructor(e){this.lastDeferredCutCopyPromise=void 0,this.removeLastCutCopyEventListenerCallback=void 0,this.lastDeferredPastePromise=void 0,this.selectedRangeToRestore=void 0,this.removeLastPasteEventListenerCallback=void 0,this.activeElementIdToRestore=void 0,this.skipFilesIfPlainTextExists=e,this.clipboardStorageType=be.SystemClipboard,this.disposableImplementationExtension=it("SystemClipboardStorage"),Sa().init()}}class ka extends nt{constructor(e){super(m.InMemory,{browserStorage:!1,systemClipboard:!1,inMemory:!0},e)}}class Wa{dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||(this.inMemoryClipboardItems=void 0,this.disposableImplementationExtension.dispose())}get(e){return this.disposableImplementationExtension.throwIfDisposed("get"),this.inMemoryClipboardItems?Promise.resolve(this.inMemoryClipboardItems):Promise.resolve(de())}set(e,t){return this.disposableImplementationExtension.throwIfDisposed("set"),this.inMemoryClipboardItems=e,Promise.resolve()}getSupportedDataFormats(){return this.disposableImplementationExtension.throwIfDisposed("getSupportedDataFormats"),[te,ae,"data/shadow-workbook"]}constructor(){this.clipboardStorageType=be.InMemory,this.disposableImplementationExtension=it("InMemoryClipboardStorage")}}class $a extends nt{constructor(e){super(m.LocalStorage,{browserStorage:!0,systemClipboard:!1,inMemory:!1},e)}}class Fa{initialize(e,t){return this.initialized=!1,this.systemClipboardStrategy=void 0,this.fullAccessClipboardStrategy=void 0,e.then((e=>(this.systemClipboardStrategy=e,t.then((e=>(this.fullAccessClipboardStrategy=e,this.initialized=!0,Promise.resolve(this)))))))}set(e,t){try{if(this.disposableImplementationExtension.throwIfDisposed("set"),!this.initialized||!this.systemClipboardStrategy)return Promise.reject(new U(h.ClipboardStrategyNotInitialized));const r={systemClipboardOperationResult:at(p,"setresult",!1),fullAccessClipboardOperationResult:at(p,"setresult",!1)};return this.dualClipboardDataProcessor&&this.dualClipboardDataProcessor.preSetProcess(e),this.systemClipboardStrategy.set(e,t).then((()=>Promise.resolve(r)),(e=>(r.systemClipboardOperationResult.failed=!0,r.systemClipboardOperationResult.clipboardOperationResultError=e,b(e,[h.RejectingPendingCutCopyPromiseDueToNewCutCopyOperation,h.RejectingBlockedSyncCutCopyPromise])?Promise.reject(e):Promise.resolve(r)))).then((r=>this.fullAccessClipboardStrategy?this.fullAccessClipboardStrategy.set(e,t).then((()=>Promise.resolve(r)),(e=>(l().ULS.traceTag(595933078,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`Failed to save to fullAccessClipboardStrategy. clipboardStrategyType: '${this.fullAccessClipboardStrategy&&this.fullAccessClipboardStrategy.clipboardStrategyType}', Command Id: '${t.id?t.id:d}', Error: ${n.Wp.getStringifiedError(e)}`),r.fullAccessClipboardOperationResult.failed=!0,r.fullAccessClipboardOperationResult.clipboardOperationResultError=e,Promise.resolve(r)))):(r.fullAccessClipboardOperationResult.failed=!0,Promise.resolve(r)))).then((e=>{if(e.systemClipboardOperationResult.failed&&e.fullAccessClipboardOperationResult.failed){let t=e.systemClipboardOperationResult.clipboardOperationResultError;return t||(t=e.fullAccessClipboardOperationResult.clipboardOperationResultError),t?Promise.reject(t):Promise.reject(new U(h.SetClipboardItems,d))}return Promise.resolve()}))}catch(e){return Promise.reject(new U(h.SetClipboardItems,"Failed in system clipboard.set",e))}}get(e){try{if(this.disposableImplementationExtension.throwIfDisposed("get"),!this.initialized||!this.systemClipboardStrategy)return Promise.reject(new U(h.ClipboardStrategyNotInitialized));const t={systemClipboardOperationResult:at(p,"getresult",!1,void 0,{items:{}}),fullAccessClipboardOperationResult:at(p,"getresult",!1,void 0,{items:{}})};return this.systemClipboardStrategy.get(e).then((e=>(t.systemClipboardOperationResult.clipboardItemsData=e.getData(),this.dualClipboardDataProcessor&&this.dualClipboardDataProcessor.postGetProcess(t.systemClipboardOperationResult),Promise.resolve(t)))).catch((r=>(l().ULS.traceTag(507904974,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`Failed to get data from systemClipboardStrategy. clipboardStrategyType: '${this.systemClipboardStrategy&&this.systemClipboardStrategy.clipboardStrategyType}', Command Id: '${e.id?e.id:d}', Error: ${n.Wp.getStringifiedError(r)}`),t.systemClipboardOperationResult.failed=!0,t.systemClipboardOperationResult.clipboardOperationResultError=r,C(r,h.RejectingPendingPastePromiseDueToNewPasteOperation)?Promise.reject(r):Promise.resolve(t)))).then((t=>this.fullAccessClipboardStrategy?this.fullAccessClipboardStrategy.get(e).then((e=>(t.fullAccessClipboardOperationResult.clipboardItemsData=e.getData(),this.dualClipboardDataProcessor&&this.dualClipboardDataProcessor.postGetProcess(t.fullAccessClipboardOperationResult),Promise.resolve(t)))).catch((r=>(l().ULS.traceTag(595933079,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`Failed to get from fullAccessClipboardStrategy. clipboardStrategyType: '${this.fullAccessClipboardStrategy&&this.fullAccessClipboardStrategy.clipboardStrategyType}', Command Id: '${e.id?e.id:d}', Error: ${n.Wp.getStringifiedError(r)}`),t.fullAccessClipboardOperationResult.failed=!0,t.fullAccessClipboardOperationResult.clipboardOperationResultError=r,Promise.resolve(t)))):(t.fullAccessClipboardOperationResult.failed=!0,Promise.resolve(t)))).then((t=>{if(t.systemClipboardOperationResult.failed||e.skipSystemClipboardAccess){if(t.fullAccessClipboardOperationResult.failed){let e=t.systemClipboardOperationResult.clipboardOperationResultError;return e||(e=t.fullAccessClipboardOperationResult.clipboardOperationResultError),e?Promise.reject(e):Promise.reject(new U(h.GetClipboardItems,d))}return 0===pe(t.fullAccessClipboardOperationResult.clipboardItemsData)?Promise.reject(t.systemClipboardOperationResult.clipboardOperationResultError):this.validateAndReturnFullAccessData(t)}return t.fullAccessClipboardOperationResult.failed?Promise.resolve(me(t.systemClipboardOperationResult.clipboardItemsData)):!B()||B()&&N.isEdgeWithTextHtmlClipboardSupportProperty?this.pasteSourceReconciliation(t,e):this.pasteSourceReconciliationBasedOnlyOnTextPlain(t)}))}catch(e){return Promise.reject(new U(h.GetClipboardItems,"Failed in system clipboard.get",e))}}onSystemClipboardChangedExternally(e){try{return this.disposableImplementationExtension.throwIfDisposed("onSystemClipboardChangedExternally"),this.initialized?this.fullAccessClipboardStrategy?this.fullAccessClipboardStrategy.onSystemClipboardChangedExternally(e):(l().ULS.shipAssertTag(595882509,n.nh.msoulscat_ES_EWAJS,!1,"ClipboardStrategyBase.onSystemClipboardChangedExternally: this.fullAccessClipboardStrategy should be defined"),Promise.reject(new U(h.ClipboardStrategyNotInitialized))):Promise.reject(new U(h.ClipboardStrategyNotInitialized))}catch(e){return Promise.reject(new U(h.ClearClipboardItems,`Failed in (clipboard ${this.clipboardStrategyType}).onSystemClipboardChangedExternally`,e))}}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||(O([()=>{this.systemClipboardStrategy&&this.systemClipboardStrategy.dispose()},()=>{this.fullAccessClipboardStrategy&&this.fullAccessClipboardStrategy.dispose()}]),this.disposableImplementationExtension.dispose())}pasteSourceReconciliation(e,t){let r,a,o;return e.systemClipboardOperationResult.signatureData&&(r=e.systemClipboardOperationResult.signatureData.ccp_infra_timestamp),e.fullAccessClipboardOperationResult.signatureData&&(a=e.fullAccessClipboardOperationResult.signatureData.ccp_infra_timestamp),l().ULS.traceTag(595719624,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`systemClipboardAndFullAccessClipboardStrategy.pasteSourceReconciliation: ccpTimestampInSystemClipboard=${r} ccpTimestampInFullAccessClipboard=${a}`),r?(o=a||0,r>o?(Ua(e.systemClipboardOperationResult.clipboardItemsData,!0),Promise.resolve(me(e.systemClipboardOperationResult.clipboardItemsData))):Promise.resolve(me(e.fullAccessClipboardOperationResult.clipboardItemsData))):t.isTimestampStoredInSystemClipboard?Oa(e)?Promise.resolve(me(e.fullAccessClipboardOperationResult.clipboardItemsData)):Ra(e)?this.validateAndReturnFullAccessData(e):(Ua(e.systemClipboardOperationResult.clipboardItemsData,!1),Promise.resolve(me(e.systemClipboardOperationResult.clipboardItemsData))):this.validateAndReturnFullAccessData(e)}validateAndReturnFullAccessData(e){return this.dualClipboardDataProcessor&&this.dualClipboardDataProcessor.validateUserHash(e.fullAccessClipboardOperationResult.signatureData),Promise.resolve(me(e.fullAccessClipboardOperationResult.clipboardItemsData))}pasteSourceReconciliationBasedOnlyOnTextPlain(e){return 0===pe(e.systemClipboardOperationResult.clipboardItemsData)||0===pe(e.fullAccessClipboardOperationResult.clipboardItemsData)?Promise.resolve(me(e.systemClipboardOperationResult.clipboardItemsData)):Oa(e)?Promise.resolve(me(e.fullAccessClipboardOperationResult.clipboardItemsData)):Ra(e)?this.validateAndReturnFullAccessData(e):(e.systemClipboardOperationResult.clipboardItemsData.items[ie]=u,Promise.resolve(me(e.systemClipboardOperationResult.clipboardItemsData)))}constructor(e,t,r,a){this.clipboardStrategyType=e,this.clipboardCapabilities=t,this._fullAccessClipboardStrategyType=r,this.dualClipboardDataProcessor=a,this.initialized=!1,this.clipboardStrategyType=e,this.clipboardCapabilities=t,this.disposableImplementationExtension=it(`${e}`)}}function Ua(e,t){e.items[ie]=u,t&&(e.items["metadata/is-last-copy-was-external-XLO-source"]="1")}function Oa(e){const t=qt(Zt(e.systemClipboardOperationResult.clipboardItemsData.items[te])),r=e.fullAccessClipboardOperationResult.clipboardItemsData.items[te];return!!r&&t===qt(Zt(r))}function Ra(e){return qt(Zt(e.systemClipboardOperationResult.clipboardItemsData.items[te]))===Ya().getCopyToClipboardLatencyMessage()}class Ja extends Fa{constructor(e){super(m.SystemClipboardAndLocalStorage,{browserStorage:!0,systemClipboard:!0,inMemory:!1},m.LocalStorage,e)}}class Na extends Fa{constructor(e){super(m.SystemClipboardAndInMemory,{browserStorage:!1,systemClipboard:!0,inMemory:!0},m.InMemory,e)}}class ja extends $r{initialize(){return this.innerInitialize().then((()=>this))}get(e){this.disposableImplementationExtension.throwIfDisposed("get"),l().ULS.traceTag(595947538,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`ClipboardStorageIframeProxy.get: isKeyboardEvent = ${e.isKeyboardEvent}; silentClipboardAccessFailures = ${e.silentClipboardAccessFailures||!1}`);const t=et(Xe(),"get",this.messageDestination,e.userHash);return this.postMessage(t,"get").then((e=>e.clipboardItemsData?Promise.resolve(me(e.clipboardItemsData)):Promise.resolve(de())))}set(e,t){let r;return this.disposableImplementationExtension.throwIfDisposed("set"),l().ULS.traceTag(595947541,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`ClipboardStorageIframeProxy.set: isKeyboardEvent = ${t.isKeyboardEvent}; silentClipboardAccessFailures = ${t.silentClipboardAccessFailures||!1}`),r=ue(e)>0?et(Xe(),"set",this.messageDestination,t.userHash,e.getData()):et(Xe(),"set",this.messageDestination),this.postMessage(r,"set").then((()=>{}))}clearClipboardNecessary(e,t){return function(e,t){return null==e||1===e||null==t||e!==t}(e,t)}getSupportedDataFormats(){return this.disposableImplementationExtension.throwIfDisposed("getSupportedDataFormats"),[te,ae,"data/shadow-workbook"]}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||this.disposableImplementationExtension.dispose()}constructor(e,t){if(super(),this.messageDestination=t,!t)throw new I(d,"messageDestination");this.clipboardStorageType=e,this.disposableImplementationExtension=it(t)}}class za extends ja{constructor(e){super(be.LocalStorage,e)}}class Ha extends nt{constructor(e){super(m.AsyncSystemClipboard,{browserStorage:!1,systemClipboard:!0,inMemory:!1},e)}}class Va{get(e){var t=this;return _async_to_generator((function*(){t.disposableImplementationExtension.throwIfDisposed("get"),e.isAsyncClipboardAPI=!0;const r=window.performance.now();if(e.skipSystemClipboardAccess)return Promise.resolve(de());const a=t.cancelLastPendingPaste(e),o=lt();let i=null;if(e.isKeyboardEvent)t.isLastPasteEventListenerRemoved=!1,i=ee(document,Q,(a=>{a.preventDefault(),a.stopPropagation(),null==i||i(),t.lastRemovePasteEventListener=null,t.isLastPasteEventListenerRemoved=!0,l().ULS.traceTag(507012887,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`AsyncSystemClipboardStorage.get - Paste event triggered by keyboard. DeferredPromiseId: ${null==o?void 0:o.id}, Command id: ${e.id}`),t.readFromSystemClipboard(e,r).then((e=>{null==o||o.resolve(e)})).catch((e=>{null==o||o.reject(e)}))}),!0);else{const a={name:"clipboard-read",allowWithoutGesture:!1};try{var s;const r=yield null===(s=navigator.permissions)||void 0===s?void 0:s.query(a);if(l().ULS.traceTag(507626376,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`AsyncSystemClipboardStorage.get - Clipboard read permission state: ${null==r?void 0:r.state}. Command id: ${e.id}`),t.initialClipboardPermissionState=null==r?void 0:r.state,"denied"===(null==r?void 0:r.state))throw t.clipboardIsInaccessibleError;"prompt"===(null==r?void 0:r.state)&&(t.isActionPerformedOnPermissionPrompt=!1,r.onchange=()=>{t.isActionPerformedOnPermissionPrompt=!0,"denied"===(null==r?void 0:r.state)?l().ULS.traceTag(507626375,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`AsyncSystemClipboardStorage.get - Clipboard read permission is denied from prompt. Command id: ${e.id}`):"granted"===(null==r?void 0:r.state)&&l().ULS.traceTag(507626374,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`AsyncSystemClipboardStorage.get - Clipboard read permission is granted from prompt. Command id: ${e.id}`)})}catch(r){if(r===t.clipboardIsInaccessibleError)throw r;l().ULS.traceTag(508651269,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`AsyncSystemClipboardStorage.get: Failed to query "clipboard-read" permission. Command id: ${e.id}, Error: ${n.Wp.getStringifiedError(r)}`)}try{const a=yield t.readFromSystemClipboard(e,r);o.resolve(a)}catch(e){o.reject(e)}}return yield a,t.lastClipboardItemsDeferredPromise=o,t.lastRemovePasteEventListener=i,o.promise}))()}set(e,t){var r=this;return _async_to_generator((function*(){r.disposableImplementationExtension.throwIfDisposed("set"),t.isAsyncClipboardAPI=!0;const a=window.performance.now(),o=i(0,!1),s=r.getSupportedDataFormats();try{const i={name:"clipboard-write",allowWithoutGesture:!1};try{var c;const e=yield null===(c=navigator.permissions)||void 0===c?void 0:c.query(i);if(l().ULS.traceTag(507626372,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`AsyncSystemClipboardStorage.set - Clipboard write permission state: ${null==e?void 0:e.state}. Command id: ${t.id}`),r.initialClipboardPermissionState=null==e?void 0:e.state,"denied"===(null==e?void 0:e.state))throw r.clipboardIsInaccessibleError;"prompt"===(null==e?void 0:e.state)&&(r.isActionPerformedOnPermissionPrompt=!1,e.onchange=()=>{r.isActionPerformedOnPermissionPrompt=!0,"denied"===(null==e?void 0:e.state)?l().ULS.traceTag(507626371,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`AsyncSystemClipboardStorage.set - Clipboard write permission is denied from prompt. Command id: ${t.id}`):"granted"===(null==e?void 0:e.state)&&l().ULS.traceTag(507626370,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`AsyncSystemClipboardStorage.set - Clipboard write permission is granted from prompt. Command id: ${t.id}`)})}catch(e){if(e===r.clipboardIsInaccessibleError)throw e;l().ULS.traceTag(508651268,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`AsyncSystemClipboardStorage.set: Failed to query "clipboard-write" permission. Command id: ${t.id}, Error: ${n.Wp.getStringifiedError(e)}`)}const d=ye(e);if(!d||d.length<1)return;const p={};for(const e of d){if(!s.includes(e.clipboardDataFormat))continue;let t;t=(0,rr.isChangeGateEnabled)("OfficeVSO:9292465_AsyncClipboardWritePromiseEnabled")&&e.deferred?e.data:new Blob([e.data],{type:e.clipboardDataFormat});const a=s.includes(`${r.webCustomFormatPrefix}${e.clipboardDataFormat}`);a&&o?p[`${r.webCustomFormatPrefix}${e.clipboardDataFormat}`]=t:a||(p[e.clipboardDataFormat]=t)}const u=new ClipboardItem(p,{unsanitized:[ae]});yield navigator.clipboard.write([u]);const m=window.performance.now()-a;l().ULS.traceTag(508703872,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`AsyncSystemClipboardStorage.set: Write successful. Command id: ${t.id}, TimeInMs: ${m}`),t.isTimestampStoredInSystemClipboard=!0}catch(e){throw"prompt"!==r.initialClipboardPermissionState||r.isActionPerformedOnPermissionPrompt||l().ULS.traceTag(507626369,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`AsyncSystemClipboardStorage.set - Clipboard write permission prompt is closed without any action. Command id: ${t.id}`),l().ULS.traceTag(508843076,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`AsyncSystemClipboardStorage.set: Failed to write data formats to system clipboard. Command id: ${t.id}, Error: ${n.Wp.getStringifiedError(e)}`),new U(h.ClipboardIsInaccessible,`AsyncSystemClipboardStorage.set - Clipboard permission is denied or failed to write. Command id: ${t.id}`,e)}}))()}getSupportedDataFormats(){return this.disposableImplementationExtension.throwIfDisposed("getSupportedDataFormats"),[te,ae,oe,"data/shadow-workbook","web data/shadow-workbook",le,"web metadata/copy-context"]}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||(this.lastClipboardItemsDeferredPromise&&!this.lastClipboardItemsDeferredPromise.fulfilled()&&(this.lastClipboardItemsDeferredPromise.reject(),this.lastClipboardItemsDeferredPromise=null),this.lastRemovePasteEventListener&&(this.lastRemovePasteEventListener(),this.lastRemovePasteEventListener=null),this.disposableImplementationExtension.dispose())}readFromSystemClipboard(e,t){var r=this;return _async_to_generator((function*(){const a=me();try{const s=i(0,!1),c=r.getSupportedDataFormats(),d=yield navigator.clipboard.read({unsanitized:[ae]});if(!d||d.length<1)return a;for(const i of d)for(const d of i.types){if(!c.includes(d))continue;const p=yield i.getType(d);if(!p){l().ULS.traceTag(506840981,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`AsyncSystemClipboardStorage.readFromSystemClipboard: Failed to read blob for '${d}' type, Command id: ${e.id}, isKeyboardEvent: ${e.isKeyboardEvent}`);continue}let u;u=d===oe?yield(o=p,da(o)):yield p.text();const m=window.performance.now()-t;l().ULS.traceTag(508703873,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`AsyncSystemClipboardStorage.readFromSystemClipboard: Read successful. DataFormat: '${d}', TimeInMs: ${m}, Command id: ${e.id}, isKeyboardEvent: ${e.isKeyboardEvent}`);const g=d.startsWith(r.webCustomFormatPrefix);g&&s?a.setItem(d.replace(r.webCustomFormatPrefix,""),u):g||a.setItem(d,u)}}catch(t){if("prompt"!==r.initialClipboardPermissionState||r.isActionPerformedOnPermissionPrompt||e.isKeyboardEvent||l().ULS.traceTag(507626373,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`AsyncSystemClipboardStorage.readFromSystemClipboard - Clipboard read permission prompt is closed without any action. Command id: ${e.id}`),t.name===r.emptyClipboardReadErrorName&&t.message===r.emptyClipboardReadErrorMessage)return l().ULS.traceTag(508352130,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`AsyncSystemClipboardStorage.readFromSystemClipboard: System clipboard is empty. Command id: ${e.id}, Error: ${n.Wp.getStringifiedError(t)}`),a;throw l().ULS.traceTag(508843077,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`AsyncSystemClipboardStorage.readFromSystemClipboard: Failed to read data formats from system clipboard. Command id: ${e.id}, IsKeyboardEvent: ${e.isKeyboardEvent}, Error: ${n.Wp.getStringifiedError(t)}`),new U(h.ClipboardIsInaccessible,`AsyncSystemClipboardStorage.readFromSystemClipboard - Clipboard permission is denied or failed to read. Command id: ${e.id}`,t)}finally{e.clearSystemClipboard&&r.clearSystemClipboard()}var o;return a}))()}clearSystemClipboard(){return _async_to_generator((function*(){try{yield navigator.clipboard.writeText(""),l().ULS.traceTag(508703843,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"AsyncSystemClipboardStorage.clearSystemClipboard: Clipboard cleared")}catch(e){l().ULS.traceTag(508703842,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"AsyncSystemClipboardStorage.clearSystemClipboard: Failed to clear system clipboard.")}}))()}cancelLastPendingPaste(e){return new Promise(((t,r)=>{setTimeout((()=>{try{if(this.lastRemovePasteEventListener&&!this.isLastPasteEventListenerRemoved&&(l().ULS.traceTag(507007387,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`AsyncSystemClipboardStorage.cancelLastPendingPaste - Removed last paste event listener, Command id: ${e.id}`),this.lastRemovePasteEventListener(),this.lastRemovePasteEventListener=null),this.lastClipboardItemsDeferredPromise&&!this.lastClipboardItemsDeferredPromise.fulfilled()){const t=`AsyncSystemClipboardStorage.cancelLastPendingPaste - Rejected last ClipboardItemsDeferredPromise, Command id: ${e.id}, DeferredPromiseId: ${this.lastClipboardItemsDeferredPromise.id}`;l().ULS.traceTag(507007386,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,t),this.lastClipboardItemsDeferredPromise.reject(new U(h.RejectingPendingPastePromiseDueToNewPasteOperation,t)),this.lastClipboardItemsDeferredPromise=null}}catch(t){l().ULS.traceTag(507007385,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`AsyncSystemClipboardStorage.cancelLastPendingPaste - Failed to clear the last paste event handler and promise, Command id: ${e.id}`)}t()}),0)}))}constructor(){this.initialClipboardPermissionState=null,this.isActionPerformedOnPermissionPrompt=!1,this.lastClipboardItemsDeferredPromise=null,this.lastRemovePasteEventListener=null,this.isLastPasteEventListenerRemoved=!0,this.webCustomFormatPrefix="web ",this.emptyClipboardReadErrorName="DataError",this.emptyClipboardReadErrorMessage="No valid data on clipboard.",this.clipboardPermissionDeniedErrorMessage="AsyncSystemClipboardStorage - Clipboard permission is denied",this.clipboardIsInaccessibleError=new U(h.ClipboardIsInaccessible,this.clipboardPermissionDeniedErrorMessage),this.clipboardStorageType=be.AsyncSystemClipboard,this.disposableImplementationExtension=it("AsyncSystemClipboardStorage")}}class Ga extends Fa{constructor(e){super(m.AsyncSystemClipboardAndLocalStorage,{browserStorage:!0,systemClipboard:!0,inMemory:!1},m.LocalStorage,e)}}class Ba{initialize(e,t){var r=this;return _async_to_generator((function*(){r.initialized=!1;const[a,o]=yield Promise.all([e,t]);return r.systemClipboardStorage=a,r.asyncSystemClipboardStorage=o,r.initialized=!0,r}))()}get(e){var t=this;return _async_to_generator((function*(){t.disposableImplementationExtension.throwIfDisposed("get");const r=window.performance.now();if(!t.initialized||!t.asyncSystemClipboardStorage||!t.systemClipboardStorage)throw new U(h.ClipboardStrategyNotInitialized);try{return yield t.systemClipboardStorage.get(e)}catch(r){l().ULS.traceTag(508154642,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CombinedSystemClipboardStorage.get - systemClipboardStorage get failed. Command id: ${e.id}, Error: ${n.Wp.getStringifiedError(r)}`);try{return yield t.asyncSystemClipboardStorage.get(e)}catch(t){throw l().ULS.traceTag(507904976,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CombinedSystemClipboardStorage.get - asyncSystemClipboardStorage get failed. Command id: ${e.id}, Error: ${n.Wp.getStringifiedError(t)}`),new U(h.ClipboardIsInaccessible,"CombinedSystemClipboardStorage.get - Clipboard permission is denied or failed to read",t)}}finally{l().ULS.traceTag(508154640,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CombinedSystemClipboardStorage.get | System clipboard total read time: ${window.performance.now()-r} ms, Command id: ${e.id}`)}}))()}set(e,t){var r=this;return _async_to_generator((function*(){r.disposableImplementationExtension.throwIfDisposed("set");const a=window.performance.now();if(!r.initialized||!r.asyncSystemClipboardStorage||!r.systemClipboardStorage)throw new U(h.ClipboardStrategyNotInitialized);try{return void(yield r.systemClipboardStorage.set(e,t))}catch(a){l().ULS.traceTag(508154638,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CombinedSystemClipboardStorage.set - systemClipboardStorage set failed. Command id: ${t.id}, Error: ${n.Wp.getStringifiedError(a)}`);try{return void(yield r.asyncSystemClipboardStorage.set(e,t))}catch(e){throw l().ULS.traceTag(507904975,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CombinedSystemClipboardStorage.set - asyncSystemClipboardStorage set failed. Command id: ${t.id}, Error: ${n.Wp.getStringifiedError(e)}`),new U(h.ClipboardIsInaccessible,"CombinedSystemClipboardStorage.set - Clipboard permission is denied or failed to write",e)}}finally{l().ULS.traceTag(508154637,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`CombinedSystemClipboardStorage.set - System clipboard total write time: ${window.performance.now()-a} ms, Command id: ${t.id}`)}}))()}getSupportedDataFormats(){var e,t,r,a;return this.disposableImplementationExtension.throwIfDisposed("getSupportedDataFormats"),[...null!==(r=null===(e=this.systemClipboardStorage)||void 0===e?void 0:e.getSupportedDataFormats())&&void 0!==r?r:[],...null!==(a=null===(t=this.asyncSystemClipboardStorage)||void 0===t?void 0:t.getSupportedDataFormats())&&void 0!==a?a:[]].reduce(((e,t)=>(-1===e.indexOf(t)&&e.push(t),e)),[])}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||this.disposableImplementationExtension.dispose()}constructor(){this.initialized=!1,this.clipboardStorageType=be.AsyncSystemClipboard,this.disposableImplementationExtension=it("CombinedSystemClipboardStorage")}}class Ka extends Fa{constructor(e){super(m.AsyncSystemClipboardAndInMemory,{browserStorage:!1,systemClipboard:!0,inMemory:!0},m.InMemory,e)}}function qa(e){return new xa(e)}function Za(){return new Va}function Xa(e,t,r,a,o,s){const c=function(e,t,r){return new yr(e,t,r)}(r,a,o);return function(e,t,r,a){let o=_e.NoError;return n.Wp.chainFallbackPromises(e,(e=>function(e,t,r,a){l().ULS.traceTag(595716231,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`clipboardPlatformEnvironmentFactory.createClipboardEnvironmentComponentsByType: Attempting to create clipboard strategy type '${e.clipboardStrategyType}'`);const o=()=>(()=>{switch(e.clipboardStrategyType){case m.SystemClipboard:case m.SystemClipboardAndInMemory:case m.AsyncSystemClipboard:case m.AsyncSystemClipboardAndInMemory:return e;case m.SystemClipboardAndLocalStorage:case m.AsyncSystemClipboardAndLocalStorage:return e.systemClipboardStrategyParameters;default:throw new M(`createClipboardEnvironmentComponentsByType: getSystemClipboardParameters couldn't be used for ${e.clipboardStrategyType}`)}})().skipFilesIfPlainTextExists,s=()=>{switch(e.clipboardStrategyType){case m.LocalStorage:return e;case m.AsyncSystemClipboard:case m.AsyncSystemClipboardAndInMemory:case m.SystemClipboardAndLocalStorage:case m.AsyncSystemClipboardAndLocalStorage:return e.localStorageStrategyParameters;default:throw new M(`createClipboardEnvironmentComponentsByType: getLocalStorageParameters couldn't be used for ${e.clipboardStrategyType}`)}},c=e=>r.createClipboardDataProcessor(e),p=()=>r.createClipboardMetaDataProcessor(),u=e=>r.createDualClipboardDataProcessor(e),g=()=>{const e=s();return e.useSharedClipboardIframe?new Ur:function(e){return new Fr(e)}(Tt(e.sharedClipboardSchemaVersion)+Pt)},f=(e,r)=>(r?r.initialize(e):Promise.resolve(void 0)).then((()=>function(e,t,r){return l().ULS.shipAssertTag(595945246,n.nh.msoulscat_ES_EWAJS,!!e,"MetadataManager.createMetadataManager: expected clipboardStrategy to be defined."),l().ULS.shipAssertTag(595945247,n.nh.msoulscat_ES_EWAJS,!!e,"MetadataManager.createMetadataManager: expected metadataSerializationHelper to be defined."),ir=e,nr=function(e){return ar=e,or}(t),sr=r,sr&&sr.setOnMetadataChangedListener(ur),pr}(e,t,r))),S=e=>{let t;return t=i(0,!1)?Promise.resolve(Za()):Promise.resolve((new Ba).initialize(Promise.resolve(qa(o())),Promise.resolve(Za()))),function(e){return new Ha(e)}(e).initialize(t)},y=()=>(new Or).initialize(Promise.resolve(qa(o()))),C=e=>function(e){return new ka(e)}(e).initialize(Promise.resolve(new Wa)),b=e=>{const t={};e.wacCluster&&(t.wacCluster=e.wacCluster.trim()),e.sessionId&&(t.sessionId=e.sessionId),a&&(t.bulsEndpointUrl=a);const r=e.sharedClipboardOverrideOrigin?1:0;var o;o={sharedClipboardHostingApp:e.sharedClipboardHostingApp,sharedClipboardHostingApps:e.sharedClipboardHostingApps,sharedClipboardHostingEnvironments:e.sharedClipboardHostingEnvironments,sharedClipboardSchemaVersion:e.sharedClipboardSchemaVersion,sharedClipboardExpirationInMinutes:e.sharedClipboardExpirationInMinutes,clipboardPromiseTimeoutInMinutes:e.sharedClipboardExpirationInMinutes,whitelistOriginComponents:r},Me=!1,function(e){if(!e)throw new I(d,"sharedClipboardSettingsCandidate");const t=ke();if("number"!=typeof e.sharedClipboardSchemaVersion||isNaN(e.sharedClipboardSchemaVersion)||(t.sharedClipboardSchemaVersion=e.sharedClipboardSchemaVersion),"number"!=typeof e.sharedClipboardExpirationInMinutes||isNaN(e.sharedClipboardExpirationInMinutes)||(t.sharedClipboardExpirationInMinutes=e.sharedClipboardExpirationInMinutes),"number"!=typeof e.clipboardPromiseTimeoutInMinutes||isNaN(e.clipboardPromiseTimeoutInMinutes)||(t.clipboardPromiseTimeoutInMinutes=e.clipboardPromiseTimeoutInMinutes),"string"==typeof e.remoteLoggerPath&&e.remoteLoggerPath&&e.remoteLoggerPath.trim()&&(t.remoteLoggerPath=e.remoteLoggerPath),"number"!=typeof e.whitelistOriginComponents||1!==e.whitelistOriginComponents)return De=t,void(Me=!0);if("string"!=typeof e.sharedClipboardHostingApp||!e.sharedClipboardHostingApp||!e.sharedClipboardHostingApp.trim())return l().ULS.traceTag(596124181,n.nh.msoulscat_ES_EWAJS,n.kp.Error,"sharedClipboardSettings.initialize: sharedClipboardHostingApp should be a non empty string"),De=t,void(Me=!0);t.sharedClipboardHostingApp=e.sharedClipboardHostingApp.trim();let r=t.sharedClipboardHostingApp;const a=r.indexOf(Pe);a>=0&&(r=r.substr(a+1));try{t.sharedClipboardHostingApps=e.sharedClipboardHostingApps?JSON.parse(e.sharedClipboardHostingApps):void 0}catch(t){l().ULS.traceTag(579737680,n.nh.msoulscat_ES_EWAJS,n.kp.Error,"sharedClipboardSettings.initialize: sharedClipboardHostingApps JSON parsing failed. String : "+e.sharedClipboardHostingApps)}if(!t.sharedClipboardHostingApps||!Array.isArray(t.sharedClipboardHostingApps)||0===t.sharedClipboardHostingApps.length||t.sharedClipboardHostingApps.some((e=>!e||!e.trim())))return l().ULS.traceTag(596124182,n.nh.msoulscat_ES_EWAJS,n.kp.Error,"sharedClipboardSettings.initialize: sharedClipboardHostingApps should be a JSON string representing an array with at list one app"),t.sharedClipboardHostingApp=d,t.sharedClipboardHostingApps=[],De=t,void(Me=!0);try{t.sharedClipboardHostingEnvironments=e.sharedClipboardHostingEnvironments?JSON.parse(e.sharedClipboardHostingEnvironments):void 0}catch(t){l().ULS.traceTag(579737681,n.nh.msoulscat_ES_EWAJS,n.kp.Error,"sharedClipboardSettings.initialize: sharedClipboardHostingEnvironments JSON parsing failed. String : "+e.sharedClipboardHostingEnvironments)}if(!t.sharedClipboardHostingEnvironments||!Array.isArray(t.sharedClipboardHostingEnvironments)||0===t.sharedClipboardHostingEnvironments.length||t.sharedClipboardHostingEnvironments.some((e=>!e||!e.trim())))return l().ULS.traceTag(596124183,n.nh.msoulscat_ES_EWAJS,n.kp.Error,"sharedClipboardSettings.initialize: sharedClipboardHostingEnvironments should be a JSON string representing an array with at list one environment"),t.sharedClipboardHostingApp=d,t.sharedClipboardHostingApps=[],t.sharedClipboardHostingEnvironments=[],De=t,void(Me=!0);if(t.sharedClipboardHostingApps.indexOf(t.sharedClipboardHostingApp)<0){if(t.sharedClipboardHostingApp===r)return l().ULS.traceTag(596124184,n.nh.msoulscat_ES_EWAJS,n.kp.Error,`sharedClipboardSettings.initialize: when sharedClipboardHostingApp is defined, then its app name component '${t.sharedClipboardHostingApp}' should be listed in sharedClipboardHostingApps`),t.sharedClipboardHostingApp=d,t.sharedClipboardHostingApps=[],t.sharedClipboardHostingEnvironments=[],De=t,void(Me=!0);if(t.sharedClipboardHostingApps.indexOf(r)<0)return l().ULS.traceTag(596124185,n.nh.msoulscat_ES_EWAJS,n.kp.Error,`sharedClipboardSettings.initialize: when sharedClipboardHostingApp is defined, then its app name component '${t.sharedClipboardHostingApp}' or '${r}' should be listed in sharedClipboardHostingApps`),t.sharedClipboardHostingApp=d,t.sharedClipboardHostingApps=[],t.sharedClipboardHostingEnvironments=[],De=t,void(Me=!0)}t.whitelistOriginComponents=!0,De=t,Me=!0}(o),function(e){l().ULS.shipAssertTag(595944468,n.nh.msoulscat_ES_EWAJS,!!e,"ClipboardPlatformSettings.setClipboardPlatformSettings: expect clipboardPlatformSettings to be defined."),tr=e}(t)},E=(e,t)=>{const r=s();return r.useSharedClipboardIframe?(b(r),function(e){return new $a(e)}(t).initialize((a=e?tt.localStorageMetadata:tt.localStorageData,new za(a)).initialize())):function(e){return new kt(e)}(t).initialize(Promise.resolve((o=e?Tt(r.sharedClipboardSchemaVersion):(i=r.sharedClipboardSchemaVersion,It+i),new xt(o))));var a,o,i},w=(e,t,r)=>Promise.all([e,t]).then((([e,t])=>f(t,r).then((t=>({dataClipboardStrategy:e,metadataManager:t})))));try{switch(e.clipboardStrategyType){case m.AsyncSystemClipboard:return w(S(c(!1)),E(!0,p()),g());case m.SystemClipboard:return w(y(),C(p()));case m.InMemory:return w(C(c(!1)),C(p()));case m.LocalStorage:return w(E(!1,c(!0)),E(!0,p()),g());case m.AsyncSystemClipboardAndLocalStorage:return w((_=u(!0),new Ga(_)).initialize(S(),E(!1)),E(!0,p()),g());case m.AsyncSystemClipboardAndInMemory:return w((()=>{return(e=u(!1),new Ka(e)).initialize(S(),C());var e})(),E(!0,p()),g());case m.SystemClipboardAndLocalStorage:return w((()=>{return(e=u(!0),new Ja(e)).initialize(y(),E(!1));var e})(),E(!0,p()),g());case m.SystemClipboardAndInMemory:return w((()=>{return(e=u(!1),new Na(e)).initialize(y(),C());var e})(),C(p()))}return Promise.reject(new U(h.UnsupportedClipboardStrategyType,`Clipboard strategy type '${e.clipboardStrategyType}' is not supported`))}catch(t){return Promise.reject(new U(h.UnsupportedClipboardStrategyType,`failed to create clipboardStrategyType: '${e.clipboardStrategyType}' with error: ${n.Wp.getStringifiedError(t)}`))}var _}(e,t,r,a).then((t=>(l().ULS.traceTag(595716294,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`clipboardPlatformEnvironmentFactory.createClipboardEnvironmentComponentsByType: Clipboard strategy type '${e.clipboardStrategyType}' was created.`),t.infraInitializationError=o,t))).catch((t=>{let r=!1;r=E(t),r&&(o=_e.LocalStorageInaccessible);const a=`clipboardPlatformEnvironmentFactory.createClipboardEnvironmentComponentsByType: selectClipboardStrategy: failed to create clipboard strategy type '${e.clipboardStrategyType}'. Error: ${n.Wp.getStringifiedError(t)}`;return l().ULS.traceTag(595716230,n.nh.msoulscat_ES_EWAJS,r?n.kp.Info:n.kp.Error,a),Promise.reject(new U(h.SelectClipboardStrategy,a,t))}))))}(e,t,c,s).then((e=>({dataClipboardStrategy:e.dataClipboardStrategy,clipboardDataManager:c,metadataManager:e.metadataManager,infraInitializationError:e.infraInitializationError})))}function Ya(){return to}var Qa;!function(e){e[e.NotInitialized=0]="NotInitialized",e[e.StateReady=1]="StateReady",e[e.InitializationSucceed=2]="InitializationSucceed"}(Qa||(Qa={}));const eo={initializationStatus:Qa.NotInitialized,stateInitialized:!1,clipboardStrategy:void 0,chromeExtensionIds:[],clipboardPromiseTimeoutInMinutes:Le,copyToClipboardLatencyMessage:"Retrieving data. Wait a few seconds and try to cut or copy again.",metadataManager:void 0,clipboardDataManager:void 0,initializationError:_e.NoError},to={init:function(e,t,r,a,o,i,s,p,u,m,g,h,f,S,y,C,b,E){return eo.lastClipboardPlatformEnvironmentInitializationInfo?Promise.resolve(eo.lastClipboardPlatformEnvironmentInitializationInfo):(c(e),t&&Array.isArray(t)?(l().ULS.traceTag(596455702,n.nh.msoulscat_ES_EWAJS,n.kp.Info,`ClipboardPlatformEnvironment.init: chromeExtensionIds = '${JSON.stringify(t)}'`),eo.chromeExtensionIds=function(e){const t=[];if(!e)return t;for(const r of e)r&&"string"==typeof r&&r.trim().length>0&&t.push(r);return t}(t),m&&(eo.copyToClipboardLatencyMessage=m),"number"!=typeof u||isNaN(u)||(eo.clipboardPromiseTimeoutInMinutes=u),eo.initializationStatus=Qa.StateReady,Xa(f,h,S,y,C,E).then((e=>(eo.clipboardDataManager=e.clipboardDataManager,eo.metadataManager=e.metadataManager,eo.clipboardStrategy=e.dataClipboardStrategy,eo.initializationError=e.infraInitializationError,eo.initializationStatus=Qa.InitializationSucceed,eo.lastClipboardPlatformEnvironmentInitializationInfo={clipboardStrategiesToInitialize:f,dataClipboardCapabilities:eo.clipboardStrategy&&eo.clipboardStrategy.clipboardCapabilities,dataClipboardStrategyType:eo.clipboardStrategy&&eo.clipboardStrategy.clipboardStrategyType,infraInitializationError:eo.initializationError},eo.lastClipboardPlatformEnvironmentInitializationInfo)))):Promise.reject(new I(d,"chromeExtensionIds")))},getClipboardStrategy:function(){if(ro(),!eo.clipboardStrategy)throw new T("A clipboard strategy has not been selected. Call selectClipboardStrategy.");return eo.clipboardStrategy},getChromeExtensionIds:function(){return ao(),eo.chromeExtensionIds},getClipboardPromiseTimeoutInMinutes:function(){return ao(),eo.clipboardPromiseTimeoutInMinutes},getCopyToClipboardLatencyMessage:function(){return ao(),eo.copyToClipboardLatencyMessage},getMetadataManager:function(){return ro(),eo.metadataManager},getClipboardDataManager:function(){return ro(),eo.clipboardDataManager},getInitializationError:function(){return ro(),eo.initializationError}};function ro(){if(eo.initializationStatus!==Qa.InitializationSucceed)throw new T("ClipboardPlatformEnvironment is not initialized. Call init(...).")}function ao(){if(eo.initializationStatus<Qa.StateReady)throw new T("ClipboardPlatformEnvironment state is not ready. Call init(...).")}var oo,io,no,so,lo;!function(e){e.Text="Text",e.TextPlain="text/plain",e.TextJSON="text/json",e.TextHtml="text/html",e.Metadata="metadata",e.ImagePNG="image/png"}(oo||(oo={})),function(e){e[e.ExpectedError=0]="ExpectedError",e[e.ClipboardIsInaccessible=1]="ClipboardIsInaccessible",e[e.UnknownError=2]="UnknownError",e[e.UnsupportedClipboardFormat=3]="UnsupportedClipboardFormat",e[e.ClipboardIsEmpty=4]="ClipboardIsEmpty"}(io||(io={})),function(e){e[e.ExpectedError=0]="ExpectedError",e[e.ClipboardIsInaccessible=1]="ClipboardIsInaccessible",e[e.UnknownError=2]="UnknownError"}(no||(no={})),function(e){e[e.SameSession=0]="SameSession",e[e.CrossSession=1]="CrossSession",e[e.ExternalImage=2]="ExternalImage"}(so||(so={})),function(e){e[e.DefaultPasteFlow=0]="DefaultPasteFlow",e[e.TextPasteFlow=1]="TextPasteFlow"}(lo||(lo={}));const co=["ndjpnladcallmjemlbaebfadecfhkepb","ifbmcpbgkhlpfcodhjhdbllhiaomkdej"],po=["png","jpeg","tiff","gif","jpg"];var uo=r(5343);class mo{serializeSourceItem(e){return JSON.stringify(e)}serializeCommandParameters(e){return e?JSON.stringify(e):""}deserializeSourceItem(e){return JSON.parse(e)}deserializeCommandParameters(e){return JSON.parse(e)}}class go{getSourceItem(e){return this._visioController.getClipboardData()}beforeSerialize(e){}serialize(e){const t=e.sourceItem,r=me();let a={asynchronousResult:null,synchronousResult:null};if(t.svgData){const e=(new XMLSerializer).serializeToString(t.svgData.svgNode);r.setItem(oo.TextHtml,e),a={asynchronousResult:this.generateBase64Async(t.CCPID?t.CCPID:"",t.CCPLogID?t.CCPLogID:"",e,t.svgData.height,t.svgData.width),synchronousResult:r}}return a}generateBase64Async(e,t,r,a,o){return new Promise(((i,s)=>{try{const l=document.createElement("canvas");l.height=a,l.width=o;const c=l.getContext("2d");let d;d=this._visioController.isSafariBrowser()?new Blob([r],{type:"image/svg+xml"}):new Blob([r],{type:"image/svg+xml;charset=utf-8"});const p=URL.createObjectURL(d),u=document.createElement("img");u.onload=()=>{try{c.drawImage(u,0,0,l.width,l.height),URL.revokeObjectURL(u.src);const r=l.toDataURL("image/png"),a=me(),o=document.createElement("img");o.setAttribute("src",r),o.setAttribute("class","Visio"),o.setAttribute("Visio-sessionId",this._visioController.getUserSessionID()),o.setAttribute("data-clipservice-ccpid",e),o.setAttribute("data-clipservice-ccplogid",t),o.setAttribute("data-clipservice-dc",this._visioController.getWACDatacenter()),a.setItem(oo.TextHtml,o.outerHTML),this._visioController.getCCPLogger().traceTag(561860804,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"SVG to base64 converted successfully"),i(a)}catch(e){return this._visioController.getCCPLogger().traceTag(561860805,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`SVG to base64 conversion failed during image load with error:'${e}'`),s(e)}},u.src=p}catch(e){return this._visioController.getCCPLogger().traceTag(561860806,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,`SVG to base64 conversion failed with error:'${e}'`),s(e)}}))}constructor(e){this._visioController=e}}class ho{}class fo{}class So{}class yo{}class Co{beforePaste(e){}deserialize(e){try{const t=e.clipboardItems,r=new ho;let a;if(e.isClipboardInaccessible)throw new $(S.ClipboardIsInaccessible,"clipboard is not accessible");if(!t)throw new $(S.ReadFromClipboardReturnNullOrUndefined,"clipboardItems is null!");const o=t.getItem(oo.ImagePNG);if(o)a=o,r.isSameSession=!1,r.pasteSessionType=so.ExternalImage;else{const e=t.getItem(oo.TextHtml);if(!e)throw new $(S.ClipboardIsEmpty,"Html Data is not present in clipboard!");const o=(new DOMParser).parseFromString(e,"text/html");if(a=o.images.length>0?o.images[0].src:null,!a)throw new $(S.ClipboardIsEmpty,"No Image source is present in the Html data!");const i=o.images[0].getAttribute("Visio-sessionId");if(i)if(i===this._visioController.getUserSessionID())r.pasteSessionType=so.SameSession,r.isSameSession=!0;else{r.pasteSessionType=so.CrossSession;const t="\\s+ccp_infra_timestamp=['|\"](\\d+)['|\"]",a=this.getRegExStringValue(e,t);if(""!==a)try{const e=Number(a);r.timeStamp=isNaN(e)?0:e}catch(e){r.timeStamp=0}r.wacDataCenter=o.images[0].getAttribute("data-clipservice-dc"),r.CCPID=o.images[0].getAttribute("data-clipservice-ccpid"),r.CCPLogID=o.images[0].getAttribute("data-clipservice-ccplogid"),r.isSameSession=!1}else r.pasteSessionType=so.ExternalImage,r.isSameSession=!1}if(!this.isBase64Image(a))throw new $(S.ClipboardIsEmpty,"Image src is not Base64!");const i=new So;return this.getImageDimensions(a).then((e=>(i.imageDimension=e,i.imageExtension=this.getImageExtension(a),i.base64ImageData=a.substring(a.indexOf(",")+1),r.base64Image=i,this._visioController.setClipboardData(r),this._visioController.getCCPLogger().traceTag(561860803,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"image details retrieved successfully"),Promise.resolve())),(e=>{throw e})).catch((e=>Promise.reject(e)))}catch(e){return Promise.reject(e)}}shouldWaitForCopyToComplete(e){return!1}onDeferredPasteStarted(e){}onDeferredPasteCompleted(e){}isBase64Image(e){return/^data:image\/[a-z]+(;[a-z\-]+\=[a-z0-9\-]+)?;base64,\s*[a-z0-9+\/]+={0,2}$/i.test(e)}getImageExtension(e){const t=e.match(/[^:\/]\w+(?=;)/i);if(!t||1!==t.length||!this.isSupportedExtension(t[0]))throw new $(S.ClipboardIsEmpty,"Image extension not valid!");return t[0]}getImageDimensions(e){return new Promise((function(t,r){const a=new Image,o=new yo;a.onload=function(){o.width=a.width,o.height=a.height,t(o)},a.onerror=function(){r(new $(S.UnknownPasteError,"failed to load the base64 image!"))},a.src=e}))}isSupportedExtension(e){return po.indexOf(e)>=0}getRegExStringValue(e,t){const r=new RegExp(t,"g").exec(e);return r&&r.length&&r.length>1?r[1]:""}constructor(e){this._visioController=e}}function bo(e){return""===e}function Eo(e){return null==e}class wo{beforePaste(e){}deserialize(e){try{const t=e.clipboardItems,r=new ho;if(e.isClipboardInaccessible)throw new $(S.ClipboardIsInaccessible,"clipboard is not accessible");if(!t)throw new $(S.ReadFromClipboardReturnNullOrUndefined,"clipboardItems is null!");const a=t.getItem(oo.TextHtml),o=t.getItem(oo.TextPlain);if(!a&&!o)throw new $(S.ClipboardIsEmpty,"Html/Text Data is not present in clipboard!");return r.HtmlData=Eo(a)||bo(a)?void 0:a,r.PlainText=Eo(o)||bo(o)?void 0:o,this._visioController.setClipboardData(r),Promise.resolve()}catch(e){return Promise.reject(e)}}shouldWaitForCopyToComplete(e){return!1}onDeferredPasteStarted(e){}onDeferredPasteCompleted(e){}constructor(e){this._visioController=e}}class _o{getCopyFlowHandler(e){return new go(this._visioController)}getPasteFlowHandler(e){return function(e,t){let r=o("VisioWebEditTextContextMenuEnabled","false");return r=r.toLowerCase(),"true"===r}()&&this._visioController.getSupportedPasteFlow()===lo.TextPasteFlow?new wo(this._visioController):new Co(this._visioController)}initializePasteContext(e){}getSessionId(){return this._visioController.getUserSessionID()}constructor(e){this._visioController=e}}class vo{isChangeGateEnabled(e){return!0}getCopyToClipboardLatencyMessage(){return this._copyToClipboardLatencyMessage}setClipboardData(e){if(this._clipboardData)throw new U(h.SetClipboardItems,"setClipboardData() called before last operation was complete!");this._clipboardData=e}setSupportedPasteFlow(e){this._supportedPasteFlow=e}getClipboardData(){if(!this._clipboardData)throw new U(h.GetClipboardItems,"GetClipboardData() called with null value of visioController.clipboardData!");const e=this._clipboardData;return this.clearClipboardData(),e}getUserSessionID(){return this._userSessionID}getWACDatacenter(){return this._wacDataCenter}getCCPLogger(){return this._ccpLogger}clearClipboardData(){this._clipboardData=void 0}isSafariBrowser(){return this._isSafari}getSupportedPasteFlow(){return this._supportedPasteFlow}constructor(e,t,r,a){this._copyToClipboardLatencyMessage=t,this._userSessionID=e,this._ccpLogger=r,this._wacDataCenter=a,this._isSafari=function(){if(window&&window.navigator){const e=window.navigator.userAgent.toLowerCase();return e.indexOf("safari")>=0&&e.indexOf("chrome")<0&&e.indexOf("edge")<0}return!1}(),this._supportedPasteFlow=lo.DefaultPasteFlow}}class Io{getCopyPasteFlowManager(){return this._copyPasteFlowManager?Promise.resolve(this._copyPasteFlowManager):this.initCCPEnvironment()}getMetadataManager(){return this._metadataManager}getApplicationHost(){return this._applicationHost}internalCopy(e){return e.id=uo.A.generate(),this.getCopyPasteFlowManager().then((t=>t.onCopy(e)),(e=>Promise.reject(e)))}internalPaste(e){return e.id=uo.A.generate(),this.getCopyPasteFlowManager().then((t=>t.onPaste(e)),(e=>Promise.reject(e)))}initCCPEnvironment(){var e=this;return _async_to_generator((function*(){return e.configureClipBoardEnvironment().then((t=>(e._metadataManager=t.getMetadataManager(),e._metadataManager.addMetadataChangeListener(e._metadataChangeListenerId,e.onMetadataChanged),e._copyPasteFlowManager=function(e,t,r){return new er(e,t,r)}(t,e._applicationHost,e._ccpLogger),e._ccpLogger.traceTag(555872907,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"initCCPEnvironment() completed successfully"),Promise.resolve(e._copyPasteFlowManager))),(e=>Promise.reject(e)))}))()}configureClipBoardEnvironment(){this._clipboardPlatformEnvironment=Ya();const e=new mo,t={clipboardStrategyType:m.LocalStorage,useSharedClipboardIframe:!1,sharedClipboardSchemaVersion:1.1},r={clipboardStrategyType:m.SystemClipboard,skipFilesIfPlainTextExists:!1},a=[{clipboardStrategyType:m.SystemClipboardAndLocalStorage,localStorageStrategyParameters:t,systemClipboardStrategyParameters:r},{clipboardStrategyType:m.SystemClipboardAndInMemory}];return this._clipboardPlatformEnvironment.init(this._ccpLogger,co,"","","",!1,1,3600,2,this._visioController.getCopyToClipboardLatencyMessage(),"DC2",e,a,void 0,void 0,void 0,void 0,this._bulsEndpointUrl).then((()=>this._clipboardPlatformEnvironment),(e=>{throw new U(h.UnsupportedOperationCode,`Clipboard Init failed! with error:'${e.name}' message: '${e.message}'`)}))}copy(e,t,r,a,o){const i={id:this._visioController.getUserSessionID(),pKey:"",clipServiceDataType:"Unknown",objectCount:-1,clipServiceDataCenter:"Unknown",uploadToClipService:!1,userHash:this._userHash,commandType:t?we.Cut:we.Copy,isKeyboardEvent:e,silentClipboardAccessFailures:!1,ribbonCommandInfo:null,stopwatch:null};try{this._visioController.setClipboardData(r)}catch(e){return void o(no.UnknownError)}this.internalCopy(i).then((e=>{e instanceof At&&!0===e.succeededPopulatingSystemClipboardSync?(this._ccpLogger.traceTag(555872908,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"Internal copy was successful , ready to call copySuccessCallback "),a()):(this._ccpLogger.traceTag(555872909,n.nh.msoulscat_ES_EWAJS,n.kp.Warning,"failed to populate System Clipboard in Sync manner"),o(no.UnknownError))}),(e=>{o(this.getPackageCopyError(e))}))}paste(e,t,r){const a={id:this._visioController.getUserSessionID(),userHash:this._userHash,isKeyboardEvent:e,commandType:we.Paste,silentClipboardAccessFailures:!1,ribbonCommandInfo:null,stopwatch:null,skipClipboardAccess:!1,clearStateOnFinish:!1,clearSystemClipboard:!1,originalDestination:null,expandDestination:null};this.internalPaste(a).then((e=>{this._ccpLogger.traceTag(555872910,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"InnerPaste() completed successfully");const r=this._visioController.getClipboardData();t(r)}),(e=>{throw e})).catch((e=>{r(this.getPackagePasteError(e))}))}pasteWithSpecificHandler(e,t,r,a){const o={id:this._visioController.getUserSessionID(),userHash:this._userHash,isKeyboardEvent:t,commandType:we.Paste,silentClipboardAccessFailures:!1,ribbonCommandInfo:null,stopwatch:null,skipClipboardAccess:!1,clearStateOnFinish:!1,clearSystemClipboard:!1,originalDestination:null,expandDestination:null};this._visioController.setSupportedPasteFlow(e),this.internalPaste(o).then((e=>{this._ccpLogger.traceTag(512349838,n.nh.msoulscat_ES_EWAJS,n.kp.Info,"InnerPaste() completed successfully in pasteWithSpecificHandler");const t=this._visioController.getClipboardData();r(t)}),(e=>{throw e})).catch((e=>{a(this.getPackagePasteError(e))}))}initializeAppSettings(r){!function(r){e=r;try{t=JSON.parse(o("DisabledChangeGates","{}"))}catch(e){t={}}}(r)}getPackagePasteError(e){let t=io.UnknownError;switch(e.reason){case S.MissingArgumentError:case S.PasteFlowHandlerNotFound:case S.FetchPasteFlowHandlerFailed:case S.UnknownPasteError:t=io.UnknownError;break;case S.FailedToReadFromClipboard:case S.InspectClipboardFailed:case S.SuccessivePasteOverridingPendingPaste:case S.FileReaderResultIsEmpty:case S.FileReaderFailed:case S.DeferredPasteRejectedBecauseOtherCopyCompleted:case S.DeferredPasteRejectedBecauseOtherCopyStarted:case S.DeferredPasteRejectedBecauseMetadataUpdateWithoutCopyContext:t=io.ExpectedError;break;case S.DeserializeOperationFailed:e.innerError.reason===S.ClipboardIsInaccessible?t=io.ClipboardIsInaccessible:e.innerError.reason===S.ClipboardIsEmpty?t=io.UnsupportedClipboardFormat:e.innerError.reason===S.ReadFromClipboardReturnNullOrUndefined?t=io.ClipboardIsEmpty:(e.innerError.reason===S.UnknownPasteError||e.innerError.reason===h.SetClipboardItems)&&(t=io.UnknownError);break;case S.ClipboardIsEmpty:case S.ReadFromClipboardReturnNullOrUndefined:t=io.ClipboardIsEmpty;break;case S.ClipboardIsInaccessible:t=io.ClipboardIsInaccessible;break;case h.GetClipboardItems:case h.UnsupportedOperationCode:t=io.UnknownError}return t}getPackageCopyError(e){let t=no.UnknownError;switch(e.reason){case f.MissingArgumentError:case f.CopyFlowHandlerNotFound:case f.FetchCopyFlowHandlerFailed:case f.FetchSourceItemFailed:case f.BeforeSerializeFailed:case f.SerializeFailed:case f.SerializeResultNotValid:case f.UnknownCopyErrorType:t=no.UnknownError;break;case f.AsyncSerializeFailed:case f.InspectClipboardFailed:case f.SaveToTheClipboardFailed:case f.SuccessiveCutCopyOverridingPendingCutCopy:case f.BlockedSynchronousCutCopy:case f.CopyOperationCancelled:t=no.ExpectedError;break;case f.ClipboardIsInaccessible:t=no.ClipboardIsInaccessible;break;case h.UnsupportedOperationCode:t=no.UnknownError}return t}constructor(e,t,r,a,o,i="",n=""){this._metadataChangeListenerId="VisioMetadataChangeListenerId",this.onMetadataChanged=e=>{this._metadataChangeListener&&this._metadataChangeListener(e)},this._ccpLogger=t,this._visioController=new vo(e,r,t,i),this._applicationHost=new _o(this._visioController),this._metadataChangeListener=o,this._userHash=a,this._bulsEndpointUrl=n,this.initCCPEnvironment()}}function Po(){console.log("on copy Success!")}function To(e){console.log(e),alert("copy failed!!")}function Ao(e){console.log(e.base64Image)}function Lo(e){console.log(e),alert("Paste Failed!")}const Do=new class{shipAssertTag(e,t,r,a){}assertTag(e,t,r,a){}traceTag(e,t,r,a){}dnmTraceTag(e,t,r,a){}debugTraceTag(e,t,r,a){}},Mo=new Io("123456",Do,"Wait copy is in Progress!!",123456,(function(e){console.log(e)}));function xo(){const e=new ho;Mo.copy(!1,!1,e,Po,To)}function ko(){Mo.paste(!1,Ao,Lo)}}(),visioClipboard=a}();
//# sourceMappingURL=visioClipboard.min.js.map