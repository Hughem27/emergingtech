var Microsoft="object"==typeof Microsoft?Microsoft:{};Microsoft.Office=Microsoft.Office||{},Microsoft.Office.Visio=function(t){var i={};function e(s){if(i[s])return i[s].exports;var o=i[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,e),o.l=!0,o.exports}return e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var o in t)e.d(s,o,function(i){return t[i]}.bind(null,o));return s},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=17)}({17:function(t,i,e){"use strict";var s,o;e.r(i),e.d(i,"ApplicationEvents",(function(){return Qt})),e.d(i,"DocRebootSupportMode",(function(){return Se})),e.d(i,"CommandIds",(function(){return nt})),e.d(i,"EventIds",(function(){return Ii})),e.d(i,"createCancellationToken",(function(){return Ui})),e.d(i,"Application",(function(){return Ie})),e.d(i,"createApplication",(function(){return be})),function(t){t[t.h=0]="msoulscat_ES_EWAJS",t[t.u=1]="msoulscat_ES_EWAJSGrid",t[t.g=6]="msoulscat_ES_EWAJSChart",t[t.v=202]="msoulscat_MSOSP_FileMenuCommands",t[t._=220]="msoulscat_MSOSP_AddInCommands",t[t.A=225]="msoulscat_MSOSP_OTelJS",t[t.F=227]="msoulscat_MSOSP_OTelJSInWebWoker",t[t.P=228]="msoulscat_MSOSP_OTelJSWebWorkerPrototype",t[t.R=301]="msoulscat_Wac_WordViewer",t[t.k=306]="msoulscat_Wac_BrowserGeneral",t[t.U=320]="msoulscat_Wac_TaskPane",t[t.O=339]="msoulscat_Wac_OneNoteGeneral",t[t.B=340]="msoulscat_Wac_Ribbon",t[t.N=356]="msoulscat_Wac_WacFeedback",t[t.H=379]="msoulscat_Wac_WopiPendingApplication",t[t.$=383]="msoulscat_Wac_Telemetry",t[t.J=391]="msoulscat_Wac_WacCatchUpActivities",t[t.j=394]="msoulscat_Wac_Dictation",t[t.q=395]="msoulscat_Wac_OneNoteSync",t[t.K=700]="msoulscat_Wac_VisioApp",t[t.X=1601]="msoulscat_OneNoteOnline_EditableCache",t[t.Z=800]="msoulscat_Wac_PptAnimation",t[t.Y=833]="msoulscat_Wac_PptLive",t[t.tt=834]="msoulscat_Wac_PptMWeb",t[t.it=835]="msoulscat_Wac_PptGc2General",t[t.et=836]="msoulscat_Wac_PptGc2GraphicHost",t[t.st=837]="msoulscat_Wac_PptGc2Operation",t[t.ot=852]="msoulscat_Wac_PptGc2EditCanvas",t[t.nt=844]="msoulscat_Wac_PptDataSync",t[t.rt=848]="msoulscat_Wac_PptFluidRuntime",t[t.ht=815]="msoulscat_Wac_PptShape",t[t.ct=817]="msoulscat_Wac_PptSession",t[t.dt=830]="msoulscat_Wac_PptSlideshow",t[t.lt=822]="msoulscat_Wac_PptView",t[t.ut=846]="msoulscat_Wac_PptVideos",t[t.pt=1303]="msoulscat_Uci_Insights",t[t.wt=2300]="msoulscat_Wac_VersionHistory",t[t.ft=302]="msoulscat_Wac_WordPresence",t[t.gt=3e3]="msoulscat_Wac_OAuth",t[t.vt=3005]="msoulscat_Wac_WordVersionHistory",t[t.St=3006]="msoulscat_Wac_LivePersonaCard",t[t.It=3012]="msoulscat_Wac_CatchUpFlyout",t[t.bt=3016]="msoulscat_Wac_WordDesigner",t[t.Tt=3021]="msoulscat_Wac_ModernFontPicker",t[t._t=3027]="msoulscat_Wac_UnifiedUiHost",t[t.Ct=3033]="msoulscat_Wac_EquationTools",t[t.Et=1401]="msoulscat_Osf_Latency",t[t.At=1402]="msoulscat_Osf_Notification",t[t.Ft=1403]="msoulscat_Osf_Runtime",t[t.yt=3041]="msoulscat_Wac_AiMaker",t[t.Vt=3043]="msoulscat_Wac_AiRewrite",t[t.Pt=3044]="msoulscat_Wac_AiInsert",t[t.Rt=3047]="msoulscat_Wac_AiSummarize",t[t.xt=3048]="msoulscat_Wac_CopilotCompose",t[t.Wt=3049]="msoulscat_Wac_Skittles",t[t.kt=3050]="msoulscat_Wac_CopilotChat",t[t.Dt=3051]="msoulscat_Wac_Syntex",t[t.Ut=3052]="msoulscat_Wac_WireGraph",t[t.Ot=3053]="msoulscat_Wac_CshCopilot",t[t.Bt=3055]="msoulscat_Wac_CopilotProactiveSummary",t[t.Mt=3056]="msoulscat_Wac_CopilotProactiveShared",t[t.Nt=3057]="msoulscat_Wac_CopilotCursor",t[t.Ht=3059]="msoulscat_Wac_WasmGeneral",t[t.Lt=3060]="msoulscat_Wac_WasmTextLayout",t[t.$t=3061]="msoulscat_Wac_WasmSmartArt",t[t.Jt=3062]="msoulscat_Wac_WasmClient",t[t.Gt=3063]="msoulscat_Wac_WasmNative",t[t.jt=4e3]="msoulscat_AIHub_CreateModuleTelemetry"}(s||(s={})),function(t){t[t.Error=10]="Error",t[t.Warning=15]="Warning",t[t.Important=20]="Important",t[t.Info=50]="Info",t[t.Verbose=100]="Verbose",t[t.Spam=200]="Spam"}(o||(o={}));const n=["eurppc"];function r(t){return 8===t.toLowerCase().indexOf("ffc")}function a(t){return 8===t.toLowerCase().indexOf("ppc")}function h(t){const i=t.match(/^https:\/\/((?!word)\w+)(-\w+)+\..*$/i);return i&&i[1]?i[1]:"public"}function c(t){const i=t.match(/^(.*?\/\/[^\/]+)(.*)$/);if(!i)throw new Error("Invalid URL");return i[1]}function d(t,i){const e=t.match(/^(.*?\/\/)([^\/:]+)(.*)$/);if(!e)throw new Error("Invalid URL");const s=e[2];if(void 0===i)return s;if(i<0)throw new Error("subDomainParts should be at least 1");return s.split(".").slice(-(i+1)).join(".")}function l(t,i,e){e&&(t[i.toLowerCase()]=e)}function u(t,i){t[i.toLowerCase()]=""}function p(t,i){const e=t.toLowerCase(),s=i.toLowerCase();let o=e.indexOf("&"+s+"=");if(-1===o&&(o=e.indexOf("?"+s+"=")),-1===o)return"";const n=o+(i.length+2),r=t.indexOf("&",n);return t.substring(n,-1===r?void 0:r)}function m(t,i,e,s){if(!e)return t;let o=t;const n=o.indexOf("?");let r="&";n===o.length-1||"&"===o.slice(-1)||"&>"===o.slice(-2)?r="":-1===n&&(r="?");const a=i.toLowerCase()+"=",h=new RegExp("\\W"+a,"i").exec(o);if("?"!==r&&h){if(s){const t=h.index+1,i=o.indexOf("&",t);o=o.substring(0,t)+a+e+(-1===i?"":o.substring(i))}return o}return o.concat(r,a,e)}function w(t){const i={},e=t.indexOf("?");return-1===e||e===t.length-1||t.substring(e+1).replace(new RegExp(/<.*?>/g),"").split("&").forEach(t=>{if(t){const e=t.indexOf("=");-1!==e&&e!==t.length-1&&(i[t.substring(0,e).toLowerCase()]=t.substring(e+1))}}),i}function f(t,i){if(!t)return t;let e=t;const s=e.indexOf("?"),o=i.toLowerCase()+"=",n=e.toLowerCase().indexOf(o,s);if(n>=0){const t=e.indexOf("&",n);return e=e.substring(0,n)+(-1===t?"":e.substring(t+1)),"&"===e.slice(-1)&&(e=e.slice(0,-1)),e}return t}function g(t){const i=new RegExp("(c[1-5])h?(-)");return t.replace(i,"$1h$2")}function v(t,i,e){const s=new RegExp("[?&]"+i+"=("+(e||"1")+")\\b","i"),o=t.match(s);return!(!o||e&&o[1]!==e)}function S(t,i){const e=p(t,i);return e?decodeURI(e):e}function I(t){return t?t.indexOf("://")>-1?t.split("/")[2]:t.split("/")[0]:""}const b={BUILD_NUMBER:"###VERSION###",BUILD_NUMBER_MINOR:-1};function T(){try{return b.BUILD_NUMBER}catch(t){return b.BUILD_NUMBER}}function _(t){if(t){const i=t.lastIndexOf(".");if(-1!==i)return t.substring(i+1).toLowerCase()}return""}function C(t){if(!t)return"";const i=Object.getOwnPropertyNames(t),e=Object.getOwnPropertyNames(Object.getPrototypeOf(t));return JSON.stringify(t,[...i,...e])}function E(){const t=new Uint8Array(31),i=function(t){const i={crypto:!1,perfNow:!1,exceptions:[]},e=window.crypto||window.msCrypto;if(e){i.crypto=!0;try{return e.getRandomValues(t),i}catch(t){i.exceptions.push("crypto: "+C(t))}}i.perfNow=!0;for(let e=0;e<t.length;e+=1){try{let t=Math.floor(100*window.performance.now())%10;(t<0||t>9)&&(t=0);for(let i=0;i<t;i+=1)Math.random()}catch(t){i.exceptions.push("Math.random: "+C(t))}t[e]=Math.floor(16*Math.random())}return i}(t);let e=0;return["xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const s=15&t[e];return e+=1,("x"===i?s:3&s|8).toString(16)}),i]}function A(t,i,e){if(!i)return;const s=window.navigator;if(s&&s.sendBeacon)try{return void s.sendBeacon(i,t)}catch{}!function(t,i,e){const s=new XMLHttpRequest;s.readyState!==XMLHttpRequest.UNSENT&&s.readyState!==XMLHttpRequest.DONE||(s.open("POST",i,e),s.send(t))}(t,i,e)}var F,y;function V(t,i,e){!function(t,i,e,s=!0){const o={type:i.toString(),payloadJson:JSON.stringify(e)};A(JSON.stringify(o),t,s)}(t,F.JSAPI_STATE,{application:i,build:T(),state:e})}function P(){return window.performance.now()}function R(){return Math.round(window.performance.now()+window.performance.timeOrigin)}!function(t){t.JSAPI_STATE="JSAPI_STATE",t.H_V2="H_V2"}(F||(F={})),function(t){t[t.Trace=0]="Trace",t[t.Assert=1]="Assert"}(y||(y={}));class x{getTimeSpentLogging(){return this.qt}addLoggingTime(t){this.qt+=t}configure(t){const i=P();if(t.uploadCadenceInMs&&(this.zt=t.uploadCadenceInMs),t.uploadTriggerSize&&(this.Kt=t.uploadTriggerSize),t.sessionId&&(this.Xt=t.sessionId),t.remoteUlsEndpoint){if(!t.sessionId&&this.Zt)throw new Error("Remote ULS endpoint is already set");this.Zt=this.Yt(t.remoteUlsEndpoint),this.Qt=R(),this.ti()}this.qt+=P()-i}handleTrace(t){const i=P();t.message.length>3072&&(t.message=t.message.substring(0,3072-"... [Trimmed]".length)+"... [Trimmed]"),this.ii.push(t),(this.ii.length>this.Kt||t.level===o.Error)&&this.ti(),this.qt+=P()-i}getUserSessionId(){return this.Xt}constructor(t){this.zt=3e4,this.Kt=30,this.ei=0,this.ii=[],this.Qt=R(),this.si=[],this.Xt="",this.qt=0,this.flushOnClose=()=>{this.oi(!1,!1)},this.flush=()=>{this.ti()},this.flushAndSetNewEndpoint=(t,i)=>{var e;const s=this.Yt(t);s.localeCompare(null!==(e=this.Zt)&&void 0!==e?e:"",void 0,{sensitivity:"accent"})&&(this.si.push(()=>{this.Zt=s,i&&i()}),this.oi(!0,!0))},this.updateEndpointAndFlush=t=>{this.Zt=this.Yt(t),this.oi(!0,!0)},this.Yt=t=>t+"?usid="+this.Xt+"&officeserverversion="+T(),this.ti=()=>{window.setTimeout(()=>this.oi(!0,!0),0)},this.oi=(t,i)=>{const e=P();window.clearTimeout(this.ni),this.Zt&&(this.ii.length>0&&(this.ei+=1,A(function(t,i,e,s){const o=[],n=t.map(t=>function(t,i,e){const s={};if(s.G=t.tag,s.T=t.timestamp-i,s.M=t.message,s.C=t.category,t.correlationId){let i=e.findIndex(i=>i===t.correlationId);i<0&&(i=e.push(t.correlationId)-1),s.I=i}const o=1e3*t.type+t.level;return s.D=o,s}(t,s,o)),r=function(t,i,e,s,o){const n={};return n.T=t,n.L=i,n.S=e,n.I=s,o&&o.length>0&&(n.W=o),n.V=1,n}(s,n,i,e,o);return JSON.stringify(r)}(this.ii.splice(0,t?this.Kt:this.ii.length),this.Xt,this.ei,this.Qt),this.Zt,i),this.Qt=R()),0===this.ii.length&&this.si.length>0&&(this.si.forEach(t=>{"requestIdleCallback"in window?window.requestIdleCallback(t):window.setTimeout(t,0)}),this.si=[]),t&&(this.ni=window.setTimeout(()=>{this.ti()},this.ii.length>this.Kt||this.si.length>0?1e3:this.zt)),this.qt+=P()-e)},t&&this.configure(t)}}let W,k=[];var D,U;function O(t){const i=new x(t);function e(t,e,s,o){const n=P();if(function(t){return 1===k[t]}(t))return;const r={timestamp:R(),category:e,tag:t,level:s,type:y.Trace,message:o,correlationId:""};i.addLoggingTime(P()-n),i.handleTrace(r)}return{ULS:{ri:(t,i,s,o)=>{e(t,i,s,o)},shipAssertTag:(t,i,s,n)=>{s&&e(t,i,o.Error,n)},debugAssertTag:(t,i,e,s)=>{throw new Error("Debug Asserts not Implemented in the TypeScript bULS module")},flush:i.flush,flushOnClose:i.flushOnClose,setCorrelationId:()=>{}},configure:t=>{i.configure(t)},settingsChangeHandler:t=>{var e,s;e=t.ai.getValue(D.hi,""),s=t.ai.getValue(D.ci,""),W&&s===W||(k=[],W=s,e&&e.split(",").forEach(t=>{const i=parseInt(t,10);i&&(k[i]=1)})),i.configure({uploadCadenceInMs:t.ai.getValue(D.di,6e4)});const o=t.ai.getValue(D.li,"").toString();""!==o&&i.flushAndSetNewEndpoint(o)},getTimeSpentLogging:()=>i.getTimeSpentLogging(),getUserSessionId:()=>i.getUserSessionId(),flushAndSetNewEndpoint:(t,e)=>{i.flushAndSetNewEndpoint(t,e)},updateEndpointAndFlush:t=>{i.updateEndpointAndFlush(t)}}}!function(t){t.pi="BootstrapperMaxUlsHeartbeatTime",t.mi="BootstrapperNoCompleteWarning1Time",t.wi="BootstrapperNoCompleteWarning2Time",t.fi="BootstrapperNoCompleteWarning3Time",t.ci="RemoteUlsETag",t.hi="RemoteUlsSuppressions",t.gi="BootstrapperSettingsFetchPeriod",t.vi="timestamp",t.Si="BootstrapperUlsHeartbeatIntervalMs",t.Ii="BootstrapperUlsHeartBeatIsEnabled",t.di="BootstrapperUlsUploadCadenceMs",t.bi="WordConsumptionViewToEditRedirectIsEnabled",t.Ti="RequestedCallThrottlingDefaultToViewMinimumValue",t.li="BulsEndpointUrl",t._i="EnableCommonHostDiagnosticsParams",t.Ci="EnableICNForWord",t.Ei="EnableModernEmbedViewForPowerPoint",t.Ai="EnableModernEmbedViewInOneUpForPowerPoint",t.Fi="EnableModernEmbedViewForPowerPointGlobalAppUrl",t.yi="EnableModernReadingViewForPowerPoint",t.Vi="EnableDefaultToModernForPowerPoint",t.Pi="ShouldLogJsApiKpisForWord",t.Ri="WordSwitchToViewInTeamsJsapiV1Enabled",t.xi="EnableWordSessionRefreshTelemetry",t.Wi="PowerPointUseEssDCHint",t.ki="ModernEmbedViewBootstrapperFeatureGatesForPowerPoint",t.Di="ModernReadingViewBootstrapperFeatureGatesForPowerPoint",t.Ui="ModernEmbedViewForPowerPointEnabledPercentage",t.Oi="PowerPointESSCookieLookbackThresholdHour",t.Bi="PowerPointSetESSCookieLookbackExpEnabled",t.Mi="ExcelForceViewOnlyInTeamsJsapiV1",t.Ni="EnableWordSessionRefreshLoggingCleanup",t.Hi="WordRefreshTelemetryExpirationInDays"}(D||(D={})),function(t){t[t.Firefox=0]="Firefox",t[t.Opera=1]="Opera",t[t.IE=2]="IE",t[t.Edge=3]="Edge",t[t.Chrome=4]="Chrome",t[t.Safari=5]="Safari",t[t.TeamsElectron=6]="TeamsElectron",t[t.Unknown=7]="Unknown"}(U||(U={}));const B=window.navigator,M=B?B.userAgent:void 0;function N(){if(M){if(M.indexOf("Firefox")>-1)return U.Firefox;if(M.indexOf("Opera")>-1||M.indexOf("OPR")>-1)return U.Opera;if(M.indexOf("Trident")>-1)return U.IE;if(M.indexOf("Electron")>-1&&M.indexOf("Teams")>-1)return U.TeamsElectron;if(M.indexOf("Edg")>-1)return U.Edge;if(M.indexOf("Chrome")>-1)return U.Chrome;if(M.indexOf("Safari")>-1)return U.Safari}return U.Unknown}function H(){try{return!!M&&M.indexOf("iPad")>=0||!!M&&M.indexOf("Macintosh")>=0&&G()&&!(M&&M.indexOf("iPhone")>=0)||!!M&&M.indexOf("Android")>=0||G()}catch{return!1}}function L(){try{return window.matchMedia("screen and (-ms-high-contrast: active)").matches}catch{return!1}}function $(){return N()===U.IE&&!(N()===U.IE&&null!=document.documentMode&&void 0!==document.documentMode&&document.documentMode>=11)}function J(){try{return window.external&&window.external.getHostEnvironmentValue&&'{"os-sku":"189"}'===window.external.getHostEnvironmentValue("os-sku")}catch(t){return!1}}function G(){return!!B&&B.maxTouchPoints>0}function j(t,i){i&&Object.keys(i).forEach(e=>{t[e]=i[e]})}function q(t,i){try{if(void 0===window.performance)return void i.ULS.ri(595948609,s.H,o.Info,"Performance not supported");const e=window.performance.getEntriesByType("resource");if(void 0===e||e.length<=0)return void i.ULS.ri(595948610,s.H,o.Info,"No resources under performance");const n=new RegExp(t+"(-boot\\.min|(\\.(app|preview))?\\.boot)(\\.[0-9a-f]{20})?\\.js","i");for(let t=e.length-1;t>=0;t-=1){const r=e[t],a=r.name.match(n);if(a){let t=JSON.stringify(r);return t=t.replace(new RegExp(r.name,"g"),a[0]),void i.ULS.ri(595948616,s.H,o.Info,t)}}i.ULS.ri(595948484,s.H,o.Info,"Could not find JSAPI resource timing entry")}catch(t){i.ULS.ri(595948617,s.H,o.Info,"Could not trace the resource timing: "+C(t))}}function z(t){var i,e;const s={...t.host,sessionId:t.hostSessionId,domain:location?location.host:void 0};delete s.siteId,delete s.webId,delete s.uiHostTabId;const o={};if(t.wdParams){const i=JSON.parse(JSON.stringify(t.wdParams).toLowerCase());["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf"].forEach(t=>{i[t]&&(o[t]=i[t])});const e=/^\w{8}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{12}$/i;o.wdprevioussession&&!e.test(o.wdprevioussession)&&delete o.wdprevioussession,o.wdpreviouscorrelation&&!e.test(o.wdpreviouscorrelation)&&delete o.wdpreviouscorrelation}const n={...t.rebootOverride};delete n.ackExpected,delete n["ui-language"],delete n.wdUserSession,delete n.rebootMode,delete n.documentUrl;const r=t.wopi;return{accessToken:r?{length:r.accessToken.length,expiry:r.expiry}:"N/A",wacToken:r&&r.wacToken?{length:r.wacToken.length}:void 0,bootParams:t.bootParams,build:T(),host:s,intent:t.intent,jsApiVersion:"v2",rebootOverride:n,region:h(t.appBaseUrl),sessionOrigin:t.hostInitDiagnostics?t.hostInitDiagnostics.entryPoint:void 0,sessionContext:t.sessionContext,throttling:t.throttling,ui:t.ui,viewMode:t.viewMode,meeting:t.meeting?{id:null===(i=t.meeting)||void 0===i?void 0:i.id,isPresenter:null===(e=t.meeting)||void 0===e?void 0:e.isPresenter}:void 0,wdParams:o}}function K(){const t={perfNowSupported:!0,browser:U[N()],touchMode:H(),highContrast:L(),windows10x:J()};try{const i=window.navigator,e=i.connection||i.mozConnection||i.webkitConnection;e&&(t.netOnline=i.onLine,t.netDownlink=e.downlink,t.netDownlinkMax=e.downlinkMax,t.netEffectiveType=e.effectiveType,t.netRtt=e.rtt,t.netSaveData=e.saveData,t.netType=e.type),t.deviceMemory=i.deviceMemory,t.logicalProcessors=i.hardwareConcurrency}catch{}return t}var X,Z;function Y(t=!1,i){return{shouldPreconnect:t=>Q&&(!i||i(t)),preconnect:i=>function(t){const i=document.createElement("link");i.rel="preconnect",i.href=t,i.crossOrigin="anonymous",document.head.appendChild(i)}(t?g(i):i)}}!function(t){t[t.Unknown=0]="Unknown",t[t.Normal=1]="Normal",t[t.Minor=2]="Minor",t[t.Medium=3]="Medium",t[t.Major=4]="Major",t[t.Critical=5]="Critical"}(X||(X={})),function(t){t.Li="App_AccessibilityLoopComplete",t.$i="Wac_ActionComplete",t.Ji="WacInitialize_Ready",t.Gi="Wac_AppFailed",t.ji="Wac_AppBootState",t.qi="Wac_AppCompleted",t.zi="BrowserEvent",t.Ki="UI_Close",t.Xi="App_CloseTab",t.Zi="UI_Conversation",t.Yi="UI_CopyAndEdit",t.Qi="App_CreateNewDocument",t.te="Wac_AppDataSavedStatus",t.ie="UI_Download",t.ee="UI_Edit",t.se="Error",t.oe="UI_FileEmbed",t.ne="UI_FileProperties",t.re="File_Rename",t.ae="File_RenameFailed",t.he="UI_FileVersions",t.ce="StateChanged",t.de="App_IsFrameTrusted",t.le="GetAccessToken",t.ue="App_GetAuthToken",t.pe="App_GetCustomAuthConfig",t.me="App_GetHostKeyValue",t.we="App_WopiInfoFromUrl",t.fe="App_DavUrlFromIds",t.ge="App_LoadingStatus",t.ve="App_SwitchMode",t.Se="App_MoveToFolder",t.Ie="UI_OpenInMobileApp",t.be="UI_OpenInBrowser",t.Te="UI_OpenInClient",t._e="PageChanged",t.Ce="App_PushCommentContext",t.Ee="App_PushState",t.Ae="App_DocReboot",t.Fe="UI_RedeemForCommenting",t.ye="App_RefreshSessionInfo",t.Ve="UI_ReplyWithChanges",t.Pe="UI_ReportAbuse",t.Re="App_FilePicker",t.xe="UI_SaveStatus",t.We="WopiSession_Complete_Ack",t.ke="SetOverlayContent",t.De="UI_Sharing",t.Ue="UI_ShareForm",t.Oe="UI_SignIn",t.Be="App_StoreHostKeyValue",t.Me="App_Unloaded",t.Ne="App_UlsLog",t.He="Wac_UnloadingApp",t.Le="App_UpdateBootComplete",t.$e="PageCount",t.Je="UI_CheckUserAccessAndGrantPermissions",t.Ge="User_Activity",t.je="Edit_Notification",t.qe="UI_Workflow",t.ze="ZoomChanged",t.Ke="CAAEMessage",t.Xe="Excel_HostFrameCacheSave",t.Ze="Excel_HostFrameCacheEvict",t.Ye="Excel_RegenerateFileBundle",t.Qe="App_SwitchToWacFrame",t.ts="App_SaveSSRData",t.es="App_PurgeDataInHostCache",t.ss="App_SaveHostRenderingV2Data",t.os="App_SaveHostUtilsData",t.ns="AcquireOAuthTokenTeams",t.as="App_SwitchNotebook",t.hs="FailedBoot_CheckFileInfo",t.cs="GetTeamsUsers",t.ds="SendTeamsUserMention",t.ls="NavigateBackToHost",t.us="App_GetClientUrlComplete",t.ps="App_GetWebUrlComplete",t.ms="App_CopyLinkComplete",t.ws="App_SendConversationId",t.fs="CloseTeamsConversation",t.gs="PageLoaded",t.vs="Visio_BRS",t.Ss="Visio_SendLicenseInfo",t.Is="Visio_Consumption_CLTComplete",t.bs="Visio_SwitchMode_FromViewFrame",t.Ts="Visio_ModeSwitch_ToHost_Ack",t._s="Visio_UpdateEditUrl",t.Cs="Visio_PageViewLoaded",t.Es="Visio_ActiveAppFrameLoadFailed",t.As="Visio_DisposeBkgFrame",t.Fs="Visio_ReadyToReceiveDocData",t.ys="Visio_DocReboot_HostNav",t.Vs="Visio_SwitchToVisioFrame",t.Ps="WacAppPerfMetric",t.Rs="App_ModifyURLState",t.xs="App_WacTokenAck",t.Ws="App_InitEnd",t.ks="App_SplashScreenShown",t.Ds="App_SetWacFlightValue",t.Us="App_PrintRedirect",t.Os="App_RequestFullScreen"}(Z||(Z={}));const Q=!0,tt=["https://augloop.office.com/v2","api://visio.officeapps.live.com/va/00695ed2-3202-4156-8da1-69f60065e255","394866fc-eedb-4f01-8536-3ff84b16be2a","https://officescripting.microsoft.com","https://officescripting-int.microsoft.com","https://nleditor.osi.office.net/nleditor","e03a13ee-9730-4cae-8525-47559c8cf18a","https://powerquery.microsoft.com","api://app.powerbi.com/00000009-0000-0000-c000-000000000000"];class it{async isResourceTrustedForMessage(t){if(!t||!t.Resource)return!1;const i=t.Resource,e=t.AddinTrustId,n=function(t){if(!t)return!1;const i=t.toLowerCase();for(const t of tt)if(t===i||t+"/"===i)return!0;return!1}(i);if(n||!e)return n;if(this.Bs[e])return et(i,this.Bs[e]);let r;const a=new Promise(t=>{r=(s,o)=>{e===s&&t(et(i,o))},this.Ms.push(r)});let h=-1;const c=new Promise(t=>{h=window.setTimeout(()=>{this.Ns.ULS.ri(560754786,s.H,o.Warning,"isResourceTrustedForMessage - timeout waiting for addinTrustId: "+e),t(!1)},2e3)}),d=await Promise.race([a,c]);return this.Ms=this.Ms.filter(t=>t!==r),window.clearTimeout(h),d}dispose(){this.Bs={},this.Ms=[],window.removeEventListener("message",this.Hs)}constructor(t){this.Bs={},this.Ms=[],this.Hs=t=>{if(t&&t.origin)try{const i=t.data;if("string"==typeof i&&i.includes("AddinTrustedOrigin")){const e=JSON.parse(i),n=e.AddinTrustId;n&&"AddinTrustedOrigin"===e.MessageId&&(this.Ns.ULS.ri(560754784,s.H,o.Info,"didReceiveMessage addinTrustId "+n),this.Bs[n]=t.origin,this.Ms.forEach(i=>{i(n,t.origin)}))}}catch(t){this.Ns.ULS.ri(560754785,s.H,o.Error,"AuthTokenTrustValidator didReceiveMessage failed")}},this.Ns=t,window.addEventListener("message",this.Hs)}}function et(t,i){try{if(!t||!i)return!1;const e=33,s=126,o=/[?&#%\\]/;for(let i=0;i<t.length;i+=1){const n=t.charCodeAt(i);if(n<e||n>s)return!1;const r=t.charAt(i);if(o.test(r))return!1}const n="api:",r="https:";let a=t;a.substring(0,n.length).toLowerCase()===n&&(a=`${r}${a.substring(n.length)}`);const h=new URL(a);return h.protocol===r&&i.toLowerCase()===h.origin.toLowerCase()}catch{return!1}}var st,ot,nt,rt,at;!function(t){t.AppInitError="AppInitError",t.ApiDisabledError="ApiDisabledError",t.CannotLoadFirstPage="CannotLoadFirstPage",t.InvalidWopiInfo="InvalidWopiInfo",t.TimeoutWacReady="TimeoutWacReady",t.WacFailed="WacFailed"}(st||(st={}));class ht{add(t){t&&this.Ls.push(t)}remove(t){if(!t)return;const i=this.Ls.indexOf(t);i>-1&&this.Ls.splice(i,1)}removeAll(){this.Ls=[]}dispatch(t,i){this.Ls.forEach(e=>{try{e(t)}catch(t){i&&i(t)}})}constructor(){this.Ls=[]}}class ct{updateEnvironment(t){this.$s=(r(t)?"FF":"Prod")+this.Js+"Settings",this.Gs()}initializePeriodicFetch(t,i){this.$s=(r(t)?"FF":"Prod")+this.Js+"Settings",this.Gs(),this.js=t+"AppSettingsHandler.ashx?app="+this.Js+"&usid="+i+"&build="+T(),this.qs||(this.qs=window.setTimeout(this.zs,3e4))}getValue(t,i){if(this.Ks||this.Gs(),!this.Ks||!this.Ks.hasOwnProperty(t))return i;const e=this.Ks[t],s=typeof i;if(typeof e===s)return e;if("string"==typeof e){if("number"===s)return parseInt(e,10);if("boolean"===s)return"true"===e}return i}addSettingsChangeListener(t){this.Xs.add(t)}removeSettingsChangeListener(t){this.Xs.remove(t)}dispose(){this.qs&&window.clearTimeout(this.qs),this.Zs&&self.cancelIdleCallback(this.Zs),this.qs=void 0,this.Zs=void 0,this.Ks=void 0,this.Xs.removeAll()}constructor(t,i){this.Ys=0,this.Gs=()=>{try{if(!window||!window.localStorage)return;const t=window.localStorage.getItem(this.$s);if(!t)return;const i=JSON.parse(t);this.Qs(i)}catch(t){this.Ns.ULS.ri(592836768,s.H,o.Warning,"Failed to get settings from localStorage: "+C(t))}},this.Qs=t=>!!this.to(t)&&(this.Ks=t,this.Xs.dispatch({ai:this},t=>{this.Ns.ULS.ri(592836769,s.H,o.Error,"Settings listener error: "+C(t))}),!0),this.to=t=>{if(t&&"object"==typeof t){if(t.hasOwnProperty(D.vi)&&!isNaN(t.timestamp))return!0;this.Ns.ULS.ri(592836770,s.H,o.Error,"Received invalid settings")}return!1},this.zs=()=>{if(!this.js)return;const t=new XMLHttpRequest;window.location.href.indexOf("wdnetcorerouting=true")>-1?t.setRequestHeader("X-NetCoreRouting","true"):window.location.href.indexOf("wdnetcorerouting=false")>-1&&t.setRequestHeader("X-NetCoreRouting","false"),t.open("GET",this.js),t.responseType="json",t.timeout=5e3,t.send(),t.onload=()=>{if(200===t.status&&t.response?(this.io(t.response),this.Ys=0):(this.Ns.ULS.ri(592836771,s.H,o.Error,`Fetch settings error. Status: ${t.status}, curErrors: ${this.Ys}`),this.Ys+=1),this.Ys>7)return;let i=this.getValue(D.gi,3e5);this.Ys>3&&(i+=(this.Ys-3+1)*(i/2)),this.qs=window.setTimeout(this.zs,i)}},this.io=t=>{"requestIdleCallback"in window?(this.Zs&&self.cancelIdleCallback(this.Zs),this.Zs=window.requestIdleCallback(()=>this.eo(t),{timeout:1e4})):window.setTimeout(()=>this.eo(t),0)},this.eo=t=>{if(!this.Qs(t)||!window||!window.localStorage)return;const i=JSON.stringify(t);try{window.localStorage.setItem(this.$s,i)}catch(t){this.Ns.ULS.ri(592836800,s.H,o.Warning,"Failed to set localStorage: "+C(t))}},this.Js=t,this.$s="Prod"+t+"Settings",this.Ns=i,this.Xs=new ht,this.Gs()}}function dt(t,i){return{isFeatureEnabled:e=>function(t,i,e){if(i)try{return i(t)}catch(t){e&&e.ULS.ri(594883024,s.H,o.Error,"IsFeatureEnabled callback error: "+C(t))}}(e,t,i)}}function lt(t,i){const e={};if(Object.keys(ot).forEach(i=>{const s=t.isFeatureEnabled(ot[i]);void 0!==s&&(e[ot[i]]=s?"1":"0")}),i&&i.wdFlights){const t=i.wdFlights.toLowerCase();for(const i of t.split(","))"et-treatment"!==i&&"et-control"!==i||(e[ot.so]="et-treatment"===i?"1":"0")}return JSON.stringify(e)}!function(t){t.so="EnterpriseTemplates",t.oo="ExcelAdaptiveLayoutDownload",t.no="ExcelLandingPageOfflineTelemetry",t.ro="ExcelLandingPageObserverRetry",t.ao="H2StaticContent",t.ho="HashedUrl",t.co="ODCShareLinkPreload",t.do="OfficeComExcelJsApiV2",t.lo="OfficeComPptJsApiV2",t.uo="OfficeComUiHost",t.po="OfficeComWordJsApiV2",t.mo="OfficeHwaUiHost",t.wo="OfficeUnifiedUiHostTeams",t.fo="WordViewToUnifiedRead",t.vo="DocAspxMsal"}(ot||(ot={}));class ut{dispose(){window.removeEventListener("beforeunload",this.So,{capture:!0}),window.removeEventListener("pagehide",this.Io,{capture:!0}),window.removeEventListener("visibilitychange",this.bo,{capture:!0}),window.removeEventListener("unload",this.To,{capture:!0})}constructor(t,i){this.So=()=>pt(t,"OnBeforeUnload",i),this.Io=()=>pt(t,"OnPageHide",i),this.bo=()=>pt(t,"VisibilityChange_"+document.visibilityState,i),this.To=()=>pt(t,"OnUnload",i),window.addEventListener("beforeunload",this.So,{capture:!0,once:!0}),window.addEventListener("pagehide",this.Io,{capture:!0}),window.addEventListener("visibilitychange",this.bo,{capture:!0}),window.addEventListener("unload",this.To,{capture:!0,once:!0})}}function pt(t,i,e){t.ULS.ri(595957843,s.H,o.Info,`Page lifecycle: ${i} fired`+(e?", flushing logger":"")),e&&t.ULS.flush()}class mt{}mt.logger=O();class wt extends class{constructor(t){this._o={},this.resetCache=()=>{if(!this.Co)return!1;try{return localStorage.removeItem(this.dataSettingsCacheKey),!0}catch(t){return mt.logger.ULS.ri(557114832,s.H,o.Error,`${this.dataSettingsCacheKey}: Failure trying to Delete data in localStorage: ${C(t)}`),!1}},this.setCache=t=>{if(t&&this.Co)try{localStorage.setItem(this.dataSettingsCacheKey,JSON.stringify(t))}catch(t){mt.logger.ULS.ri(557114833,s.H,o.Error,`${this.dataSettingsCacheKey}: Error while saving settings in cache: ${C(t)}`)}},this.getIntegerSetting=t=>{const i=this.Eo(t);if(null!=i&&"number"==typeof i){const t=i;if(!isNaN(t))return t}return null},this.getBooleanSetting=t=>{const i=this.Eo(t);return null!=i&&"boolean"==typeof i?i:null},this.getStringSetting=t=>{const i=this.Eo(t);return null!=i&&"string"==typeof i?i:null},this.Eo=t=>{if(!this.Co)return null;try{if(t in this._o)return this._o[t];const i=localStorage.getItem(this.dataSettingsCacheKey);if(null!==i){const e=JSON.parse(i)[t];return this._o[t]=e,e}}catch(i){mt.logger.ULS.ri(557114834,s.H,o.Error,`${this.dataSettingsCacheKey}: Failure trying to find ${t} setting in localStorage: ${C(i)}`)}return null},this.dataSettingsCacheKey=t,this.Co=!1;try{localStorage&&(this.Co=!0)}catch(t){mt.logger.ULS.ri(538018719,s.H,o.Warning,"Local storage not supported: "+C(t))}}}{static get Instance(){return wt.Ao||(wt.Ao=new wt)}constructor(){super(wt.Fo)}}function ft(t,i){return t+"RemoteTelemetry.ashx"+(i?"?usid="+i:"")}function gt(t,i){return ft(vt(t),i)}function vt(t){const i=t.match(/^(.*?\/\/[^\/]+\/[^\/]+\/)(.*)$/);if(!i)throw new Error("Invalid URL");return i[1]}function St(t){if(!t)return"";const i=""+document.cookie,e=new RegExp("(?:^|; )"+t+"=([^;]*)"),s=i.match(e);return!s||s.length<2?"":s[1]}function It(t,i,e,s=at.none,o){const n=t+"="+i;let r="";const a=new Date;a.setTime(a.getTime()+31536e6);let h=new Date;h.setTime(h.getTime()+864e5*e),h>a&&(h=a),h&&(r=";expires="+h.toUTCString());const c=n+r+";SameSite="+at[s];return document.cookie=o?c+"; Secure":c,!(!document.cookie||-1===document.cookie.indexOf(n))||s===at.none&&It(t,i,e,at.doNotSet,o)}wt.Fo="OneNote_hostUtilsSettingsCache",function(t){t.blurFocus="blurFocus",t.boot="boot",t.completeCreateNew="completeCreateNew",t.continueAccessibilityLoop="continueAccessibilityLoop",t.createNew="createNew",t.dispose="dispose",t.grabFocus="grabFocus",t.moveToFolder="moveToFolder",t.popState="popState",t.sendChannelId="sendChannelId",t.sendConvId="sendConvId",t.teamsUsersReply="teamsUsersReply",t.teamsUserMentionReply="teamsUserMentionReply",t.backButtonPressed="backButtonPressed",t.getClientUrl="getClientUrl",t.getWebUrl="getWebUrl",t.rename="rename",t.completeSharedFilePicker="completeSharedFilePicker",t.sendAccessToken="sendAccessToken",t.sendAuthToken="sendAuthToken",t.sendCustomAuthConfig="sendCustomAuthConfig",t.sendEmbeddedViewUrl="sendEmbeddedViewUrl",t.sendFrameTrustResult="sendFrameTrustResult",t.sendHWRTelemetry="sendHWRTelemetry",t.sendSessionInfo="sendSessionInfo",t.sendUserAccessAndPermissions="sendUserAccessAndPermissions",t.sendWopiInfo="sendWopiInfo",t.sendDavUrl="sendDavUrl",t.switchMode="switchMode",t.signalShared="signalShared",t.postWacToken="postWacToken"}(nt||(nt={})),function(t){t.yo="Ack",t.Vo="WacInitialize_Ready_Ack",t.Po="Wac_BeforeUnloadApp",t.Ro="Blur_Focus",t.xo="Wac_AppFailed_Ack",t.Wo="Wac_AppCompleted_Ack",t.ko="WopiStartSession_Complete",t.Do="WopiPendingSession_Complete",t.Uo="Host_AccessibilityLoopComplete",t.de="Host_IsFrameTrusted",t.Oo="Grab_Focus",t.Bo="HostCacheDiagnostic",t.Mo="Host_KeyValue",t.No="JsApiDiagnostics",t.Se="Host_MoveToFolder",t.Ho="PageChanged_Ack",t.Lo="App_PopState",t.$o="Host_SendChannelId",t.Jo="Host_SendConversationId",t.Go="GetTeamsUsers_Reply",t.jo="SendTeamsUserMention_Reply",t.qo="Host_BackButtonPressed",t.zo="Host_GetClientUrl",t.Ko="Host_GetWebUrl",t.Xo="File_Rename",t.Re="Host_FilePicker",t.Zo="PostAccessToken",t.Yo="Host_SetAuthToken",t.Qo="Host_SetCustomAuthConfig",t.tn="App_PushCommentContext",t.in="CanEmbed",t.en="Host_RefreshSessionInfo",t.sn="CheckUserAccessAndGrantPermissions_Result",t.on="Host_WopiInfoFromUrl",t.nn="Host_DavUrlFromIds",t.rn="SetCurrentPage",t.an="SetZoomLevel",t.hn="WopiPendingSession_Fail",t.cn="SetOverlayContent",t.dn="WopiPendingApplicationComplete_Received",t.ln="Host_SwitchMode",t.un="Host_Unload",t.pn="PageCount_Ack",t.mn="ZoomChanged_Ack",t.wn="Host_ShareUI",t.fn="Host_Telemetry",t.gn="Visio_ConsumptionCLTComplete_Ack",t.vn="Visio_SwitchMode_FromHF_Ack",t.Sn="Visio_SwitchMode_FromHostFrame",t.In="Visio_FallbackToLegacySwitch",t.bn="Visio_DocumentData",t.Tn="Host_PostWacToken"}(rt||(rt={})),function(t){t[t.doNotSet=0]="doNotSet",t[t.none=1]="none",t[t.lax=2]="lax",t[t.strict=3]="strict"}(at||(at={}));const bt={[nt.blurFocus]:rt.Ro,[nt.continueAccessibilityLoop]:rt.Uo,[nt.grabFocus]:rt.Oo,[nt.moveToFolder]:rt.Se,[nt.popState]:rt.Lo,[nt.rename]:rt.Xo,[nt.sendAccessToken]:rt.Zo,[nt.sendAuthToken]:rt.Yo,[nt.sendCustomAuthConfig]:rt.Qo,[nt.sendEmbeddedViewUrl]:rt.in,[nt.sendSessionInfo]:rt.en,[nt.sendUserAccessAndPermissions]:rt.sn,[nt.sendWopiInfo]:rt.on,[nt.sendDavUrl]:rt.nn,[nt.completeSharedFilePicker]:rt.Re,[nt.switchMode]:rt.ln,[nt.signalShared]:rt.wn};class Tt{registerMessagePayloadHandler(t,i){if(this._n[t])throw new Error("Duplicate registration!");this._n[t]=i}removeMessageHandler(t){delete this._n[t]}sendPostMessage(t,i,e){if(!t||!t.contentWindow)return void this.Ns.ULS.ri(595948308,s.H,o.Info,"Missing target for SendPostMessage");this.Ns.ULS.ri(596464334,s.H,o.Info,"Sending message: "+i);const n={MessageId:i,SendTime:R(),Values:e};this.Cn(t.contentWindow,JSON.stringify(n),this.En)}activate(t,i){this.An=t,this.Fn=!!i,this.yn||(window.addEventListener("message",this.Vn,!1),this.yn=!0)}postMessageForCommand(t,i,e){const n=bt[i];n?(this.Ns.ULS.ri(595702598,s.H,o.Info,`Sending message ${n} for command ${i}`),this.sendPostMessage(t,n,e)):this.Ns.ULS.ri(595702599,s.H,o.Warning,"No mapping for command "+i)}dispose(){this._n={},this.yn&&(window.removeEventListener("message",this.Vn,!1),this.yn=!1)}constructor(t,i){var e;if(this.yn=!1,this._n={},this.En="",this.Pn="",this.Fn=!1,this.Rn=!1,this.xn=!1,this.Wn=!1,this.kn=[],this.Dn=!0,this.Un=(t,i,e)=>{if(!t)return void this.Ns.ULS.ri(595736136,s.H,o.Info,"Missing target to send Ack back");const n={MessageId:rt.yo,CorrelationId:e,SendTime:R()};this.Ns.ULS.ri(595732176,s.H,o.Info,"Sending Ack back"),t.postMessage(JSON.stringify(n),i)},this.Vn=t=>{let i,e=!1,n=!0,r="",a=!1;if(this.An&&this.An.contentWindow&&(e=!0,n=t.source===this.An.contentWindow),t.origin&&(r=d(t.origin,2).toLowerCase(),a=r===this.Pn,!a&&this.On&&(r=d(t.origin).toLowerCase(),a=this.On.includes(r))),!this.Rn&&(!this.xn||a&&n)||this.Ns.ULS.ri(595730526,s.H,o.Info,`Window is available: ${e}, window is valid: ${n}, origin is valid: ${a}, expected origin: ${this.Pn}, actual origin: ${r}`),!a||this.Fn&&!n)return;try{i=JSON.parse(t.data)}catch(t){return void this.Ns.ULS.ri(596464282,s.H,o.Info,`Failed to parse event data: ${C(t)}.`)}const h=i.MessageId;if(!h)return void((this.Rn||this.xn)&&this.Ns.ULS.ri(595730520,s.H,o.Info,"Could not find message id"));var c;if(this.Ns.ULS.ri(595714715,s.H,o.Info,`Received messageId: ${h}, correlation: ${i.CorrelationId}`),h!==Z.qi&&h!==Z.ge||this.Bn(t.origin),this.Wn&&h===Z.Ps)return window._pageTimings=null!==(c=window._pageTimings)&&void 0!==c?c:{},void(window._pageTimings[i.Values.name]=i.Values.time);i.Values&&i.Values.ackExpected&&this.Un(t.source,t.origin,i.CorrelationId);const l=this._n[h];if(!l)return this.Ns.ULS.ri(596464289,s.H,o.Info,"No handler found for message id: "+h),void(this.Dn&&h===Z.ue&&(this.kn.push(i),this.Ns.ULS.ri(543207888,s.H,o.Info,"Kept for later process: "+h)));this.Ns.ULS.ri(596464288,s.H,o.Info,"Processing message: "+h),h===Z.De&&(i.Values={...i.Values||{},sendTimeAsClickTime:i.SendTime});try{l(i.Values||{})}catch(t){this.Ns.ULS.ri(593773704,s.H,o.Error,"Handler error: "+C(t))}this.Dn&&h===Z.qi&&this.Mn()},this.Mn=()=>{this.Dn=!1,this.kn.forEach(t=>{const i=t.MessageId,e=this._n[i];if(e){this.Ns.ULS.ri(543207890,s.H,o.Info,"Processing message after boot complete: "+i);try{e(t.Values||{})}catch(t){this.Ns.ULS.ri(543207891,s.H,o.Error,"Handler error: "+C(t))}}else this.Ns.ULS.ri(543207889,s.H,o.Info,"No handler found after boot complete: "+i)}),this.kn=[]},this.Cn=(t,i,e)=>{t.postMessage(i,e)},this.Bn=t=>{const i=t.toLowerCase();this.En&&this.En!==i&&this.Ns.ULS.ri(596128131,s.H,o.Warning,`Updating origin: [${I(this.En)}]->[${I(i)}]`),this.En=i,this.Pn=d(i,2),this.Rn=r(i),this.xn=a(i)},!t)throw new Error("Missing origin for PostMessageHandler");this.Rn=r(t),this.xn=a(t),this.Ns=i,this.Bn(t),this.Wn=!(null===(e=window.location)||void 0===e||null===(e=e.search)||void 0===e||!e.match(/wdpa=1/gi))||"1"===St("EnableMetricLogging")}}function _t(t,i,e,n,r,a){const h=R();n.ULS.ri(507774684,s.H,o.Important,"postWacToken flow initiated");const c=()=>{a&&a.flush&&a.flush()};r?r.then(r=>{const d=()=>e.sendPostMessage(r,rt.Tn,{wacToken:t,postWacTokenStart:i});d();const l=window.setInterval(d,100);e.registerMessagePayloadHandler(Z.xs,t=>{n.ULS.ri(507597019,s.H,o.Info,`postWacToken flow completed in ${R()-h} ms`),window.clearInterval(l),window.clearTimeout(u),a&&(a.PostWacTokenResult="success",a.PostWacTokenEndTime=R(),t&&void 0!==t.TokenAlreadySet&&(a.TokenAlreadySet=t.TokenAlreadySet),c())});const u=window.setTimeout(()=>{n.ULS.ri(507597018,s.H,o.Warning,"postWacToken flow timed out after 60000 ms"),window.clearInterval(l),a&&(a.PostWacTokenResult="timeout",a.PostWacTokenEndTime=R(),c())},6e4)}).catch(t=>{n.ULS.ri(507873094,s.H,o.Warning,"This should never reject, error: "+C(t)),a&&(a.PostWacTokenResult="Unexpected JSAPI V1 error",a.PostWacTokenEndTime=R(),c())}):(n.ULS.ri(507846862,s.H,o.Warning,"`Promise` does not exist natively for this browser."),a&&(a.PostWacTokenResult="JSAPI V1 error: Promise not supported in browser",a.PostWacTokenEndTime=R(),c()))}class Ct{static sendXmlHttpRequest(t,i,e,n,r,a,h,c=!1){if(!t)throw new TypeError("method");if(!i)throw new TypeError("requestUrl");const d=R();if("GET"!==t)throw Error("Not Implemented");{const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(4===l.readyState)if(200===l.status){const t=R()-d;h.ULS.ri(595985034,s.K,o.Info,`Success: ${a}, time spent in getting XHR response: ${t}(ms)`),n&&n(l.responseText)}else h.ULS.ri(595985035,s.K,o.Error,`Failed request: ${a} with status code: ${l.status.toString()}`),r&&r();c&&2===l.readyState&&l.abort()},l.open(t,i,e),l.send()}}}class Et{}Et.HeaderHeight=50,Et.ToolbarHeightConsumption=40,Et.ToolbarLowerHeightEdit=46,Et.ToolbarUpperHeightEdit=26,Et.StatusbarHeight=50,Et.StatusbarBorderTop=1,Et.ProgressImageHeight=4,Et.FishbowlBorderTop=1,Et.FishbowlMarginInches=.4,Et.RibbonHeightConsumption=Et.HeaderHeight+Et.ToolbarHeightConsumption,Et.RibbonHeightEdit=Et.HeaderHeight+Et.ToolbarLowerHeightEdit+Et.ToolbarUpperHeightEdit,Et.RibbonHeightNoChrome=Et.ToolbarLowerHeightEdit+Et.ToolbarUpperHeightEdit,Et.ShapePanelBorderWidth=1,Et.ShapePanelWidthWithoutBorder=312,Et.ShapePanelWidthWithBorder=Et.ShapePanelWidthWithoutBorder+2*Et.ShapePanelBorderWidth;class At{}var Ft,yt,Vt,Pt,Rt;At.FastViewImage="fpd.png",At.FastViewJson="fv.json",At.docInfoNormal="di2.json",At.docInfoHighDpi="di4.json",function(t){t[t.INVALID=0]="INVALID",t[t.VIEW=1]="VIEW",t[t.EMBED_VIEW=2]="EMBED_VIEW",t[t.INTERACTIVE_PREVIEW=3]="INTERACTIVE_PREVIEW",t[t.EDIT=4]="EDIT",t[t.EDIT_NEW=5]="EDIT_NEW"}(Ft||(Ft={})),function(t){t.BOOTSTART="BOOTSTART",t.BACKGROUND_MODESWITCH_BOOTSTART="BACKGROUND_MODESWITCH_BOOTSTART",t.BOOTSUCCESS="BOOTSUCCESS",t.BOOTFAILED="BOOTFAILED",t.BOOTEXCEPTION="BOOTEXCEPTION",t.BOOTTIMEOUT="BOOTTIMEOUT"}(yt||(yt={})),function(t){t.JSAPIV2="JSAPIV2"}(Vt||(Vt={})),function(t){t[t.Fastfood=0]="Fastfood",t[t.MSITandFastfood=1]="MSITandFastfood",t[t.AllRings=2]="AllRings",t[t.None=3]="None"}(Pt||(Pt={}));class xt{static initialize(t,i){xt.Nn=t,xt.Ns=i,void 0===xt.Nn&&xt.Ns&&xt.Ns.ULS.ri(592975122,s.K,o.Warning,"Environment is undefined")}static getIntegerBRSValue(t,i){let e=xt.Hn[t];return e&&!isNaN(parseInt(e,10))?parseInt(e,10):window.localStorage?(e=localStorage.getItem(t),e&&!isNaN(parseInt(e,10))?(xt.Hn[t]=e,parseInt(e,10)):i):i}static getBRSValue(t,i=!1){try{const e=xt.Hn[t];if(e)return"true"===e.toLowerCase();if(!window.localStorage)return!1;let n=localStorage.getItem(t);if(n)return xt.Hn[t]=n,i&&localStorage.removeItem(t),"true"===n.toLowerCase();if(n="false",xt.Ln.has(t))switch(xt.Ln.get(t)){case Pt.Fastfood:this.Nn===di.Fastfood&&(n="true");break;case Pt.MSITandFastfood:this.Nn!==di.Fastfood&&this.Nn!==di.MSIT||(n="true");break;case Pt.AllRings:n="true";break;default:n="false",xt.Ns&&xt.Ns.ULS.ri(592975123,s.K,o.Warning,t+" set to false due EnabledEnvironment=None")}return xt.Hn[t]=n,"true"===n.toLowerCase()}catch(t){return!1}}static dispose(){xt.Hn={}}}function Wt(t){const i=t.toLocaleLowerCase();return i.indexOf("visioview=consumptionview&embed=1")>=0?Ft.EMBED_VIEW:i.indexOf("visioview=consumptionview&interactivepreview=1")>=0?Ft.INTERACTIVE_PREVIEW:i.indexOf("visioview=consumptionview")>=0?Ft.VIEW:i.indexOf("visioview=editview&new=1")>=0?Ft.EDIT_NEW:i.indexOf("visioview=editview")>=0?Ft.EDIT:Ft.INVALID}function kt(t){return v(t,"backgroundsession","1")}function Dt(t){return t.toLocaleLowerCase().indexOf("embed=1")>=0}function Ut(t){return t.toLocaleLowerCase().indexOf("interactivepreview=1")>=0}function Ot(t){return(xt.IsInfiniteCanvasPLTFixEnabled||xt.getBRSValue(xt.IsInfiniteCanvasEnabled))&&(t===Ft.EDIT||t===Ft.EDIT_NEW)}function Bt(t){t&&history.replaceState({},"",t)}function Mt(t,i){return!!(t.sessionInformation&&t.sessionInformation.WdParams&&t.sessionInformation.WdParams[i])}function Nt(t,i){return t.sessionInformation&&t.sessionInformation.WdParams&&t.sessionInformation.WdParams[i]?t.sessionInformation.WdParams[i]:null}function Ht(t,i,e){const s=document.createElement("canvas");if(!s.getContext||!s.getContext("2d"))return"";s.width=i,s.height=e;const o=s.getContext("2d");return null==o?"":(o.drawImage(t,0,0),s.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/,""))}function Lt(){return performance.timing?performance.timing.navigationStart:0}function $t(){return performance.navigation?performance.navigation.redirectCount:0}function Jt(){let t=window.location.href;t=f(t,"wdreloadsessionid"),t=f(t,"wdreloadcount"),xt.getBRSValue(xt.WOPITokenRefreshIsEnabledForViewer)&&t&&(t=f(t,"wdToastUser")),xt.getBRSValue(xt.DTEEnabledBRSKey)&&t&&(t=f(t,"wdToastForUnsupported"),t=f(t,"wdPreviousSessionDct")),xt.getBRSValue(xt.VisioWebVsdEditEnabled)&&(t=f(t,"wdvsdedit")),Bt(t)}xt.fromWacVisioFrameBRS="Visio_BRS",xt.instantCreateNewLocalStorageKey="BRS_IsInstantCreateNewEnabled",xt.backgroundEditSessionEnabledKey="BRS_IsUnifiedBackgroundEditAppEnabled",xt.hostCacheForEmbedViewEnabledBRSKey="BRS_HostCacheForEmbedViewEnabled",xt.InstantForAllTemplatesEnabledBRSKey="BRS_InstantForAllTemplatesEnabled",xt.AppShellPrebootEnabledBRSKey="BRS_AppShellPrebootEnabled",xt.FastViewForMRUFixEnabledBRSKey="BRS_FastViewForMRUFixEnabled",xt.ReloadOnScriptFailMaxLimitBRSKey="BRS_ReloadOnScriptFailMaxLimit",xt.CoCommentingAcrossViewAndEditEnabled="BRS_CoCommentingAcrossViewAndEditEnabled",xt.WOPITokenRefreshIsEnabledForViewer="BRS_WOPITokenRefreshIsEnabledForViewer",xt.IsToastUserFixEnabledBRSKey="BRS_IsToastUserFixEnabled",xt.IsContextAppRefreshFixEnabledBRSKey="BRS_IsContextAppRefreshFixEnabled",xt.IsAtMentionsEnabled="BRS_IsAtMentionsEnabled",xt.IsFormulaeSerializationRollbackEnabled="BRS_IsFormulaeSerializationRollbackEnabled",xt.IsFastViewCacheInTeamsDisabled="BRS_IsFastViewCacheInTeamsDisabled",xt.IsSaveAndCloseRequestInvokedInTeamsEnabled="BRS_IsSaveAndCloseRequestInvokedInTeamsEnabled",xt.IsTeamsBackgroundFrameFixEnabled="BRS_IsTeamsBackgroundFrameFixEnabled",xt.TypeScriptLocalStorageEnabled="BRS_TypeScriptLocalStorageEnabled",xt.JsapiV1DiagnosticFixEnabled="BRS_JsapiV1DiagnosticFixEnabled",xt.DTEEnabledBRSKey="BRS_DTEEnabled",xt.DTEEnabledForPlan0BRSKey="BRS_DTEEnabledForPlan0",xt.DTESharingFixEnabledBRSKey="BRS_DTESharingFixEnabled",xt.DTESafariFixEnabledBRSKey="BRS_DTESafariFixEnabled",xt.DisableDTEForUnsupportedFileTypesEnabledBRSKey="BRS_DisableDTEForUnsupportedFileTypesEnabled",xt.IsLongPoleInfraEnabled="BRS_IsLongPoleInfraEnabled",xt.Fluent2StyleIsEnabled="BRS_Fluent2StyleIsEnabled",xt.VisioWebVsdEditEnabled="BRS_VisioWebVsdEditEnabled",xt.IsInfiniteCanvasEnabled="BRS_IsInfiniteCanvasEnabled",xt.IsInfiniteCanvasPLTFixEnabled="BRS_IsInfiniteCanvasPLTFixEnabled",xt.Nn=void 0,xt.Ns=void 0,xt.Hn={},xt.Ln=new Map([[xt.instantCreateNewLocalStorageKey,Pt.AllRings],[xt.backgroundEditSessionEnabledKey,Pt.AllRings],[xt.InstantForAllTemplatesEnabledBRSKey,Pt.Fastfood],[xt.IsToastUserFixEnabledBRSKey,Pt.AllRings],[xt.IsContextAppRefreshFixEnabledBRSKey,Pt.Fastfood],[xt.IsAtMentionsEnabled,Pt.AllRings],[xt.JsapiV1DiagnosticFixEnabled,Pt.AllRings],[xt.Fluent2StyleIsEnabled,Pt.Fastfood]]),xt.handleVisioBRS=(t,i)=>{if(window.localStorage&&t){const e=!!t.IsInstantCreateNewEnabled;localStorage.setItem(xt.instantCreateNewLocalStorageKey,e.toString());const n=!!t.IsUnifiedBackgroundEditAppEnabled;localStorage.setItem(xt.backgroundEditSessionEnabledKey,n.toString());const r=!!t.IsToastUserFixEnabled;localStorage.setItem(xt.IsToastUserFixEnabledBRSKey,r.toString());const a=!!t.IsContextAppRefreshFixEnabled;localStorage.setItem(xt.IsContextAppRefreshFixEnabledBRSKey,a.toString());const h=!!t.HostCacheForEmbedViewEnabled;localStorage.setItem(xt.hostCacheForEmbedViewEnabledBRSKey,h.toString());const c=!!t.InstantForAllTemplatesEnabled;localStorage.setItem(xt.InstantForAllTemplatesEnabledBRSKey,c.toString());const d=!!t.AppShellPrebootEnabled;localStorage.setItem(xt.AppShellPrebootEnabledBRSKey,d.toString());const l=t.VisioReloadOnScriptFailMaxLimit?t.VisioReloadOnScriptFailMaxLimit:0;localStorage.setItem(xt.ReloadOnScriptFailMaxLimitBRSKey,l.toString());const u=!!t.CoCommentingAcrossViewAndEditEnabled;localStorage.setItem(xt.CoCommentingAcrossViewAndEditEnabled,u.toString());const p=!!t.DTEEnabled;localStorage.setItem(xt.DTEEnabledBRSKey,p.toString());const m=!!t.DTEEnabledForPlan0;localStorage.setItem(xt.DTEEnabledForPlan0BRSKey,m.toString());const w=!!t.DTESafariFixEnabled;localStorage.setItem(xt.DTESafariFixEnabledBRSKey,w.toString());const f=!!t.DisableDTEForUnsupportedFileTypesEnabled;localStorage.setItem(xt.DisableDTEForUnsupportedFileTypesEnabledBRSKey,f.toString());const g=!!t.DTESharingFixEnabled;localStorage.setItem(xt.DTESharingFixEnabledBRSKey,g.toString());const v=!!t.WOPITokenRefreshIsEnabledForViewer;localStorage.setItem(xt.WOPITokenRefreshIsEnabledForViewer,v.toString());const S=!!t.IsAtMentionsEnabled;localStorage.setItem(xt.IsAtMentionsEnabled,S.toString());const I=!!t.IsFastViewCacheInTeamsDisabled;localStorage.setItem(xt.IsFastViewCacheInTeamsDisabled,I.toString());const b=!!t.IsSaveAndCloseRequestInvokedInTeamsEnabled;localStorage.setItem(xt.IsSaveAndCloseRequestInvokedInTeamsEnabled,b.toString());const T=!!t.IsTeamsBackgroundFrameFixEnabled;localStorage.setItem(xt.IsTeamsBackgroundFrameFixEnabled,T.toString());const _=!!t.IsFormulaeSerializationRollbackEnabled;localStorage.setItem(xt.IsFormulaeSerializationRollbackEnabled,_.toString());const C=!!t.TypeScriptLocalStorageEnabled;localStorage.setItem(xt.TypeScriptLocalStorageEnabled,C.toString());const E=!!t.JsapiV1DiagnosticFixEnabled;localStorage.setItem(xt.JsapiV1DiagnosticFixEnabled,E.toString());const A=!!t.IsLongPoleInfraEnabled;localStorage.setItem(xt.IsLongPoleInfraEnabled,A.toString());const F=!!t.Fluent2StyleIsEnabled;localStorage.setItem(xt.Fluent2StyleIsEnabled,F.toString());const y=!!t.VisioWebVsdEditEnabled;localStorage.setItem(xt.VisioWebVsdEditEnabled,y.toString());const V=!!t.IsInfiniteCanvasEnabled;localStorage.setItem(xt.IsInfiniteCanvasEnabled,V.toString());const P=!!t.IsInfiniteCanvasPLTFixEnabled;localStorage.setItem(xt.IsInfiniteCanvasPLTFixEnabled,P.toString()),i.ULS.ri(595691654,s.K,o.Info,"Received BRS settings from visio frame and storing it in local storage. BRS values:"+t)}else i.ULS.ri(595691671,s.K,o.Info,"Received BRS settings from visio frame but local storage is not supported or values are null.")};class Gt{static Create(t,i,e,s){if(Gt.$n(t,i,e)){const o=t+"_"+i,n=Gt.getHashCode(i),r=Gt.getHashCode(e);Gt.Ao=new Gt(n,r,o,s)}return Gt.Ao}static dispose(){Gt.Ao=null}SaveDocument(t,i){try{if(!i||i.length<=0||!t||t.length<=0)return this.Ns.ULS.ri(595903506,s.K,o.Warning,"Unexpected data provided to save document in cache. Removing the item."),void localStorage.removeItem(this.Jn);const e=R(),n={ImageData:i,DocView:t,DocVersion:this.Gn},r=JSON.stringify(n);this.encrypt(r,this.jn,this.qn,this.zn,this.Kn).then(t=>{try{t.DocVersion=this.Gn,t.LastAccessTime=R(),localStorage.setItem(this.Jn,JSON.stringify(t));const i=R();this.Ns.ULS.ri(595903646,s.K,o.Info,"[VO_Perf] Save Document Cache Time Taken: "+(i-e))}catch(t){this.Ns.ULS.ri(595910981,s.K,o.Warning,"Failure trying to save data in localStorage: "+C(t))}},t=>{this.Ns.ULS.ri(595907478,s.K,o.Warning,"Failure to encrypt: "+C(t))})}catch(t){this.Ns.ULS.ri(595907479,s.K,o.Warning,"Failure to SaveDocument: "+C(t))}}DeleteDocument(){try{localStorage.removeItem(this.Jn)}catch(t){this.Ns.ULS.ri(595904288,s.K,o.Warning,"Failure to DeleteDocument: "+C(t))}}IsCacheAvailable(){return null!=this.Xn}static EvictStaleCache(t,i,e){try{if(!window.localStorage)return void e.ULS.ri(595903507,s.K,o.Info,"localStorage is not supported by Browser. Skipping Eviction.");const n=R(),r=[];for(let t=0;t<localStorage.length;t+=1){const i=localStorage.key(t);if(i.substring(0,this.Zn.length)===this.Zn){const t=localStorage.getItem(i);if(t){const e=JSON.parse(t);if(e){const s=e.LastAccessTime;s?r.push({key:i,lastAccessTime:s,data:t}):localStorage.removeItem(i)}else localStorage.removeItem(i)}else localStorage.removeItem(i)}}r.sort((t,i)=>i.lastAccessTime-t.lastAccessTime);const a=[];let h=0,c=0;for(let e=0;e<r.length;e+=1)h+=2*r[e].data.length,h>t&&R()-r[e].lastAccessTime>i?(localStorage.removeItem(r[e].key),c+=1,h-=2*r[e].data.length):a.push(r[e]);a.sort((t,i)=>t.lastAccessTime-i.lastAccessTime),h=0;let d=0;for(let i=0;i<a.length;i+=1)h+=2*a[i].data.length,h>t&&(localStorage.removeItem(a[i].key),d+=1,h-=2*a[i].data.length);const l=R();e.ULS.ri(595903508,s.K,o.Info,`[VO_Perf] Evict Stale Cache Time Taken: ${l-n}, Ist iteration evicted items: ${c}, 2nd iteration evicted items: ${d}`)}catch(t){e.ULS.ri(595904090,s.K,o.Warning,"Failure to Evict Stale Cache: "+C(t))}}GetDocVersion(){return this.IsCacheAvailable()?this.Gn:""}DecryptAndValidate(t,i){try{const e=R();this.decrypt(this.Xn,this.jn,this.qn,this.zn).then(n=>{try{let r;r=JSON.parse(n);const a=R();this.Ns.ULS.ri(595903648,s.K,o.Info,"[VO_Perf] Decrypt and validate cache Time Taken: "+(a-e)),r.DocVersion===this.Gn?t(r.DocView,r.ImageData):(this.Ns.ULS.ri(595907480,s.K,o.Warning,"Document version unexpected mismatch."),i())}catch(t){this.Ns.ULS.ri(595907481,s.K,o.Warning,"Failure to deserialize the decrypted text: "+C(t)),i()}},t=>{this.Ns.ULS.ri(595907482,s.K,o.Warning,"Failure to decrypt: "+C(t)),i()})}catch(t){this.Ns.ULS.ri(595907483,s.K,o.Warning,"Failure to DecryptAndValidate: "+C(t)),i()}}loadCache(){try{const t=localStorage.getItem(this.Jn);if(t){let i;i=JSON.parse(t),i.DocVersion===this.Gn&&(this.Xn=i)}}catch(t){this.Ns.ULS.ri(595910982,s.K,o.Warning,"Failure trying to load data from localStorage: "+t)}}encode64(t){return btoa(new Uint8Array(t).reduce((t,i)=>t+String.fromCharCode(i),""))}decode64(t){const i=window.atob(t),e=i.length,s=new Uint8Array(new ArrayBuffer(e));for(let t=0;t<e;t+=1)s[t]=i.charCodeAt(t);return s}async genEncryptionKey(t,i,e){const s={name:"PBKDF2",hash:"SHA-256",salt:(new TextEncoder).encode("VisioBrowserCacheSalt"),iterations:1e3},o={name:i,length:e},n=(new TextEncoder).encode(t),r=await crypto.subtle.importKey("raw",n,"PBKDF2",!1,["deriveKey"]);return crypto.subtle.deriveKey(s,r,o,!1,["encrypt","decrypt"])}async encrypt(t,i,e,s,o){const n={name:e,length:s,iv:crypto.getRandomValues(new Uint8Array(o))},r=await this.genEncryptionKey(i,e,s);return{DocumentData:this.encode64(await crypto.subtle.encrypt(n,r,(new TextEncoder).encode(t))),DocVersion:void 0,DataHash:void 0,IV:n.iv,LastAccessTime:void 0}}async decrypt(t,i,e,s){const o={name:e,length:s,iv:new Uint8Array(this.Kn)};for(let i=0;i<this.Kn;i+=1)o.iv[i]=t.IV[i];const n=await this.genEncryptionKey(i,e,s),r=await crypto.subtle.decrypt(o,n,this.decode64(t.DocumentData));return(new TextDecoder).decode(r)}static getHashCode(t){let i=0;const e=t.length;let s=0;if(e>0)for(;s<e;)i=(i<<5)-i+t.charCodeAt(s)|0,s+=1;return i}constructor(t,i,e,s){this.qn="AES-GCM",this.zn=256,this.Kn=12,this.Xn=null,this.Jn=Gt.Zn+t,this.Gn=i,this.jn=e,this.Ns=s,this.loadCache()}}function jt(t,i){N()===U.Safari?t.style.display=i?"none":"block":t.style.visibility=i?"hidden":"visible"}function qt(t){try{return window===window.top||window.parent===window.top&&window.location.origin===window.top.origin}catch(i){return t&&t.ULS.ri(591525084,s.H,o.Info,"Trust check error: "+C(i)),!1}}function zt(t){const i=window.navigator;if(i&&i.virtualKeyboard&&void 0!==i.virtualKeyboard.overlaysContent&&window===top)return i.virtualKeyboard.overlaysContent=t}Gt.cachedDocumentVersionData="cacheDocVersion",Gt.documentSaveIdleTimeInMs=4e3,Gt.cacheEvictIdleTimeInMs=8e3,Gt.maxStorageQuotaSettingName="BrowserCacheMaxQuotaInMB",Gt.minEvictTimePeriodSettingName="BrowserCacheMinEvictTimePeriodInDays",Gt.Zn="VisioCachedView_",Gt.Ao=null,Gt.$n=(t,i,e)=>{if(null!=Gt.Ao&&t&&e&&i){const s=t+"_"+i,o=Gt.getHashCode(e);if(Gt.Ao.jn===s&&Gt.Ao.Gn===o)return!1}return!!(window.crypto&&crypto.subtle&&window.localStorage)&&"TextEncoder"in window&&!!e&&!!i&&!!t&&e.length>0&&t.length>0&&i.length>0},function(t){t.Yn="access_token",t.Qn="access_token_ttl",t.tr="wac_token",t.ir="bundleSrc",t.er="bundleStaleness",t.sr="DocID",t.or="SiteID",t.nr="WebID",t.rr="ETag",t.ar="feature_status",t.hr="fileExtension",t.cr="fileGetUrl",t.dr="customFontCatalogUrl",t.lr="fileName",t.ur="fileSize",t.pr="forceSLR",t.mr="frameHeightPx",t.wr="frameWidthtPx",t.gr="highContrast",t.vr="highDpi",t.Sr="host_diagnostics",t.Ir="hostName",t.br="huictrls",t.Tr="owner_id",t._r="sc",t.Cr="softBlockedBrowser",t.Er="templateUrl",t.Ar="touchMode",t.Fr="user_id",t.yr="hfck",t.Vr="hfcv",t.Pr="timeZoneId",t.Rr="darkCssMedia",t.xr="forcedColors",t.Wr="prefersContrast",t.kr="caae",t.Dr="meetingId",t.Ur="meetingTitle",t.Or="meetingType",t.Br="scheduledStartTime",t.Mr="scheduledEndTime",t.Nr="isPresenter",t.Hr="meetingOrganizerId",t.Lr="meetingJoinUrl",t.$r="isMeetingTeamsRoom",t.Jr="jsapibuild",t.Gr="owlver",t.jr="owlro",t.qr="caaemode",t.zr="traceparent",t.Kr="tracestate",t.Xr="supports_zipit",t.Zr="sipcn",t.Yr="devcs",t.Qr="dceit",t.ta="frameInnerHeightPx",t.ia="frameInnerWidthPx"}(Rt||(Rt={}));const Kt=(t,i,e,s,o)=>t!==Z.ke?Promise.reject("Wrong flow"):new Promise(t=>{zt(i.overlayContent),e.container&&e.container.postMessage(rt.cn,void 0),t({completion:"success"})});let Xt=!1,Zt=!1;function Yt(t){if(!Xt)try{Xt=!0,Zt=!1,function(t){t.innerApplicationFrame&&(t.innerApplicationFrame.src="about:blank",window.setTimeout(()=>{t.innerApplicationFrame&&t.innerApplicationFrame.parentElement&&t.innerApplicationFrame.parentElement.removeChild(t.innerApplicationFrame),t.onFrameRemoved&&t.onFrameRemoved()},0))}(t),function(t){const i={disposeStartTime:t.disposeStartTime,disposeEndTime:R(),forceAppUnload:t.forceAppUnload,appUnloadTimedOut:t.appUnloadTimedOut};if(t.forceAppUnloadStartTime&&(i.appUnloadStartTime=t.forceAppUnloadStartTime),t.forceAppUnloadEndTime&&(i.appUnloadEndTime=t.forceAppUnloadEndTime),t.appUnloadedMessageValues){const e=t.appUnloadedMessageValues,s=Number(e.hostMessageReceived);t.forceAppUnloadStartTime&&!isNaN(s)&&(i.hostToAppPostMessageLatency=s-t.forceAppUnloadStartTime);const o=Number(e.appMessageSent);!isNaN(o)&&t.forceAppUnloadEndTime&&(i.appToHostPostMessageLatency=t.forceAppUnloadEndTime-o);const n=Number(e.appUnloadStart),r=Number(e.appUnloadEnd);if(isNaN(n)||isNaN(r)||(i.appUnloadLatency=r-n),e.serverTimings){const t=e.serverTimings;for(const e in t)i["st-"+e.toString()]=t[e]}}t.logger.ULS.ri(595855436,s.H,o.Info,"App disposed "+JSON.stringify(i)),t.logger.ULS.flushOnClose()}(t),t.onDisposed&&t.onDisposed()}catch(i){t.logger.ULS.ri(595714434,s.H,o.Error,"Error disposing: "+C(i))}}var Qt,ti;function ii(t,i){i&&i.Diagnostics&&Object.keys(i.Diagnostics).forEach(e=>t[e]=i.Diagnostics[e])}!function(t){t.BrowserEvent="BrowserEvent",t.AcquireOAuthTokenTeams="AcquireOAuthTokenTeams",t.PageChanged="PageChanged",t.ZoomChanged="ZoomChanged",t.ContentRefreshBegin="ContentRefreshBegin",t.ContentRefreshEnd="ContentRefreshEnd",t.AppClosed="UI_Close",t.UserEdit="Edit_Notification",t.FileRename="File_Rename",t.FileShare="UI_Sharing",t.ShowFileVersions="UI_FileVersions",t.UIWorkflow="UI_Workflow",t.IsDisabled="IsDisabled",t.AccessibilityLoopComplete="App_AccessibilityLoopComplete",t.Unloaded="Unloaded",t.Disposed="Disposed",t.SwitchMode="App_SwitchMode",t.DocumentReboot="DocReboot",t.WopiInfoFromUrl="WopiInfoFromUrl",t.DavUrlFromIds="DavUrlFromIds",t.ModeSwitched="ModeSwitched",t.CreateNewDocument="App_CreateNewDocument",t.GetAuthToken="GetAuthToken",t.GetCustomAuthConfig="GetCustomAuthConfig",t.SetOverlayContent="SetOverlayContent",t.MoveToFolder="MoveToFolder",t.SharedFilePicker="SharedFilePicker"}(Qt||(Qt={})),function(t){t.bootWithoutWopiInfo="",t.unifiedSingleFlush="Unified_SingleFlush",t.unifiedIrmEnabled="Unified_IrmEnabled",t.unifiedViewActionUrl="Unified_ViewActionUrl",t.unifiedNotEditOrViewActionUrl="Unified_NotEditOrViewActionUrl",t.forceSingleStepBoot="Force_SingleStepBoot",t.wordUiEmbedReadOnlyEarlyRedirect="WordUiEmbed_ReadOnlyEarlyRedirect",t.wordUiEmbedIrmEnabledEarlyRedirect="WordUiEmbed_IrmEnabledEarlyRedirect",t.wordViewToUnifiedReadRedirect="WordView_UnifiedReadRedirect"}(ti||(ti={}));const ei="WebApplicationFrame";function si(t,i,e,s,o){let n=w(t);("teams"===n.uih&&"UnifiedUiHostTeams"!==i.UiHostIntegrationType&&"TeamsModern"!==i.UiHostIntegrationType||"owa"===n.uih)&&(n.hhdr="1");const r=t.indexOf("?"),a=-1===r?t.concat("?"):t.substring(0,r+1);i.UiLocale&&(n.ui=encodeURIComponent(i.UiLocale)),i.DataLocale&&(n.rs=encodeURIComponent(i.DataLocale)),i.HostSessionId&&(n.hid=encodeURIComponent(i.HostSessionId)),i.DisableChat&&(n.dchat="1"),i.SessionContext&&(n.sc=encodeURIComponent(i.SessionContext)),e&&e.WopiSrc&&(n.wopisrc=encodeURIComponent(e.WopiSrc)),i.CookieCompliant&&(n.mscc="1"),s&&(s.entryPoint&&(n.wdorigin=encodeURI(s.entryPoint)),s.userClickTime&&(n.wdhostclicktime=s.userClickTime.toString())),n={...n,...i.WdParams,...o};const h={};for(const t in n)h[t.toLowerCase()]=n[t];const c=[];for(const t in h)h[t]&&c.push(t.concat("=",h[t]));return a.concat(c.join("&"))}function oi(t){return t.AccessTokenExpiry?t.AccessTokenExpiry.getTime().toString():"0"}class ni{setFrameLoaded(){this.ea=!0,this.sa="Boot_HeartBeat_FrameLoaded"}setFrameError(){this.oa=!0,this.sa="Boot_HeartBeat_FrameError"}restart(){const t=this.na.getValue(D.Ii,!1);this.ra=P()+(this.aa?this.aa:this.na.getValue(D.pi,6e5));const i=this.Rn?3e3:5e3;this.ha=window.setInterval(()=>{t&&this.Ns.ULS.ri(595724178,s.H,o.Info,this.sa),P()>this.ra&&(this.stop(),this.ca(),this.da&&this.da())},this.na.getValue(D.Si,i)),this.la.push(window.setTimeout(this.ca,this.na.getValue(D.mi,3e4),1)),this.la.push(window.setTimeout(this.ca,this.na.getValue(D.wi,12e4),2)),this.la.push(window.setTimeout(this.ca,this.na.getValue(D.fi,18e4),3))}stop(){this.ra=0,this.ha&&(window.clearInterval(this.ha),this.ha=void 0),this.la.forEach(t=>{window.clearTimeout(t)}),this.la=[]}constructor(t,i,e,n,r){this.ra=0,this.la=[],this.Rn=!1,this.sa="Boot_HeartBeat",this.ea=!1,this.oa=!1,this.ca=t=>{const i="Boot_NotComplete_"+(t||"Final")+(this.oa?"_FrameError":this.ea?"_FrameLoaded":"");this.Ns.ULS.ri(594901218,s.H,o.Warning,i),this.Ns.ULS.flush()},this.Rn=t,this.na=i,this.Ns=e,this.da=n,this.aa=r,this.restart()}}const ri=(t,i,e,n,r)=>t!==Z.Ds?Promise.reject("Wrong flow"):new Promise(t=>{const n=i.flightKey,r=i.flightValue;var a;e.logger.ULS.ri(507343134,s._t,o.Info,`setWacFlightValue ${n}: ${r}`),a=i,localStorage.setItem(a.flightKey,a.flightValue.toString()),t({completion:"success"})});class ai{registerPostMessageHandlers(){this.ua.registerMessagePayloadHandler(Z.Ji,this.pa),this.ua.registerMessagePayloadHandler(Z.qi,this.ma),this.ua.registerMessagePayloadHandler(Z.Gi,this.wa),this.ua.registerMessagePayloadHandler(ai.fa,this.ga),this.ua.registerMessagePayloadHandler(Z.Ae,this.va),this.ua.registerMessagePayloadHandler(Z.Qi,this.Sa),this.ua.registerMessagePayloadHandler(Z.We,this.Ia),this.ua.registerMessagePayloadHandler(ai.ba,this.Ta),xt.getBRSValue(xt.CoCommentingAcrossViewAndEditEnabled)&&this.ua.registerMessagePayloadHandler(Z.Ce,this._a),this.Ca.SupportsFrameTrustCheck||this.ua.registerMessagePayloadHandler(Z.de,this.Ea),this.ua.registerMessagePayloadHandler(Z.ue,this.Aa),this.ua.registerMessagePayloadHandler(Z.pe,this.Fa),this.ua.registerMessagePayloadHandler(Z.ke,this.ya),this.ua.registerMessagePayloadHandler(Z.Se,this.Va),this.ua.registerMessagePayloadHandler(Z.Re,this.Pa)}unregisterPostMessageHandlers(){this.ua.removeMessageHandler(Z.Ji),this.ua.removeMessageHandler(Z.qi),this.ua.removeMessageHandler(Z.Gi),this.ua.removeMessageHandler(ai.fa),this.ua.removeMessageHandler(Z.We),this.ua.removeMessageHandler(ai.ba),xt.getBRSValue(xt.CoCommentingAcrossViewAndEditEnabled)&&this.ua.removeMessageHandler(Z.Ce),this.ua.removeMessageHandler(Z.de),this.ua.removeMessageHandler(Z.ue),this.ua.removeMessageHandler(Z.pe),this.ua.removeMessageHandler(Z.ke),this.ua.removeMessageHandler(Z.Se),this.ua.removeMessageHandler(Z.Re),this.ua.removeMessageHandler(Z.Ae),this.ua.removeMessageHandler(Z.Qi)}registerEventHandler(t,i){switch(t){case Qt.Unloaded:case Qt.DocumentReboot:case Qt.CreateNewDocument:case Qt.GetAuthToken:case Qt.GetCustomAuthConfig:case Qt.MoveToFolder:case Qt.SharedFilePicker:case Qt.SetOverlayContent:if(this._n[t])throw new Error("Duplicate registration for: "+t);this._n[t]=i;break;default:this.ua.registerMessagePayloadHandler(t,i)}}removeEventHandler(t,i){switch(t){case Qt.Unloaded:case Qt.DocumentReboot:case Qt.CreateNewDocument:case Qt.GetAuthToken:case Qt.GetCustomAuthConfig:case Qt.MoveToFolder:case Qt.SharedFilePicker:case Qt.SetOverlayContent:if(this._n[t]!==i)throw new Error("The handler requested to be removed does not exist for the eventType: "+t);delete this._n[t];break;default:this.ua.removeMessageHandler(t)}}showApplicationFrame(){this.An.style.opacity="1.0"}hideApplicationFrame(){this.An.style.opacity=ai.Ra}Dispose(t,i){this.Ns.ULS.ri(595682585,s.K,o.Info,"VisioWopiApplication.Dispose() Entered"),t||this.An&&this.An.parentElement&&this.An.parentElement.removeChild(this.An),t?function(t,i,e,n,r,a,h){if(i.ULS.ri(595714433,s.H,o.Info,`Starting disposing the application. unloadApp:${t}; disposed:${Xt}; unloading:${Zt}`),Xt||Zt&&t)return void i.ULS.ri(595714908,s.H,o.Info,"Application is already disposed or unloading");const c={logger:i,postMessenger:e,innerApplicationFrame:n,onDisposed:r,onFrameRemoved:a,unloadTimeoutInMs:h||1e3,forceAppUnload:!1,disposeStartTime:R(),appUnloadTimedOut:!1};if(t&&n)return Zt=!0,c.forceAppUnload=!0,(d=c).forceAppUnloadStartTime=R(),d.logger.ULS.ri(595855490,s.H,o.Info,"Sending postmessage to unload app"),d.logger.ULS.flush(),d.postMessenger.registerMessagePayloadHandler(Z.Me,t=>function(t,i){t.forceAppUnloadEndTime=R(),t.appUnloadedMessageValues=i,t.logger.ULS.ri(595855491,s.H,o.Info,"AppUnloaded received from app"),Yt(t)}(d,t)),d.postMessenger.sendPostMessage(d.innerApplicationFrame,rt.un,{}),void window.setTimeout(()=>function(t){!Zt&&Xt||(t.appUnloadTimedOut=!0,t.logger.ULS.ri(595855492,s.H,o.Info,"ApplicationUnload timed out, forcing dispose"),Yt(t))}(d),d.unloadTimeoutInMs);var d;Yt(c)}(t||!1,this.Ns,this.ua,this.An,()=>{delete this.xa,delete this.Wa,delete this.An,this.raiseEvent(Qt.Unloaded,{})},void 0,i):(delete this.xa,delete this.Wa,delete this.An)}raiseEvent(t,i){const e=this._n[t];e&&e(i||{})}activate(){this.Ns.ULS.ri(595682586,s.K,o.Info,"VisioWopiApplication.Activate() Entered"),this.ka(!1)}resetInnerApplicationFrameId(){this.An.id=ei}getInnerApplicationFrame(){return this.An}getInnerApplicationFramePromise(){return this.Da}completeTwoStepFlow(t,i){this.Ns.ULS.ri(595706829,s.K,o.Info,"VisioWopiApplication.CompleteTwoStepFlow()");try{this.Ua=t,void 0!==i&&(this.Oa=i),this.Ua&&this.Ba&&this.Ma()}catch(t){this.Ns.ULS.ri(595706830,s.K,o.Error,"VisioWopiApplication.CompleteTwoStepFlow() failed: "+C(t))}}Boot(t=!1){this.Ns.ULS.ri(596464402,s.K,o.Info,"VisioWopiApplication.Boot() isBackground:"+t),pi.validateAppModeForBackgroundBoot(t,this.Na);try{this.Ha(t,this.La,()=>{try{this.$a(t)}catch(t){this.Ja(t,this.Ga)}})}catch(t){this.Ja(t,this.Ga)}}notifyFastPreviewFailed(){this.ja?this.ja=!1:this.Ns.ULS.ri(596459906,s.K,o.Info,"Fast boot container is not available")}sendCreateNewTemplateId(t){void 0!==t&&this.qa(ai.za,t)}sendWACDataPostMessage(t){this.ua.sendPostMessage(this.An,ai.Ka,t),this.Ns.ULS.ri(595935318,s.K,o.Info,"Document Data Sent with Post Message.")}sendPostMessageForCommand(t,i){this.ua.postMessageForCommand(this.An,t,i)}IsPageViewLoaded(){return this.Xa}IsBootComplete(){return this.Za}UpdateLogger(t){this.Ns=t}PostWacToken(t,i,e){_t(t,i,this.ua,this.Ns,this.Da,e)}constructor(t,i,e,n,r,a,h,d,l,u,p,m,f,g){this.Ba=!1,this.Xa=!1,this.Za=!1,this.ja=!1,this.Ya=!1,this.Qa=!1,this.th=!1,this.ih=!1,this._n={},this.qa=(t,i)=>{this.An&&this.An.contentWindow?this.ua.sendPostMessage(this.An,t,i):this.Ns.ULS.ri(595706831,s.H,o.Warning,"Attempted to send postmessage: "+t)},this.Ha=(t=!1,i,e)=>{this.Ns.ULS.ri(596464673,s.K,o.Info,"VisioWopiApplication.createInnerFrame()"),this.An=document.createElement("iframe"),this.An.id=t?ai.eh:ei,this.An.name=ei,this.An.width="100%",this.An.height="100%",this.An.src="",this.An.frameBorder="0",this.An.marginWidth="0",this.An.marginHeight="0",this.An.allowFullscreen=!0,this.An.style.left="0",this.An.style.top="0",this.An.style.right="0",this.An.style.bottom="0",this.ka(t),this.An.style.position="absolute",this.An.style.backgroundColor="transparent",this.An.setAttribute("allowTransparency","true"),this.An.setAttribute("loading","eager"),this.An.title="Office Online Frame",this.An.style.zIndex="1000",this.An.style.setProperty("will-change","opacity"),this.An.onload=e;const n=c(this.sh);this.An.setAttribute("allow",`microphone ${n}; autoplay ${n}; camera ${n}; clipboard-read ${n}; clipboard-write ${n}; keyboard-map ${n}; display-capture ${n}`),this.Ga.officeFrameCreateTime=R(),i.insertBefore(this.An,i.firstChild),this.oh&&this.oh(this.An)},this.ka=t=>{N()===U.Safari?this.An.style.display=t?"none":"block":this.An.style.visibility=t?"hidden":"visible"},this.$a=(t=!1)=>{if(this.An.onload=()=>{},this.Ns.ULS.ri(596464674,s.K,o.Info,"VisioWopiApplication.internalBootFromWac() isBackground:"+t),null==this.An.contentWindow)return;this.Wa=this.An.contentWindow,this.xa=this.Wa.document,this.xa.body.style.margin="0",this.xa.body.style.padding="0",this.xa.body.style.overflow="hidden",this.xa.body.style.msContentZooming="none";const i=this.xa.createElement("meta");i.charset="utf-8",this.xa.head.appendChild(i);const e=this.xa.createElement("meta");e.httpEquiv="x-ua-compatible",this.xa.head.appendChild(e);const n=this.xa.createElement("meta");n.name="viewport",n.content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no",this.xa.head.appendChild(n);const r=this.xa.createElement("form");r.id="office_form",r.name="office_form",r.target=t?"_self":ei,r.action=this.nh,r.method="POST";const a=function(t,i){const e={};if(t.wopiInfo&&(e[Rt.Yn]=t.wopiInfo.AccessToken,e[Rt.Qn]=oi(t.wopiInfo),t.wopiInfo.WacToken&&(e[Rt.tr]=t.wopiInfo.WacToken)),t.wopiPrecheckInfo.BundleInfo&&t.wopiPrecheckInfo.BundleInfo.Url&&t.wopiPrecheckInfo.BundleInfo.Url.length>0)if(e[Rt.ir]=t.wopiPrecheckInfo.BundleInfo.Url,null!=t.wopiPrecheckInfo.BundleInfo.BundleStaleness&&void 0!==t.wopiPrecheckInfo.BundleInfo.BundleStaleness){const n=t.wopiPrecheckInfo.BundleInfo.BundleStaleness.toString();i.ULS.ri(593503580,s.H,o.Info,"Content bundle staleness - "+n),e[Rt.er]=n}else i.ULS.ri(593503581,s.H,o.Info,"Content bundle staleness does not exist");if(t.wopiPrecheckInfo.FileGetUrl&&(e[Rt.cr]=t.wopiPrecheckInfo.FileGetUrl),t.wopiPrecheckInfo.CustomFontCatalogUrl&&(e[Rt.dr]=t.wopiPrecheckInfo.CustomFontCatalogUrl),t.wopiPrecheckInfo.FileName){const i=_(t.wopiPrecheckInfo.FileName);i&&(e[Rt.hr]=i),e[Rt.lr]=t.wopiPrecheckInfo.FileName}t.newFileTemplateSource&&t.newFileTemplateSource.FileSize?e[Rt.ur]=t.newFileTemplateSource.FileSize.toString():t.wopiPrecheckInfo.FileSize&&(e[Rt.ur]=t.wopiPrecheckInfo.FileSize.toString()),t.sessionInformation.UserId&&(e[Rt.Fr]=t.sessionInformation.UserId),t.sessionInformation.OwnerId&&(e[Rt.Tr]=t.sessionInformation.OwnerId),t.sessionInformation.SessionContext&&(e[Rt._r]=t.sessionInformation.SessionContext),void 0!==t.sessionInformation.SupportsZipIt&&(e[Rt.Xr]=t.sessionInformation.SupportsZipIt.toString()),t.diagnostics.HostInitDiagnostics&&(e[Rt.Sr]=JSON.stringify({HostInitializeDiagnostics:t.diagnostics.HostInitDiagnostics,ClientDiagnostics:t.diagnostics.ClientDiagnostics})),e[Rt.ar]=lt(t.featureManager,t.sessionInformation.WdParams),t.applicationCustomSettings&&t.applicationCustomSettings.HostUIControls&&(e[Rt.br]=JSON.stringify(t.applicationCustomSettings.HostUIControls)),e[Rt.vr]=String(window.devicePixelRatio>1.24),e[Rt.Cr]=String($()),e[Rt.Ir]=t.sessionInformation.HostName;const n=t.newFileTemplateSource;n&&n.FileGetUrl&&(e[Rt.Er]=n.FileGetUrl),n&&n.DocUniqueId?e[Rt.sr]=n.DocUniqueId:t.wopiPrecheckInfo.DocUniqueId&&(e[Rt.sr]=t.wopiPrecheckInfo.DocUniqueId),n&&n.ETag?e[Rt.rr]=n.ETag:t.wopiPrecheckInfo.ETag&&(e[Rt.rr]=t.wopiPrecheckInfo.ETag),"Templatization"!==t.sessionInformation.ContentAssemblyMode&&"DocGen"!==t.sessionInformation.ContentAssemblyMode&&"ContentAssemblyEdit"!==t.sessionInformation.ContentAssemblyMode&&"ContentAssemblyView"!==t.sessionInformation.ContentAssemblyMode||(e[Rt.kr]="1"),t.sessionInformation.ContentAssemblyMode&&(e[Rt.qr]=t.sessionInformation.ContentAssemblyMode);const r=t.sessionInformation.Meeting;r&&(r.id&&(e[Rt.Dr]=r.id),r.title&&(e[Rt.Ur]=r.title),r.type&&(e[Rt.Or]=r.type),r.scheduledStartTime&&(e[Rt.Mr]=r.scheduledStartTime),r.scheduledEndTime&&(e[Rt.Mr]=r.scheduledEndTime),r.joinUrl&&(e[Rt.Lr]=encodeURIComponent(r.joinUrl)),r.organizerId&&(e[Rt.Hr]=r.organizerId),r.isPresenter&&(e[Rt.Nr]=r.isPresenter.toString()),r.isMeetingTeamsRoom&&(e[Rt.$r]=r.isMeetingTeamsRoom.toString()));const a=t.sessionInformation.OwlVersion;a&&(e[Rt.Gr]=a);const h=t.sessionInformation.OwlRollout;h&&(e[Rt.jr]=h);const c=t.sessionInformation.SupportsInPlaceCreateNew;c&&(e[Rt.Zr]=c.toString()),t.sessionInformation.DisableEmbedViewCodeSnippet&&(e[Rt.Yr]="1"),t.sessionInformation.DisableCoEditInTeams&&(e[Rt.Qr]="1"),e[Rt.Jr]=T();const d=t.sessionInformation.TraceParent;if(d){e[Rt.zr]=d;const i=t.sessionInformation.TraceState;i&&(e[Rt.Kr]=i)}return e}(this.rh,this.Ns);pi.isInstantBootMode(this.Na,this.sh)&&(a.hasOwnProperty(Rt.Yn)&&delete a[Rt.Yn],a.hasOwnProperty(Rt.Qn)&&delete a[Rt.Qn],a.hasOwnProperty(Rt.tr)&&delete a[Rt.tr]),a.hasOwnProperty(Rt._r)&&delete a[Rt._r];for(const t in a)this.ah(r,t,a[t]);if(xt.getBRSValue(xt.DTEEnabledBRSKey)&&this.ah(r,ai.hh,this.Qa.toString()),!this.Ca.MetaUiHostVersion){if(this.Ca.HighContrastMode&&this.ah(r,"hcm",encodeURIComponent(this.Ca.HighContrastMode)),this.Ca.SupportsAccessibilityLoop&&this.ah(r,"accloop","1"),this.Ca.SupportsDocReboot){const t=this.Ca.SupportsDocReboot;this.ah(r,"sdr",!0===t?"1":t.toString())}this.Ca.SupportsCreateNewDocument&&this.ah(r,"scnd","1"),this.Ca.SupportsAuthToken&&this.ah(r,"sat","1"),window.docAspxMsalEnabled&&(this.Ca.AuthTokenStrategy="PairwiseBroker"),this.Ca.AuthTokenStrategy&&this.ah(r,"ats",this.Ca.AuthTokenStrategy),this.Ca.SupportsCustomAuthConfig&&this.ah(r,"cac","1"),this.Ca.SupportsMoveToFolder&&this.ah(r,"mtf","1"),this.Ca.SupportsCommonFilePicker&&this.ah(r,"sfp","1"),this.Ca.SupportsDirectPrint&&this.ah(r,"sdp","1"),this.Ca.DisableOfficeAddins&&this.ah(r,"doa","1"),this.Ca.SupportsDirectDownload&&this.ah(r,"sdd","1"),this.Ca.HideHeader&&this.ah(r,"hhdr","1"),this.Ca.MetaUiHostVersion&&this.ah(r,"muv",this.Ca.MetaUiHostVersion),this.Ca.HideWACOneDriveFileLocationPicker&&this.ah(r,"hodflp","1"),this.Ca.OpenLinksInNewWindow&&this.ah(r,"onw","1"),this.Ca.UseDarkTheme&&this.ah(r,"udt","1"),xt.getBRSValue(xt.IsAtMentionsEnabled)&&this.Ca.SupportsAtMentions&&this.ah(r,"sams","1")}if(this.dh&&this.Na===Ft.VIEW){const t=decodeURIComponent(this.dh);this.ah(r,"nav",t)}this.ah(r,ai.lh,"true"),this.ah(r,ai.uh,"true"),this.ph&&this.ah(r,Gt.cachedDocumentVersionData,this.ph.GetDocVersion()),this.ah(r,Rt.vr,String(window.devicePixelRatio>ai.highDpiThreshold)),this.mh&&this.ah(r,ai.wh,this.mh.getTime().toString()),this.xa.body.appendChild(r),r.submit()},this.ah=(t,i,e)=>{const s=this.xa.createElement("input");s.name=i,s.value=e,s.type="hidden",t.appendChild(s)},this.fh=()=>{let t;t=this.Ca.MetaUiHostVersion?function(t,i,e=!1){let s=t.applicationUrl,o={jsApi:"1",jsapiver:"v1"};if(e&&(o.NewSession="1"),o.corrid=t.sessionId,o.usid=t.sessionId,o.sftc="1",(t.applicationCustomSettings&&t.applicationCustomSettings.IsCore||t.sessionInformation.IsCore)&&(o.core="1"),t.sessionInformation.HideViewerToolbar&&(o.hvt="1"),t.sessionInformation.DisableFocusOnBoot&&(o.disableFocusOnBoot="1"),t.sessionInformation.HighContrastMode&&(o.hcm=encodeURIComponent(t.sessionInformation.HighContrastMode)),t.sessionInformation.SupportsAtMentions&&(o.sams="1"),t.sessionInformation.SupportsAccessibilityLoop&&(o.accloop="1"),t.sessionInformation.SupportsDocReboot){const i=t.sessionInformation.SupportsDocReboot;o.sdr=!0===i?"1":i.toString()}return t.sessionInformation.SupportsCreateNewDocument&&(o.scnd="1"),t.sessionInformation.SupportsAuthToken&&(o.sat="1"),window.docAspxMsalEnabled&&(t.sessionInformation.AuthTokenStrategy="PairwiseBroker"),t.sessionInformation.AuthTokenStrategy&&(o.ats=t.sessionInformation.AuthTokenStrategy),t.sessionInformation.SupportsCustomAuthConfig&&(o.cac="1"),t.sessionInformation.SupportsMoveToFolder&&(o.mtf="1"),t.sessionInformation.SupportsCommonFilePicker&&(o.sfp="1"),t.sessionInformation.OpenLinksInNewWindow&&(o.onw="1"),t.sessionInformation.UseDarkTheme&&(o.udt="1"),(t.sessionInformation.HideHeader||"DocGen"===t.sessionInformation.ContentAssemblyMode||"Templatization"===t.sessionInformation.ContentAssemblyMode||"ContentAssemblyEdit"===t.sessionInformation.ContentAssemblyMode||"ContentAssemblyView"===t.sessionInformation.ContentAssemblyMode)&&(o.hhdr="1"),t.sessionInformation.HideAppLauncherInHeader&&(o.halh="1"),t.sessionInformation.HideChatInHeader&&(o.hch="1"),t.sessionInformation.HideMeInHeader&&(o.hmh="1"),t.sessionInformation.HideSearchInHeader&&(o.hsh="1"),t.sessionInformation.HideWorkflowInHeader&&(o.hwfh="1"),t.sessionInformation.HideSettingsInHeader&&(o.hsth="1"),t.sessionInformation.ShowAppIconInHeader&&(o.sih="1"),t.sessionInformation.UseNeutralColorInHeader&&(o.unh="1"),t.sessionInformation.HideBreadCrumbInViewer&&(o.hbcv="1"),t.sessionInformation.HideTitleInViewer&&(o.htv="1"),t.sessionInformation.HideWACOneDriveFileLocationPicker&&(o.hodflp="1"),t.sessionInformation.NoBrowserModalDialogs&&(o.nbmd="1"),t.applicationCustomSettings&&t.applicationCustomSettings.FixDiagnosticsJson&&(o.fixdiag="1"),t.wopiPrecheckInfo.ReadOnly&&(o.readOnly="1"),"DocGen"!==t.sessionInformation.ContentAssemblyMode&&"ContentAssemblyView"!==t.sessionInformation.ContentAssemblyMode||(o.readOnly="1"),t.sessionInformation.UIEmbed&&(o.uiEmbed="1"),t.sessionInformation.IsSynthetic&&(o.syn="1"),t.sessionInformation.SupportsDirectDownload&&(o.sdd="1"),t.sessionInformation.SupportsDirectPrint&&(o.sdp="1"),t.sessionInformation.DisableOfficeAddins&&(o.doa="1"),t.sessionInformation.UiHostIntegrationType&&(o.uihit=encodeURIComponent(t.sessionInformation.UiHostIntegrationType)),t.sessionInformation.MetaUiHostVersion&&(o.muv=encodeURIComponent(t.sessionInformation.MetaUiHostVersion)),t.applicationCustomSettings&&t.applicationCustomSettings.InAppDocumentPreview&&(o.InAppDocPreview="1"),t.wopiPrecheckInfo.PreseededSessionKey&&(o.preseededSessionKey=encodeURIComponent(t.wopiPrecheckInfo.PreseededSessionKey)),t.wopiPrecheckInfo.PreseededWacSessionId&&(o.preseededWacSessionId=encodeURIComponent(t.wopiPrecheckInfo.PreseededWacSessionId)),t.wopiPrecheckInfo.RequestedCallThrottling&&(o.rct=t.wopiPrecheckInfo.RequestedCallThrottling),t.wopiPrecheckInfo.ClientThrottlingProtection&&(o.ctp=t.wopiPrecheckInfo.ClientThrottlingProtection),t.applicationCustomSettings&&t.applicationCustomSettings.additionalApplicationParameters&&(o={...t.applicationCustomSettings.additionalApplicationParameters,...o}),t.rebootOverrideData&&t.rebootOverrideData.queryOverrides&&(o={...o,...t.rebootOverrideData.queryOverrides}),si(s,t.sessionInformation,t.wopiInfo,t.diagnostics.HostInitDiagnostics,o)}(this.rh,function(t,i){let e={isSingleStepBoot:t.forceSingleStepBoot,bootFlowType:t.forceSingleStepBoot?ti.forceSingleStepBoot:ti.bootWithoutWopiInfo,ignoreWacFramePostMessages:!1};if(t.forceSingleStepBoot,e.isSingleStepBoot){const n={singleStepBootIsRequired:!0,singleStepBootReason:e.bootFlowType,irmEnabled:t.wopiPrecheckInfo.IrmEnabled,readOnly:t.wopiPrecheckInfo.ReadOnly,ignoreWacFramePostMessages:e.ignoreWacFramePostMessages};i.ULS.ri(596444182,s.H,n.irmEnabled?o.Warning:o.Info,JSON.stringify(n))}else i.ULS.ri(596444183,s.H,o.Info,"Received input valid for two step flow")}(this.rh,this.Ns)):this.sh;const i={};return i.usid=this.gh,i.sftc="1",i.fileSrc=this.Ca.HostName,i.pmOrigin=encodeURIComponent(c(window.location.href)),i.fastPreview=this.ja?"true":"false",pi.isInstantBootMode(this.Na,this.sh)&&(i.instantedit="1"),this.Ca.MetaUiHostVersion||(this.vh.RequestedCallThrottling&&(i.rct=this.vh.RequestedCallThrottling),this.vh.ClientThrottlingProtection&&(i.ctp=this.vh.ClientThrottlingProtection)),"DocGen"!==this.Ca.ContentAssemblyMode&&"ContentAssemblyView"!==this.Ca.ContentAssemblyMode||(i.readOnly="1"),"DocGen"!==this.Ca.ContentAssemblyMode&&"Templatization"!==this.Ca.ContentAssemblyMode&&"ContentAssemblyView"!==this.Ca.ContentAssemblyMode&&"ContentAssemblyEdit"!==this.Ca.ContentAssemblyMode||(i.hhdr="1"),si(t,this.Ca,this.Ua,this.Sh,i)},this.pa=t=>{this.qa(rt.Vo,{}),this.Ba||(this.Ba=!0,ii(this.Ga,t),pi.isInstantBootMode(this.Na,this.sh)&&this.Ua&&this.Ma())},this.Ma=()=>{if(this.Ya)return;this.Ya=!0,this.Ns.ULS.ri(595706832,s.H,o.Info,"Sending wopi info to the frame.");let t="";xt.getBRSValue(xt.AppShellPrebootEnabledBRSKey)&&void 0!==this.Oa&&void 0!==this.Oa.TemplateSource&&void 0!==this.Oa.TemplateSource.DocUniqueId&&(t=this.Oa.TemplateSource.DocUniqueId);const i={WopiDetails:{WopiSrc:this.Ua.WopiSrc,AccessToken:this.Ua.AccessToken,AccessTokenTtl:oi(this.Ua),CreateNewTemplateId:t}};this.Ua.WacToken&&(i.WopiDetails.WacToken=this.Ua.WacToken),this.Ih(rt.Do,i)},this.Ih=(t,i)=>{this.bh(t,i,1)},this.Th=()=>{if(this.Ns.ULS.ri(589611397,s.H,o.Info,"Sending comment context message to frame"),void 0!==this._h){const t=this._h;this.qa(rt.tn,t),this._h=void 0}},this._a=t=>{this._h=t},this.bh=(t,i,e)=>{e>3?this.Ns.ULS.ri(595706833,s.H,o.Error,"Attempted to call complete, but received no ack from the frame. Time: "+R()):(this.Ns.ULS.ri(595706834,s.H,o.Info,`Sending completion message to frame. Attempt number: ${e}, Time: ${R()}`),this.qa(t,i),window.setTimeout(()=>this.Ch(t,i,e),1e3))},this.Ch=(t,i,e)=>{this.th||(this.Ns.ULS.ri(595706835,s.H,o.Info,"SessionCompletion timed out with no ack."),this.bh(t,i,e+1))},this.Ia=t=>{this.th=!0},this.ma=t=>{this.Na===Ft.VIEW&&xt.getBRSValue(xt.CoCommentingAcrossViewAndEditEnabled)&&this.Th(),this.Za||(this.Za=!0,this.Ns.ULS.ri(596457678,s.K,o.Info,"Switched to Visio Frame at Time: "+R()),ii(this.Ga,t),this.Ga.webAppFrameReinitialized=this.ih,this.Ga&&this.Ns.ULS.ri(596464400,s.K,o.Info,"AppInitializeDiagnostics:"+JSON.stringify(this.Ga)),this.Ns.ULS.ri(596464675,s.K,o.Info,""+JSON.stringify(t)),this.Eh(this.Ga,t&&t.Settings?t.Settings:null),this.ua.sendPostMessage(this.An,rt.No,{HostInitializeDiagnostics:this.rh.diagnostics.HostInitDiagnostics,ClientDiagnostics:this.rh.diagnostics.ClientDiagnostics}))},this.wa=t=>{let i;this.Za=!0,t&&(i=t.Error),void 0===i&&(this.Ns.ULS.ri(596453597,s.K,o.Warning,"No error information passed by the WAC Frame"),i={errorType:st.AppInitError,errorObject:new TypeError("WacFrame")}),this.Ja(i,this.Ga)},this.ga=t=>{this.Xa||(this.Xa=!0,this.Ns.ULS.ri(595969242,s.K,o.Info,"Page View loaded on WAC Frame"),ii(this.Ga,t))},this.va=t=>{this.raiseEvent(Qt.DocumentReboot,t)},this.Sa=t=>{this.raiseEvent(Qt.CreateNewDocument,t)},this.Aa=t=>{Promise?this.Ah.isResourceTrustedForMessage(t).then(i=>{i?this.raiseEvent(Qt.GetAuthToken,t):this.ua.sendPostMessage(this.An,rt.Yo,{AuthToken:"",Error:"accessDenied",RequestId:t.RequestId,IdentityType:t.IdentityType})},()=>{this.ua.sendPostMessage(this.An,rt.Yo,{AuthToken:"",Error:"Exception encountered in AuthTokenTrustValidator.isResourceTrustedForMessage",RequestId:t.RequestId,IdentityType:t.IdentityType})}):this.ua.sendPostMessage(this.An,rt.Yo,{AuthToken:"",Error:'"Promise" does not exist natively in browser',RequestId:t.RequestId,IdentityType:t.IdentityType})},this.Fa=t=>{this.raiseEvent(Qt.GetCustomAuthConfig,t)},this.Va=t=>{this.raiseEvent(Qt.MoveToFolder,t)},this.Pa=t=>{this.raiseEvent(Qt.SharedFilePicker,t)},this.Ea=t=>{const i=qt();this.Ns.ULS.ri(595642328,s.K,o.Info,"Top frame is trusted: "+i),this.ua.sendPostMessage(this.An,rt.de,{isTopFrameTrusted:i})},this.ya=t=>{const i=zt(t&&t.overlayContent);this.Ns.ULS.ri(587487433,s.H,o.Info,"Overlay content: "+i),this.ua.sendPostMessage(this.An,rt.cn,void 0)},this.Ua=t,this.rh=i,this.vh=i.wopiPrecheckInfo,this.La=i.container,this.Ca=i.sessionInformation,this.gh=i.sessionId,this.sh=i.applicationUrl,this.Sh=i.diagnostics.HostInitDiagnostics,this.Ns=e,this.Eh=n,this.Ja=r,this.Ta=a,this.ja=h,this.ph=d,this.ua=u,this.Ah=p,this.Na=m,this.ih=f,this.Qa=g,this._n=l,this.Ga={officeSessionId:this.gh,officeBootstrapperVersion:T()},Promise&&(this.Da=new Promise(t=>this.oh=t));const v=w(window.location.href);this.dh="",xt.getBRSValue(xt.IsAtMentionsEnabled)&&(this.dh=v.nav),void 0!==this.Sh?(v.teamsvisiomode&&(this.Ns.ULS.ri(576074626,s.K,o.Warning,"Resetting user click for Teams reboot scenarios"),this.Sh.userClickTime=(new Date).getTime()),this.mh=this.Sh.userClickTime?new Date(this.Sh.userClickTime):void 0,this.Fh=this.Sh.officeInitializationTime?new Date(this.Sh.officeInitializationTime):void 0):(this.mh=void 0!==this.Ca&&void 0!==this.Ca.DocumentClickTime?this.Ca.DocumentClickTime:void 0,this.Fh=void 0!==this.Ca&&void 0!==this.Ca.HostInitTime?this.Ca.HostInitTime:void 0),this.mh?this.Ns.ULS.ri(596459904,s.K,o.Info,"DocumentClickTime: "+this.mh.getTime()):(this.mh=new Date,this.Ns.ULS.ri(595686562,s.K,o.Info,"Fallback DocumentClickTime: "+this.mh.getTime())),this.Fh&&this.Ns.ULS.ri(596459905,s.K,o.Info,"hostInitTime: "+this.Fh.getTime()),this.nh=this.fh(),f||this.registerPostMessageHandlers(),Xt=!1}}var hi,ci,di;ai.fa="Visio_PageViewLoaded",ai.Ka="Visio_DocumentData",ai.za="TemplateInfo_Ready",ai.ba="Visio_ReadyToReceiveDocData",ai.lh="bsdpm",ai.uh="dpmdv",ai.wh="dct",ai.hh="wde",ai.eh="BkgWebApplicationFrame",ai.highDpiThreshold=1.25,ai.Ra="0.0000001",function(t){t[t.TimerBegin=0]="TimerBegin",t[t.TimerEnd=1]="TimerEnd"}(hi||(hi={}));class li{static RecordTelemetryData(t,i,e,n,r,a){if(!xt.getBRSValue(xt.IsLongPoleInfraEnabled))return;const h={FeatureName:t,GUID:i,ComponentName:e,EventCategory:n===hi.TimerBegin?"BeginTimeStamp":"EndTimeStamp",MilliSecondsSinceEpoch:null!=r?r.getTime().toString():"-1",Value:null!=r?r.toUTCString():"-1"};a&&a.ULS.ri(523375501,s.K,o.Info,JSON.stringify(h))}}function ui(t,i,e){let s=void 0;if(null!=t&&t.userClickTime?s=t.userClickTime:null!=t&&t.hostPageFirstFlushTime&&(s=t.hostPageFirstFlushTime),null!=t&&t.officeBootstrapperStartTime&&s&&Math.floor((t.officeBootstrapperStartTime-s)/1e3)<60&&(li.RecordTelemetryData("bootPerf","constGuid","hostDuration",hi.TimerBegin,new Date(s),e),li.RecordTelemetryData("bootPerf","constGuid","hostDuration",hi.TimerEnd,new Date(t.officeBootstrapperStartTime),e)),null!=t&&t.officeBootstrapperStartTime&&li.RecordTelemetryData("bootPerf","constGuid","bootStrapperStartToVisioFrameCreateDuration",hi.TimerBegin,new Date(t.officeBootstrapperStartTime),e),null!=i&&i.officeFrameCreateTime){const t=new Date(i.officeFrameCreateTime);li.RecordTelemetryData("bootPerf","constGuid","visioFrameToAppCompleteDuration",hi.TimerBegin,t,e),li.RecordTelemetryData("bootPerf","constGuid","bootStrapperStartToVisioFrameCreateDuration",hi.TimerEnd,t,e)}if(null!=i&&i.appCompletedTime){const t=new Date(i.appCompletedTime);li.RecordTelemetryData("bootPerf","constGuid","visioFrameToAppCompleteDuration",hi.TimerEnd,t,e)}if(null!=i&&i.documentLoadedTime){const t=new Date(i.documentLoadedTime);li.RecordTelemetryData("bootPerf","constGuid","fastViewDuration",hi.TimerEnd,t,e)}}class pi{unregisterAppLevelPostMessageHandlers(){this.yh||(this.Vh&&this.Vh.unregisterPostMessageHandlers(),this.Ph(),this.yh=!0)}registerAppLevelPostMessageHandlers(){this.Rh.activate(this.getInnerApplicationFrame()),this.xh(),this.Vh&&this.Vh.registerPostMessageHandlers()}isBackground(){return this.Wh===ci.Background}isActive(){return this.Wh===ci.Active}getWopiInfo(){return this.rh.wopiInfo}getNewFileInfo(){return this.Oa}GetApplicationType(){return"Visio"}GetVersion(){return T()}GetSessionId(){return this.rh.sessionId}RegisterEventHandler(t,i){this.Vh&&this.Vh.registerEventHandler(t,i)}RemoveEventHandler(t,i){this.Vh&&this.Vh.removeEventHandler(t,i)}RegisterErrorHandler(t){throw void 0!==t&&(this.kh=t),Error("Not Implemented")}RemoveErrorHandler(t){throw void 0!==t&&delete this.kh,Error("Not Implemented")}PostCommand(t,i){this.Vh.sendPostMessageForCommand(t,i)}Dispose(t){if(this.Ns.ULS.ri(595682625,s.K,o.Info,`VisioApplication.Dispose() Disposing Active Frame appMode:${this.Na}, appState:${this.Wh}`),this.Wh===ci.Disposed){if(!(xt.getBRSValue(xt.IsSaveAndCloseRequestInvokedInTeamsEnabled)&&t&&this.Dh))throw new TypeError("Trying to Dispose application whose appState is Disposed");return this.Ns.ULS.ri(529343379,s.K,o.Info,`Calling appUnloadCallback to dispose active application (Edit Background App) in appMode:${this.Na}, appState:${this.Wh}`),void this.Dh({})}this.Wh=ci.Disposed,this.Uh(),this.Oh(t),this.rh.sessionInformation.MetaUiHostVersion&&this.unregisterAppLevelPostMessageHandlers(),this.Ns.ULS.flushOnClose(),delete this.Bh,delete this.Mh}removeFastView(){this.Mh&&this.rh.container&&this.rh.container.contains(this.Mh)&&this.rh.container.removeChild(this.Mh)}updateVisibilityMetrics(t){t&&(this.Nh=t)}activate(){if(this.Ns.ULS.ri(595682626,s.K,o.Info,`VisioApplication.activate() Activating Background Frame appMode:${this.Na}, appState:${this.Wh}`),this.Wh!==ci.Background)throw new TypeError("Trying to activate application whose appState is not Background");if(!this.Vh)throw new TypeError("VisioApplication:activate() Visio wopi Application is null");this.Wh=ci.Active,this.Hh&&(this.Hh=!1,this.Lh()),this.Vh.activate()}resetInnerApplicationFrameId(){this.Vh.resetInnerApplicationFrameId()}getInnerApplicationFrame(){return this.Vh.getInnerApplicationFrame()}getInnerApplicationFramePromise(){if(this.$h)return this.$h.then(t=>t.getInnerApplicationFramePromise())}Complete(t,i){if(this.Ns.ULS.ri(596464068,s.K,o.Info,`VisioApplication.Complete() isBackground:${this.isBackground()} appMode:${this.Na}`),xt.getBRSValue(xt.JsapiV1DiagnosticFixEnabled)&&this.rh.diagnostics.HostInitDiagnostics&&(this.rh.diagnostics.HostInitDiagnostics.hostCompleteCallTime=R()),this.Ua=t,this.rh.wopiInfo=t,void 0!==i&&(this.Oa=i),this.Ua&&this.Ua.AccessToken&&this.Ua.WopiSrc)if(this.Ns.ULS.ri(596464070,s.K,o.Info,"Create VisioWopiApplication"),this.Jh)this.Vh.completeTwoStepFlow(t,i),this.Gh(i);else try{this.jh(this.isBackground()),this.qh&&(this.Ns.ULS.ri(540922266,s.K,o.Info,"Document image/data are present in local cache"),window.setTimeout(()=>{this.Ns.ULS.ri(540922267,s.K,o.Info,"Loading the fast view from local cache"),this.qh()})),this.Gh(i)}catch(t){this.Ns.ULS.ri(596464072,s.K,o.Error,"Failure trying to boot the WOPI application: "+C(t)),this.rh.fnOnInitializeFailure({errorType:st.AppInitError,errorObject:t},void 0),V(this.rh.remoteTelemetryUrl,"Visio","bootException")}else this.Ns.ULS.ri(596464069,s.K,o.Error,"VisioApplication Invalid WopiInfo"),this.rh.fnOnInitializeFailure({errorType:st.AppInitError,errorObject:new TypeError("wopiInfo")},void 0)}Fail(t){this.Ns.ULS.ri(596464073,s.K,o.Info,"VisioApplication.Fail() Reason: "+JSON.stringify(t)),this.Ns.ULS.flush()}PostWacToken(t,i,e){_t(t,i,this.Rh,this.Ns,this.getInnerApplicationFramePromise(),e)}static GetMinContentVersion(){return 1}static validateAppModeForBackgroundBoot(t,i){if(t&&i!==Ft.EDIT)throw new TypeError("Boot() isBackground can not be true in other than Edit Mode")}addTimerTagForBoot(t){window.setTimeout(()=>this.zh(t),t)}Boot(){if(this.Ns.ULS.ri(596464074,s.K,o.Info,"VisioApplication.Boot()"),this.Ns.ULS.ri(596452560,s.K,o.Info,`Visio Application Mode: ${this.Na} , isBackground: ${this.isBackground()}`),pi.validateAppModeForBackgroundBoot(this.isBackground(),this.Na),this.Kh=xt.getBRSValue(xt.hostCacheForEmbedViewEnabledBRSKey,!0),this.Na===Ft.VIEW?(this.Ns.ULS.ri(596457682,s.K,o.Info,"Enabling fast boot since this is consumption mode"),this.Xh=!0,this.Zh=!0):this.Na!==Ft.EMBED_VIEW&&this.Na!==Ft.INTERACTIVE_PREVIEW||!this.Kh?this.Na===Ft.EDIT&&-1===this.rh.applicationUrl.indexOf("embed=1")&&(this.Xh=!0,this.Ns.ULS.ri(594838688,s.K,o.Info,"Enabling wrs fast boot in edit mode")):(this.Ns.ULS.ri(595198939,s.K,o.Info,"Enabling fast boot with no chrome mode for Embed View."),this.Xh=!0,this.Yh=!0),(this.Xh||this.Zh)&&this.Qh()&&this.rh.sessionInformation.HideHeader&&(this.Yh=!0),this.Yh&&this.Qh()&&(this.tc=!0),this.rh.sessionInformation&&this.rh.sessionInformation.WdParams&&(this.rh.sessionInformation.WdParams.wdPBIView&&(this.Ns.ULS.ri(596464075,s.K,o.Info,"No fast boot since the session is in PBI Mode"),this.Xh=!1,this.Zh=!1),this.rh.sessionInformation.WdParams.wdnc&&(this.Ns.ULS.ri(596129760,s.K,o.Info,"Boot in no chrome mode"),this.Yh=!0)),-1!==this.rh.applicationUrl.indexOf("wdPBIView")&&(this.Ns.ULS.ri(596457683,s.K,o.Info,"No fast boot since the session is in PBI Mode"),this.Xh=!1,this.Zh=!1),-1!==this.rh.applicationUrl.indexOf("wdnc")&&(this.Ns.ULS.ri(596129761,s.K,o.Info,"Boot in no chrome mode"),this.Yh=!0),-1!==this.rh.applicationUrl.indexOf("wdFastView")&&(this.Xh=!0,this.Zh=!0),window.matchMedia("screen and (-ms-high-contrast: active)").matches&&(this.Ns.ULS.ri(596452935,s.K,o.Info,"Running in High Contrast Mode, disable fast view"),this.Xh=!1,this.Zh=!1),this.Xh?this.rh.wopiPrecheckInfo.BundleInfo?(this.Ns.ULS.ri(596464076,s.K,o.Info,"Bundle is cached in host, try rendering the first page"),this.ic=this.rh.wopiPrecheckInfo.BundleInfo,this.ec(),this.oc(!1)):this.Ns.ULS.ri(596464077,s.K,o.Info,"Did not find the bundle information"):this.Ns.ULS.ri(596464078,s.K,o.Info,"Fast View is disabled via configuration"),this.Jh)try{this.jh(this.isBackground()),this.Ns.ULS.ri(595706836,s.K,o.Info,"VisioWopiApplication created in case of instant create-new")}catch(t){this.Ns.ULS.ri(595706837,s.K,o.Error,"Failure trying to boot the WOPI application in instant create-new: "+C(t)),this.rh.fnOnInitializeFailure({errorType:st.AppInitError,errorObject:t},void 0)}}updateModeSwitchClickTime(){this.rh.diagnostics.AppInitDiagnostics.modeSwitchClickTime=R()}showFasttViewForEditApp(){this.Na===Ft.EDIT?this.rh.wopiPrecheckInfo.BundleInfo?(this.Ns.ULS.ri(595648647,s.K,o.Info,"showFasttViewForDirectToEdit(): Bundle is cached in host, try rendering the first page"),this.ic=this.rh.wopiPrecheckInfo.BundleInfo,this.ec(),this.qh&&this.qh()):this.Ns.ULS.ri(595648648,s.K,o.Info,"showFasttViewForDirectToEdit(): Did not find the bundle information"):this.Ns.ULS.ri(595648649,s.K,o.Info,"showFasttViewForDirectToEdit() called for non edit app mode")}static isInstantBootMode(t,i){if(!xt.getBRSValue(xt.instantCreateNewLocalStorageKey)||void 0===i)return!1;const e=i.toLowerCase();return-1===e.indexOf("wopisrc")&&(!(t!==Ft.EDIT_NEW||!xt.getBRSValue(xt.InstantForAllTemplatesEnabledBRSKey)&&-1!==e.indexOf("wdtpl"))||xt.getBRSValue(xt.AppShellPrebootEnabledBRSKey)&&-1!==e.indexOf("wdasp"))}updateCreateNewTemplateInfo(t){void 0!==this.Vh&&this.Vh.sendCreateNewTemplateId(t)}constructor(t,i,e,n,r,a,h,c,d=ci.Active,l=!1){this.nc=!1,this.rc=!1,this.Yh=!1,this.tc=!1,this.ac=!1,this.hc=!1,this.Xh=!1,this.Zh=!1,this.Kh=!1,this.cc=!1,this.dc=!1,this.lc=!1,this.uc=!1,this.pc=!1,this.yh=!1,this.Qa=!1,this._ImageDataFormat="data:image/png;base64,{0}",this._n={},this.Qh=()=>"teams"===this.mc.toLowerCase(),this.xh=()=>{this.Rh.registerMessagePayloadHandler(Z.Vs,this.wc),this.Rh.registerMessagePayloadHandler(Z._s,this.fc),this.Rh.registerMessagePayloadHandler(Z.Es,this.gc),this.Rh.registerMessagePayloadHandler(Z.ys,this.vc)},this.Ph=()=>{this.Rh.removeMessageHandler(Z.Vs),this.Rh.removeMessageHandler(Z._s),this.Rh.removeMessageHandler(Z.Es),this.Rh.removeMessageHandler(Z.ys)},this.Oh=t=>{if(!this.Vh)throw new TypeError("VisioApplication:disposeWopiApplication() Visio wopi Application is null");this.Vh.Dispose(t),t||(this.Vh=void 0)},this.Uh=()=>{Gt.dispose()},this.zh=t=>{this.Vh&&this.Vh.IsBootComplete()||!this.isActive()||this.Ns.ULS.ri(587580759,s.K,o.Warning,`Wopi Boot not completed even after ${t} milliseconds`)},this.Sc=()=>this.Na===Ft.EDIT||this.Na===Ft.EDIT_NEW,this.Gh=t=>{this.Na===Ft.EDIT_NEW&&(t&&t.NewFilePath?(Bt(t.NewFilePath),t.UpdatedPageTitle&&(document.title=t.UpdatedPageTitle)):this.Ns.ULS.ri(595722523,s.H,this.Jh?o.Warning:o.Info,"Either NewFileInfo or NewFilePath are not provided for a new file."))},this.fc=t=>{if(-1!==this.rh.applicationUrl.indexOf("embed"))return;let i="";t&&t.RefreshOrigin&&(i=t.RefreshOrigin);let e=window.location.href;xt.getBRSValue(xt.IsToastUserFixEnabledBRSKey)&&e&&(e=f(e,"wdToastUser")),xt.getBRSValue(xt.IsContextAppRefreshFixEnabledBRSKey)&&e&&(e=f(e,"wdActivePageId"),e=f(e,"wdPageScale"),e=f(e,"wdPageCenterX"),e=f(e,"wdPageCenterY")),this.Na===Ft.EDIT?e&&(e=m(e,"action","edit",!0),i&&(e=m(e,"OR",i,!0)),Bt(e)):this.Na===Ft.EDIT_NEW&&e&&(e=m(e,"action","edit",!0),i&&(e=m(e,"OR",i,!0)),e=m(e,"wdNewAndOpenCt","0",!0),Bt(e))},this.vc=t=>{let i=window.location.href;"VIEW"===t.toMode||"EDIT"===t.toMode?(i=m(i,"teamsvisiomode",t.toMode,!0),xt.getBRSValue(xt.IsFormulaeSerializationRollbackEnabled)&&this.Na===Ft.EDIT&&"1"===t.wdDisableFormulae&&(i=m(i,"wdDisableFormulae","1",!0)),window.location.href=i):this.Ns.ULS.ri(593622414,s.K,o.Warning,"Invalid options received in Visio_DocReboot_HostNav message")},this.gc=()=>{let t=window.location.href;t=m(t,"wdreloadsessionid",this.rh.sessionId,!0);const i=this.rh.sessionId;let e=1;Mt(this.rh,"wdreloadcount")&&(e=parseInt(Nt(this.rh,"wdreloadcount"),10)+1),e>xt.getIntegerBRSValue(xt.ReloadOnScriptFailMaxLimitBRSKey,3)?this.Ns.ULS.ri(590455010,s.K,o.Error,"Visio Boot failed for WACSessionID: "+i+" after"+e+"retries"):(t=m(t,"wdreloadcount",String(e),!0),this.Ns.ULS.ri(590455011,s.K,o.Warning,"Refreshing VisioFrame for WACSessionID: "+i+", currentReloadCount: "+e+", UriLen: "+t.length),this.Ns.ULS.flush(),window.location.href=t)},this.jh=t=>{this.Vh=new ai(this.Ua,this.rh,this.Ns,this.Ic,this.bc,this.Tc,this.nc,this.ph,this._n,this.Rh,this.Ah,this.Na,this.isBackground(),this.Qa),this._c&&this._c(this.Vh),this.Ns.ULS.ri(596464071,s.K,o.Info,"Boot VisioWopiApplication"),this.Vh.Boot(t),this.rc&&this.Vh.hideApplicationFrame()},this.ec=()=>{this.Ns.ULS.ri(596464079,s.K,o.Info,"VisioApplication.ShowFirstPage()"),kt(this.rh.applicationUrl)||li.RecordTelemetryData("bootPerf","constGuid","fastViewDuration",hi.TimerBegin,new Date,this.Ns);try{if(this.Cc(this.ic),this.ic.MajorVersion<pi.GetMinContentVersion())return void this.Ns.ULS.ri(596464080,s.K,o.Warning,`Content bundle version: ${this.ic.MajorVersion} is out of date`);this.cc=!0,this.Ec(this.rh.container),this.Ac()}catch(t){this.Ns.ULS.ri(596464081,s.K,o.Error,"Failed to boot from the host cache: "+C(t))}},this.oc=t=>{if(t){this.Ns.ULS.ri(596121056,s.K,o.Info,"VisioApplication.TryPrefetchRemainingContent()");try{if(this.Cc(this.ic),this.ic.MajorVersion<pi.GetMinContentVersion())return void this.Ns.ULS.ri(596121057,s.K,o.Warning,`Content bundle version: ${this.ic.MajorVersion} is out of date`);this.Fc()}catch(t){this.Ns.ULS.ri(596121058,s.K,o.Error,"Failed to pre fetch interactive content from host cache: "+C(t))}}},this.Cc=t=>{if(void 0===t)throw new TypeError("WopiPrecheckInfo.BundleInfo");if(void 0===t.Url)throw new TypeError("WopiPrecheckInfo.BundleInfo.Url");if(void 0===t.MajorVersion)throw new TypeError("WopiPrecheckInfo.BundleInfo.MajorVersion")},this.yc=()=>"",this.Vc=t=>{t.setAttribute("crossorigin","anonymous")},this.Pc=t=>{const i=this.Rc;i.style.top=t+"px",i.style.position="absolute",i.style.height="auto",i.style.borderWidth=Et.ShapePanelBorderWidth+"px",i.style.borderRightStyle="solid",i.style.boxShadow="2px 1px 4px 0 rgba(0,0,0,0.13)",i.style.borderColor="#e1e1e1",i.style.backgroundColor="#f2f2f2",i.style.width=Et.ShapePanelWidthWithoutBorder+"px",i.style.bottom="0px",i.style.overflow="0";const e=document.createElement("div");e.style.top="50%",e.style.left="50%",e.style.position="absolute",e.style.transform="translateX(-50%) translateY(-50%)",e.style.fontSize="9pt",e.style.fontFamily='"Segoe UI", Arial, Verdana, sans-serif',i.appendChild(e);const s=document.createElement("img");s.style.cssFloat="left",s.style.height="16px",s.style.width="16px",this.Vc(s),void 0!==this.xc?s.src=this.xc.getLoadingSpinnerGif():s.style.visibility="hidden",e.appendChild(s);const o=document.createElement("div");return o.style.cssFloat="left",o.style.paddingLeft="10px",o.innerText=this.yc(),e.appendChild(o),i},this.Ec=t=>{this.nc||(this.Mh=document.createElement("div"),this.Mh.id="VisioBootContainer",this.Mh.style.width="100%",this.Mh.style.height="100%",this.Mh.style.visibility="hidden",this.Mh.style.position="absolute",this.Mh.style.backgroundColor="#F3F2F1",this.Mh.style.display="block",this.Mh.style.touchAction="none",this.rc=!1,t.appendChild(this.Mh),this.Wc=document.createElement("div"),this.Wc.style.top=Et.RibbonHeightConsumption+"px",this.Wc.style.left="0px",this.Wc.style.right="0px",this.Wc.style.bottom=Et.StatusbarHeight+"px",this.Wc.style.position="absolute",this.Wc.style.borderTopColor="#C6C6C6",this.Wc.style.borderTopWidth=Et.FishbowlBorderTop+"px",this.Wc.style.borderTopStyle="solid",this.Wc.style.backgroundColor=Ot(this.Na)?"#FFFFFF":"#F9F9F9",this.Mh.appendChild(this.Wc),this.kc=document.createElement("div"),this.kc.id="backgroundPage",this.Wc.appendChild(this.kc),this.Bh=document.createElement("img"),this.Bh.id="foregroundPage",this.Bh.style.visibility="hidden",this.Vc(this.Bh),this.kc.appendChild(this.Bh),this.Yh||(this.Dc=document.createElement("div"),this.Dc.style.top="0px",this.Dc.style.height=Et.HeaderHeight+"px",this.Dc.style.left="0px",this.Dc.style.right="0px",this.Dc.style.position="absolute",xt.getBRSValue(xt.Fluent2StyleIsEnabled)?this.Dc.style.backgroundColor=this.Qh()?"#F3F2F1":"#FFFFFF":this.Dc.style.backgroundColor=this.Qh()?"#F3F2F1":"#3955A3",this.Mh.appendChild(this.Dc)),this.Yh&&!this.tc||(this.Uc=document.createElement("div"),this.Uc.style.top=(this.tc?0:Et.HeaderHeight)+"px",this.Uc.style.height="0px",this.Uc.style.left="0px",this.Uc.style.right="0px",this.Uc.style.position="absolute",this.Uc.style.backgroundColor="#E1E1E1",this.Mh.appendChild(this.Uc),this.Oc=document.createElement("div"),this.Oc.style.top=(this.tc?0:Et.HeaderHeight)+"px",this.Oc.style.height=Et.ToolbarHeightConsumption+"px",this.Oc.style.left="0px",this.Oc.style.right="0px",this.Oc.style.position="absolute",this.Oc.style.backgroundColor="#FFFFFF",this.Mh.appendChild(this.Oc)),this.Rc=document.createElement("div"),this.Mh.appendChild(this.Rc),this.Rc.style.height="0px",this.Bc=document.createElement("div"),this.Bc.style.top=Et.RibbonHeightConsumption+Et.FishbowlBorderTop+"px",this.Bc.style.height=Et.ProgressImageHeight+"px",this.Bc.style.left="0px",this.Bc.style.right="0px",this.Bc.style.position="absolute",void 0!==this.xc&&(this.Bc.style.backgroundImage=`url(${this.xc.getDelayLoadingGif()})`,this.Bc.style.backgroundRepeat="repeat-x"),this.Yh&&(this.Wc.style.top=this.tc?Et.ToolbarHeightConsumption+"px":"0px",this.Bc.style.top=this.tc?Et.ToolbarHeightConsumption+"px":"0px"),this.Mh.appendChild(this.Bc),this.Mc=document.createElement("div"),this.Mc.style.bottom="0px",this.Mc.style.height=Et.StatusbarHeight+"px",this.Mc.style.left="0px",this.Mc.style.right="0px",this.Mc.style.position="absolute",this.Mc.style.borderTopColor="#C6C6C6",this.Mc.style.borderTopWidth=Et.StatusbarBorderTop+"px",this.Mc.style.borderTopStyle="solid",this.Mc.style.backgroundColor="#FFFFFF",this.Mh.appendChild(this.Mc),this.nc=!0),this.Sc()&&this.Nc()},this.Nc=()=>{if(this.Sc()){this.Ns.ULS.ri(596456520,s.K,o.Info,"Adjusting Boot container for Edit View"),this.Yh&&this.Ns.ULS.ri(596129762,s.K,o.Warning,"No chrome mode encountered in Edit App");const t=this.Yh?Et.RibbonHeightNoChrome:Et.RibbonHeightEdit;this.Yh?this.Wc.style.top=Et.RibbonHeightNoChrome+"px":(this.Wc.style.top=Et.RibbonHeightEdit+"px",this.Oc.style.height=Et.ToolbarLowerHeightEdit+"px",this.Oc.style.top=Et.HeaderHeight+Et.ToolbarUpperHeightEdit+"px",this.Uc.style.height=Et.ToolbarUpperHeightEdit+"px",this.Uc.style.backgroundColor="#F4F4F4",this.Oc.style.backgroundColor="#F4F4F4"),this.Bc.style.top=t+Et.FishbowlBorderTop+"px",this.Wc.style.left=Et.ShapePanelWidthWithBorder+"px",this.Mc.style.left=Et.ShapePanelWidthWithBorder+"px",this.Pc(t)}},this.Hc=()=>{this.nc&&(this.Ns.ULS.ri(596449229,s.K,o.Info,"Disabling boot container"),this.nc=!1,this.Vh&&this.Vh.showApplicationFrame(),this.Lc(),this.uc=!0,this.Ns.ULS.ri(595935319,s.K,o.Info,"Ready to send doc data empty response."),this.pc&&this.Vh&&this.Vh.sendWACDataPostMessage(this.$c),this.Vh&&this.Vh.notifyFastPreviewFailed())},this.Lc=()=>{this.Mh&&(this.Mh.style.display="none",this.rc=!1)},this.Jc=t=>{if(this.nc&&(this.Ns.ULS.ri(596449230,s.K,o.Info,"Switching to Wopi App"),this.Vh&&this.Vh.showApplicationFrame(),window.setTimeout(this.Lc,0)),t){const i=parseInt(t[Gt.maxStorageQuotaSettingName],10),e=parseInt(t[Gt.minEvictTimePeriodSettingName],10);i>0?this.ph&&(window.setTimeout(()=>this.ph.SaveDocument(this.Gc,this.jc),Gt.documentSaveIdleTimeInMs),window.setTimeout(()=>Gt.EvictStaleCache(1024*i*1024,24*e*60*60*1e3,this.Ns),Gt.cacheEvictIdleTimeInMs)):(this.Ns.ULS.ri(595903509,s.K,o.Info,"Evicting all cache as per app settings."),Gt.EvictStaleCache(0,0,this.Ns))}},this.Ac=()=>{const t=R(),i=this.qc(this.ic.Url,At.FastViewJson),e=t=>this.zc(t),n=()=>this.Kc();if(this.Bh.onload=()=>{const i=R()-t;this.Ns.ULS.ri(596464084,s.K,o.Info,`Time spent in getting Image response: ${i}(ms)`),n()},this.Bh.onerror=()=>{this.Ns.ULS.ri(596464085,s.K,o.Error,"Failed to download the first page image"),this.cc=!1,this.dc=!1,this.Hc()},(!xt.getBRSValue(xt.IsFastViewCacheInTeamsDisabled)||N()!==U.TeamsElectron)&&this.ph&&this.ph.IsCacheAvailable())return this.dc=!0,this.qh=()=>this.ph.DecryptAndValidate((t,i)=>{this.jc=i,this.Bh.setAttribute("src",this._ImageDataFormat.replace("{0}",i)),e(t)},()=>{this.cc=!1,this.dc=!1,this.ph.DeleteDocument(),this.Hc()}),void(this.Kh&&(this.Xc=!0));Ct.sendXmlHttpRequest("GET",i,!0,t=>{e(t),this.Ns.ULS.ri(596464082,s.K,o.Info,"Successfully handled doc view response")},()=>{this.Ns.ULS.ri(596464083,s.K,o.Error,"Failed to get doc view response"),this.cc=!1,this.Hc()},At.FastViewJson,this.Ns),this.Bh.src=this.qc(this.ic.Url,At.FastViewImage),this.Xc=!0},this.Fc=()=>{const t=window.devicePixelRatio>ai.highDpiThreshold?At.docInfoHighDpi:At.docInfoNormal,i=this.qc(this.ic.Url,t);Ct.sendXmlHttpRequest("GET",i,!0,t=>{this.Ns.ULS.ri(596121059,s.K,o.Info,"Received doc info json response. Size: "+t.length)},()=>{this.Ns.ULS.ri(596121088,s.K,o.Error,"Failed to get doc info response")},t,this.Ns,!0)},this.zc=t=>{try{this.Gc=t,this.Zc=JSON.parse(t),null==this.Zc.Width&&(this.Ns.ULS.ri(596115793,s.K,o.Info,"New format of doc view. Filling the old params."),this.Zc.Width=this.Zc.Pages[0].PageImage.Width,this.Zc.Height=this.Zc.Pages[0].PageImage.Height,this.Zc.OffsetX=this.Zc.Pages[0].PageImage.OffsetX,this.Zc.OffsetY=this.Zc.Pages[0].PageImage.OffsetY,this.Zc.Scale=this.Zc.Pages[0].PageImage.Scale)}catch(t){return this.Ns.ULS.ri(596464086,s.K,o.Error,"Unable to parse JSON response: "+C(t)),void this.Hc()}this.Yc=this.Qc(this.Zc.PageWidth,this.Zc.PageHeight),this.td(this.Zc.PageWidth,this.Zc.PageHeight,this.Yc),this.ed(this.Zc.Height,this.Zc.OffsetX,this.Zc.OffsetY,this.Yc)},this.Tc=t=>(this.Ns.ULS.ri(595935320,s.K,o.Info,"WAC is ready to receive Doc Data."),this.pc=!0,!this.uc&&this.Xc||this.Vh.sendWACDataPostMessage(this.$c),t),this.Kc=()=>{this.ac=!0,this.hc&&this.Lh()},this.Qc=(t,i)=>{const e=96*Et.FishbowlMarginInches,s=96*Et.FishbowlMarginInches,o=(this.Wc.offsetWidth-e)/(96*t),n=(this.Wc.offsetHeight-s)/(96*i);return Math.min(o,n)},this.td=(t,i,e)=>{const s=this.Wc.offsetWidth-96*t*e,o=this.Wc.offsetHeight-96*i*e;this.kc.style.width=96*t*e+"px",this.kc.style.height=96*i*e+"px",this.kc.style.backgroundColor="white",Ot(this.Na)||(this.kc.style.borderColor="#C6C6C6",this.kc.style.borderWidth="1px",this.kc.style.borderStyle="solid",this.kc.style.boxShadow="0px 0px 20px #C6C6C6"),this.kc.style.position="absolute",this.kc.style.top=o/2+"px",this.kc.style.left=s/2+"px"},this.ed=(t,i,e,s)=>{this.Bh.style.position="absolute",this.Bh.style.left=96*i*s+"px",this.Bh.style.top=this.kc.clientHeight-96*(t+e)*s+"px",this.hc=!0,this.ac&&this.Lh()},this.Lh=()=>{if(this.Vh&&this.Vh.IsBootComplete())this.Ns.ULS.ri(596129763,s.K,o.Warning,"WOPI Boot already completed, not switching to Fast View");else if(this.Vh&&this.Vh.IsPageViewLoaded())this.Ns.ULS.ri(595969243,s.K,o.Warning,"WOPI Page View already loaded, not switching to Fast View");else{if(xt.getBRSValue(xt.FastViewForMRUFixEnabledBRSKey)&&this.Wh!==ci.Active)return this.Ns.ULS.ri(592470212,s.K,o.Info,"MakeFastViewVisible called in inactive VisioApplication, skipping it for now"),void(this.Hh=!0);if(this.sd=this.Bh.height,this.od=this.Bh.width,this.Bh.width=96*this.Zc.Width*this.Yc,this.Bh.height=96*this.Zc.Height*this.Yc,this.Bh.style.visibility="visible",this.Mh.style.display="block",this.Mh.style.visibility="visible",this.rc=!0,this.Vh&&this.Vh.hideApplicationFrame(),this.nd=new Date,this.lc=!0,this.Ns.ULS.ri(596453598,s.K,o.Info,"Fast View Visible (PLT) Time: "+this.nd.getTime()),this.Na===Ft.EDIT&&this.rd){const t=this.nd.getTime()-this.rd;this.Ns.ULS.ri(596452765,s.K,o.Info,"Fast View Switch To Edit Visible (PLT) Time: "+t)}window.setTimeout(this.ad,15e3),(!this.jc||this.jc.length<=0)&&(this.jc=Ht(this.Bh,this.od,this.sd)),this.$c[At.FastViewImage]=this.jc,this.$c[At.FastViewJson]=this.Gc,this.uc=!0,this.Ns.ULS.ri(595935321,s.K,o.Info,"Doc Data is ready to send with Post Message."),this.pc&&this.Vh.sendWACDataPostMessage(this.$c),this.Ns.ULS.ri(595907484,s.K,o.Info,"Loaded from browser cache: "+this.dc)}},this.ad=()=>{this.Vh&&!this.Vh.IsBootComplete()&&(this.Ns.ULS.ri(596129792,s.K,o.Warning,"WOPI boot taking too long, time since FastView: 15000"),this.Jc(null))},this.Ic=(t,i)=>{this.Ns.ULS.ri(596457106,s.K,o.Info,"Initialization succeeded Time: "+R()),i&&i.VisioEarlyToolbarEnabled&&"true"===i.VisioEarlyToolbarEnabled.toString().toLowerCase()?this.Ns.ULS.ri(595654606,s.K,o.Verbose,"Early toolbar enabled, so skipping switching to visioframe here"):this.Jc(i),t.cacheAboutToExpire=!1,this.cc&&!t.cacheHit&&(t.cacheAboutToExpire=!0),t.cacheHit=this.cc,t.documentLoadedFromWopiPrecheckInfo=this.lc,this.lc&&(t.documentLoadedTime=this.nd.getTime()),this.Nh.stop();const e=this.Nh.getVisibilityChangeEvents();if(null!=e&&e.length>0){for(const i of e)if("hidden"===(null==i?void 0:i.visibility)){t.documentLoadedWithTabSwitch=!0;break}this.Ns.ULS.ri(596457107,s.K,o.Info,"Visibility Change Events:"+JSON.stringify(e))}this.rh.pageStateObserver.dispose(),this.rh.fnOnInitializeSuccess(this,t),this.hd(t),q("visio",this.Ns),this.Ns.ULS.flush(),V(this.rh.remoteTelemetryUrl,"Visio","bootSuccess")},this.bc=(t,i)=>{this.Ns.ULS.ri(596464088,s.K,o.Error,"Initialize failed due to error "+JSON.stringify(t)),this.Jc(null),i.cacheHit=this.cc,i.documentLoadedFromWopiPrecheckInfo=this.lc,this.Nh.stop(),this.rh.pageStateObserver.dispose(),this.rh.fnOnInitializeFailure({errorType:st.AppInitError,errorObject:t},i),this.hd(i),this.Ns.ULS.flush(),V(this.rh.remoteTelemetryUrl,"Visio","bootFailure")},this.qc=(t,i)=>{if(!t||-1===t.indexOf("{0}"))throw new TypeError("invalid content URL");if(!i)throw new TypeError("invalid content id");return decodeURI(t).replace("{0}",i)},this.hd=t=>{var i,e,n,r,a;t&&(kt(this.rh.applicationUrl)||ui(this.rh.diagnostics.HostInitDiagnostics,t,this.Ns),this.Ns.ULS.ri(595981388,s.K,o.Info,JSON.stringify({BootDiagnostics:t,hostDiagnostics:this.rh.diagnostics.HostInitDiagnostics,navigationStartTime:Lt(),isJSAPIV2:"false",localCacheHit:this.dc?"true":"false",compressedView:this.Zc&&this.Zc.IsCompressed?"true":"false",backgroundBoot:kt(this.rh.applicationUrl),appMode:this.Na.toString()})),window._pageTimings=null!==(i=window._pageTimings)&&void 0!==i?i:{},t.documentLoadedTime&&null!==(e=this.rh.diagnostics.HostInitDiagnostics)&&void 0!==e&&e.hostInitializeCallTime&&(window._pageTimings.Visio_Perf_PLT=t.documentLoadedTime-(null===(r=this.rh.diagnostics.HostInitDiagnostics)||void 0===r?void 0:r.hostInitializeCallTime)),t.appCompletedTime&&null!==(n=this.rh.diagnostics.HostInitDiagnostics)&&void 0!==n&&n.hostInitializeCallTime&&(window._pageTimings.Visio_Perf_ILT=t.appCompletedTime-(null===(a=this.rh.diagnostics.HostInitDiagnostics)||void 0===a?void 0:a.hostInitializeCallTime)))},this.wc=t=>{this.Ns.ULS.ri(595654607,s.K,o.Info,""+JSON.stringify(t)),(this.Xh&&this.Na===Ft.EDIT||t&&t.Settings&&t.Settings.VisioEarlyToolbarEnabled&&"true"===t.Settings.VisioEarlyToolbarEnabled.toString().toLowerCase())&&this.Jc(t.Settings)},this.dd=new Date,this.rh=t,this.xc=n,this.Nh=e,this.Ns=i,this.Na=r,this.Rh=h,this._n=a,this.Wh=d,this.Ah=new it(i),this.mc=p(this.rh.applicationUrl,"uih"),this.mc&&(this.mc=this.mc.toLowerCase()),this.Hh=!1,this.Qa=l,this.Ns.ULS.ri(596457105,s.K,o.Info,"Created visio application Time: "+this.dd.getTime()),this.$c={},this.Xc=!1,Promise&&(this.$h=new Promise(t=>this._c=t));let u=-1!==t.applicationUrl.indexOf("wdDisableBCache");var w;t.sessionInformation&&t.sessionInformation.WdParams&&(u=void 0!==t.sessionInformation.WdParams.wdDisableBCache),u||(this.ph=Gt.Create(t.sessionInformation.UserId,null===(w=t.wopiInfo)||void 0===w?void 0:w.WopiSrc,t.wopiPrecheckInfo.ETag,i)),this.Jh=pi.isInstantBootMode(this.Na,this.rh.applicationUrl),this.Dh=c,this.isBackground()||this.xh()}}class mi{getDelayLoadingGif(){return this.ld?this.ud+"/wise/owl/delay.gif":`${this.ud}/v/s/${this.pd}_resources/1033/delay.gif`}getLoadingSpinnerGif(){return this.ld?this.ud+"/wise/owl/progress.gif":`${this.ud}/v/s/${this.pd}_resources/1033/progress16.gif`}constructor(t,i){this.ld=!!i&&function(t){return!!t.includes("wise")}(i),this.ud=c(this.ld&&i?i:t),this.pd=this.ld?"":function(t){if(!t)throw new Error("Build number not available");const i=t.split(".");if(4!==i.length)throw new Error("Build number has incorrect format");return i[0]+i[2]+i[3]}(T())}}class wi{registerEventHandler(t){this._n.push(t)}removeEventHandler(t){if(t){const i=this._n.indexOf(t);this._n.splice(i,1)}}stop(){document.removeEventListener("visibilitychange",this.md)}getVisibilityChangeEvents(){return this.fd}dispose(){this.stop(),this._n=[],this.fd=[]}constructor(){if(this.fd=[],this._n=[],this.md=()=>{const t={visibility:document.visibilityState,time:R(),initialState:!1};this.fd.push(t);for(const i of this._n)i&&i(t)},"hidden"===document.visibilityState){const t={visibility:document.visibilityState,time:R(),initialState:!0};this.fd.push(t)}document.addEventListener("visibilitychange",this.md)}}class fi{buildApplication(){return this.gd(ci.Active)}dispose(){this.vd&&(this.vd.Dispose(),this.vd=null),this.Sd()}constructor(t,i,e,n,r,a,h){if(this.vd=null,this.Id=null,this.bd=null,this.Td=null,this._d=null,this._n={},this.Cd=()=>{const t=this.Ed;let i=t.applicationUrl;if("consumptionview"!==p(i.toLowerCase(),"visioview"))throw new TypeError("applicationUrl does not have VisioView=ConsumptionView query param");i=m(i,"VisioView","EditView",!0),i=m(i,"backgroundsession","1",!0),t.applicationUrl=m(i,"wdIsModeSwitch","1",!0);const[e,n]=E();t.sessionId=e;const r=O({remoteUlsEndpoint:this.Ed.applicationBasePath+"RemoteUls.ashx",sessionId:e,uploadCadenceInMs:gi}),a=JSON.parse(JSON.stringify(t.sessionInformation));delete a.OwnerId,delete a.SiteId,delete a.TenantId,delete a.UserId,delete a.Upn,delete a.WebId,r.ULS.ri(595682589,s.K,o.Info,`VisioApplicationManager - initializing background Edit session.\n      Init Time: ${R()},\n      newGuidLogging: ${JSON.stringify(n)},\n      loggableSessionInfo: ${JSON.stringify({hostSessionInformation:a})}`),this.bd=t,this.Td=r,this._d=Ft.EDIT},this.gd=t=>{const i=t===ci.Background;this.Ns.ULS.ri(595682590,s.K,o.Info,`Visio Application Manager appMode: ${this.Na}, isBackground: ${i}`);let e=this.Ns,n=this.Ed;try{const s=this.ua;let o=this.Na;i&&(this.Cd(),n=this.bd,e=this.Td,o=this._d);const r=new pi(n,e,this.Nh,this.xc,o,this._n,s,this.appUnloadHandler,t);return i?this.Id=r:(this.vd=r,this.vd.addTimerTagForBoot(12e4)),r.Boot(),r}catch(t){return this.Ns.ULS.ri(595682591,s.K,o.Error,`Background Edit App ${st.AppInitError}: ${C(t)}`),e&&e.ULS.flushOnClose(),void n.fnOnInitializeFailure({errorType:st.AppInitError,errorObject:t})}},this.appUnloadHandler=()=>{this.vd&&this.vd.isActive()&&this.vd.Dispose(!0)},this.Ad=()=>{if(this.Fd(rt.gn),this.Ns.ULS.ri(595682592,s.K,o.Info,"ApplicationManager Visio ViewFrame CLTComplete PostMessage Received"),this.Na!==Ft.VIEW)throw new TypeError("Active Visio Application mode is not view but received ConsumptionCLTCompletePost Message");const t=this.vd.getWopiInfo();if(!t)throw new TypeError("ApplicationManager wopiInfo is null");if(this.Ns.ULS.ri(595682593,s.K,o.Info,"Building Background Edit VisioApplication"),this.gd(ci.Background),!this.Id)throw new TypeError("After BuildApplication backgroundEditApp is null");this.Id.Complete(t,this.vd.getNewFileInfo())},this.yd=()=>{this.Id?this.Sd():this.Ns.ULS.ri(595642373,s.K,o.Warning,"handleVisioViewDisposeBkgFrame backgroundEditApp is null")},this.Vd=t=>{if(this.Fd(rt.vn),this.Ns.ULS.ri(595682594,s.K,o.Info,"ApplicationManager Received SwitchMode PostMessage from Visio View Frame appMode:"+this.Na),!this.Id)return this.Ns.ULS.ri(595682466,s.K,o.Warning,"handleVisioViewFrameSwitchMode backgroundEditApp is null"),void this.Fd(rt.In);this.Td?this.Id.updateVisibilityMetrics(new wi):this.Ns.ULS.ri(595616995,s.K,o.Warning,"handleVisioViewFrameSwitchMode bgLogger is null"),this.vd.unregisterAppLevelPostMessageHandlers(),this.Id.registerAppLevelPostMessageHandlers(),this.vd.removeFastView(),this.Id.updateModeSwitchClickTime(),this.Id.showFasttViewForEditApp(),this.Id.resetInnerApplicationFrameId(),this.Id.addTimerTagForBoot(12e4),this.ua.registerMessagePayloadHandler(Z.Ts,this.Pd),this.Rd(rt.Sn,t)},this.Rd=(t,i)=>{this.xd(t,i,1)},this.xd=(t,i,e)=>{if(e>3)switch(this.Ns.ULS.ri(595650624,s.H,o.Error,`Attempted to call mode switch, but received no ack from the frame. MessageId: ${t}, Time: ${R()}`),t){case rt.Sn:if(!this.Wd)return this.Ns.ULS.ri(595650625,s.H,o.Error,"Falling back to legacy way of switching for message timeout. Message: "+t),void this.Fd(rt.In);break;default:return void this.Ns.ULS.ri(595650626,s.H,o.Warning,"Invalid message. MessageId: "+t)}this.Ns.ULS.ri(595650627,s.H,o.Info,`Sending mode switch message to frame. MessageId: ${t}, Attempt number: ${e}, Time: ${R()}`),this.kd(t,i),window.setTimeout(()=>this.Dd(t,i,e),1e3)},this.Dd=(t,i,e)=>{switch(t){case rt.Sn:if(this.Wd)return;break;default:return void this.Ns.ULS.ri(595650628,s.H,o.Warning,"Invalid message. MessageId: "+t)}this.Ns.ULS.ri(595650629,s.H,o.Info,"Timed out with no ack. MessageId: "+t),this.xd(t,i,e+1)},this.Fd=(t,i=null)=>{if(!this.vd)throw new TypeError("visio Active Application is null");if(!this.vd.getInnerApplicationFrame())throw new TypeError("visio Active Application Frame is null");this.ua.sendPostMessage(this.vd.getInnerApplicationFrame(),t,i)},this.kd=(t,i=null)=>{if(!this.Id)throw new TypeError("visio Background Edit Application is null");if(!this.Id.getInnerApplicationFrame())throw new TypeError("visio Background Edit Application Frame is null");this.ua.sendPostMessage(this.Id.getInnerApplicationFrame(),t,i)},this.Ud=()=>{if(!this.vd||!this.Id)throw new TypeError("HandleEditILTCompletePostMessage visioApplicationActive or backgroundEditApp is null");this.vd.Dispose(),this.vd=null,this.Id.activate(),this.vd=this.Id,this.Ns=this.Td,this.Na=this._d,this.Ed=this.bd,this.Id=null,this.Td=null,this._d=null,this.bd=null},this.Pd=t=>{if(this.Ns.ULS.ri(595682624,s.K,o.Info,"ApplicationManager Visio_ACK_ModeSwitch_ToHost Received on ack to Visio_SwitchMode_FromHostFrame"),this.Wd=!0,t){if(t.IsSuccess)return void this.Ud();this.Ns.ULS.ri(595645409,s.K,o.Warning,""+JSON.stringify(t))}this.Fd(rt.In)},this.Sd=()=>{this.Id&&(this.Id.Dispose(),this.Id=null)},this.Ed=t,this.Ns=i,this.Nh=e,this.xc=n,this.Na=r,this.ua=a,this._n=h,this.Wd=!1,this.mc=p(this.Ed.applicationUrl,"uih"),this.mc&&(this.mc=this.mc.toLowerCase()),r!==Ft.VIEW)throw new TypeError("VisioApplicationManager appMode is not view");this.ua.registerMessagePayloadHandler(Z.Is,this.Ad),this.ua.registerMessagePayloadHandler(Z.bs,this.Vd),this.ua.registerMessagePayloadHandler(fi.Od,this.yd)}}fi.Od="Visio_DisposeBkgFrame",function(t){t[t.Active=0]="Active",t[t.Background=1]="Background",t[t.Disposed=2]="Disposed"}(ci||(ci={})),function(t){t[t.Fastfood=0]="Fastfood",t[t.MSIT=1]="MSIT",t[t.Production=2]="Production"}(di||(di={}));const gi=6e4;var vi,Si,Ii;!function(t){t.Unknown="UNKNOWN",t.Initialized="INITIALIZED",t.Prebooted="PREBOOTED",t.Booting="BOOTING",t.Booted="BOOTED",t.Failed="FAILED",t.Disposing="DISPOSING",t.Disposed="DISPOSED"}(vi||(vi={})),function(t){t.appReboot="appReboot",t.boot="boot",t.closeTab="closeTab",t.createNew="createNew",t.dispose="dispose",t.frameTrust="frameTrust",t.getAuthToken="getAuthToken",t.getHostKeyValue="getHostKeyValue",t.handleBootState="handleBootState",t.postWacToken="postWacToken",t.rename="rename",t.setOverlayContent="setOverlayContent",t.storeHostKeyValue="storeHostKeyValue",t.switchMode="switchMode",t.updateBootComplete="updateBootComplete",t.setWacFlightValue="setWacFlightValue"}(Si||(Si={})),function(t){t.AccessibilityLoopCompleted="AccessibilityLoopCompleted",t.ActionCompleted="ActionCompleted",t.BrowserEvent="BrowserEvent",t.CAAEMessage="CAAEMessage",t.Close="Close",t.InitEnd="InitEnd",t.Conversation="Conversation",t.CopyAndEdit="CopyAndEdit",t.CreateNewDocument="CreateNewDocument",t.Download="Download",t.Edit="Edit",t.Error="Error",t.FileEmbed="FileEmbed",t.FileProperties="FileProperties",t.FileRenamed="FileRenamed",t.FileVersions="FileVersions",t.FrameStateChanged="FrameStateChanged",t.FrameTrust="FrameTrust",t.GetAccessToken="GetAccessToken",t.GetAuthToken="GetAuthToken",t.GetCustomAuthConfig="GetCustomAuthConfig",t.GetWopiInfoFromUrl="GetWopiInfoFromUrl",t.GetDavUrlFromIds="GetDavUrlFromIds",t.ModeSwitched="ModeSwitched",t.MoveToFolder="MoveToFolder",t.OpenInMobileApp="OpenInMobileApp",t.OpenInBrowser="OpenInBrowser",t.OpenInClient="OpenInClient",t.PageChanged="PageChanged",t.PushState="PushState",t.Reboot="Reboot",t.RedeemForCommenting="RedeemForCommenting",t.RefreshSessionInfo="RefreshSessionInfo",t.ReplyWithChanges="ReplyWithChanges",t.ReportAbuse="ReportAbuse",t.SharedFilePicker="SharedFilePicker",t.SaveStatus="SaveStatus",t.Share="Share",t.ShareForm="ShareForm",t.SignIn="SignIn",t.SplashScreenShown="SplashScreenShown",t.UserAccessAndPermissions="UserAccessAndPermissions",t.UserActivity="UserActivity",t.UserEditActivity="UserEditActivity",t.Workflow="Workflow",t.ZoomChanged="ZoomChanged",t.AcquireOAuthTokenTeams="AcquireOAuthTokenTeams",t.LoadingStatus="LoadingStatus",t.SwitchNotebook="SwitchNotebook",t.FailedBootCheckFileInfo="FailedBootCheckFileInfo",t.GetTeamsUsers="GetTeamsUsers",t.SendTeamsUserMention="SendTeamsUserMention",t.NavigateBackToHost="NavigateBackToHost",t.GetClientUrlComplete="GetClientUrlComplete",t.GetWebUrlComplete="GetWebUrlComplete",t.CopyLinkComplete="CopyLinkComplete",t.SendConversationId="SendConversationId",t.CloseTeamsConversation="CloseTeamsConversation",t.PageLoaded="PageLoaded",t.FrameChanged="FrameChanged",t.PrintRedirect="PrintRedirect",t.RequestFullScreen="RequestFullScreen"}(Ii||(Ii={}));const bi={[nt.boot]:{Bd:Si.boot},[nt.createNew]:{Bd:Si.createNew},[nt.dispose]:{Bd:Si.dispose},[nt.postWacToken]:{Bd:Si.postWacToken},[nt.rename]:{Bd:Si.rename},[nt.switchMode]:{Bd:Si.switchMode},[Z.ji]:{Bd:Si.handleBootState},[Z.Xi]:{Bd:Si.closeTab},[Z.de]:{Bd:Si.frameTrust},[Z.ue]:{Bd:Si.getAuthToken},[Z.me]:{Bd:Si.getHostKeyValue},[Z.Ae]:{Bd:Si.appReboot},[Z.Ds]:{Bd:Si.setWacFlightValue},[Z.ke]:{Bd:Si.setOverlayContent},[Z.Be]:{Bd:Si.storeHostKeyValue},[Z.Le]:{Bd:Si.updateBootComplete},[nt.blurFocus]:{Md:rt.Ro},[nt.continueAccessibilityLoop]:{Md:rt.Uo},[nt.grabFocus]:{Md:rt.Oo},[nt.moveToFolder]:{Md:rt.Se},[nt.popState]:{Md:rt.Lo},[nt.sendChannelId]:{Md:rt.$o},[nt.sendConvId]:{Md:rt.Jo},[nt.teamsUsersReply]:{Md:rt.Go},[nt.teamsUserMentionReply]:{Md:rt.jo},[nt.backButtonPressed]:{Md:rt.qo},[nt.getClientUrl]:{Md:rt.zo},[nt.getWebUrl]:{Md:rt.Ko},[nt.sendAccessToken]:{Md:rt.Zo},[nt.sendAuthToken]:{Md:rt.Yo},[nt.sendHWRTelemetry]:{Md:rt.fn},[nt.sendCustomAuthConfig]:{Md:rt.Qo},[nt.sendDavUrl]:{Md:rt.nn},[nt.sendEmbeddedViewUrl]:{Md:rt.in},[nt.sendFrameTrustResult]:{Md:rt.de},[nt.sendSessionInfo]:{Md:rt.en},[nt.sendUserAccessAndPermissions]:{Md:rt.sn},[nt.sendWopiInfo]:{Md:rt.on},[nt.signalShared]:{Md:rt.wn},[nt.completeSharedFilePicker]:{Md:rt.Re},[Z.Li]:{Nd:Ii.AccessibilityLoopCompleted},[Z.$i]:{Nd:Ii.ActionCompleted},[Z.zi]:{Nd:Ii.BrowserEvent},[Z.Ke]:{Nd:Ii.CAAEMessage},[Z.Ki]:{Nd:Ii.Close},[Z.Zi]:{Nd:Ii.Conversation},[Z.Yi]:{Nd:Ii.CopyAndEdit},[Z.Qi]:{Nd:Ii.CreateNewDocument},[Z.ie]:{Nd:Ii.Download},[Z.ee]:{Nd:Ii.Edit},[Z.se]:{Nd:Ii.Error},[Z.oe]:{Nd:Ii.FileEmbed},[Z.ne]:{Nd:Ii.FileProperties},[Z.re]:{Nd:Ii.FileRenamed},[Z.he]:{Nd:Ii.FileVersions},[Z.le]:{Nd:Ii.GetAccessToken},[Z.fe]:{Nd:Ii.GetDavUrlFromIds},[Z.pe]:{Nd:Ii.GetCustomAuthConfig},[Z.we]:{Nd:Ii.GetWopiInfoFromUrl},[Z.ce]:{Nd:Ii.FrameStateChanged},[Z.ve]:{Nd:Ii.ModeSwitched},[Z.Se]:{Nd:Ii.MoveToFolder},[Z.Ie]:{Nd:Ii.OpenInMobileApp},[Z.be]:{Nd:Ii.OpenInBrowser},[Z.Te]:{Nd:Ii.OpenInClient},[Z._e]:{Nd:Ii.PageChanged},[Z.Ee]:{Nd:Ii.PushState},[Z.Fe]:{Nd:Ii.RedeemForCommenting},[Z.ye]:{Nd:Ii.RefreshSessionInfo},[Z.Ve]:{Nd:Ii.ReplyWithChanges},[Z.Re]:{Nd:Ii.SharedFilePicker},[Z.Pe]:{Nd:Ii.ReportAbuse},[Z.xe]:{Nd:Ii.SaveStatus},[Z.De]:{Nd:Ii.Share},[Z.Ue]:{Nd:Ii.ShareForm},[Z.Oe]:{Nd:Ii.SignIn},[Z.Je]:{Nd:Ii.UserAccessAndPermissions},[Z.Ge]:{Nd:Ii.UserActivity},[Z.je]:{Nd:Ii.UserEditActivity},[Z.qe]:{Nd:Ii.Workflow},[Z.ze]:{Nd:Ii.ZoomChanged},[Z.ns]:{Nd:Ii.AcquireOAuthTokenTeams},[Z.ge]:{Nd:Ii.LoadingStatus},[Z.as]:{Nd:Ii.SwitchNotebook},[Z.hs]:{Nd:Ii.FailedBootCheckFileInfo},[Z.cs]:{Nd:Ii.GetTeamsUsers},[Z.ds]:{Nd:Ii.SendTeamsUserMention},[Z.ls]:{Nd:Ii.NavigateBackToHost},[Z.us]:{Nd:Ii.GetClientUrlComplete},[Z.ps]:{Nd:Ii.GetWebUrlComplete},[Z.ms]:{Nd:Ii.CopyLinkComplete},[Z.ws]:{Nd:Ii.SendConversationId},[Z.fs]:{Nd:Ii.CloseTeamsConversation},[Z.gs]:{Nd:Ii.PageLoaded},[Z.Ws]:{Nd:Ii.InitEnd},[Z.ks]:{Nd:Ii.SplashScreenShown},[Z.Us]:{Nd:Ii.PrintRedirect},[Z.Os]:{Nd:Ii.RequestFullScreen}};class Ti{get diagnostics(){return{hostInitDiagnostics:this.hostInitDiagnostics,appInitDiagnostics:this.appInitDiagnostics}}raiseEvent(t,i){this.logger.ULS.ri(574654541,s.H,o.Info,"Raising event: "+t);try{this.Hd(t,i)}catch(t){this.logger.ULS.ri(593506838,s.H,o.Error,"Event handler error: "+C(t))}}addActionHandler(t,i){this.Ld[t]||(this.Ld[t]=[]),this.Ld[t].push(i)}removeActionHandler(t,i){const e=this.Ld[t];if(e&&e.length>0){const t=e.indexOf(i);t>-1&&e.splice(t,1)}}run(t,i,e){if(this.state===vi.Disposed&&this.backgroundSession)return this.logger.ULS.ri(525203609,s.H,o.Info,"Redirecting to background session: "+t),this.backgroundSession.run(t,i,e);const n=[],r=this.Ld[t];if(r&&r.length>0)n.push(this.$d(t,i));else{const r=bi[t];if(r){const a=r.Bd,h=r.Md;if(a){this.logger.ULS.ri(574654542,s.H,o.Info,"Running flow: "+a);const r=this.Jd[a](t,i,this,this.Gd[a],e).catch(t=>(this.jd(a,t),{completion:"failure",errorSource:"jsapi",error:t}));n.push(r)}else h&&(this.container&&this.container.postMessage(h,i),n.push(Promise.resolve({completion:"success"})))}else n.push(Promise.resolve({completion:"failure"})),this.logger.ULS.ri(593500189,s.H,o.Warning,"Unhandled command: "+t)}return Promise.race(n)}dispose(){if(this.successTime=0,this.failureTime=0,this.timeoutTime=0,this.ai.dispose(),this.pageStateObserver.dispose(),this.authTokenTrustValidator.dispose(),this.Ld={},!this.pendingReboot){const t=this.application.sessions,i=t.indexOf(this.session);i>-1&&t.splice(i,1)}}constructor(t,i,e,n,r,a,h){var c;this.successTime=0,this.failureTime=0,this.timeoutTime=0,this.pendingReboot=!1,this.skipWopiValidation=!1,this.skipFileNameCheck=!1,this.appContext={},this.isLoggerFromOwl=!1,this.appUrl="",this.appBaseUrl="",this.appBasePath="",this.remoteTelemetryUrl="",this.Ld={},this.onMessage=t=>{const i=t.MessageId,e=t.Values||{},n=this.Ld[i];if(n&&n.length>0)this.$d(i,e);else{const n=bi[i];if(n){const r=n.Bd,a=n.Nd;r?(this.logger.ULS.ri(574654543,s.H,o.Info,"Running flow: "+r),this.Jd[r](i,e,this,this.Gd[r]).catch(t=>{this.jd(r,t)})):a&&(a===Ii.Share&&(e.sendTimeAsClickTime=t.SendTime),this.raiseEvent(a,e))}}},this.jd=(t,i)=>{this.logger.ULS.ri(596459925,s.H,o.Error,`${t} flow error: ${C(i)}`),this.remoteTelemetryUrl&&V(this.remoteTelemetryUrl,this.appInfo.name,"flowException")},this.$d=(t,i)=>{this.logger.ULS.ri(574654544,s.H,o.Info,"Dispatching action: "+t);const e=this.Ld[t].slice().reverse();for(let n=e.length-1;n>-1;n-=1)try{e[n](t,i)}catch(i){this.logger.ULS.ri(596444186,s.H,o.Error,`${t} action handler error: ${C(i)}`)}return Promise.resolve({completion:"success"})},this.state=vi.Unknown;const[d,l]=E();this.isLoggerFromOwl=!!e.logger,this.logger=null!==(c=e.logger)&&void 0!==c?c:O(),this.logger.ULS.ri(593506837,s.H,o.Info,JSON.stringify(l)),this.sessionId=d,this.hostSessionId=e.hostSessionId,this.host=t.host,this.hostName=this.host.uiHostName||this.host.storageHostName,this.user=t.user,this.bootstrapperUrl=t.bootstrapperUrl,this.ui=t.ui||{},this.viewMode=t.viewMode,this.application=n,this.appInfo=i,this.session=r,this.featureManager=dt(t.host.capabilities&&t.host.capabilities.isFeatureEnabledCallback,this.logger),this.ai=new ct(i.name,this.logger),this.preloader=i.preloader,[this.Jd,this.Gd]=a(this.featureManager),this.Hd=h,this.clientDiagnostics=K(),this.pageStateObserver=new ut(this.logger,!0),this.authTokenTrustValidator=new it(this.logger)}}class _i{get id(){return this.qd.sessionId}get diagnostics(){return this.qd.diagnostics}run(t,i,e){return this.qd.run(t,i,e)}boot(t,i){return this.qd.run(nt.boot,t,i)}dispose(t){return this.qd.run(nt.dispose,void 0,t)}constructor(t,i,e,s,o,n){!function(t){if(!t)throw new TypeError("SessionInitParams");if(!t.hostSessionId)throw new TypeError("HostSessionId")}(e),this.qd=new Ti(t,i,e,s,this,n,(t,i)=>o({type:t,data:i,session:this})),this.qd.state=vi.Initialized}}class Ci{setTargetOrigin(t){const i=c(t).toLowerCase();this.En&&this.En!==i&&this.Ns.ULS.ri(593232847,s.H,o.Warning,`Updating origin: [${I(this.En)}]->[${I(i)}]`),this.En=i,this.Pn=d(i,2),this.Rn=r(i),this.xn=a(i)}setTargetFrame(t,i){this.zd=t,this.Fn=!!i}setMessageHandler(t){this.Kd=t}removeMessageHandler(){this.Kd=void 0}postMessage(t,i,e){if(!this.zd||!this.zd.contentWindow)return void this.Ns.ULS.ri(593232848,s.H,o.Error,"Missing target to send message: "+t);this.Ns.ULS.ri(593232849,s.H,o.Info,"Sending message: "+t);const n={MessageId:t,SendTime:R(),CorrelationId:e,Values:i};this.zd.contentWindow.postMessage(JSON.stringify(n),this.En)}dispose(){window.removeEventListener("message",this.Xd,!1),this.Kd=void 0}constructor(t,i,e,n){var r;this.En="",this.Pn="",this.Rn=!1,this.xn=!1,this.Fn=!1,this.Wn=!1,this.Xd=t=>{let i,e=!1,n=!0,r="",a=!1;if(this.zd&&this.zd.contentWindow&&(e=!0,n=t.source===this.zd.contentWindow),t.origin&&(r=d(t.origin,2).toLowerCase(),a=r===this.Pn,!a&&this.On&&(r=d(t.origin).toLowerCase(),a=this.On.includes(r))),!this.Rn&&(!this.xn||a&&n)||this.Ns.ULS.ri(593232850,s.H,o.Info,"Window: available["+e+"] valid["+n+"]; Origin: valid["+a+"] expected["+this.Pn+"] actual["+r+"]"),!a||this.Fn&&!n)return;try{i=JSON.parse(t.data)}catch(t){return void this.Ns.ULS.ri(593232851,s.H,o.Info,"Failed to parse event data: "+C(t))}const h=i.MessageId;if(h){var c;if(this.Ns.ULS.ri(593232854,s.H,o.Info,`Received message: ${h}, correlation: ${i.CorrelationId}`),h!==Z.qi&&h!==Z.ge||this.setTargetOrigin(t.origin),i.Values&&i.Values.ackExpected&&this.postMessage(rt.yo,void 0,i.CorrelationId),this.Wn&&h===Z.Ps)return window._pageTimings=null!==(c=window._pageTimings)&&void 0!==c?c:{},void(window._pageTimings[i.Values.name]=i.Values.time);if(this.Kd)try{this.Kd(i)}catch(t){this.Ns.ULS.ri(594556386,s.H,o.Error,"Message handler error: "+C(t))}else this.Ns.ULS.ri(591933923,s.H,o.Error,"No message handler")}else(this.Rn||this.xn)&&this.Ns.ULS.ri(593232853,s.H,o.Info,"Missing message id")},this.Ns=i,this.setTargetOrigin(t),this.On=n,e&&this.setMessageHandler(e),this.Wn=!(null===(r=window.location)||void 0===r||null===(r=r.search)||void 0===r||!r.match(/wdpa=1/gi))||"1"===St("EnableMetricLogging"),window.addEventListener("message",this.Xd,!1)}}class Ei{get element(){return this.Zd}get frameId(){return this.Yd}get formId(){return this.Qd}get isTopFrameTrusted(){return this.tl}boot(t,i,e,n,r,a,h){this.Ns=e,this.ua=new Ci(t,e,this.Kd,n.additionalReceivingDomainList);const c=n.useAdditionalDiv,d=n.permissionsPolicy;this.il&&!c?(this.il.setAttribute("allow",d),this.Ns.ULS.ri(588793045,s.H,o.Info,"Wac frame reused")):(this.il=function(t,i,e,s,o,n,r,a,h,c){t.style.top="0",t.style.bottom="0",t.style.left="0",t.style.right="0",t.style.height="100%",t.style.width="100%";const d=t.ownerDocument,l=d.createElement("iframe");if(l.id=i,l.name=i,l.src="",l.title="Office on the web Frame",l.marginWidth="0",l.marginHeight="0",l.style.top="0",l.style.bottom="0",l.style.left="0",l.style.right="0",l.style.height="100%",l.style.width="100%",l.style.display="block",l.style.position="absolute",l.style.backgroundColor="transparent",l.style.border="none",l.frameBorder="0",l.setAttribute("allowfullscreen","true"),l.setAttribute("allowTransparency","true"),l.setAttribute("allow",e),jt(l,r),s&&(t.style.minHeight=s,l.style.minHeight=s),o&&(t.style.minWidth=o,l.style.minWidth=o),a&&l.setAttribute("role","none"),n){const i=d.createElement("div");i.style.top="0",i.style.bottom="0",i.style.left="0",i.style.right="0",i.style.height="100%",i.style.width="100%",i.style.backgroundColor="#393a3d",i.style.backfaceVisibility="hidden",s&&(i.style.minHeight=s),o&&(i.style.minWidth=o),i.appendChild(l),t.appendChild(i)}else t.appendChild(l);return h&&l.addEventListener("load",h,{once:!0}),c&&l.addEventListener("error",c,{once:!0}),l}(this.Zd,this.Yd,d,n.minHeight,n.minWidth,c,n.isInvisible,n.setNoneRole,a,h),this.Ns.ULS.ri(588793046,s.H,o.Info,"Wac frame created")),r(),this.ua.setTargetFrame(this.il,n.enforceSameWindow),c&&(this.el=this.il.parentElement),n.useFrameFixForTeams&&e.ULS.ri(509143245,s.H,o.Info,"Frame fix enabled for teams uiHost"),function(t,i,e){l(i,Rt.mr,String(e?window.outerHeight:t.offsetHeight)),l(i,Rt.wr,String(e?window.outerWidth:t.offsetWidth)),l(i,Rt.Ar,String(H())),l(i,Rt.gr,String(L())),l(i,Rt.pr,String(J())),l(i,Rt.Rr,String(function(){try{return window.matchMedia("(prefers-color-scheme: dark)").matches}catch{return!1}}())),l(i,Rt.Wr,String(function(){try{return window.matchMedia("(prefers-contrast: more)").matches}catch{return!1}}())),l(i,Rt.xr,String(function(){try{return window.matchMedia("(forced-colors: active)").matches||window.matchMedia("screen and (-ms-high-contrast: active)").matches}catch{return!1}}())),l(i,Rt.ta,String(window.innerHeight)),l(i,Rt.ia,String(window.innerWidth))}(this.il,i,n.useFrameFixForTeams),this.sl=function(t,i,e,s,o){const n=t.ownerDocument,r=n.createElement("form");r.id=e,r.name=e,r.action=s,r.target=i,r.method="POST";for(const t in o){const i=n.createElement("input");i.type="hidden",i.name=t,i.value=o[t],r.appendChild(i)}return t.appendChild(r),r}(this.Zd,this.Yd,this.Qd,t,i);try{this.sl.submit()}catch(t){this.Ns.ULS.ri(507909977,s.H,o.Warning,"WAC frame failed to submit, will retry. Error: "+C(t)),new Promise(t=>{window.setTimeout(t,10)}).then(()=>{this.sl.submit()}).catch(t=>{throw this.Ns.ULS.ri(507909976,s.H,o.Error,"WAC frame failed to submit on retry. Error: "+C(t)),t})}}setVisibility(t){this.il&&jt(this.il,t)}setMessageHandler(t){this.Kd=t,this.ua&&this.ua.setMessageHandler(t)}setWrapperPostMessage(t){this.ol=t}removeMessageHandler(){this.Kd=void 0,this.ua&&this.ua.removeMessageHandler()}postMessage(t,i){this.ol?this.ol(t,i):this.ua&&this.ua.postMessage(t,i)}dispose(t,i){return new Promise(e=>{if(this.sl&&(this.Zd.removeChild(this.sl),this.sl=void 0),this.ua&&(this.ua.dispose(),this.ua=void 0,this.Kd=void 0),this.ol&&(this.ol=void 0),this.Ns=void 0,!this.il||!this.el&&t)e();else{const t=()=>{this.el?(this.el.removeChild(this.il),this.Zd.removeChild(this.el)):this.Zd.removeChild(this.il),this.il=void 0,this.el=void 0,e()};i?t():(this.il.src="about:blank",window.setTimeout(t,0))}})}constructor(t,i){!function(t){if(!t||!t.appendChild)throw TypeError("Container")}(t),this.Zd=t,this.Yd=i,this.Qd=i+"_Form",this.tl=qt()}}class Ai{get name(){return this.nl.name}get version(){return T()}addEventListener(t){this.rl.add(t)}removeEventListener(t){this.rl.remove(t)}createContainer(t){const i=`WacFrame_${this.nl.name}_${this.containers.length}`,e=new Ei(t,i);return this.containers.push(e),e}createSession(t){const i=new _i(this.al,this.nl,t,this,this.hl,this.cl);return this.sessions.push(i),i}dispose(t){const i=this.sessions.map(i=>i.dispose(t).catch(t=>{}));return Promise.all(i).then(t=>(this.rl.removeAll(),this.sessions=[],this.containers=[],{completion:"success"}))}constructor(t,i,e){this.sessions=[],this.containers=[],this.hl=t=>{this.rl.dispatch(t)},function(t){if(!t)throw new TypeError("ApplicationInitParams");const i=t.host;if(!i||!i.storageHostName)throw new TypeError("HostInfo");const e=t.user;if(!e||null==e.id)throw new TypeError("UserInfo")}(t),this.al=t,this.nl=i,this.cl=e,this.rl=new ht,function(t){if(t&&(b.BUILD_NUMBER=t,t.includes("."))){const i=t.split(".");b.BUILD_NUMBER_MINOR=parseInt((i[0]||"").concat((i[1]||"").padStart(3,"0")),10)}}(t.host.owlVersion)}}const Fi=(t,i,e,n,r)=>t!==Z.Ae?Promise.reject("Wrong flow"):new Promise(t=>{e.pendingReboot=!0;let n=void 0;if(i.queryOverrides)try{n=JSON.parse(i.queryOverrides)}catch(t){e.logger.ULS.ri(592217694,s.H,o.Error,"Failed to parse queryOverrides: "+n)}e.raiseEvent(Ii.Reboot,{...i,previousSessionId:e.sessionId,queryOverrides:n}),t({completion:"success"})});function yi(t){return!(!(t&&t.source&&t.accessToken)||!t.expiry&&0!==t.expiry)}function Vi(t){const i={};l(i,"jsapi","1"),l(i,"jsapiver","v2"),l(i,"corrid",t.sessionId),l(i,"usid",t.sessionId),l(i,"newsession","1"),l(i,"sftc","1"),t.hostSessionId&&l(i,"hid",encodeURIComponent(t.hostSessionId));const e=t.host;e.uiHostName&&l(i,"uih",e.uiHostName),e.uiHostIntegrationType&&l(i,"uihit",encodeURIComponent(e.uiHostIntegrationType)),e.metaUiHostVersion&&l(i,"muv",encodeURIComponent(e.metaUiHostVersion));const s=e.capabilities;s&&(s.accessibilityLoop&&l(i,"accloop","1"),s.rebootDoc&&l(i,"sdr",s.rebootDoc.toString()),s.createNewDoc&&l(i,"scnd","1"),s.authToken&&l(i,"sat","1"),window.docAspxMsalEnabled&&(s.authTokenStrategy="PairwiseBroker"),s.authTokenStrategy&&l(i,"ats",s.authTokenStrategy),s.customAuthConfig&&l(i,"cac","1"),s.refreshAccessToken&&l(i,"rat","1"),s.atMentions&&l(i,"sams","1"),s.moveToFolder&&l(i,"mtf","1"),s.noBrowserModalDialogs&&l(i,"nbmd","1"),s.commonFilePicker&&l(i,"sfp","1"),s.directDownload&&l(i,"sdd","1"),s.directPrint&&l(i,"sdp","1"),s.disableOfficeAddins&&l(i,"doa","1"));const o=t.ui;o.language&&l(i,"ui",encodeURIComponent(o.language)),o.uiEmbed&&l(i,"uiembed","1"),(o.hideHeader||"DocGen"===o.contentAssemblyMode||"Templatization"===o.contentAssemblyMode||"ContentAssemblyEdit"===o.contentAssemblyMode||"ContentAssemblyView"===o.contentAssemblyMode)&&l(i,"hhdr","1"),o.highContrast&&l(i,"hcm",encodeURIComponent(o.highContrast)),o.hideFileLocationPicker&&l(i,"hodflp","1"),o.hideAppLauncherInHeader&&l(i,"halh","1"),o.hideChatInHeader&&l(i,"hch","1"),o.hideMeInHeader&&l(i,"hmh","1"),o.hideSearchInHeader&&l(i,"hsh","1"),o.hideWorkflowInHeader&&l(i,"hwfh","1"),o.hideSettingsInHeader&&l(i,"hsth","1"),o.showAppIconInHeader&&l(i,"sih","1"),o.useNeutralColorInHeader&&l(i,"unh","1"),o.openLinksInNewWindow&&l(i,"onw","1"),o.useDarkTheme&&l(i,"udt","1"),"DocGen"!==o.contentAssemblyMode&&"ContentAssemblyView"!==o.contentAssemblyMode||l(i,"readOnly","1");const n=t.wopi;n&&n.source&&l(i,"wopisrc",encodeURIComponent(n.source));const r=t.bootParams;r&&(r.dataLanguage&&l(i,"rs",encodeURIComponent(r.dataLanguage)),r.readOnly&&l(i,"readonly","1"),r.disableChat&&l(i,"dchat","1"),r.cookieCompliant&&l(i,"mscc","1"),r.isNewFile&&(l(i,"new","1"),r.isFromHostTemplate&&l(i,"wdtpl","fromhost"))),t.user.isLicensed&&l(i,"islicenseduser","1"),t.user.isSynthetic&&l(i,"syn","1"),t.actNavId&&l(i,"actnavid",t.actNavId),t.sessionContext&&l(i,"sc",encodeURIComponent(t.sessionContext));const a=t.wdParams;if(a)for(const t in a)l(i,t,a[t]);const h=t.preseededSession;h&&(h.key&&l(i,"preseededsessionkey",encodeURIComponent(h.key)),h.id&&l(i,"preseededwacsessionid",encodeURIComponent(h.id)));const c=t.throttling;c&&(c.protection&&l(i,"ctp",c.protection),c.request&&l(i,"rct",c.request));const d=t.hostInitDiagnostics;d&&(d.entryPoint&&l(i,"wdorigin",encodeURI(d.entryPoint)),d.userClickTime&&l(i,"wdhostclicktime",d.userClickTime.toString()));const p=t.rebootOverride;return p&&p.previousSessionId&&l(i,"wdprevioussession",p.previousSessionId),u(i,"region"),i}function Pi(t,i,e){let s={...w(t.appUrl),...Vi(t),...e};const o=t.rebootOverride;return o&&o.queryOverrides&&(s={...s,...o.queryOverrides}),function(t,i,e){const s=[];for(const t in e)e[t]&&s.push(t+"="+e[t]);return t+i+(s.length>0?"?"+s.join("&"):"")}(t.appBasePath,i,s)}const Ri=(t,i,e,a,h)=>t!==nt.boot?Promise.reject("Wrong flow"):new Promise(t=>{const d=R();var u;e.state=vi.Booting,e.pendingReboot=!1,function(t,i,e=!1){if(!t)throw new TypeError("SessionBootParams");const s=t.appUrl,o=t.appBaseUrl;if(!s&&!o)throw new TypeError("Either appUrl or appBaseUrl should exist");if(s&&"string"!=typeof s)throw new TypeError("AppUrl");if(o&&"string"!=typeof o)throw new TypeError("AppBaseUrl");const n=t.file;if(!n||!e&&!n.name)throw new TypeError("FileInfo");const r=t.container;if(!r||!(r instanceof Ei)&&!r.appendChild)throw new TypeError("Container");if(!i&&!yi(t.wopi))throw new TypeError("WopiInfo")}(i,e.skipWopiValidation,e.skipFileNameCheck),e.intent=i.intent,e.file=i.file,e.customFontCatalogUrl=i.customFontCatalogUrl,e.wopi=i.wopi,e.contentBundle=i.contentBundle,e.newFileTemplate=i.newFileTemplate,e.ownerId=i.ownerId,e.sessionContext=i.sessionContext,e.actNavId=i.actNavId,e.preseededSession=i.preseededSession,e.throttling=i.throttling,e.meeting=i.meeting,e.tenantId=i.tenantId,e.wdParams=(u=i.wdParams,function(t,i){const e={};return i&&Object.keys(i).forEach(t=>{e[t.toLowerCase()]=i[t]}),t.split("&").forEach(t=>{if(/^wd\w+=.+/i.test(t)){const i=t.split("=");e[i[0].toLowerCase()]=i[1]}}),e}(window.location.search.substring(1),u)),e.pinnedTarget=i.pinnedTarget,e.rebootOverride=i.rebootOverride,e.bootParams=i.bootParams||{},e.hostInitDiagnostics={...i.diagnostics,hostInitializeCallTime:d};let m=!1;const w=e.preseededSession;e.appInfo.usePreseededSessionId&&w&&w.id&&(e.sessionId=w.id,m=!0);let f=!1;const I=i.hostGeneratedSessionId;if(!m&&I&&(e.sessionId=I,f=!0),e.ai.getValue(D._i,!1)&&function(t){const i=window.performance.timing;i&&(t.hostPageNavigationStartTime||(t.hostPageNavigationStartTime=i.navigationStart),t.hostPageFetchStartTime||(t.hostPageFetchStartTime=i.fetchStart),t.hostPageRequestStartTime||(t.hostPageRequestStartTime=i.requestStart),t.hostPageResponseStartTime||(t.hostPageResponseStartTime=i.responseStart),t.hostPageResponseEndTime||(t.hostPageResponseEndTime=i.responseEnd),t.hostPageDomCompleteTime||(t.hostPageDomCompleteTime=i.domComplete));const e=window.performance.navigation;if(e&&(void 0===t.hostPageRedirectCount&&(t.hostPageRedirectCount=e.redirectCount),!t.hostPageNavigationType)){let i="UNKNOWN";switch(e.type){case 0:i="NAVIGATE";break;case 1:i="RELOAD";break;case 2:i="BACK_FORWARD";break;case 255:i="RESERVED"}t.hostPageNavigationType=i}}(e.hostInitDiagnostics),i.appUrl){const t=i.appUrl;e.appUrl=t;const s=e.bootParams;if(v(t,"new")&&(s.isNewFile=!0),!s.dataLanguage){const i=S(t,"rs");i&&(s.dataLanguage=i)}const o=e.ui;if(v(t,"uiembed")&&(o.uiEmbed=!0),!o.language){const i=S(t,"ui");i&&(o.language=i)}if(!e.hostInitDiagnostics.entryPoint){const i=S(t,"wdorigin");i&&(e.hostInitDiagnostics.entryPoint=i)}if(!e.host.uiHostName){const i=S(t,"uih");i&&(e.host.uiHostName=i)}}else e.appUrl="";let b;if(e.appBaseUrl=i.appBaseUrl?i.appBaseUrl.toLowerCase():c(i.appUrl).toLowerCase(),e.appBaseUrl=function(t,i){if(!i||-1===n.indexOf(i.toLowerCase()))return t;const e=t.match(/(^http[s]:\/\/)((?!word)\w*[-])?(.*)/i);return e?`${e[1]}${i}-${e[3]}`:t}(e.appBaseUrl,p(e.appUrl,"region")),e.ai.updateEnvironment(e.appBaseUrl),a.initializeAppContext(e,t,i),e.appBasePath=a.buildAppBasePath(e),i.rebootOverride&&(m||f||([e.sessionId,b]=E()),e.pageStateObserver=new ut(e.logger,!0),e.authTokenTrustValidator=new it(e.logger)),e.logger.ULS.ri(38580693,s.H,o.Info,`User session id: ${e.sessionId}, is preseeded: ${m}, is host generated: ${f}`),e.remoteTelemetryUrl=a.buildRemoteTelemetryUrl(e),V(e.remoteTelemetryUrl,e.appInfo.name,"init"),!e.isLoggerFromOwl){let t=e.ai.getValue(D.li,"").toString();t||(t=e.appBasePath+"RemoteUls.ashx"),e.logger.configure({remoteUlsEndpoint:t,sessionId:e.sessionId})}if(e.ai.initializePeriodicFetch(e.appBasePath,e.sessionId),b&&e.logger.ULS.ri(590966790,s.H,o.Info,JSON.stringify(b)),function(t){try{const i=t.hostInitDiagnostics;t.logger.ULS.ri(558155803,s.H,o.Info,"HostInitDiagnostics: "+(i?JSON.stringify(i):"N/A")),t.logger.ULS.ri(596444237,s.H,o.Info,JSON.stringify({session:z(t),client:t.clientDiagnostics}))}catch(i){t.logger.ULS.ri(558155804,s.H,o.Error,"Failed to log init info: "+C(i))}}(e),a.onContextReady&&a.onContextReady(e),e.appInitDiagnostics={officeSessionId:e.sessionId,officeBootstrapperVersion:T(),hostName:e.hostName,documentLoadedWithTabSwitch:"hidden"===document.visibilityState},document.addEventListener("visibilitychange",()=>{e.appInitDiagnostics.documentLoadedWithTabSwitch=!0},{once:!0}),!e.container){const t=i.container;e.container=t instanceof Ei?t:e.application.createContainer(t)}e.container.setMessageHandler(e.onMessage);const A=!!a.ignoreCompletionMessage&&a.ignoreCompletionMessage(e),F=(t,i)=>{e.successTime=R(),A||(e.container.postMessage(rt.Wo,void 0),j(e.appInitDiagnostics,i.Diagnostics)),e.ai.addSettingsChangeListener(e.logger.settingsChangeHandler),a.onSuccess&&a.onSuccess(e,i),e.logger.ULS.ri(596448985,s.H,o.Important,JSON.stringify(e.diagnostics)),V(e.remoteTelemetryUrl,e.application.name,"bootSuccess"),e.logger.ULS.flush(),e.container.postMessage(rt.No,{HostInitializeDiagnostics:e.hostInitDiagnostics,ClientDiagnostics:e.clientDiagnostics}),e.state=vi.Booted,P({completion:"success"}),q(e.appInfo.name,e.logger)},y=(t,i)=>{var n;e.failureTime=R(),a.onFailure&&a.onFailure(e,i.Error),e.logger.ULS.ri(596448986,s.H,o.Error,JSON.stringify({error:i.Error,diagnostics:e.diagnostics})),V(e.remoteTelemetryUrl,e.application.name,"bootFailure"),e.logger.ULS.flush(),e.state=vi.Failed,P({completion:"failure",error:i.Error,errorSource:"app",documentLoadedWithTabSwitch:null===(n=e.appInitDiagnostics)||void 0===n?void 0:n.documentLoadedWithTabSwitch}),q(e.appInfo.name,e.logger)},P=i=>{A||(e.bootHeartBeat&&e.bootHeartBeat.stop(),e.removeActionHandler(Z.qi,F),e.removeActionHandler(Z.Gi,y)),t(i)};h&&h.subscribe(()=>{var t;P({completion:h.reason||"cancelled",documentLoadedWithTabSwitch:null===(t=e.appInitDiagnostics)||void 0===t?void 0:t.documentLoadedWithTabSwitch})}),A||(e.addActionHandler(Z.qi,F),e.addActionHandler(Z.Gi,y)),function(t){(function(t){return"wdjs"in t||"wd1js"in t})(t)&&("true"!==window.sessionStorage.getItem("sideLoadingIsEnabled")?It("sideLoadingIsEnabled","false",0):function(t,i){const e=St("sideLoadingIsEnabled");return"true"===e||"false"!==e&&!1}()||It("sideLoadingIsEnabled","true",1))}(e.wdParams);const x=a.buildBootRequestParams(e),W=Pi(e,x.appPageName,x.queryParamsOverrides),k=function(t,i){const e=function(t){const i={};l(i,"highdpi",String(window.devicePixelRatio>1.24)),l(i,"softblockedbrowser",String($())),l(i,"hostname",t.hostName),l(i,"feature_status",lt(t.featureManager,t.wdParams)),l(i,"jsapibuild",T());const e=t.wopi;e&&(l(i,"access_token",e.accessToken),l(i,"access_token_ttl",e.expiry.toString()),e.wacToken&&l(i,"wac_token",e.wacToken));const n=t.customFontCatalogUrl;n&&l(i,"customfontcatalogurl",n);const r=t.contentBundle;if(r){if(r.url){l(i,"bundlesrc",r.url);const e=r.staleness,n=null!=e;n&&l(i,Rt.er,e.toString()),t.logger.ULS.ri(577783775,s.H,o.Info,"Content bundle staleness: "+(n?e:"N/A"))}r.bundleUrlNoAuth&&l(i,"bundleurlnoauth",r.bundleUrlNoAuth),r.bundleCode&&l(i,"bundlecode",r.bundleCode)}const a=t.file,h=a.name;if(h){l(i,"filename",h);const t=_(h);t&&l(i,"fileextension",t)}a.getUrl&&l(i,"filegeturl",a.getUrl),a.downloadCode&&l(i,"filedownloadcode",a.downloadCode),a.urlNoAuth&&l(i,"fileurlnoauth",a.urlNoAuth),a.size&&l(i,"filesize",a.size.toString()),a.eTag&&l(i,"etag",a.eTag),a.cTag&&l(i,"revid",a.cTag),a.uniqueId&&l(i,"docid",a.uniqueId),void 0!==a.immutableReason&&l(i,"immutableReason",a.immutableReason.toString()),void 0!==a.supportsZipIt&&l(i,"supports_zipit",a.supportsZipIt.toString());const c=t.newFileTemplate;c&&(c.getUrl&&l(i,"templateurl",c.getUrl),c.size&&l(i,"filesize",c.size.toString()),c.eTag&&l(i,"etag",c.eTag),c.uniqueId&&l(i,"docid",c.uniqueId)),t.user.id&&l(i,"user_id",t.user.id),t.ownerId&&l(i,"owner_id",t.ownerId),t.sessionContext&&l(i,"sc",t.sessionContext);const d=t.ui;d.controls&&l(i,"huictrls",JSON.stringify(d.controls)),"Templatization"!==d.contentAssemblyMode&&"DocGen"!==d.contentAssemblyMode&&"ContentAssemblyEdit"!==d.contentAssemblyMode&&"ContentAssemblyView"!==d.contentAssemblyMode||l(i,"caae","1"),d.contentAssemblyMode&&l(i,"caaemode",d.contentAssemblyMode);const u=t.meeting;u&&(u.id&&l(i,"meetingId",u.id),u.title&&l(i,"meetingTitle",u.title),u.type&&l(i,"meetingType",u.type),u.scheduledStartTime&&l(i,"scheduledStartTime",u.scheduledStartTime),u.scheduledEndTime&&l(i,"scheduledEndTime",u.scheduledEndTime),u.isPresenter&&l(i,"isPresenter",u.isPresenter.toString()),u.organizerId&&l(i,"meetingOrganizerId",u.organizerId),u.joinUrl&&l(i,"meetingJoinUrl",encodeURIComponent(u.joinUrl)),u.isMeetingTeamsRoom&&l(i,"isMeetingTeamsRoom",u.isMeetingTeamsRoom.toString()));const p=t.host;p.owlVersion&&l(i,"owlver",p.owlVersion),p.owlRollout&&l(i,"owlro",p.owlRollout);const m=p.capabilities;return m&&(m.supportsInPlaceCreateNew&&l(i,"sipcn",m.supportsInPlaceCreateNew.toString()),m.disableEmbedViewCodeSnippet&&l(i,"devcs","1"),m.disableCoEditInTeams&&l(i,"dceit","1")),i}(t);return Object.keys(i).forEach(t=>{i[t]?e[t]=i[t]:delete e[t]}),e}(e,x.postDataOverrides);if(e.bootstrapperUrl&&e.preconnector&&e.preconnector.shouldPreconnect(e.hostName)&&e.preconnector.preconnect(e.bootstrapperUrl),e.bootstrapperUrl&&e.preloader&&e.preloader.shouldPreload(W,e.host.origin))try{a.beforePreload&&a.beforePreload(e);let t=e.bootstrapperUrl;e.featureManager.isFeatureEnabled(ot.ao)&&(e.logger.ULS.ri(590966791,s.H,o.Info,"HTTP2 preload enabled"),t=g(t)),e.preloader.preload(t,e.ui.language,e.logger,e.featureManager)}catch(t){e.logger.ULS.ri(590966792,s.H,o.Error,"Error preloading")}a.beforeContainerBoot&&a.beforeContainerBoot(e,W),e.container.boot(W,k,e.logger,a.buildContainerBootParams(e),()=>{e.appInitDiagnostics.officeFrameCreateTime=R()},()=>{e.appInitDiagnostics.officeFrameLoadTime=R(),e.logger.ULS.ri(506012820,s.H,o.Important,"Frame loaded"),e.bootHeartBeat&&e.bootHeartBeat.setFrameLoaded()},()=>{e.appInitDiagnostics.officeFrameErrorTime=R(),e.logger.ULS.ri(506012819,s.H,o.Error,"Frame error"),e.bootHeartBeat&&e.bootHeartBeat.setFrameError()}),A?F(Z.qi,{Diagnostics:{}}):(e.bootHeartBeat=new ni(r(e.appBaseUrl),e.ai,e.logger,()=>{var t;e.timeoutTime=R(),a.onTimeout&&a.onTimeout(e),V(e.remoteTelemetryUrl,e.application.name,"bootTimeout"),P({completion:"timeout",error:{documentLoadedWithTabSwitch:null===(t=e.appInitDiagnostics)||void 0===t?void 0:t.documentLoadedWithTabSwitch}}),h&&h.cancel()},h&&a.overrideBootTimeout?Math.min(h.timeoutInMs,a.overrideBootTimeout(e)):h?h.timeoutInMs:a.overrideBootTimeout?a.overrideBootTimeout(e):void 0),a.beforeBootCompletionMessage&&a.beforeBootCompletionMessage(e))}).catch(t=>{throw e.failureTime=R(),a.onException&&a.onException(e,t),e.remoteTelemetryUrl&&V(e.remoteTelemetryUrl,e.application.name,"bootException"),e.bootHeartBeat&&e.bootHeartBeat.stop(),{error:t.toString(),errorStack:t.stack}}),xi=(t,i,e)=>new Promise(i=>{e.logger.ULS.ri(590111070,s.H,o.Error,"Unsupported flow: "+t),i({completion:"failure"})}),Wi=(t,i,e,n,r)=>t!==nt.createNew?Promise.reject("Wrong flow"):new Promise(a=>{const h={wopiPendingInitializeTime:R()},c=!!(n&&n.parallelizeStartSessionRequest&&n.buildStartSessionRequestParams)&&n.parallelizeStartSessionRequest(e);let d=!1,l=!1,u=!1,p=!1,m=void 0,w=void 0,f=!1,g=!1;if(N()===U.IE||n&&n.fallBackToSingleStepBootFlow&&n.fallBackToSingleStepBootFlow(e,i))return void function(){e.logger.ULS.ri(578074079,s.H,o.Info,"Waiting for WOPI info to start boot");const t=(t,a)=>{if(d)e.logger.ULS.ri(578074080,s.H,o.Warning,"completeCreateNew already called");else{if(d=!0,h.wopiPendingCompleteTime=R(),"failure"===a.state)return V(a.reason),e.state=vi.Failed,void n({completion:"failure"});ki(a.newFile),e.run(nt.boot,{...i,wopi:a.wopi},r).then(t=>{n(t)})}};e.addActionHandler(nt.completeCreateNew,t);const n=i=>{e.removeActionHandler(nt.completeCreateNew,t),a(i)};r&&r.subscribe(()=>{n({completion:"cancelled"})})}();const v=(t,i)=>{d?e.logger.ULS.ri(587236372,s.H,o.Warning,"completeCreateNew already called"):(d=!0,h.wopiPendingCompleteTime=R(),"failure"!==i.state?(m=i.wopi,yi(m)?(e.wopi=m,e.logger.ULS.ri(587286030,s.H,o.Info,"WOPI info received. Access token: "+JSON.stringify({length:m.accessToken.length,expiry:m.expiry})+", current state: "+JSON.stringify({parallelizeStartSessionRequest:c,wacFrameLoaded:l,wacCanAcceptStartSessionResponse:u})),!c||l&&!u?l&&C():I(),l&&e.container&&e.container.postMessage(rt.dn,void 0),ki(i.newFile)):S("InvalidWopiInfo")):S(i.reason))},S=t=>{V(t),l&&e.container&&e.container.postMessage(rt.hn,void 0)},I=()=>{e.logger.ULS.ri(587233056,s.H,o.Info,"Making parallelized StartSession request");const i=n.buildStartSessionRequestParams(e,t,m),r=Pi(e,i.appPageName,i.queryParamsOverrides),a="access_token="+encodeURIComponent(m.accessToken)+"&access_token_ttl="+encodeURIComponent(m.expiry.toString());h.startSessionStartTime=R(),function(t,i,e,s){const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(o&&4===o.readyState){if(void 0===o.status||0===o.status)return;try{s&&s(o)}finally{null!=o&&(o.onreadystatechange=()=>{})}}},o.open("POST",t);for(const t in e)o.setRequestHeader(t,e[t]);o.send(i)}(r,a,{"Content-Type":"application/x-www-form-urlencoded"},b)},b=t=>{const i=R();h.startSessionCompleteTime=i,e.logger.ULS.ri(587233057,s.H,o.Info,`StartSession request completed. Status code: ${t.status}, time: ${i}`),w={RequestStatus:t.status,ResponseText:t.responseText},l&&u?_():e.logger.ULS.ri(587233058,s.H,o.Info,"StartSession response not yet sent: "+JSON.stringify({wacFrameLoaded:l,wacCanAcceptStartSessionResponse:u,wopiInfoSent:f,startSessionResponseSent:g}))},T=(t,i)=>{h.readyMessageReceiveTime=R(),e.container&&e.container.postMessage(rt.Vo,void 0),l||(l=!0,u=i.CanAcceptStartSessionComplete,e.logger.ULS.ri(587321567,s.H,o.Info,"App ready: "+JSON.stringify({parallelizeStartSessionRequest:c,wacCanAcceptStartSessionResponse:u,startSessionResponseAvailable:!!w,wopiInfoAvailable:!!m})),d&&e.container&&e.container.postMessage(m?rt.dn:rt.hn,void 0),c&&u?_():C(),j(e.appInitDiagnostics,i.Diagnostics))},_=()=>{g||f||!w||(200===w.RequestStatus?(g=!0,h.completeMessageCreateTime=R(),E(rt.ko,{StartSessionResponse:w,Diagnostics:h},3)):C())},C=()=>{g||f||!m||(f=!0,h.completeMessageCreateTime=R(),n&&n.sendCreateNewWopiInfo?n.sendCreateNewWopiInfo(e):E(rt.Do,{WopiDetails:{WopiSrc:m.source,AccessToken:m.accessToken,AccessTokenTtl:m.expiry.toString()},Diagnostics:h},3))},E=(t,i,n)=>{const r=R();n<=0?e.logger.ULS.ri(587233165,s.H,o.Error,"Attempted to complete but no ack. Time: "+r):(e.logger.ULS.ri(587233166,s.H,o.Info,`Sending complete message. Retries left: ${n-1}, Time: ${r}`),h.completeMessageSendTime=r,e.container&&e.container.postMessage(t,i),window.setTimeout(A,1e3,t,i,n-1))},A=(t,i,n)=>{p||(e.logger.ULS.ri(587233167,s.H,o.Info,"Timeout session complete ack. Retries left: "+n),E(t,i,n))},F=(t,i)=>{p=!0},y=t=>{e.removeActionHandler(nt.completeCreateNew,v),e.removeActionHandler(Z.Ji,T),e.removeActionHandler(Z.We,F),a(t)};function V(t){e.logger.ULS.ri(596444188,s.H,o.Warning,"Fail with reason: "+(t?JSON.stringify(t):"N/A"))}e.addActionHandler(nt.completeCreateNew,v),e.addActionHandler(Z.Ji,T),e.addActionHandler(Z.We,F),r&&r.subscribe(()=>{y({completion:"cancelled"})}),e.skipWopiValidation=!0,e.skipFileNameCheck=!0,e.wopi=void 0,e.run(nt.boot,i,r).then(t=>{e.skipWopiValidation=!1,e.wopi=m,y(t)})});function ki(t){t&&(t.path&&history.replaceState({},"",t.path),t.title&&(document.title=t.title))}class Di{get isCancelled(){return this.dl}get timeoutInMs(){return this.ll}get reason(){return this.ul}cancel(){this.pl(!1)}subscribe(t){this.dl?t():this.ml.push(t)}constructor(t){this.dl=!1,this.ul="",this.ml=[],this.pl=t=>{this.dl||(this.dl=!0,this.ul=t?"timeout":"cancelled",this.ml.map(t=>t()),this.ml=[])},this.ll=t,window.setTimeout(()=>this.pl(!0),t)}}function Ui(t){return new Di(t)}const Oi=(t,i,e,n,r)=>t!==nt.dispose?Promise.reject("Wrong flow"):new Promise(t=>{e.logger.ULS.ri(595714433,s.H,o.Info,"start disposing the application");const a=e.host.requireExplicitUnload,h={disposeStartTime:R(),forceAppUnload:a};e.state=vi.Disposing;const c=()=>{e.state=vi.Disposed,t({completion:"success"})},d=t=>{n&&n.disposeAppSpecificResources&&n.disposeAppSpecificResources(e,i),e.dispose(),h.disposeEndTime=R(),function(t,i,e){if(e){const t=Number(e.hostMessageReceived);i.appUnloadStartTime&&!isNaN(t)&&(i.hostToAppPostMessageLatency=t-i.appUnloadStartTime);const s=Number(e.appMessageSent);!isNaN(s)&&i.appUnloadEndTime&&(i.appToHostPostMessageLatency=i.appUnloadEndTime-s);const o=Number(e.appUnloadStart),n=Number(e.appUnloadEnd);if(isNaN(o)||isNaN(n)||(i.appUnloadLatency=n-o),e.serverTimings){const t=e.serverTimings;for(const e in t)i["st-"+e.toString()]=t[e]}}t.logger.ULS.ri(592524822,s.H,o.Info,"App disposed: "+JSON.stringify(i)),t.logger.ULS.flushOnClose()}(e,h,t),e.container?e.container.dispose(e.pendingReboot,a).then(c):c()};if(a){h.appUnloadStartTime=R();const t=(t,i)=>{h.appUnloadEndTime=R(),d(i)};e.addActionHandler(Z.Me,t),(r||new Di(5e3)).subscribe(()=>{e.state===vi.Disposing&&(h.appUnloadTimedOut=!0,d())}),e.container&&e.container.postMessage(rt.un,void 0)}else d()}),Bi=(t,i,e,n,r)=>t!==Z.de?Promise.reject("Wrong flow"):new Promise(t=>{if(e.host.capabilities&&e.host.capabilities.frameTrustCheck)e.raiseEvent(Ii.FrameTrust,i);else{const t=!!e.container&&e.container.isTopFrameTrusted;e.logger.ULS.ri(592445957,s.H,o.Info,"Top frame is trusted: "+t),e.container&&e.container.postMessage(rt.de,{isTopFrameTrusted:t})}t({completion:"success"})}),Mi=(t,i,e,s,o)=>t!==Z.ue?Promise.reject("Wrong flow"):new Promise(t=>{e.authTokenTrustValidator.isResourceTrustedForMessage(i).then(s=>{s?e.raiseEvent(Ii.GetAuthToken,i):(e.container.postMessage(rt.Yo,{AuthToken:"",Error:"accessDenied",RequestId:i.RequestId,IdentityType:i.IdentityType}),t({completion:"success"}))},s=>{e.container.postMessage(rt.Yo,{AuthToken:"",Error:"Exception encountered in AuthTokenTrustValidator.isResourceTrustedForMessage",RequestId:i.RequestId,IdentityType:i.IdentityType}),t({completion:"failure",error:s})})}),Ni=(t,i,e,n,r)=>t!==Z.ji?Promise.reject("Wrong flow"):new Promise(t=>{const r=i&&i.state?i.state:"Unknown";e.logger.ULS.ri(592839750,s.H,o.Info,`Boot state: [${r}]`),n&&n.beforeComplete&&n.beforeComplete(r),t({completion:"success"})}),Hi=(t,i,e,n,r)=>{if(t!==nt.postWacToken)return Promise.reject("Wrong flow");const a=P();return e.logger.ULS.ri(507774685,s.H,o.Important,"postWacToken flow initiated"),new Promise(t=>{const n=(t,i)=>{e.logger.ULS.ri(507597017,s.H,o.Info,`postWacToken flow completed in ${P()-a} ms`),window.clearInterval(c),window.clearTimeout(d);const n={completion:"success"};i&&void 0!==i.TokenAlreadySet&&(n.data={TokenAlreadySet:i.TokenAlreadySet}),r(n)},r=i=>{e.removeActionHandler(Z.xs,n),t(i)},h=()=>{var t;return null===(t=e.container)||void 0===t?void 0:t.postMessage(rt.Tn,i)};e.addActionHandler(Z.xs,n),h();const c=window.setInterval(h,100),d=window.setTimeout(()=>{window.clearInterval(c),e.logger.ULS.ri(507844190,s.H,o.Warning,"postWacToken flow timed out after 60000 milliseconds"),r({completion:"timeout"})},6e4)})};function Li(t,i){t.ULS.ri(42524822,s.H,o.Info,"LogFeatureUsage: "+i.toString())}const $i={[yt.BOOTSTART]:596464066,[yt.BACKGROUND_MODESWITCH_BOOTSTART]:596464066,[yt.BOOTSUCCESS]:596457106,[yt.BOOTFAILED]:596464088,[yt.BOOTEXCEPTION]:596464072,[yt.BOOTTIMEOUT]:587580759};function Ji(t,i){switch(i){case yt.BOOTSTART:case yt.BACKGROUND_MODESWITCH_BOOTSTART:case yt.BOOTSUCCESS:case yt.BOOTFAILED:case yt.BOOTEXCEPTION:case yt.BOOTTIMEOUT:t.ULS.ri($i[i],s.H,o.Warning,i.toString());break;default:t.ULS.ri(523298252,s.H,o.Info,"UKNOWN RELIABILITY MILESTONE")}t.ULS.flush()}function Gi(t,i,e){var n,r,a,h;Jt(),kt(t.appUrl)||(Li(t.logger,Vt.JSAPIV2),Ji(t.logger,yt.BOOTSTART));const c=t.appContext,d=xt.getBRSValue(xt.DTEEnabledBRSKey);c.wasDefaultedtoEdit=!1,d&&!kt(t.appUrl)&&function(t,i){var e;const n=t.appContext,r=p(window.location.href,"action");let a=!1;const h=t.host.uiHostName,c=h&&"teams"===h.toLowerCase();if(c){const i=Wt(t.appUrl)===Ft.VIEW;t.rebootOverride||(a=i)}const d=Dt(t.appUrl)||Ut(t.appUrl);if(xt.getBRSValue(xt.DisableDTEForUnsupportedFileTypesEnabledBRSKey)){if(null===t.file||void 0===t.file||!t.file.name)return void t.logger.ULS.ri(507110738,s.H,o.Error,"Missing file name in the context");const i=_(t.file.name);if("vsdx"!==i)return void t.logger.ULS.ri(507110737,s.H,o.Info,"Not defaulting to edit for  "+i+"file type.")}xt.getBRSValue(xt.DTESafariFixEnabledBRSKey)&&N()===U.Safari||"default"!==r&&!a&&(!xt.getBRSValue(xt.DTESharingFixEnabledBRSKey)||null!=i&&null!==(e=i.bootParams)&&void 0!==e&&e.readOnly||d||c||0!==r.length)||"true"===localStorage.getItem("enableDTE")&&(t.appUrl=m(t.appUrl,"VisioView","EditView",!0),n.wasDefaultedtoEdit=!0)}(t,e),c.appMode=Wt(t.appUrl),c.resource=new mi(t.appBaseUrl,t.bootstrapperUrl),c.appFramePageViewLoaded=!1,c.fastViewPostMessageToWacFrameState={appFrameReadyToReceiveFastViewData:!1,jsapiAlreadySentFastViewDataToWacFrame:!1,jsapiReadyToSendFastViewDataToWacFrame:!1},c.fastViewInfo={fastViewContainer:void 0,fishBowlElement:void 0,imageElement:void 0,pageElement:void 0,docViewLoaded:!1,imageLoaded:!1,docViewResponseText:void 0,fastViewcontainerVisible:!1,fastviewShownFromHostCache:!1,fastViewPLTTime:void 0,defaultImageWidth:void 0,defaultImageHeight:void 0,fastviewContentLoadedFromLocalcache:!1,fastViewImageDataFromCache:void 0,fastViewCacheHit:!1,noChromeMode:!1,noChromeWithToolbar:!1,fastviewSavedToBrowserCache:!1},c.fastViewBrowserCache=Gt.Create(t.user.id,null===(n=t.wopi)||void 0===n?void 0:n.source,null===(r=t.file)||void 0===r?void 0:r.eTag,t.logger),c.sessionBootParams=e,c.commentContext=void 0,c.modeSwitchAckReceived=!1;const l=t.host.uiHostName,u=l&&"teams"===l.toLowerCase();(null!==(a=t.wdParams)&&void 0!==a&&a.wdnc||xt.getBRSValue(xt.hostCacheForEmbedViewEnabledBRSKey)&&(c.appMode===Ft.EMBED_VIEW||c.appMode===Ft.INTERACTIVE_PREVIEW))&&(c.fastViewInfo.noChromeMode=!0),u&&null!==(h=t.ui)&&void 0!==h&&h.hideHeader&&(c.appMode===Ft.VIEW||c.appMode===Ft.EMBED_VIEW||c.appMode===Ft.INTERACTIVE_PREVIEW||c.appMode===Ft.EDIT&&-1===t.appUrl.indexOf("embed=1"))&&(c.fastViewInfo.noChromeMode=!0),u&&c.fastViewInfo.noChromeMode&&(c.fastViewInfo.noChromeWithToolbar=!0),p(window.location.href,"teamsvisiomode")&&t.hostInitDiagnostics&&(t.hostInitDiagnostics.userClickTime=(new Date).getTime())}function ji(t){return t.appBaseUrl+"/v/"}function qi(t){return t.appBasePath+"RemoteTelemetry.ashx"+((i=t.sessionId)?"?usid="+i:"");var i}function zi(t,i=!1){if(ee(t,i)){kt(t.appUrl)||li.RecordTelemetryData("bootPerf","constGuid","fastViewDuration",hi.TimerBegin,new Date,t.logger);try{!function(t){const{imageElement:i,fishBowlElement:e,pageElement:n,fastViewContainer:r}=function(t){const i=t.appContext;if(!t.container)return;const e=ie(t),s=function(){const t=document.createElement("div");return t.id="VisioFastViewContainer",t.style.width="100%",t.style.height="100%",t.style.visibility="hidden",t.style.position="absolute",t.style.backgroundColor="#F3F2F1",t.style.display="block",t.style.touchAction="none",t.style.zIndex="1",t}(),o=function(t,i,e,s){const o=document.createElement("div");return o.style.top=e?Et.ToolbarHeightConsumption+"px":i?"0px":Et.RibbonHeightConsumption+"px",o.style.left="0px",o.style.right="0px",o.style.bottom=Et.StatusbarHeight+"px",o.style.position="absolute",o.style.borderTopColor="#C6C6C6",o.style.borderTopWidth=Et.FishbowlBorderTop+"px",o.style.borderTopStyle="solid",o.style.backgroundColor=Ot(s)?"#FFFFFF":"#F9F9F9",t.appendChild(o),o}(s,e.noChromeMode,e.noChromeWithToolbar,i.appMode),n=function(t){const i=document.createElement("div");return i.id="backgroundPage",t.appendChild(i),i}(o),r=function(t){const i=document.createElement("img");return i.id="foregroundPage",i.style.visibility="hidden",i.setAttribute("crossorigin","anonymous"),t.appendChild(i),i}(n);!e.noChromeMode&&function(t,i){const e=document.createElement("div");e.style.top="0px",e.style.height=Et.HeaderHeight+"px",e.style.left="0px",e.style.right="0px",e.style.position="absolute",xt.getBRSValue(xt.Fluent2StyleIsEnabled)?e.style.backgroundColor="#FFFFFF":e.style.backgroundColor=i.ui&&i.ui.useNeutralColorInHeader?"#F3F2F1":"#3955A3",t.appendChild(e)}(s,t),(!e.noChromeMode||e.noChromeWithToolbar)&&function(t,i){const e=document.createElement("div");e.style.top=(t?0:Et.HeaderHeight)+"px",e.style.height="0px",e.style.left="0px",e.style.right="0px",e.style.position="absolute",e.style.backgroundColor="#E1E1E1",e.id="visio_fastview_toolbar_upper",i.appendChild(e);const s=document.createElement("div");s.style.top=(t?0:Et.HeaderHeight)+"px",s.style.height=Et.ToolbarHeightConsumption+"px",s.style.left="0px",s.style.right="0px",s.style.position="absolute",s.style.backgroundColor="#FFFFFF",s.id="visio_fastview_toolbar",i.appendChild(s)}(e.noChromeWithToolbar,s);const a=function(t,i){const e=i.appContext,s=document.createElement("div");return e.fastViewInfo.noChromeWithToolbar?s.style.top=Et.ToolbarHeightConsumption+"px":e.fastViewInfo.noChromeMode?s.style.top="0px":s.style.top=Et.RibbonHeightConsumption+Et.FishbowlBorderTop+"px",s.style.height=Et.ProgressImageHeight+"px",s.style.left="0px",s.style.right="0px",s.style.position="absolute",i.appContext.resource&&(s.style.backgroundImage=`url(${i.appContext.resource.getDelayLoadingGif()})`,s.style.backgroundRepeat="repeat-x"),t.appendChild(s),s}(s,t),h=function(t){const i=document.createElement("div");return i.style.height="0px",t.appendChild(i),i}(s),c=function(t){const i=document.createElement("div");return i.style.bottom="0px",i.style.height=Et.StatusbarHeight+"px",i.style.left="0px",i.style.right="0px",i.style.position="absolute",i.style.borderTopColor="#C6C6C6",i.style.borderTopWidth=Et.StatusbarBorderTop+"px",i.style.borderTopStyle="solid",i.style.backgroundColor="#FFFFFF",t.appendChild(i),i}(s);return i.appMode===Ft.EDIT&&function(t,i,e,s,o,n){(function(t,i,e,s){const o=s?Et.RibbonHeightNoChrome:Et.RibbonHeightEdit;t.style.top=o+"px",e.style.top=o+Et.FishbowlBorderTop+"px",t.style.left=Et.ShapePanelWidthWithBorder+"px",i.style.left=Et.ShapePanelWidthWithBorder+"px"})(t,e,s,o),function(t,i,e){t.style.top=i.style.top,t.style.position="absolute",t.style.height="auto",t.style.borderWidth=Et.ShapePanelBorderWidth+"px",t.style.borderRightStyle="solid",t.style.boxShadow="2px 1px 4px 0 rgba(0,0,0,0.13)",t.style.borderColor="#e1e1e1",t.style.backgroundColor="#f2f2f2",t.style.width=Et.ShapePanelWidthWithoutBorder+"px",t.style.bottom="0px",t.style.overflow="0",function(t,i){const e=document.createElement("div");e.style.top="50%",e.style.left="50%",e.style.position="absolute",e.style.transform="translateX(-50%) translateY(-50%)",e.style.fontSize="9pt",e.style.fontFamily='"Segoe UI", Arial, Verdana, sans-serif',t.appendChild(e);const s=document.createElement("img");s.style.cssFloat="left",s.style.height="16px",s.style.width="16px",s.setAttribute("crossorigin","anonymous"),i.appContext.resource?s.src=i.appContext.resource.getLoadingSpinnerGif():s.style.visibility="hidden",e.appendChild(s);const o=document.createElement("div");o.style.cssFloat="left",o.style.paddingLeft="10px",o.innerText="",e.appendChild(o)}(t,e)}(i,t,n)}(o,h,c,a,e.noChromeMode,t),t.container.element.appendChild(s),{fastViewContainer:s,fishBowlElement:o,pageElement:n,imageElement:r,shapePanelElement:h}}(t),a=ie(t);a.fishBowlElement=e,a.imageElement=i,a.pageElement=n,a.fastViewContainer=r;const h=t.appContext;h.fastViewBrowserCache&&h.fastViewBrowserCache.IsCacheAvailable()?h.fastViewBrowserCache.DecryptAndValidate((i,e)=>{try{a.imageElement.setAttribute("src","data:image/png;base64,{0}".replace("{0}",e)),a.imageLoaded=!0,a.docViewResponseText=i,a.docViewLoaded=!0,a.fastviewContentLoadedFromLocalcache=!0,a.fastViewImageDataFromCache=e,Xi(t)}catch(i){t.logger.ULS.ri(508045407,s.H,o.Error,"doc view parsing failed from cache with exception: "+C(i)),Ki(t)}},()=>{t.logger.ULS.ri(508045406,s.H,o.Error,"fastview browser cache decryption and validation failed"),h.fastViewBrowserCache.DeleteDocument(),Ki(t)}):(function(t){var i;const e=ie(t),{imageElement:n}=e;n.onload=()=>{e.imageLoaded=!0,Xi(t)},n.onerror=()=>{t.logger.ULS.ri(523531992,s.H,o.Error,"Fast View image request failed in JSAPI bootstrapper"),Ki(t)},n.src=Zi(null===(i=t.contentBundle)||void 0===i?void 0:i.url,At.FastViewImage)}(t),function(t){var i;const e=Zi(null===(i=t.contentBundle)||void 0===i?void 0:i.url,At.FastViewJson),n=ie(t);Ct.sendXmlHttpRequest("GET",e,!0,i=>{try{n.docViewResponseText=i,n.docViewLoaded=!0,Xi(t)}catch(i){t.logger.ULS.ri(508045405,s.H,o.Error,"doc view usage failed with exception: "+C(i)),Ki(t)}},()=>{t.logger.ULS.ri(508045404,s.H,o.Error,"doc view request failed in JSAPI bootstrapper"),Ki(t)},At.FastViewJson,t.logger)}(t))}(t)}catch(i){t.logger.ULS.ri(523531990,s.H,o.Error,"Failed to boot from the host cache: "+C(i)),Ki(t)}}}function Ki(t){const i=ie(t);i.fastViewContainer&&i.fastViewContainer.parentElement&&i.fastViewContainer.parentElement.removeChild(i.fastViewContainer),i.fastViewcontainerVisible=!1,t.appContext.fastViewPostMessageToWacFrameState.jsapiReadyToSendFastViewDataToWacFrame=!0,se(t)}function Xi(t){try{const i=ie(t),e=JSON.parse(i.docViewResponseText);if(i.fastViewCacheHit=!0,i.docViewLoaded&&i.imageLoaded&&t.state===vi.Booting&&!t.appContext.appFramePageViewLoaded){const n=function(t,i,e,s){const o=(e-96*Et.FishbowlMarginInches)/(96*t),n=(s-96*Et.FishbowlMarginInches)/(96*i);return Math.min(o,n)}(e.PageWidth,e.PageHeight,i.fishBowlElement.offsetWidth,i.fishBowlElement.offsetHeight);!function(t,i,e){const s=ie(t),o=e.PageWidth,n=e.PageHeight,{fishBowlElement:r,pageElement:a}=s,h=r.offsetWidth-96*o*i,c=r.offsetHeight-96*n*i;a.style.width=96*o*i+"px",a.style.height=96*n*i+"px",a.style.backgroundColor="white",Ot(t.appContext.appMode)||(a.style.borderColor="#C6C6C6",a.style.borderWidth="1px",a.style.borderStyle="solid",a.style.boxShadow="0px 0px 20px #C6C6C6"),a.style.position="absolute",a.style.top=c/2+"px",a.style.left=h/2+"px"}(t,n,e),i.imageElement.style.position="absolute",i.imageElement.style.left=96*e.OffsetX*n+"px",i.imageElement.style.top=i.pageElement.clientHeight-96*(e.Height+e.OffsetY)*n+"px",i.defaultImageHeight=i.imageElement.height,i.defaultImageWidth=i.imageElement.width,i.imageElement.width=96*e.Width*n,i.imageElement.height=96*e.Height*n,i.imageElement.style.visibility="visible",i.fastViewContainer.style.display="block",i.fastViewContainer.style.visibility="visible",i.fastviewShownFromHostCache=!0,i.fastViewPLTTime=R(),i.fastViewcontainerVisible=!0,t.appContext.fastViewPostMessageToWacFrameState.jsapiReadyToSendFastViewDataToWacFrame=!0,function(t){const i=ie(t);setTimeout(()=>{i.fastViewcontainerVisible&&(t.logger.ULS.ri(523089178,s.H,o.Warning,"[setTimeoutForRemovalOfFastView] Removing fastview screen as its > 15000 millisec."),Yi(t))},15e3)}(t),se(t)}else i.docViewLoaded&&i.imageLoaded&&t.logger.ULS.ri(523531993,s.H,o.Info,"FastView not shown. Conditions: "+JSON.stringify({SessionState:t.state,appFramePageViewLoaded:t.appContext.appFramePageViewLoaded}))}catch(i){t.logger.ULS.ri(508045403,s.H,o.Error,"fastview creation failed with exception: "+C(i))}}function Zi(t,i){if(!t||-1===t.indexOf("{0}"))throw new TypeError("invalid content URL");if(!i)throw new TypeError("invalid content id");return decodeURI(t).replace("{0}",i)}function Yi(t){window.setTimeout(()=>Ki(t),0)}function Qi(t){const i=ie(t),e=t.appInitDiagnostics;e.documentLoadedFromWopiPrecheckInfo=i.fastviewShownFromHostCache,i.fastviewShownFromHostCache&&(e.documentLoadedTime=i.fastViewPLTTime),e.cacheAboutToExpire=!1,i.fastViewCacheHit&&!e.cacheHit&&(e.cacheAboutToExpire=!0),e.cacheHit=i.fastViewCacheHit,kt(t.appUrl)&&(e.webAppFrameReinitialized=!0);const s=t.hostInitDiagnostics;s&&void 0===s.hostPageRedirectCount&&(s.hostPageRedirectCount=$t())}function te(t){var i,e,n,r;const a=t.appInitDiagnostics;if(!a)return;const h=t.appContext,c=ie(t);kt(t.appUrl)||ui(t.hostInitDiagnostics,a,t.logger);let d=!1;try{var l;d=null===(l=JSON.parse(c.docViewResponseText))||void 0===l?void 0:l.IsCompressed}catch(t){}var u,p;t.logger.ULS.ri(595981388,s.H,o.Info,JSON.stringify({BootDiagnostics:a,hostDiagnostics:t.hostInitDiagnostics,navigationStartTime:Lt(),isJSAPIV2:"true",localCacheHit:c.fastviewContentLoadedFromLocalcache,compressedView:d?"true":"false",backgroundBoot:kt(t.appUrl),appMode:h.appMode.toString()})),a.documentLoadedWithTabSwitch&&t.logger.ULS.ri(596457107,s.H,o.Info,"DOCUMENTLOADEDWITHTABSWITCH"),t.logger.ULS.ri(596457681,s.H,o.Info,JSON.stringify({hostInitDiagnostics:null!==(i=t.hostInitDiagnostics)&&void 0!==i?i:"N/A"})),window._pageTimings=null!==(e=window._pageTimings)&&void 0!==e?e:{},a.documentLoadedTime&&null!==(n=t.hostInitDiagnostics)&&void 0!==n&&n.hostInitializeCallTime&&(window._pageTimings.Visio_Perf_PLT=a.documentLoadedTime-(null===(u=t.hostInitDiagnostics)||void 0===u?void 0:u.hostInitializeCallTime)),a.appCompletedTime&&null!==(r=t.hostInitDiagnostics)&&void 0!==r&&r.hostInitializeCallTime&&(window._pageTimings.Visio_Perf_ILT=a.appCompletedTime-(null===(p=t.hostInitDiagnostics)||void 0===p?void 0:p.hostInitializeCallTime))}function ie(t){return t.appContext.fastViewInfo}function ee(t,i){var e;const s=t.appContext;return!(!t.contentBundle||!t.contentBundle.url)&&(!!t.container&&(!(null!==(e=t.wdParams)&&void 0!==e&&e.wdPBIView||t.appUrl.indexOf("wdPBIView")>=0)&&(!window.matchMedia("screen and (-ms-high-contrast: active)").matches&&(s.appMode===Ft.VIEW||!(s.appMode!==Ft.EMBED_VIEW&&s.appMode!==Ft.INTERACTIVE_PREVIEW||!xt.getBRSValue(xt.hostCacheForEmbedViewEnabledBRSKey))||s.appMode===Ft.EDIT&&!Dt(t.appUrl)&&(!kt(t.appUrl)||i)))))}function se(t,i=!1){const e=t.appContext.fastViewPostMessageToWacFrameState,n=ie(t);if(e.jsapiAlreadySentFastViewDataToWacFrame||!e.appFrameReadyToReceiveFastViewData)return;if(e.appFrameReadyToReceiveFastViewData&&i){const i={[At.FastViewImage]:void 0,[At.FastViewJson]:void 0};return t.container&&t.container.postMessage(rt.bn,i),e.jsapiAlreadySentFastViewDataToWacFrame=!0,void t.logger.ULS.ri(523368192,s.H,o.Info,"[sendFastViewDataToVisioAppFrame] force sending empty postmessage for fastview data after 5 sec wait time.")}if(e.appFrameReadyToReceiveFastViewData&&!e.jsapiReadyToSendFastViewDataToWacFrame)return t.logger.ULS.ri(523368193,s.H,o.Info,"[sendFastViewDataToVisioAppFrame] wac appframe is waiting for fastview data. jsapi is not yet ready to send it. Setting up 5 sec timer to revert if not done automatically. "),void setTimeout(()=>se(t,!0),5e3);const r=n.fastviewContentLoadedFromLocalcache?n.fastViewImageDataFromCache:Ht(n.imageElement,n.defaultImageWidth,n.defaultImageHeight);let a=n.docViewResponseText,h={[At.FastViewImage]:r,[At.FastViewJson]:a};t.container&&t.container.postMessage(rt.bn,h),e.jsapiAlreadySentFastViewDataToWacFrame=!0,t.logger.ULS.ri(523368194,s.H,o.Info,"[sendFastViewDataToVisioAppFrame] Sent fastview data to wac appframe. ")}function oe(t){var i,e;const s=t.appContext,o={},n={};let r=p(window.location.href,"teamsvisiomode");!s.wasDefaultedtoEdit&&t.host&&t.host.metaUiHostVersion&&!r&&null!==(i=t.rebootOverride)&&void 0!==i&&i.mode&&(r=t.rebootOverride.mode),r&&t.appUrl.indexOf("embed=1")<0&&("edit"===r.toLocaleLowerCase()&&s.appMode!==Ft.EDIT&&(l(o,"VisioView","EditView"),l(o,"wdIsModeSwitch","1"),s.appMode=Ft.EDIT),"view"===r.toLocaleLowerCase()&&s.appMode!==Ft.VIEW&&(l(o,"VisioView","ConsumptionView"),s.appMode=Ft.VIEW));const a=t.host.uiHostName;if(a&&"teams"===a.toLowerCase()&&l(o,"enableToolbarInTeams","true"),l(o,"pmOrigin",encodeURIComponent(c(window.location.href))),t.hostName&&l(o,"filesrc",encodeURIComponent(t.hostName)),s.appMode!==Ft.EDIT_NEW||t.wopi||l(o,"instantedit","1"),u(o,"sams"),xt.getBRSValue(xt.IsAtMentionsEnabled)){const i=p(window.location.href,"nav");i&&s.appMode===Ft.VIEW&&l(n,"nav",decodeURIComponent(i)),t.host.capabilities&&t.host.capabilities.atMentions&&l(n,"sams","1")}null!==(e=t.contentBundle)&&void 0!==e&&e.url&&(l(n,"bsdpm","true"),l(n,"dpmdv","true"));let h=void 0;return t.hostInitDiagnostics&&(h=t.hostInitDiagnostics.userClickTime,h||(h=t.hostInitDiagnostics.hostInitializeCallTime)),h||(h=(new Date).getTime()),l(n,"dct",h.toString()),l(n,"wde",s.wasDefaultedtoEdit.toString()),l(n,"highdpi",String(window.devicePixelRatio>1.25)),ee(t,!1)?l(o,"fastPreview","true"):l(o,"fastPreview","false"),kt(t.appUrl)&&u(o,"newsession"),{appPageName:"visioframe.aspx",queryParamsOverrides:o,postDataOverrides:n}}var ne;function re(t,i){const e=ie(t);if(!i)return;if(e.fastviewSavedToBrowserCache)return;const s=parseInt(i[Gt.maxStorageQuotaSettingName].toString(),10),o=parseInt(i[Gt.minEvictTimePeriodSettingName].toString(),10);if(window.setTimeout(()=>Gt.EvictStaleCache(1024*s*1024,24*o*60*60*1e3,t.logger),Gt.cacheEvictIdleTimeInMs),!e.fastviewShownFromHostCache)return;const n=e.fastviewContentLoadedFromLocalcache?e.fastViewImageDataFromCache:Ht(e.imageElement,e.defaultImageWidth,e.defaultImageHeight);n&&(window.setTimeout(()=>{var i;return null===(i=t.appContext.fastViewBrowserCache)||void 0===i?void 0:i.SaveDocument(e.docViewResponseText,n)},Gt.documentSaveIdleTimeInMs),e.fastviewSavedToBrowserCache=!0)}function ae(t){!function(t){t.addActionHandler(Z.vs,(i,e)=>{xt.handleVisioBRS(e,t.logger)}),t.addActionHandler(Z.Ss,(t,i)=>{!function(t){if(t&&t.License){const i=xt.getBRSValue(xt.DTEEnabledForPlan0BRSKey);"plan1"===t.License||i&&"plan0"===t.License?localStorage.setItem("enableDTE","true"):localStorage.setItem("enableDTE","false")}}(i)}),t.addActionHandler(Z.Cs,(i,e)=>{t.appContext.appFramePageViewLoaded=!0;const s=t.appInitDiagnostics;e&&e.Diagnostics&&Object.keys(e.Diagnostics).forEach(t=>s[t]=e.Diagnostics[t])}),t.addActionHandler(Z.Es,i=>{!function(t){var i;let e=window.location.href;e=m(e,"wdreloadsessionid",t.sessionId,!0);const n=t.sessionId;let r=1;null!==(i=t.wdParams)&&void 0!==i&&i.wdreloadcount&&(r=parseInt(t.wdParams.wdreloadcount,10)+1),r>xt.getIntegerBRSValue(xt.ReloadOnScriptFailMaxLimitBRSKey,3)?t.logger.ULS.ri(523531988,s.K,o.Error,"Visio Boot failed for WACSessionID: "+n+" after"+r+"retries"):(e=m(e,"wdreloadcount",String(r),!0),t.logger.ULS.ri(523531989,s.K,o.Warning,"Refreshing VisioFrame for WACSessionID: "+n+", currentReloadCount: "+r+", UriLen: "+e.length),t.logger.ULS.flush(),window.location.href=e)}(t)}),xt.getBRSValue(xt.CoCommentingAcrossViewAndEditEnabled)&&t.addActionHandler(Z.Ce,(i,e)=>{!function(t,i){t.appContext.commentContext=i}(t,e)}),t.addActionHandler(Z.ys,(i,e)=>{!function(t,i){let e=window.location.href;"VIEW"===i.toMode||"EDIT"===i.toMode?(e=m(e,"teamsvisiomode",i.toMode,!0),xt.getBRSValue(xt.IsFormulaeSerializationRollbackEnabled)&&t.appContext.appMode===Ft.EDIT&&"1"===i.wdDisableFormulae&&(e=m(e,"wdDisableFormulae","1",!0)),window.location.href=e):t.logger.ULS.ri(593622414,s.K,o.Warning,"Invalid options received in Visio_DocReboot_HostNav message")}(t,e)}),t.addActionHandler(Z.Vs,(i,e)=>{!function(t,i){Yi(t),re(t,i.Settings)}(t,e)}),t.addActionHandler(Z.Fs,i=>{t.appContext.fastViewPostMessageToWacFrameState.appFrameReadyToReceiveFastViewData=!0,se(t)})}(t),t.appContext.appMode===Ft.VIEW?function(t){t.addActionHandler(Z.bs,(i,e)=>{!function(t,i){var e;t.logger.ULS.ri(526455301,s.H,o.Info,"[handleModeSwitchFromViewerFrame] Received switch mode post message from frame with App mode : "+(null===(e=t.appContext)||void 0===e?void 0:e.appMode.toString())),t.container&&t.container.postMessage(rt.vn,void 0),t.backgroundSession?(t.backgroundSession.run(ne.wl,void 0),t.backgroundSession.run(ne.fl,i)):t.container&&t.container.postMessage(rt.In,void 0)}(t,e)}),t.addActionHandler(Z.Is,i=>{!function(t){t.logger.ULS.ri(526455300,s.H,o.Info,"[handleViewModeCLT] View mode CLT complete message received"),t.container&&t.container.postMessage(rt.gn,void 0),function(t){return!!xt.getBRSValue(xt.backgroundEditSessionEnabledKey)&&(!t.host.metaUiHostVersion||xt.getBRSValue(xt.IsTeamsBackgroundFrameFixEnabled))}(t)&&function(t){const i=t.appContext;if(i.appMode!==Ft.VIEW)throw new TypeError("Booting up background editor in non viewer session");if(!i.sessionBootParams)return;const e={...i.sessionBootParams};let n=e.appUrl;if(void 0===n)throw new TypeError("applicationUrl is empty");if("consumptionview"!==p(n.toLowerCase(),"visioview"))throw new TypeError("applicationUrl does not have VisioView=ConsumptionView query param");n=m(n,"VisioView","EditView",!0),n=m(n,"backgroundsession","1",!0),e.appUrl=m(n,"wdIsModeSwitch","1",!0);const[r]=E();e.hostGeneratedSessionId=r,e.preseededSession=void 0,t.logger.ULS.ri(521176415,s.H,o.Info,"[createBackgroudEditorSession] edit session associated: "+r),e.rebootOverride=void 0,t.backgroundSession=t.application.createSession({hostSessionId:t.hostSessionId}),t.backgroundSession.boot(e),t.backgroundSession.run(ne.gl,t.session)}(t)}(t)}),t.addActionHandler(ne.vl,i=>{t.container&&t.container.postMessage(rt.In,void 0)}),t.addActionHandler(Z.As,i=>{!function(t){t.backgroundSession?t.backgroundSession.dispose():t.logger.ULS.ri(523531987,s.K,o.Warning,"handleVisioViewDisposeBkgFrame backgroundEditApp is null")}(t)})}(t):function(t){t.addActionHandler(ne.fl,(i,e)=>{!function(t,i){var e,n;null===(e=t.bootHeartBeat)||void 0===e||e.restart();let r=0;null===(n=t.container)||void 0===n||n.setVisibility(!1),function t(i,e,s,o,n,r,a=0){a>=10&&n("[workWithRetry] max recursion depth of 10 reached. Stopping retry and failing"),e()||(s()?(o(),i(),setTimeout(()=>t(i,e,s,o,n,r,a+1),r())):n("[workWithRetry] max retries configured reached. Stopping retry and failing"))}(()=>{t.container&&t.container.postMessage(rt.Sn,i)},()=>t.appContext.modeSwitchAckReceived,()=>r<3,()=>{r++},i=>{t.logger.ULS.ri(522840264,s.H,o.Info,`[handleBootBackgroundClient] ${i}. Falling back to legacy switch`);const e=t.appContext.activeSession;e&&e.run(ne.vl,void 0)},()=>1e3)}(t,e)}),t.addActionHandler(ne.gl,(i,e)=>{t.appContext.activeSession=e}),t.addActionHandler(Z.Ts,(i,e)=>{!function(t,i){var e,n;if(t.logger.ULS.ri(526455302,s.H,o.Info,"[handleModeSwitchAckFromEditor] Received mode switch ack from Editor"+i),t.appContext.modeSwitchAckReceived=!0,null==i||!i.IsSuccess){const i=t.appContext.activeSession;return void(i&&i.run(ne.vl,void 0))}const r=t.appContext;null==r||null===(e=r.activeSession)||void 0===e||e.run(nt.dispose,{notDisposeBackgroundSession:!0},void 0),Li(t.logger,Vt.JSAPIV2),Ji(t.logger,yt.BOOTSTART),t.raiseEvent(Ii.FrameChanged,null===(n=t.container)||void 0===n?void 0:n.frameId)}(t,e)}),t.addActionHandler(ne.wl,i=>{t.diagnostics.appInitDiagnostics&&(t.diagnostics.appInitDiagnostics.modeSwitchClickTime=R()),zi(t,!0)}),t.addActionHandler(Z._s,(i,e)=>{!function(t,i){const e=t.appContext;if(Dt(t.appUrl))return;let s="";i&&i.RefreshOrigin&&(s=i.RefreshOrigin);let o=window.location.href;xt.getBRSValue(xt.IsToastUserFixEnabledBRSKey)&&o&&(o=f(o,"wdToastUser")),xt.getBRSValue(xt.IsContextAppRefreshFixEnabledBRSKey)&&o&&(o=f(o,"wdActivePageId"),o=f(o,"wdPageScale"),o=f(o,"wdPageCenterX"),o=f(o,"wdPageCenterY")),e.appMode!==Ft.EDIT&&e.appMode!==Ft.EDIT_NEW||(o&&(o=m(o,"action","edit",!0),s&&(o=m(o,"OR",s,!0)),e.appMode===Ft.EDIT_NEW&&(o=m(o,"wdNewAndOpenCt","0",!0))),Bt(o))}(t,e)})}(t)}function he(t){zi(t),ae(t)}function ce(t){return{permissionsPolicy:(i=t.appBaseUrl,`microphone ${i}; autoplay ${i}; camera ${i}; clipboard-read ${i}; clipboard-write ${i}; keyboard-map ${i}; display-capture ${i}`),isInvisible:t.appUrl.indexOf("backgroundsession")>-1,enforceSameWindow:!0};var i}function de(t,i){t.appContext.appMode===Ft.VIEW&&xt.getBRSValue(xt.CoCommentingAcrossViewAndEditEnabled)&&function(t){t.logger.ULS.ri(523352026,s.H,o.Info,"Sending comment context message to frame"),void 0!==t.appContext.commentContext&&(t.container&&t.container.postMessage(rt.tn,t.appContext.commentContext),t.appContext.commentContext=void 0)}(t),Yi(t),re(t,i.Settings),Qi(t),te(t),Ji(t.logger,yt.BOOTSUCCESS)}function le(t){Yi(t),Qi(t),te(t),Ji(t.logger,yt.BOOTFAILED)}function ue(t,i){Ji(t.logger,yt.BOOTEXCEPTION)}function pe(t){Ji(t.logger,yt.BOOTTIMEOUT)}function me(t){var i;kt(t.appUrl)&&(null===(i=t.bootHeartBeat)||void 0===i||i.stop())}function we(){return 12e4}function fe(t,i){if(xt.getBRSValue(xt.instantCreateNewLocalStorageKey)){var e,s,o;if(null!==(e=i.bootParams)&&void 0!==e&&e.isNewFile)return!(null===(o=i.wdParams)||void 0===o||!o.wdTpl||xt.getBRSValue(xt.InstantForAllTemplatesEnabledBRSKey));if(-1!==(null===(s=i.appUrl)||void 0===s?void 0:s.indexOf("wdasp")))return!xt.getBRSValue(xt.InstantForAllTemplatesEnabledBRSKey)}return!0}function ge(t,i){Ki(t);const e=t.appContext;var s;e.sessionBootParams=void 0,e.appFramePageViewLoaded=!1,e.modeSwitchAckReceived=!1,Gt.dispose(),e.fastViewInfo={fastViewContainer:void 0,fishBowlElement:void 0,imageElement:void 0,pageElement:void 0,docViewLoaded:!1,imageLoaded:!1,docViewResponseText:void 0,fastViewcontainerVisible:!1,fastviewShownFromHostCache:!1,fastViewPLTTime:void 0,defaultImageWidth:void 0,defaultImageHeight:void 0,fastviewContentLoadedFromLocalcache:!1,fastViewImageDataFromCache:void 0,fastViewCacheHit:!1,noChromeMode:!1,noChromeWithToolbar:!1,fastviewSavedToBrowserCache:!1},xt.dispose(),null!=i&&i.notDisposeBackgroundSession||null===(s=t.backgroundSession)||void 0===s||s.dispose()}!function(t){t.fl="Visio_BootBackgroundClientApp",t.gl="Visio_SaveActiveSessionReference",t.wl="Visio_ShowFastViewInBackgroundSession",t.vl="Visio_RelayFallBackToLegacySwitchToActiveSession"}(ne||(ne={}));const ve=()=>[{[Si.appReboot]:Fi,[Si.boot]:Ri,[Si.closeTab]:xi,[Si.createNew]:Wi,[Si.dispose]:Oi,[Si.frameTrust]:Bi,[Si.getAuthToken]:Mi,[Si.getHostKeyValue]:xi,[Si.handleBootState]:Ni,[Si.postWacToken]:Hi,[Si.rename]:xi,[Si.setOverlayContent]:Kt,[Si.setWacFlightValue]:ri,[Si.storeHostKeyValue]:xi,[Si.switchMode]:xi,[Si.updateBootComplete]:xi},{[Si.boot]:{initializeAppContext:Gi,buildAppBasePath:ji,buildRemoteTelemetryUrl:qi,buildBootRequestParams:oe,beforeContainerBoot:he,buildContainerBootParams:ce,onSuccess:de,onFailure:le,onException:ue,onTimeout:pe,beforeBootCompletionMessage:me,overrideBootTimeout:we},[Si.dispose]:{disposeAppSpecificResources:ge},[Si.createNew]:{fallBackToSingleStepBootFlow:fe}}];var Se;!function(t){t[t.NotSupported=0]="NotSupported",t[t.SameDocOnly=1]="SameDocOnly",t[t.AnyDoc=2]="AnyDoc",t[t.OtherMode=4]="OtherMode"}(Se||(Se={}));const Ie=new class{GetVersion(){return T()}GetMinContentVersion(){return pi.GetMinContentVersion()}Prefetch(t){}InitializeWopiPending(t){let i=void 0,e=void 0,n=Ft.INVALID;try{let[h,d]=E();if(V(gt(t.ApplicationUrl,h),"Visio","init"),xt.getBRSValue(xt.AppShellPrebootEnabledBRSKey)&&this.Sl)return void 0!==this.Il&&void 0!==t.NewFileTemplateSource&&void 0!==t.NewFileTemplateSource.DocUniqueId&&this.Il.updateCreateNewTemplateInfo(t.NewFileTemplateSource.DocUniqueId),this.Sl=!1,this.Il;t.ApplicationUrl.indexOf("wdasp=1")>=0&&(this.Sl=!0),function(t){if(void 0===t)throw new TypeError("initParams");const i=t.Container;if(void 0===i||void 0===i.appendChild)throw new TypeError("Container");const e=t.SessionInformation;if(void 0===e||void 0===e.HostName||void 0===e.HostSessionId||void 0===e.UserId)throw new TypeError("SessionInformation");const s=t.ApplicationUrl;if(void 0===s||"string"!=typeof s)throw new TypeError("ApplicationUrl");const o=t.WopiPrecheckInfo;if(void 0===o||void 0===o.FileName)throw new TypeError("WopiPrecheckInfo");if(void 0===t.FnOnInitializeSuccess)throw new TypeError("FnOnInitializeSuccess");if(void 0===t.FnOnInitializeFailure)throw new TypeError("FnOnInitializeFailure")}(t);const l=p(window.location.href,"wdreloadsessionid"),u=p(window.location.href,"wdreloadcount");l&&u&&(h=l),i=O({remoteUlsEndpoint:vt(t.ApplicationUrl)+"RemoteUls.ashx",sessionId:h,uploadCadenceInMs:gi});const f=r(t.ApplicationUrl)?di.Fastfood:a(t.ApplicationUrl)?di.MSIT:di.Production;xt.initialize(f,i);const g=function(t,i,e,s,o,n=!1){t.SessionInformation.IsCore&&(t.SessionInformation.HideViewerToolbar=!0),function(t,i){const e=t.SessionInformation;if(e.WdParams||(e.WdParams={}),e.WdParams.wd)return;i.substring(1).split("&").filter(t=>{if(0===t.indexOf("wd")){const i=t.split("=");i[0].length>2&&(e.WdParams[i[0]]=i[1])}});const s=t.RebootOverrideData;s&&s.previousSessionId&&(e.WdParams.wdprevioussession=s.previousSessionId),wt.Instance.getBooleanSetting("OneNoteHostSessionOriginFixEnabled")}(t,window.location.search);const r=o||new ct("Visio",e),a=vt(t.ApplicationUrl),h={container:t.Container,sessionInformation:t.SessionInformation,applicationUrl:t.ApplicationUrl,wopiPrecheckInfo:t.WopiPrecheckInfo,applicationCustomSettings:t.ApplicationCustomSettings,diagnostics:{HostInitDiagnostics:t.Diagnostics,ClientDiagnostics:K(),AppInitDiagnostics:{officeSessionId:i,officeBootstrapperVersion:T(),hostName:t.SessionInformation.HostName},SessionTraces:{}},fnOnInitializeSuccess:t.FnOnInitializeSuccess,fnOnInitializeFailure:t.FnOnInitializeFailure,sessionId:i,applicationBasePath:a,remoteTelemetryUrl:ft(a,i),wopiInfo:t.WopiInfo,forceSingleStepBoot:n,isCreateNew:t.WopiPrecheckInfo.IsNewFile||v(t.ApplicationUrl,"new"),featureManager:s||dt(t.FnIsFeatureEnabled,e),ai:r,newFileTemplateSource:t.NewFileTemplateSource,rebootOverrideData:t.RebootOverrideData,pageStateObserver:new ut(e,!0)};return h.fnOnAppModeSwitched=t.FnOnAppModeSwitched,h}(t,h,i);let S=!1;this.bl=xt.getBRSValue(xt.DTEEnabledBRSKey),xt.getBRSValue(xt.IsTeamsBackgroundFrameFixEnabled)?this.Tl=xt.getBRSValue(xt.backgroundEditSessionEnabledKey):this.Tl=!t.SessionInformation.MetaUiHostVersion&&xt.getBRSValue(xt.backgroundEditSessionEnabledKey),t.SessionInformation.MetaUiHostVersion&&(this._n={}),this._l(i,g),xt.getBRSValue(xt.JsapiV1DiagnosticFixEnabled)&&g.diagnostics.HostInitDiagnostics&&(g.diagnostics.HostInitDiagnostics.hostInitializeCallTime=R(),void 0===g.diagnostics.HostInitDiagnostics.hostPageRedirectCount&&(g.diagnostics.HostInitDiagnostics.hostPageRedirectCount=$t())),i.ULS.ri(596457679,s.K,o.Info,"Bootstrapper Init Time: "+R()),i.ULS.ri(595937312,s.K,o.Info,JSON.stringify(d));const I=function(t,i){const e={...i};delete e.UserId,delete e.OwnerId,delete e.SiteId,delete e.WebId,delete e.Upn,delete e.TenantId,delete e.UiHostTabId,delete e.OriginalWdParam,delete e.WdParams;const s=e,o=i.WdParams?JSON.parse(JSON.stringify(i.WdParams).toLowerCase()):{};s.WdParams={},["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf"].forEach(t=>{o[t]&&(s.WdParams[t]=o[t])});const n=/^\w{8}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{12}$/i;return s.WdParams.wdprevioussession&&!n.test(s.WdParams.wdprevioussession)&&delete s.WdParams.wdprevioussession,s.WdParams.wdpreviouscorrelation&&!n.test(s.WdParams.wdpreviouscorrelation)&&delete s.WdParams.wdpreviouscorrelation,s.UiEmbedMode=v(t,"uiembed"),s.UiHostName=p(t,"uih")||"N/A",s.HostDomain=location?location.hostname:"",s}(g.applicationUrl,g.sessionInformation);i.ULS.ri(596457680,s.K,o.Info,JSON.stringify({hostSessionInformation:I,clientSignals:K()})),i.ULS.ri(596457681,s.K,o.Info,JSON.stringify({hostInitDiagnostics:g.diagnostics.HostInitDiagnostics?g.diagnostics.HostInitDiagnostics:"N/A"}));const b=c(t.ApplicationUrl),_=new Tt(b,i);_.activate(),_.registerMessagePayloadHandler(xt.fromWacVisioFrameBRS,t=>{xt.handleVisioBRS(t,i)}),_.registerMessagePayloadHandler(Z.Ss,t=>{this.Cl(t)}),g.applicationUrl.indexOf("VisioView=ConsumptionView&embed=1")>=0?n=Ft.EMBED_VIEW:g.applicationUrl.indexOf("VisioView=ConsumptionView&InteractivePreview=1")>=0?n=Ft.INTERACTIVE_PREVIEW:g.applicationUrl.indexOf("VisioView=ConsumptionView")>=0?n=Ft.VIEW:g.applicationUrl.indexOf("VisioView=EditView&New=1")>=0?n=Ft.EDIT_NEW:g.applicationUrl.indexOf("VisioView=EditView")>=0?n=Ft.EDIT:(n=Ft.INVALID,i.ULS.ri(596132872,s.K,o.Error,"Invalid Visio Frame Url")),xt.getBRSValue(xt.AppShellPrebootEnabledBRSKey)&&g.applicationUrl.indexOf("wdasp=1")>=0&&(n=Ft.EDIT_NEW,g.applicationUrl=m(g.applicationUrl,"VisioView","EditView",!0),g.applicationUrl=m(g.applicationUrl,"New","1",!1));let C=w(window.location.href).teamsvisiomode;g.sessionInformation.MetaUiHostVersion&&!C&&g.rebootOverrideData&&g.rebootOverrideData.mode&&(C=g.rebootOverrideData.mode),C&&g.applicationUrl.indexOf("embed=1")<0&&("edit"===C.toLocaleLowerCase()&&n!==Ft.EDIT&&(g.applicationUrl=m(g.applicationUrl,"VisioView","EditView",!0),g.applicationUrl=m(g.applicationUrl,"wdIsModeSwitch","1",!0),n=Ft.EDIT),"view"===C.toLocaleLowerCase()&&n!==Ft.VIEW&&(g.applicationUrl=m(g.applicationUrl,"VisioView","ConsumptionView",!0),n=Ft.VIEW));const A=p(g.applicationUrl,"uih"),F=A&&"teams"===A.toLowerCase();if(this.bl){const i=p(window.location.href,"action");let e=!1;if(F){const t=w(window.location.href).teamsvisiomode;e=n===Ft.VIEW&&!t}const s=Dt(g.applicationUrl)||Ut(g.applicationUrl);let o=!1;xt.getBRSValue(xt.DTESafariFixEnabledBRSKey)&&N()===U.Safari&&(o=!0),o||"default"!==i&&!e&&(!xt.getBRSValue(xt.DTESharingFixEnabledBRSKey)||t.WopiPrecheckInfo.ReadOnly||s||F||0!==i.length)||"true"===localStorage.getItem("enableDTE")&&(g.applicationUrl=m(g.applicationUrl,"VisioView","EditView",!0),n=Ft.EDIT,S=!0)}if(F&&(i.ULS.ri(545813153,s.K,o.Info,"Show Visio viewer react toolbar in Teams"),g.applicationUrl=m(g.applicationUrl,"enableToolbarInTeams","true")),xt.getBRSValue(xt.TypeScriptLocalStorageEnabled)){const t=localStorage.getItem("UseTypeScriptJS");t&&(g.applicationUrl=m(g.applicationUrl,"wdVisioTS",t))}g.applicationUrl=this.El(g.applicationUrl);const y=new wi;if(void 0!==t.BootstrapperUrl?e=new mi(t.BootstrapperUrl,t.BootstrapperUrl):i.ULS.ri(596457563,s.K,o.Warning,"Could not determine visio resources URL"),Jt(),this.Tl&&n===Ft.VIEW){const t=new fi(g,i,y,e,n,_,this._n);return i.ULS.ri(595682587,s.K,o.Info,"Building VisioApplication in appMode "+n),this.Il=t.buildApplication(),this.Il}return i.ULS.ri(595682588,s.K,o.Info,`BRS isUnifiedBackgroundAppBRSEnabled: ${this.Tl}, appMode: ${n}`),void 0!==t.BootstrapperUrl&&this.Preconnect(t.BootstrapperUrl),this.Il=new pi(g,i,y,e,n,this._n,_,void 0,ci.Active,S),this.Il.addTimerTagForBoot(12e4),this.Il.Boot(),this.Il}catch(e){return i&&(i.ULS.ri(596464067,s.K,o.Error,`${st.AppInitError}: ${C(e)}`),i.ULS.flushOnClose()),void(t&&(t.ApplicationUrl&&V(gt(t.ApplicationUrl,void 0),"Visio","bootException"),t.FnOnInitializeFailure&&t.FnOnInitializeFailure({errorType:st.AppInitError,errorObject:e})))}}Preconnect(t){const i=Y();i.shouldPreconnect()&&i.preconnect(t)}constructor(){this._n={},this.Sl=!1,this._l=(t,i)=>{!function(t){return!(!Mt(t,"wdreloadsessionid")||!Mt(t,"wdreloadcount"))}(i)?t.ULS.ri(596464066,s.K,o.Info,"VisioBootstrapper - initializing session. Build version: "+this.GetVersion()):t.ULS.ri(590357217,s.K,o.Info,"VisioBootstrapper - Initializing reloaded session.  current Reload count: "+Nt(i,"wdreloadcount")+" Build version: "+this.GetVersion())},this.Cl=t=>{if(t&&t.License){const i=xt.getBRSValue(xt.DTEEnabledForPlan0BRSKey);"plan1"===t.License||i&&"plan0"===t.License?localStorage.setItem("enableDTE","true"):localStorage.setItem("enableDTE","false")}},this.El=t=>m(m(t,"jsApi","1"),"jsapiver","v1")}},be=t=>new Ai(t,{name:"Visio"},ve)}});
//# sourceMappingURL=visio.boot.8092be7dea115e54ead5.js.map